<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2015-10-06 Tue 11:51 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Notes on creating spectral maps from Orion West slit spectra</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="William Henney" />
<style type="text/css">
<!--/*--><![CDATA[/*><!--*/
html {
    font-family: Lucida Grande, Tahoma, Arial, Helvetica, sans-serif;
    font-size: 11pt;
    /* color:  rgb(224, 224, 224); */
    /* background: rgb(48, 48, 48); */
}

/* Links */
a:link {color: #333399; }
a:visited {color: #777788; }
a:hover {color: #2222ff; }


/* 08 Mar 2015 - we want more definite distinguishing of blockquotes */
blockquote {
    background: #E3E3E3;
    font-size: 90%
}

/* Added by Will 03 Sep 2007 */
li {padding: 4px; }

/* Added by Will 08 Oct 2007 */ 

/* Headings shamelessly copied from MoinMoin theme "sinorca4moin" by David Linke*/

h1, h2, h3, h4, h5 {
	margin: 1em 0 0.5em 0;
	padding: 0.5em 0.5em 0.5em 0.5em;
        font-weight: bold;
	/* Why did I remove the color? */
	/* background-color: #fafada; */
	line-height: 1.2em;
}	

/* h5, h6 { */
/*     border-bottom: 1px dashed rgb(135,135,135); */
/* }   */
/* h1, h2, h3, h4 { */
/*     /\* border-left: 1px solid rgb(135,135,135); *\/ */
/*     border-bottom: 2px solid rgb(135,135,135); */
/* }   */

h1, h2, h3, h4 {
    color: #f0f0f0;
    background-color: #404040;
}
h4 {
    color: #f0f0f0;
    background-color: #606060;
}
h5, h6 {
    color: #f0f0f0;
    background-color: #808080;
}
h1 {font-size: 140%;}
h2 {font-size: 120%;}
h3, h4, h5, h6 {font-size: 100%;}
h6 {font-style: italic;}

p {margin: 0.5em 0.0em;}
/* .src:before {  */
/*     background: #3F3F3F; */
/*     border-right: 1px solid #DCDCDC; border-bottom: 1px solid #DCDCDC; */
/* } */

.src {
    background: #4F4F4F;
    color: #ECECEC;
}
.example, thead {
    background: #E3E3E3;
}

pre.src:before {
    color: black;
}

pre.src {
    overflow: auto;
}

/* pre.src-python:before { content: 'Python'; } */

.wjhfig {
    background-color: #eee;
    padding: 10pt;
    margin: 10pt;
}
.figure, img {
    padding: 0pt;
    margin: 0pt;
}

/* Make sure paragraphs are no thinner than a certain width, even if
   there is a floating div eating up their space - based on this tip:
   http://css-tricks.com/minimum-paragraph-widths */ 
/* p:before { */
/*   content: ""; */
/*   width: 20em; */
/*   display: block; */
/*   overflow: hidden; */
/*   /\* For Demonstration *\/ */
/*   /\* border: 1px solid green; *\/ */
/* } */

/* ul { */
/*     /\* try and fix item indentation when the list is to the right pf a */
/*        "float:left" div.  Initially inspired by advice from */
/*        http://wordpress.org/support/topic/left-float-and-bullet-lists-not-playing-well-together */
/*        although in the end I had to do things differently*\/ */
/*     list-style: inside; */
/*     text-indent: 10pt; */
/* } */
/* ul > li > ul { text-indent: 20pt; } */
/* ul > li > ul > li > ul { text-indent: 30pt; } */

.src, .example, table {
    font-size: 80%;
}

tbody {
    background-color: #fafada;
    /* background-color: rgb(250, 250, 200); */
}


#table-of-contents {
    background-color: #f0f0f0;
}




/*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Notes on creating spectral maps from Orion West slit spectra</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline30">1. <span class="todo nilTODO">TODO</span> New general version of the slit flux calibration and astrometry</a>
<ul>
<li><a href="#orgheadline7">1.1. Outline of steps</a></li>
<li><a href="#orgheadline14">1.2. Table of all slits</a>
<ul>
<li><a href="#orgheadline9">1.2.1. Different binning between image and spectrum</a></li>
<li><a href="#orgheadline10">1.2.2. <span class="todo nilTODO">TODO</span> Allow for offsets perpendicular to slit</a></li>
<li><a href="#orgheadline13">1.2.3. <span class="done nilDONE">DONE</span> Problems with the flux zero-point of the spectra</a>
<ul>
<li><a href="#orgheadline11">1.2.3.1. Script to fix the 2007 bias subtractions</a></li>
<li><a href="#orgheadline12">1.2.3.2. <span class="done nilDONE">DONE</span> Script to cut out the ha and nii spectra from the 2015 slits</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline28">1.3. Program to perform flux calibration: slit-calibration.py</a>
<ul>
<li><a href="#orgheadline15">1.3.1. Imports</a></li>
<li><a href="#orgheadline16">1.3.2. Read in the table of all slits</a></li>
<li><a href="#orgheadline17">1.3.3. Fits files for the spectra and image+slit</a></li>
<li><a href="#orgheadline18">1.3.4. Construct the synthetic slit from the reference image</a></li>
<li><a href="#orgheadline8">1.3.5. Find the world coordinates of each pixel along the slit</a></li>
<li><a href="#orgheadline20">1.3.6. Package up the slit coordinates for use in a FITS header</a></li>
<li><a href="#orgheadline21">1.3.7. Fit Chebyshev polynomials to along-slit variation</a></li>
<li><a href="#orgheadline22">1.3.8. Make some useful and pretty plots</a></li>
<li><a href="#orgheadline23">1.3.9. Use command line argument to restrict which datasets are processed</a></li>
<li><a href="#orgheadline26">1.3.10. <span class="todo nilTODO">TODO</span> Remove background and sum over wavelength across line</a>
<ul>
<li><a href="#orgheadline25">1.3.10.1. Original version</a></li>
</ul>
</li>
<li><a href="#orgheadline19">1.3.11. Loop over the slit positions and do the stuff</a></li>
<li><a href="#orgheadline27">1.3.12. Test what is going on</a></li>
</ul>
</li>
<li><a href="#orgheadline29">1.4. Run slit-calibration.py</a></li>
</ul>
</li>
<li><a href="#orgheadline52">2. Fix the issue with the [N II]/Ha ratio</a>
<ul>
<li><a href="#orgheadline36">2.1. <span class="done nilDONE">DONE</span> <code>[1/1]</code> Program to check the [N II]/Ha ratios: slit-ratio-check.py</a>
<ul>
<li><a href="#orgheadline31">2.1.1. Re-use stuff from slit-calibration.py</a></li>
<li><a href="#orgheadline32">2.1.2. Convert wavelength to pixel</a></li>
<li><a href="#orgheadline33">2.1.3. Make a sensible WCS (even if wavelength info missing)</a></li>
<li><a href="#orgheadline24">2.1.4. <span class="done nilDONE">DONE</span> Extract profile along slit for an isolated line</a></li>
<li><a href="#orgheadline34">2.1.5. Find the celestial coordinates along the slit by using the WCS of the calibrated spectrum</a></li>
<li><a href="#orgheadline35">2.1.6. Loop over all the slits and check the ratios</a></li>
</ul>
</li>
<li><a href="#orgheadline46">2.2. Check the pixel bounds for bg and line</a>
<ul>
<li><a href="#orgheadline37">2.2.1. Script to check the grating angles and other observational parameters</a></li>
<li><a href="#orgheadline38">2.2.2. 2006-02 dataset</a></li>
<li><a href="#orgheadline39">2.2.3. 2007-01b dataset</a></li>
<li><a href="#orgheadline40">2.2.4. 2007-01 dataset</a></li>
<li><a href="#orgheadline41">2.2.5. 2010-01 dataset</a></li>
<li><a href="#orgheadline42">2.2.6. 2013-02</a></li>
<li><a href="#orgheadline43">2.2.7. 2013-12</a></li>
<li><a href="#orgheadline44">2.2.8. 2015-02</a></li>
<li><a href="#orgheadline45">2.2.9. Looking at the calibrated spectra</a></li>
</ul>
</li>
<li><a href="#orgheadline47">2.3. Run slit-ratio-check.py</a></li>
<li><a href="#orgheadline51">2.4. Looking for more external constraints on the [N II]/Ha ratios</a>
<ul>
<li><a href="#orgheadline50">2.4.1. WFPC2 mosaic</a>
<ul>
<li><a href="#orgheadline48">2.4.1.1. Inferences from the mosaic</a></li>
<li><a href="#orgheadline49">2.4.1.2. Make a ratio map from f658n and f656n</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline56">3. <span class="done nilDONE">DONE</span> <code>[2/2]</code> Final tweaks to the zero level - fit 2D Chebyshev</a>
<ul>
<li><a href="#orgheadline54">3.1. Program to fit 2D Chebyshev to so-called continuum: chebfit2d.py</a></li>
<li><a href="#orgheadline55">3.2. Test the chebyshev fitting</a></li>
<li><a href="#orgheadline53">3.3. Apply to all the slits</a></li>
</ul>
</li>
<li><a href="#orgheadline71">4. <span class="done nilDONE">DONE</span> Back-propagate the heliocentric velocities to the spectra</a>
<ul>
<li><a href="#orgheadline58">4.1. Program to add a better wcs to the spectra: spec_augment_wcs.py</a></li>
<li><a href="#orgheadline59">4.2. Test the addition of the <code>V</code> WCS</a></li>
<li><a href="#orgheadline60">4.3. Add the VHEL and pixel WCS to all the spectra</a></li>
<li><a href="#orgheadline70">4.4. Displaying the new calibrated spectra in DS9</a>
<ul>
<li><a href="#orgheadline61">4.4.1. Delete all exisiting frames</a></li>
<li><a href="#orgheadline62">4.4.2. General function for displaying a bunch of spectra</a></li>
<li><a href="#orgheadline67">4.4.3. Trying out the spectra display</a>
<ul>
<li><a href="#orgheadline63">4.4.3.1. Horizontal western slits</a></li>
<li><a href="#orgheadline64">4.4.3.2. Vertical western slits</a></li>
<li><a href="#orgheadline65">4.4.3.3. LL2 vertical slits</a></li>
<li><a href="#orgheadline66">4.4.3.4. More eastern horizontal slits</a></li>
</ul>
</li>
<li><a href="#orgheadline68">4.4.4. Testing passing glob patterns to a shell script</a></li>
<li><a href="#orgheadline69">4.4.5. Earlier stuff</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline88">5. <span class="todo nilTODO">TODO</span> New version of spectral map</a>
<ul>
<li><a href="#orgheadline74">5.1. Convert wavelengths to velocities</a>
<ul>
<li><a href="#orgheadline72">5.1.1. Module to find heliocentric correction: helio_utils.py</a></li>
<li><a href="#orgheadline73">5.1.2. Script to test obtaining heliocentric correction from spectrum headers</a></li>
</ul>
</li>
<li><a href="#orgheadline57">5.2. Program to generate spectral map: spectral-map.py</a></li>
<li><a href="#orgheadline75">5.3. Run spectral-map.py for the nii or ha spectra</a></li>
<li><a href="#orgheadline76">5.4. Program to do multigridding of new spectral maps: multibin-map.py</a></li>
<li><a href="#orgheadline77">5.5. Perform the multigridding</a></li>
<li><a href="#orgheadline78">5.6. <span class="done nilDONE">DONE</span> Program to combine different grids: multibin-combine.py</a></li>
<li><a href="#orgheadline85">5.7. <span class="done nilDONE">DONE</span> Perform the combining</a>
<ul>
<li><a href="#orgheadline79">5.7.1. Wide bands</a></li>
<li><a href="#orgheadline80">5.7.2. Line core V = -10 to +50 km/s</a></li>
<li><a href="#orgheadline81">5.7.3. Blue flank: V = -70 to -10 km/s</a></li>
<li><a href="#orgheadline82">5.7.4. Far blue wing: V = -110 to -70 km/s</a></li>
<li><a href="#orgheadline83">5.7.5. Near red flank: V = +50 to +110 km/s</a></li>
<li><a href="#orgheadline84">5.7.6. Far red wing: V = +110 to +170 km/s</a></li>
</ul>
</li>
<li><a href="#orgheadline86">5.8. <span class="done nilDONE">DONE</span> Calculate [N II]/Ha ratio and [N II] + Ha sum</a></li>
<li><a href="#orgheadline87">5.9. Load the spectral map into ds9</a></li>
</ul>
</li>
<li><a href="#orgheadline92">6. Features seen in the isovelocity maps</a>
<ul>
<li><a href="#orgheadline89">6.1. Point objects</a></li>
<li><a href="#orgheadline91">6.2. The red bows</a>
<ul>
<li><a href="#orgheadline90">6.2.1. Identification from imaging</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline93">7. T diagnostics from linewidths</a></li>
<li><a href="#orgheadline94">8. The big bowshock</a></li>
<li><a href="#orgheadline95">9. Proper motions of the Orion West shocks</a></li>
<li><a href="#orgheadline124">10. Old stuff on calibration</a>
<ul>
<li><a href="#orgheadline98">10.1. Dealing with the offset between image and spectrum</a>
<ul>
<li><a href="#orgheadline1">10.1.1. Application to the vertical slits</a></li>
<li><a href="#orgheadline2">10.1.2. Repeat for the horizontal slits</a></li>
</ul>
</li>
<li><a href="#orgheadline112">10.2. Datasets that we will use</a>
<ul>
<li><a href="#orgheadline99">10.2.1. Odd slits that we don't want to forget</a></li>
<li><a href="#orgheadline100">10.2.2. Dec 2013</a></li>
<li><a href="#orgheadline101">10.2.3. Feb 2015</a></li>
<li><a href="#orgheadline103">10.2.4. Jan 2007 and Feb 2006</a>
<ul>
<li><a href="#orgheadline102">10.2.4.1. Original database for vertical slits</a></li>
</ul>
</li>
<li><a href="#orgheadline104">10.2.5. Feb 2013</a>
<ul>
<li><a href="#orgheadline4">10.2.5.1. WCS values</a></li>
<li><a href="#orgheadline97">10.2.5.2. Inter-position brightness calibration</a></li>
</ul>
</li>
<li><a href="#orgheadline111">10.2.6. Jan 2010</a>
<ul>
<li><a href="#orgheadline3">10.2.6.1. WCS values and per-slit weighting</a></li>
<li><a href="#orgheadline109">10.2.6.2. Which to use</a></li>
<li><a href="#orgheadline110">10.2.6.3. Message from Teresa <span class="timestamp-wrapper"><span class="timestamp">[2010-02-18 Thu]</span></span></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline117">10.3. Making spectral maps</a>
<ul>
<li><a href="#orgheadline113">10.3.1. Define the output grid</a></li>
<li><a href="#orgheadline5">10.3.2. Test with the velocity-integrated emission</a></li>
<li><a href="#orgheadline6">10.3.3. Repeat the spectral map for the horizontal slits</a></li>
<li><a href="#orgheadline114">10.3.4. <span class="todo nilTODO">TODO</span> Correction for heliocentric velocity</a></li>
<li><a href="#orgheadline115">10.3.5. Try to use different velocity ranges</a></li>
<li><a href="#orgheadline116">10.3.6. Combine both the horizontal and vertical slits</a></li>
</ul>
</li>
<li><a href="#orgheadline118">10.4. The multigrid smoothing method</a></li>
<li><a href="#orgheadline123">10.5. Coordinates of the slits</a>
<ul>
<li><a href="#orgheadline119">10.5.1. Description from Alba</a></li>
<li><a href="#orgheadline120">10.5.2. Brightness correction factors</a></li>
<li><a href="#orgheadline121">10.5.3. HORIZONTALES 2013</a></li>
<li><a href="#orgheadline122">10.5.4. VERTICALES 2010</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline30" class="outline-2">
<h2 id="orgheadline30"><span class="section-number-2">1</span> <span class="todo TODO">TODO</span> New general version of the slit flux calibration and astrometry</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>It would be better to use the <a href="file:///Users/will/Work/OrionTreasury/wfi/">WFI images</a> to flux calibrate the spectra
<ul class="org-ul">
<li>As well as being more reliable, this is necessary in the case of some of the LL2 slits, since the Image+slit was taken in [S II] instead of H alpha</li>
</ul></li>
<li>We will apply it first to the LL2 slits, plus any other odd slits that are lying around
<ul class="org-ul">
<li>With the plan being to add in the original horizontal and vertical slits afterwards</li>
</ul></li>
<li>As well as flux calibration, it will also help with the offset along the slit</li>
</ul>
</div>


<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">1.1</span> Outline of steps</h3>
<div class="outline-text-3" id="text-1-1">
<ol class="org-ol">
<li>We use the image+slit in order to find the slit reference position
<ul class="org-ul">
<li>The image-spectrum offset along the slit has to be found iteratively through a later step</li>
</ul></li>
<li>Compare the spectrum profile (<code>spec</code>) with a synthetic slit (<code>image</code>) on the WFI image
<ul class="org-ul">
<li>Similar to <a href="#orgheadline1">Application to the vertical slits</a> and <a href="#orgheadline2">Repeat for the horizontal slits</a></li>
<li>Find the <code>jshift</code> value that best matches up the profiles</li>
<li>Find brightness normalization
<ul class="org-ul">
<li>Check for calibration gradients along the slit by plotting <code>spec/image</code> against <code>s</code> (distance along slit)
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-08 Tue] </span></span> It appears that the trends are not linear.  They tend to either curve down near the left hand edge, or curve up at the right hand edge, combined with a more linear increase from left to right</li>
<li>A cubic would probably capture the behavior well</li>
<li class="off"><code>[&#xa0;]</code> Fit a chebychev polynomial to the ratio</li>
</ul></li>
<li>Check for zero point errors by plotting  <code>spec</code> against <code>image</code></li>
<li class="on"><code>[X]</code> One problem will be disentangling the above two effects, because if there is a strong systematic brightness gradient along the slit then their effects will be degenerate
<ul class="org-ul">
<li>It turns out this is not too difficult in most cases, so long as we assume that the along-slit variation is a low-order polynomial</li>
<li>Some slits have a compact region with strong brightness gradients near the middle of the slit, which allows one to clearly see if a zero-point offset is present</li>
</ul></li>
</ul></li>
<li>Write out the slit astrometry and flux calibration to a table, similar to how we did <a href="#orgheadline3">here</a> for the vertical slits and <a href="#orgheadline4">here</a> for the horizontal slits</li>
</ul></li>
<li>Project the calibrated spectra onto a common spatial grid
<ul class="org-ul">
<li>For different velocity ranges
<ul class="org-ul">
<li>This requires finding the heliocentric correction</li>
</ul></li>
<li>This is what we already did for the <a href="#orgheadline5">vertical</a> and <a href="#orgheadline6">horizontal</a> slits
<ul class="org-ul">
<li>We need to generalise this slightly so we can treat any PA (maybe that will work out of the box) and both cases for the dimension order of the spectra files (Y-V, or V-Y)</li>
</ul></li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14"><a id="ID-38EBF0CA-1CA6-4420-A9D8-F784FEB57BCC"></a><span class="section-number-3">1.2</span> Table of all slits</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>This does not have all the slits yet, but it will eventually (I hope)
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-16 Wed] </span></span> Adding the original horizontal slits</li>
</ul></li>
<li>The Notes column is just to remind us of stuff</li>
<li>After editing, remember to export the table to file with <code>C-c t e</code></li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-04 Fri] </span></span> Added some new columns:
<dl class="org-dl">
<dt>saxis</dt><dd>dimension along the slit length in IMAGE coordinates (1 for x-axis; 2 for y-axis)
<ul class="org-ul">
<li>This is checked by hand in DS9</li>
</ul></dd>
<dt>islit</dt><dd>pixel position of slit along the perpendicular axis (y-axis for saxis=1, x-axis for saxis=2)
<ul class="org-ul">
<li>This is measured by hand in DS9</li>
</ul></dd>
<dt>shift</dt><dd>pixel offset along the slit between image+slit and spectrum
<ul class="org-ul">
<li>This has to be found by trial and error (from plotting slit profile from spectrum and comparing with synthetic slit)</li>
</ul></dd>
<dt>norm</dt><dd>the factor we divide the spectrum by so that it is equal to the flux calibration image
<ul class="org-ul">
<li>This is for the center of the slit, since we will need to include a polynomial correction term later</li>
<li>Also found by trial and error - it does not need to be exact since any inaccuracy will get compensated by the leading term of the Chebyshev fit</li>
</ul></dd>
<dt>zero</dt><dd>Correction to the zero point of the spectra
<ul class="org-ul">
<li>Found by looking at the background in the ha and nii spectra, and a little bit of trial and error so that the upper graph panel of spectrum versus image passes through the origin</li>
</ul></dd>
</dl></li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Dataset</th>
<th scope="col" class="org-right">imid</th>
<th scope="col" class="org-right">specid</th>
<th scope="col" class="org-right">saxis</th>
<th scope="col" class="org-right">islit</th>
<th scope="col" class="org-right">shift</th>
<th scope="col" class="org-right">norm</th>
<th scope="col" class="org-right">zero</th>
<th scope="col" class="org-right">r(nii)</th>
<th scope="col" class="org-left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2006-02</td>
<td class="org-right">326</td>
<td class="org-right">324</td>
<td class="org-right">2</td>
<td class="org-right">283.5</td>
<td class="org-right">74.</td>
<td class="org-right">1000</td>
<td class="org-right">1.0</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 first epoch</td>
</tr>

<tr>
<td class="org-right">2006-02</td>
<td class="org-right">318</td>
<td class="org-right">319</td>
<td class="org-right">2</td>
<td class="org-right">280.0</td>
<td class="org-right">78.</td>
<td class="org-right">3300</td>
<td class="org-right">3</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 first epoch</td>
</tr>

<tr>
<td class="org-right">2006-02</td>
<td class="org-right">260</td>
<td class="org-right">261</td>
<td class="org-right">2</td>
<td class="org-right">251.4</td>
<td class="org-right">55.</td>
<td class="org-right">3600</td>
<td class="org-right">1</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 first epoch</td>
</tr>

<tr>
<td class="org-right">2006-02</td>
<td class="org-right">270</td>
<td class="org-right">271</td>
<td class="org-right">2</td>
<td class="org-right">253.5</td>
<td class="org-right">60.</td>
<td class="org-right">6500</td>
<td class="org-right">4</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 first epoch</td>
</tr>

<tr>
<td class="org-right">2006-02</td>
<td class="org-right">276</td>
<td class="org-right">277</td>
<td class="org-right">2</td>
<td class="org-right">256.0</td>
<td class="org-right">60.</td>
<td class="org-right">7000</td>
<td class="org-right">6</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 first epoch</td>
</tr>

<tr>
<td class="org-right">2006-02</td>
<td class="org-right">281</td>
<td class="org-right">282</td>
<td class="org-right">2</td>
<td class="org-right">257.7</td>
<td class="org-right">64.</td>
<td class="org-right">3600</td>
<td class="org-right">8</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 first epoch</td>
</tr>

<tr>
<td class="org-right">2006-02</td>
<td class="org-right">286</td>
<td class="org-right">287</td>
<td class="org-right">2</td>
<td class="org-right">261.0</td>
<td class="org-right">64.</td>
<td class="org-right">4000</td>
<td class="org-right">8</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 first epoch</td>
</tr>

<tr>
<td class="org-right">2006-02</td>
<td class="org-right">291</td>
<td class="org-right">292</td>
<td class="org-right">2</td>
<td class="org-right">262.7</td>
<td class="org-right">65.</td>
<td class="org-right">6000</td>
<td class="org-right">6</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 first epoch</td>
</tr>

<tr>
<td class="org-right">2006-02</td>
<td class="org-right">296</td>
<td class="org-right">297</td>
<td class="org-right">2</td>
<td class="org-right">267.0</td>
<td class="org-right">66.</td>
<td class="org-right">3000</td>
<td class="org-right">8</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 first epoch</td>
</tr>

<tr>
<td class="org-right">2006-02</td>
<td class="org-right">303</td>
<td class="org-right">304</td>
<td class="org-right">2</td>
<td class="org-right">270.5</td>
<td class="org-right">70.</td>
<td class="org-right">3300</td>
<td class="org-right">8</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 first epoch</td>
</tr>

<tr>
<td class="org-right">2006-02</td>
<td class="org-right">313</td>
<td class="org-right">312</td>
<td class="org-right">2</td>
<td class="org-right">278.0</td>
<td class="org-right">70.</td>
<td class="org-right">2600</td>
<td class="org-right">6</td>
<td class="org-right">1.8</td>
<td class="org-left">Image follows spec!</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">2007-01b</td>
<td class="org-right">2061</td>
<td class="org-right">2062-c</td>
<td class="org-right">2</td>
<td class="org-right">256.0</td>
<td class="org-right">65.</td>
<td class="org-right">7000</td>
<td class="org-right">20</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 second epoch</td>
</tr>

<tr>
<td class="org-right">2007-01b</td>
<td class="org-right">2037</td>
<td class="org-right">2038-2040</td>
<td class="org-right">2</td>
<td class="org-right">249.0</td>
<td class="org-right">60.</td>
<td class="org-right">7000</td>
<td class="org-right">16</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 second epoch</td>
</tr>

<tr>
<td class="org-right">2007-01b</td>
<td class="org-right">2041</td>
<td class="org-right">2042-2044</td>
<td class="org-right">2</td>
<td class="org-right">250.0</td>
<td class="org-right">63.</td>
<td class="org-right">7000</td>
<td class="org-right">21</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 second epoch</td>
</tr>

<tr>
<td class="org-right">2007-01b</td>
<td class="org-right">2045</td>
<td class="org-right">2046-2048</td>
<td class="org-right">2</td>
<td class="org-right">251.5</td>
<td class="org-right">64.</td>
<td class="org-right">6500</td>
<td class="org-right">25</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 second epoch</td>
</tr>

<tr>
<td class="org-right">2007-01b</td>
<td class="org-right">2049</td>
<td class="org-right">2050-2052</td>
<td class="org-right">2</td>
<td class="org-right">253.0</td>
<td class="org-right">65.</td>
<td class="org-right">7000</td>
<td class="org-right">25</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 second epoch</td>
</tr>

<tr>
<td class="org-right">2007-01b</td>
<td class="org-right">2053</td>
<td class="org-right">2054-2056</td>
<td class="org-right">2</td>
<td class="org-right">254.5</td>
<td class="org-right">68.</td>
<td class="org-right">7000</td>
<td class="org-right">25</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 second epoch</td>
</tr>

<tr>
<td class="org-right">2007-01b</td>
<td class="org-right">2057</td>
<td class="org-right">2058-2060</td>
<td class="org-right">2</td>
<td class="org-right">254.5</td>
<td class="org-right">66.</td>
<td class="org-right">7000</td>
<td class="org-right">25</td>
<td class="org-right">1.8</td>
<td class="org-left">LL2 second epoch</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">2007-01</td>
<td class="org-right">054</td>
<td class="org-right">055</td>
<td class="org-right">2</td>
<td class="org-right">262.5</td>
<td class="org-right">68.</td>
<td class="org-right">5000</td>
<td class="org-right">10</td>
<td class="org-right">1.9</td>
<td class="org-left">LL1 extreme N</td>
</tr>

<tr>
<td class="org-right">2007-01</td>
<td class="org-right">067</td>
<td class="org-right">068</td>
<td class="org-right">2</td>
<td class="org-right">273.0</td>
<td class="org-right">72.</td>
<td class="org-right">5000</td>
<td class="org-right">10</td>
<td class="org-right">1.9</td>
<td class="org-left">LL1 extreme N</td>
</tr>

<tr>
<td class="org-right">2007-01</td>
<td class="org-right">072</td>
<td class="org-right">073</td>
<td class="org-right">2</td>
<td class="org-right">277.5</td>
<td class="org-right">74.</td>
<td class="org-right">5200</td>
<td class="org-right">10</td>
<td class="org-right">1.8</td>
<td class="org-left">LL1 extreme N</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">2010-01</td>
<td class="org-right">078</td>
<td class="org-right">079-080</td>
<td class="org-right">2</td>
<td class="org-right">248.0</td>
<td class="org-right">62.</td>
<td class="org-right">5500</td>
<td class="org-right">2.0</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical W of LL2</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">202</td>
<td class="org-right">203-204</td>
<td class="org-right">2</td>
<td class="org-right">233.6</td>
<td class="org-right">52.5</td>
<td class="org-right">6500</td>
<td class="org-right">2.0</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">124</td>
<td class="org-right">125-127</td>
<td class="org-right">2</td>
<td class="org-right">235.5</td>
<td class="org-right">54.5</td>
<td class="org-right">3400</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">206</td>
<td class="org-right">207-208</td>
<td class="org-right">2</td>
<td class="org-right">234.6</td>
<td class="org-right">54</td>
<td class="org-right">7700</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">128</td>
<td class="org-right">129-130</td>
<td class="org-right">2</td>
<td class="org-right">237.5</td>
<td class="org-right">57</td>
<td class="org-right">3500</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">133</td>
<td class="org-right">134-135</td>
<td class="org-right">2</td>
<td class="org-right">239.4</td>
<td class="org-right">58</td>
<td class="org-right">5500</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">210</td>
<td class="org-right">211-212</td>
<td class="org-right">2</td>
<td class="org-right">236.4</td>
<td class="org-right">55</td>
<td class="org-right">7000</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">137</td>
<td class="org-right">138-139</td>
<td class="org-right">2</td>
<td class="org-right">241.3</td>
<td class="org-right">60</td>
<td class="org-right">3600</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">214</td>
<td class="org-right">215-216</td>
<td class="org-right">2</td>
<td class="org-right">238.4</td>
<td class="org-right">60</td>
<td class="org-right">7500</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">145</td>
<td class="org-right">146-147</td>
<td class="org-right">2</td>
<td class="org-right">244.3</td>
<td class="org-right">65</td>
<td class="org-right">1000</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">248</td>
<td class="org-right">249-250</td>
<td class="org-right">2</td>
<td class="org-right">254.9</td>
<td class="org-right">68</td>
<td class="org-right">3300</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">219</td>
<td class="org-right">220-221</td>
<td class="org-right">2</td>
<td class="org-right">240.0</td>
<td class="org-right">57.5</td>
<td class="org-right">7700</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">157</td>
<td class="org-right">158-159</td>
<td class="org-right">2</td>
<td class="org-right">252.2</td>
<td class="org-right">65</td>
<td class="org-right">1600</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">236</td>
<td class="org-right">237-238</td>
<td class="org-right">2</td>
<td class="org-right">247.0</td>
<td class="org-right">63</td>
<td class="org-right">7200</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">240</td>
<td class="org-right">241-242</td>
<td class="org-right">2</td>
<td class="org-right">249.5</td>
<td class="org-right">65</td>
<td class="org-right">5500</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">244</td>
<td class="org-right">245-246</td>
<td class="org-right">2</td>
<td class="org-right">251.6</td>
<td class="org-right">64</td>
<td class="org-right">4500</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>

<tr>
<td class="org-right">2010-01</td>
<td class="org-right">252</td>
<td class="org-right">253-254</td>
<td class="org-right">2</td>
<td class="org-right">258.2</td>
<td class="org-right">69</td>
<td class="org-right">5700</td>
<td class="org-right">2.</td>
<td class="org-right">1.8</td>
<td class="org-left">Vertical Far West</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">2013-02</td>
<td class="org-right">024</td>
<td class="org-right">025</td>
<td class="org-right">1</td>
<td class="org-right">465.0</td>
<td class="org-right">-73.</td>
<td class="org-right">1500</td>
<td class="org-right">4.5</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal LL2</td>
</tr>

<tr>
<td class="org-right">2013-02</td>
<td class="org-right">165</td>
<td class="org-right">166-167</td>
<td class="org-right">1</td>
<td class="org-right">468.5</td>
<td class="org-right">-67.</td>
<td class="org-right">3500</td>
<td class="org-right">5.5</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal West</td>
</tr>

<tr>
<td class="org-right">2013-02</td>
<td class="org-right">169</td>
<td class="org-right">170-171</td>
<td class="org-right">1</td>
<td class="org-right">468.5</td>
<td class="org-right">-65.</td>
<td class="org-right">3200</td>
<td class="org-right">5.5</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal West</td>
</tr>

<tr>
<td class="org-right">2013-02</td>
<td class="org-right">237</td>
<td class="org-right">238-239</td>
<td class="org-right">1</td>
<td class="org-right">467.0</td>
<td class="org-right">-74.</td>
<td class="org-right">4500</td>
<td class="org-right">7</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal West</td>
</tr>

<tr>
<td class="org-right">2013-02</td>
<td class="org-right">232</td>
<td class="org-right">233-234</td>
<td class="org-right">1</td>
<td class="org-right">468.5</td>
<td class="org-right">-78.</td>
<td class="org-right">4800</td>
<td class="org-right">9</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal West</td>
</tr>

<tr>
<td class="org-right">2013-02</td>
<td class="org-right">226</td>
<td class="org-right">227-228</td>
<td class="org-right">1</td>
<td class="org-right">468.5</td>
<td class="org-right">-75.</td>
<td class="org-right">4200</td>
<td class="org-right">10</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal West</td>
</tr>

<tr>
<td class="org-right">2013-02</td>
<td class="org-right">149</td>
<td class="org-right">150-151</td>
<td class="org-right">1</td>
<td class="org-right">468.0</td>
<td class="org-right">-70.</td>
<td class="org-right">3600</td>
<td class="org-right">3.5</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal West</td>
</tr>

<tr>
<td class="org-right">2013-02</td>
<td class="org-right">154</td>
<td class="org-right">155-156</td>
<td class="org-right">1</td>
<td class="org-right">467.2</td>
<td class="org-right">-67.</td>
<td class="org-right">3600</td>
<td class="org-right">4.5</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal West</td>
</tr>

<tr>
<td class="org-right">2013-02</td>
<td class="org-right">159</td>
<td class="org-right">160-161</td>
<td class="org-right">1</td>
<td class="org-right">467.5</td>
<td class="org-right">-70.</td>
<td class="org-right">3600</td>
<td class="org-right">5.0</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal West</td>
</tr>

<tr>
<td class="org-right">2013-02</td>
<td class="org-right">033</td>
<td class="org-right">034-035</td>
<td class="org-right">1</td>
<td class="org-right">467.0</td>
<td class="org-right">-70.</td>
<td class="org-right">3800</td>
<td class="org-right">6.0</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal West</td>
</tr>

<tr>
<td class="org-right">2013-02</td>
<td class="org-right">029</td>
<td class="org-right">030-031</td>
<td class="org-right">1</td>
<td class="org-right">465.2</td>
<td class="org-right">-76.</td>
<td class="org-right">3800</td>
<td class="org-right">4.5</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal West</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">2013-12</td>
<td class="org-right">116</td>
<td class="org-right">117-118</td>
<td class="org-right">1</td>
<td class="org-right">395.0</td>
<td class="org-right">-160.</td>
<td class="org-right">400</td>
<td class="org-right">10.5</td>
<td class="org-right">1.8</td>
<td class="org-left">Horizontal below LL2</td>
</tr>

<tr>
<td class="org-right">2013-12</td>
<td class="org-right">086</td>
<td class="org-right">088</td>
<td class="org-right">1</td>
<td class="org-right">404.0</td>
<td class="org-right">-155.</td>
<td class="org-right">300</td>
<td class="org-right">11.0</td>
<td class="org-right">1.8</td>
<td class="org-left">W of HH269</td>
</tr>

<tr>
<td class="org-right">2013-12</td>
<td class="org-right">090</td>
<td class="org-right">089</td>
<td class="org-right">1</td>
<td class="org-right">404.5</td>
<td class="org-right">-160.</td>
<td class="org-right">400</td>
<td class="org-right">10.5</td>
<td class="org-right">1.8</td>
<td class="org-left">Image follows spec</td>
</tr>

<tr>
<td class="org-right">2013-12</td>
<td class="org-right">102</td>
<td class="org-right">103-104</td>
<td class="org-right">1</td>
<td class="org-right">402.5</td>
<td class="org-right">-150.</td>
<td class="org-right">350</td>
<td class="org-right">10.5</td>
<td class="org-right">1.8</td>
<td class="org-left">V faint image</td>
</tr>

<tr>
<td class="org-right">2013-12</td>
<td class="org-right">111</td>
<td class="org-right">112-113</td>
<td class="org-right">1</td>
<td class="org-right">400.0</td>
<td class="org-right">-145.</td>
<td class="org-right">400</td>
<td class="org-right">10.5</td>
<td class="org-right">1.8</td>
<td class="org-left">W of HH269</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">2015-02</td>
<td class="org-right">0003</td>
<td class="org-right">0004</td>
<td class="org-right">1</td>
<td class="org-right">463.0</td>
<td class="org-right">-80.</td>
<td class="org-right">1300</td>
<td class="org-right">0</td>
<td class="org-right">1.8</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">2015-02</td>
<td class="org-right">0012</td>
<td class="org-right">0013</td>
<td class="org-right">1</td>
<td class="org-right">464.0</td>
<td class="org-right">-60.</td>
<td class="org-right">1300</td>
<td class="org-right">0</td>
<td class="org-right">1.8</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>



<p>
Run it for a single slit
</p>
<div class="org-src-container">

<pre class="src src-sh">python slit-calibration.py 2015-02 <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">1&gt;&amp;2</span>
</pre>
</div>

<pre class="example">
&lt;Row 54 of table
 values=(2015-02, 0003, 0004, 1, 463.0, -80.0, 1300, 0.0, 1.8, --)
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB15/archivos/spm0003-ardec.fits
~/Dropbox/SPMFEB15/archivos/spm0004o_bcrx.fits
~/Dropbox/SPMFEB15/archivos/spm0004o_sub-ha.fits
~/Dropbox/SPMFEB15/archivos/spm0004o_sub-nii.fits
iarr = [  80.  180.  280.  380.  480.  580.  680.  780.  880.  980.] jarr = [ 463.  463.  463.  463.  463.  463.  463.  463.  463.  463.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.76300486, -5.38914842), (83.75317756, -5.38920898),
     (83.74335024, -5.38926939), (83.73352293, -5.38932964),
     (83.72369561, -5.38938973), (83.71386829, -5.38944967),
     (83.70404097, -5.38950944), (83.69421365, -5.38956906),
     (83.68438632, -5.38962852), (83.674559, -5.38968782)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.7629988   83.75317149  83.74334418  83.73351686  83.72368954
  83.71386222  83.7040349   83.69420758  83.68438026  83.67455293] [-5.3891432  -5.38920377 -5.38926417 -5.38932442 -5.38938451 -5.38944445
 -5.38950422 -5.38956384 -5.3896233  -5.38968261]
[ 4255.  4403.  4551.  4699.  4847.  4995.  5143.  5291.  5439.  5587.] [ 5222.  5221.  5220.  5219.  5218.  5218.  5217.  5216.  5215.  5214.]
Wav: [6559.29, 6566.29] Pixel: [  12.45186057  134.32298985]
Wav: [6579.95, 6586.95] Pixel: [  10.14579358  132.01692287]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2                c3       
    -------------- ---------------- ---------------- -----------------
    0.968088496551 -0.0353020238319 -0.0368421106332 0.000390521891842
Saving ha calibrated spectrum
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.7629988, -5.3891432), (83.75317148, -5.389203),
     (83.74334417, -5.38926263), (83.73351686, -5.38932211),
     (83.72368954, -5.38938143), (83.71386223, -5.3894406),
     (83.70403492, -5.3894996), (83.6942076, -5.38955845),
     (83.6843803, -5.38961714), (83.67455299, -5.38967568)]&gt;
Displacements in arcsec: [  8.58749764e-12   2.77185864e-03   5.54373697e-03   8.31565447e-03
   1.10876306e-02   1.38596848e-02   1.66318366e-02   1.94041055e-02
   2.21765108e-02   2.49490722e-02]
Saving nii calibrated spectrum
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.7629988, -5.3891432), (83.75317148, -5.389203),
     (83.74334417, -5.38926263), (83.73351686, -5.38932211),
     (83.72368954, -5.38938143), (83.71386223, -5.3894406),
     (83.70403492, -5.3894996), (83.6942076, -5.38955845),
     (83.6843803, -5.38961714), (83.67455299, -5.38967568)]&gt;
Displacements in arcsec: [  8.58749764e-12   2.77185864e-03   5.54373697e-03   8.31565447e-03
   1.10876306e-02   1.38596848e-02   1.66318366e-02   1.94041055e-02
   2.21765108e-02   2.49490722e-02]
&lt;Row 55 of table
 values=(2015-02, 0012, 0013, 1, 464.0, -60.0, 1300, 0.0, 1.8, --)
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB15/archivos/spm0012-ardec.fits
~/Dropbox/SPMFEB15/archivos/spm0013o_bcrx.fits
~/Dropbox/SPMFEB15/archivos/spm0013o_sub-ha.fits
~/Dropbox/SPMFEB15/archivos/spm0013o_sub-nii.fits
iarr = [  60.  160.  260.  360.  460.  560.  660.  760.  860.  960.] jarr = [ 464.  464.  464.  464.  464.  464.  464.  464.  464.  464.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.76323814, -5.3929956), (83.75342282, -5.39306366),
     (83.7436075, -5.39313156), (83.73379217, -5.3931993),
     (83.72397685, -5.39326688), (83.71416152, -5.39333431),
     (83.70434619, -5.39340158), (83.69453086, -5.39346869),
     (83.68471553, -5.39353565), (83.6749002, -5.39360244)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.76323207  83.75341675  83.74360143  83.73378611  83.72397078
  83.71415545  83.70434012  83.69452479  83.68470946  83.67489413] [-5.39299038 -5.39305844 -5.39312634 -5.39319408 -5.39326167 -5.39332909
 -5.39339636 -5.39346348 -5.39353043 -5.39359723]
[ 4252.  4399.  4547.  4695.  4843.  4991.  5138.  5286.  5434.  5582.] [ 5164.  5163.  5162.  5161.  5160.  5159.  5158.  5157.  5156.  5155.]
Wav: [6559.29, 6566.29] Pixel: [  13.23643219  135.38568331]
Wav: [6579.95, 6586.95] Pixel: [   3.75122191  125.90047303]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2               c3      
    -------------- ---------------- ---------------- ---------------
    0.910890984261 -0.0345993965867 -0.0231613499696 0.0155135592095
Saving ha calibrated spectrum
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.76323207, -5.39299038), (83.75341675, -5.39305767),
     (83.74360142, -5.3931248), (83.7337861, -5.39319178),
     (83.72397078, -5.39325859), (83.71415545, -5.39332525),
     (83.70434013, -5.39339175), (83.69452481, -5.39345809),
     (83.68470949, -5.39352428), (83.67489417, -5.39359031)]&gt;
Displacements in arcsec: [  2.28999937e-11   2.76707470e-03   5.53416590e-03   8.30128974e-03
   1.10684626e-02   1.38357006e-02   1.66030200e-02   1.93704370e-02
   2.21379680e-02   2.49056291e-02]
Saving nii calibrated spectrum
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.76323207, -5.39299038), (83.75341675, -5.39305767),
     (83.74360142, -5.3931248), (83.7337861, -5.39319178),
     (83.72397078, -5.39325859), (83.71415545, -5.39332525),
     (83.70434013, -5.39339175), (83.69452481, -5.39345809),
     (83.68470949, -5.39352428), (83.67489417, -5.39359031)]&gt;
Displacements in arcsec: [  2.28999937e-11   2.76707470e-03   5.53416590e-03   8.30128974e-03
   1.10684626e-02   1.38357006e-02   1.66030200e-02   1.93704370e-02
   2.21379680e-02   2.49056291e-02]
</pre>
</div>




<div id="outline-container-orgheadline9" class="outline-4">
<h4 id="orgheadline9"><span class="section-number-4">1.2.1</span> Different binning between image and spectrum</h4>
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li>Note that binning along the slit axis differs between image+slit and spectrum for these 2013-12 datasets:
<ul class="org-ul">
<li>086</li>
<li>090</li>
<li>102</li>
<li>111</li>
</ul></li>
<li>It is x2 for the image+slit, but x3 for the spectrum</li>
<li>This is now dealt with in the <a href="#orgheadline8">find_slit_coords</a> function</li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline10" class="outline-4">
<h4 id="orgheadline10"><span class="section-number-4">1.2.2</span> <span class="todo TODO">TODO</span> Allow for offsets perpendicular to slit</h4>
<div class="outline-text-4" id="text-1-2-2">
<ul class="org-ul">
<li>In some cases, the pointing may have drifted in between the image+slit exposure and the spectrum exposure</li>
<li>I suspect this is happening with the 2013-12 spectra at least</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><span class="section-number-4">1.2.3</span> <span class="done DONE">DONE</span> Problems with the flux zero-point of the spectra</h4>
<div class="outline-text-4" id="text-1-2-3">
<ul class="org-ul">
<li>The original way I was dealing with this was to use the <code>zero</code> column in the table to finesse things by hand so that the "calib image" versus "integrated spectrum" plot goes through the origin
<ul class="org-ul">
<li>However, I don't like this approach because there is no check that the "continuum" parts of the spectrum (in between the emission lines) still have a sensible value (at the very least, non-negative!)</li>
</ul></li>
<li>We can do better.  By looking at vignetted edge of the untrimmed spectra exposures, we can see whether the "continuum" values are real continuum or not.
<ul class="org-ul">
<li>In many cases, it is obvious that there is still a residual constant value that needs to be subtracted</li>
<li>For instance, with 2013-12-086 dataset:
<ul class="org-ul">
<li><a href="file:///Users/will/Dropbox/papers/LL-Objects/SPMDIC13/"><a href="file:///Users/will/Dropbox/papers/LL-Objects/SPMDIC13/">file:///Users/will/Dropbox/papers/LL-Objects/SPMDIC13/</a></a></li>
<li>The raw spectrum is spm088.fits</li>
<li>The reduced spectrum is spm088_bcrx.fits, spec088-ha.fits, spec088-nii.fits</li>
<li>Unfortunately, hey are not all the same
<ul class="org-ul">
<li>spm088_bcrx.fits looks like its flux zero point is 16</li>
<li>spec088-ha.fits looks like its flux zero point is 11</li>
<li>spec088-nii.fits looks like its flux zero point is 12</li>
</ul></li>
<li>We will try using 11.0</li>
</ul></li>
</ul></li>
<li>So plan is to re-use the <code>zero</code> column to be the value that we subtract from the ha and nii spectra pixels <b>before</b> summing in wavelength.</li>
<li>This works more or less well for 2013-12 and 2010</li>
<li class="on"><code>[X]</code> Linear trend in zero-point for 2007-01 LL1 slits
<ul class="org-ul">
<li>The "continuum" goes negative at the N end of the slits</li>
<li>This would be best dealt with by modifying the images before using them</li>
<li>The problem is seen in all the spectra - it seems to be due to having subtracted the image in superbias.fits, which is obviously wrong, since it has a linear gradient from 1150 to 1230, which is a delta of 80
<ul class="org-ul">
<li>I thing the real value should be about 1160 to 1170</li>
<li>So if we map the y-axis onto [0, 1], then we need to add 80*y - 10</li>
<li>This is done <a href="#orgheadline11">below</a></li>
</ul></li>
</ul></li>
<li>Now that we have fixed up the LL1 slits, we still get reasonable calibrations, even when we determine <code>zero</code> directly from the spectral images
<ul class="org-ul">
<li>The only problem is that the Bright Bar is slightly less prominent on the spectra than it is on the calibration image</li>
<li>It can be largely fixed by pushing <code>zero</code> up to about 10</li>
<li>This is fine for Ha, but is a bit low for nii in the S end of the slit</li>
<li>But the high vel components are in the N end and not seen in nii, so it doesn't matter</li>
</ul></li>
</ul>
</div>

<div id="outline-container-orgheadline11" class="outline-5">
<h5 id="orgheadline11"><a id="ID-4335A38B-52C8-4F0E-8F92-308DC4DBC4F6"></a><span class="section-number-5">1.2.3.1</span> Script to fix the 2007 bias subtractions</h5>
<div class="outline-text-5" id="text-1-2-3-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> glob
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #dfaf8f;">fnlist</span> = glob.glob(<span style="color: #eee8aa; font-style: italic;">'spec*-ha.fits'</span>) + glob.glob(<span style="color: #eee8aa; font-style: italic;">'spec*-nii.fits'</span>)
<span style="color: #b9d3ee;">for</span> fn <span style="color: #b9d3ee;">in</span> fnlist:
    <span style="color: #b9d3ee;">print</span>(fn)
    hdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(fn)
    <span style="color: #dfaf8f;">ny</span>, <span style="color: #dfaf8f;">nx</span> = hdu.data.shape
    <span style="color: #dfaf8f;">y</span> = np.linspace(0.0, 1.0, ny).reshape((ny, 1))
    <span style="color: #dfaf8f;">hdu.data</span> += 0.5*(80*y - 5.0)
    hdu.writeto(fn.replace(<span style="color: #eee8aa; font-style: italic;">'.fits'</span>, <span style="color: #eee8aa; font-style: italic;">'-fix.fits'</span>), clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>

<pre class="example">
spec014-ha.fits
spec016-ha.fits
spec021-ha.fits
spec025-ha.fits
spec029-ha.fits
spec036-ha.fits
spec040-ha.fits
spec044-ha.fits
spec055-ha.fits
spec068-ha.fits
spec073-ha.fits
spec078-ha.fits
spec016-nii.fits
spec021-nii.fits
spec025-nii.fits
spec029-nii.fits
spec036-nii.fits
spec040-nii.fits
spec044-nii.fits
spec055-nii.fits
spec068-nii.fits
spec073-nii.fits
spec078-nii.fits
</pre>
</div>
</div>




<div id="outline-container-orgheadline12" class="outline-5">
<h5 id="orgheadline12"><span class="section-number-5">1.2.3.2</span> <span class="done DONE">DONE</span> Script to cut out the ha and nii spectra from the 2015 slits</h5>
<div class="outline-text-5" id="text-1-2-3-2">
<ul class="org-ul">
<li>We only have a lamp spectrum for the 0013 setting
<ul class="org-ul">
<li>So I calculate an offset by hand for the 0004 exposure</li>
<li>656.76 - 529.148 = 127.612</li>
<li>654.275 - 525.139 = 129.136</li>
<li>Tweaked it by hand by aligning on WCS in ds9
<ul class="org-ul">
<li>Strangely, the shift was slightly different for nii and ha</li>
</ul></li>
</ul></li>
</ul>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #dfaf8f;">jwin</span> = 160
<span style="color: #b9d3ee;">for</span> slitid, lineid, j0 <span style="color: #b9d3ee;">in</span>  [[<span style="color: #eee8aa; font-style: italic;">'0004'</span>, <span style="color: #eee8aa; font-style: italic;">'ha'</span>, 570], [<span style="color: #eee8aa; font-style: italic;">'0004'</span>, <span style="color: #eee8aa; font-style: italic;">'nii'</span>, 930],
                            [<span style="color: #eee8aa; font-style: italic;">'0013'</span>, <span style="color: #eee8aa; font-style: italic;">'ha'</span>, 440], [<span style="color: #eee8aa; font-style: italic;">'0013'</span>, <span style="color: #eee8aa; font-style: italic;">'nii'</span>, 810],]:
    <span style="color: #dfaf8f;">fn</span> = <span style="color: #eee8aa; font-style: italic;">'spm{}o_sub.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(slitid)
    hdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(fn)
    <span style="color: #dfaf8f;">hdu.data</span> = hdu.data[j0:j0+jwin]
    <span style="color: #dfaf8f;">hdu.header</span>[<span style="color: #eee8aa; font-style: italic;">'CRPIX2'</span>] -= j0
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">if (slitid, lineid) == ('0004', 'nii'):</span>
    <span style="color: #5F7F5F;">#     </span><span style="color: #8b8b83; font-style: italic;">hdu.data *= 3.0         # forced to use weaker doublet component</span>
    <span style="color: #b9d3ee;">if</span> (slitid, lineid) == (<span style="color: #eee8aa; font-style: italic;">'0004'</span>, <span style="color: #eee8aa; font-style: italic;">'ha'</span>):
        <span style="color: #dfaf8f;">hdu.header</span>[<span style="color: #eee8aa; font-style: italic;">'CRPIX2'</span>] += 127.0
    <span style="color: #b9d3ee;">if</span> (slitid, lineid) == (<span style="color: #eee8aa; font-style: italic;">'0004'</span>, <span style="color: #eee8aa; font-style: italic;">'nii'</span>):
        <span style="color: #dfaf8f;">hdu.header</span>[<span style="color: #eee8aa; font-style: italic;">'CRPIX2'</span>] += 125.0
    hdu.writeto(                                                                
        fn.replace(<span style="color: #eee8aa; font-style: italic;">'.fits'</span>, <span style="color: #eee8aa; font-style: italic;">'-{}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(lineid)),
        clobber=<span style="color: #cFfBcF;">True</span>
    )
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-3">
<h3 id="orgheadline28"><span class="section-number-3">1.3</span> Program to perform flux calibration: slit-calibration.py</h3>
<div class="outline-text-3" id="text-1-3">
</div>

<div id="outline-container-orgheadline15" class="outline-4">
<h4 id="orgheadline15"><span class="section-number-4">1.3.1</span> Imports</h4>
<div class="outline-text-4" id="text-1-3-1">
<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock1"><span style="color: #b9d3ee;">import</span> os
<span style="color: #b9d3ee;">import</span> sys
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">import</span> astropy
<span style="color: #b9d3ee;">from</span> astropy.table <span style="color: #b9d3ee;">import</span> Table
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS
<span style="color: #b9d3ee;">from</span> astropy.wcs.utils <span style="color: #b9d3ee;">import</span> pixel_to_skycoord
<span style="color: #b9d3ee;">from</span> matplotlib <span style="color: #b9d3ee;">import</span> pyplot <span style="color: #b9d3ee;">as</span> plt
<span style="color: #b9d3ee;">import</span> seaborn <span style="color: #b9d3ee;">as</span> sns
<span style="color: #b9d3ee;">from</span> astropy <span style="color: #b9d3ee;">import</span> units <span style="color: #b9d3ee;">as</span> u
<span style="color: #b9d3ee;">from</span> astropy.coordinates <span style="color: #b9d3ee;">import</span> SkyCoord
<span style="color: #b9d3ee;">from</span> astropy.modeling <span style="color: #b9d3ee;">import</span> models, fitting
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-4">
<h4 id="orgheadline16"><span class="section-number-4">1.3.2</span> Read in the table of all slits</h4>
<div class="outline-text-4" id="text-1-3-2">
<ul class="org-ul">
<li>We want the ID columns to be read as strings since they contain leading zeros in some cases, which need to be preserved</li>
<li>This was not happening automatically for the <code>imid</code> column so I use a custom converter</li>
</ul>
<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock2"><span style="color: #dfaf8f;">converters</span> = {<span style="color: #eee8aa; font-style: italic;">'imid'</span>: [astropy.io.<span style="color: #DCDCCC; font-weight: bold;">ascii</span>.convert_numpy(np.<span style="color: #DCDCCC; font-weight: bold;">str</span>)]}
<span style="color: #dfaf8f;">tab</span> = Table.read(<span style="color: #eee8aa; font-style: italic;">'all-slits-input.tab'</span>,
                 <span style="color: #DCDCCC; font-weight: bold;">format</span>=<span style="color: #eee8aa; font-style: italic;">'ascii.tab'</span>, converters=converters)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-4">
<h4 id="orgheadline17"><span class="section-number-4">1.3.3</span> Fits files for the spectra and image+slit</h4>
<div class="outline-text-4" id="text-1-3-3">
<ul class="org-ul">
<li>These are kept in nested dicts of dicts of template formats, which are keyed
<ol class="org-ol">
<li>By the file type (see below)</li>
<li>By the date of observations (YYYY-MM)
<ul class="org-ul">
<li>with a suffix b to distinguish different sets from same temporada</li>
</ul></li>
</ol></li>
<li>The file types are:
<dl class="org-dl">
<dt>fullspec</dt><dd>The original full spectrum file, which includes ha and nii
<ul class="org-ul">
<li>This is only used for the flux calibration and positioning, summing up in the wavelength direction</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-11 Fri] </span></span> <i>UPDATE: I don't use these any more</i></li>
<li>So it doesn't matter that it isn't rectified</li>
<li class="on"><code>[X]</code> Ideally it will be CR-rejected and bias-subtracted, but I am not sure I have those for all datasets
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-11 Fri] </span></span> This wasn't important since I have ended up using the ha and nii spectra instead</li>
</ul></li>
<li>Note that some of the datasets where two exposures are summed use a format like <code>117-118</code> for the file name for the full spectrum</li>
<li>Also note that for the 2013-02 dataset I have made symbolic links into the <code>WesternShocks/</code> folder for the full spectrum files, so that we don't have to know about the individual night folders (<code>150213/</code> and <code>160213/</code>) any more.</li>
</ul></dd>
<dt>ha</dt><dd>The extracted Ha line
<ul class="org-ul">
<li>In cases where the full spectrum has form like <code>117-118</code>, then the extracted H&alpha; spectrum just uses <code>117</code></li>
<li>This is implemented in the function <code>find_fits_filepath()</code></li>
</ul></dd>
<dt>nii</dt><dd>The extracted [N II] line
<ul class="org-ul">
<li>Same as for H&alpha;</li>
</ul></dd>
<dt>image</dt><dd>The image+slit exposure
<ul class="org-ul">
<li>I only use this for finding the ra, dec of the slit center</li>
</ul></dd>
</dl></li>
</ul>
<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock3"><span style="color: #dfaf8f;">file_templates</span> = {
    <span style="color: #eee8aa; font-style: italic;">'fullspec'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2005/pp{}.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spec{}.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spec{}-transf.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/spm{}h.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spm{}_bcr.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spm{}_bcrx.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}o_bcrx.fits'</span>,
    },
    <span style="color: #eee8aa; font-style: italic;">'ha'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/SPMha/spec{}-halpha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spec{}-ha-fix.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}o_sub-ha.fits'</span>,
    },
    <span style="color: #eee8aa; font-style: italic;">'nii'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/SPMnii/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spec{}-nii-fix.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}o_sub-nii.fits'</span>,
    },
    <span style="color: #eee8aa; font-style: italic;">'image'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/Papers/LL-Objects/feb2006/pp{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/posiciones/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spm{}_ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}-ardec.fits'</span>,
    },
}

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">find_fits_filepath</span>(db, filetype):
    <span style="color: #eee8aa; font-style: italic;">"""Return path to the FITS file for an image or spectrum </span>
<span style="color: #eee8aa; font-style: italic;">    """</span>
    <span style="color: #dfaf8f;">id_</span> = db[<span style="color: #eee8aa; font-style: italic;">'imid'</span>] <span style="color: #b9d3ee;">if</span> filetype == <span style="color: #eee8aa; font-style: italic;">'image'</span> <span style="color: #b9d3ee;">else</span> db[<span style="color: #eee8aa; font-style: italic;">'specid'</span>]
    <span style="color: #dfaf8f;">id_</span> = <span style="color: #DCDCCC; font-weight: bold;">str</span>(id_)
    <span style="color: #b9d3ee;">if</span> filetype <span style="color: #b9d3ee;">in</span> (<span style="color: #eee8aa; font-style: italic;">'ha'</span>, <span style="color: #eee8aa; font-style: italic;">'nii'</span>) <span style="color: #b9d3ee;">and</span> db[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>] <span style="color: #b9d3ee;">not</span> <span style="color: #b9d3ee;">in</span> [<span style="color: #eee8aa; font-style: italic;">'2013-12'</span>]:
        <span style="color: #dfaf8f;">id_</span> = id_.split(<span style="color: #eee8aa; font-style: italic;">'-'</span>)[0]
    <span style="color: #dfaf8f;">template</span> = file_templates[filetype][db[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>]]
    <span style="color: #dfaf8f;">path</span> = template.<span style="color: #DCDCCC; font-weight: bold;">format</span>(id_)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'~/'</span>+path)
    <span style="color: #dfaf8f;">homedir</span> = os.path.expanduser(<span style="color: #eee8aa; font-style: italic;">'~'</span>)
    <span style="color: #b9d3ee;">return</span> os.path.join(homedir, path)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline18" class="outline-4">
<h4 id="orgheadline18"><span class="section-number-4">1.3.4</span> Construct the synthetic slit from the reference image</h4>
<div class="outline-text-4" id="text-1-3-4">
<p>
A function to trace the profile of a slit
</p>
<ul class="org-ul">
<li>Input are arrays of RA and Dec coordinates</li>
<li>Together with the image itself and its WCS object</li>
<li>Output is an array of the profile along the slit
<ul class="org-ul">
<li>Although the function makes no assumption about the geometry of the coordinate arrays, so it doesn't <i>need</i> to be a slit</li>
</ul></li>
<li class="off"><code>[&#xa0;]</code> Currently the output profile is simply calculated from the nearest pixel, but I have grander plans for this eventually:
<ul class="org-ul">
<li>I should construct a logical mask for each slit pixel, based on the pixel size, and then average all the image pixels for which the mask is True</li>
<li>This will be pretty slow if I am using the entire reference image array every time</li>
<li>So I should first extract a sub-image, given by the limits of the slit</li>
</ul></li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">slit_profile</span>(ra, dec, image, wcs):
    <span style="color: #eee8aa; font-style: italic;">"""</span>
<span style="color: #eee8aa; font-style: italic;">    Find the image intensity for a list of positions (ra and dec)</span>
<span style="color: #eee8aa; font-style: italic;">    """</span>
    <span style="color: #dfaf8f;">xi</span>, <span style="color: #dfaf8f;">yj</span> = wcs.all_world2pix(ra, dec, 0)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find nearest integer pixel</span>
    <span style="color: #dfaf8f;">ii</span>, <span style="color: #dfaf8f;">jj</span> = np.floor(xi + 0.5), np.floor(yj + 0.5)
    <span style="color: #b9d3ee;">print</span>(ra[::100], dec[::100])
    <span style="color: #b9d3ee;">print</span>(ii[::100], jj[::100])
    <span style="color: #b9d3ee;">return</span> np.array([image[j, i] <span style="color: #b9d3ee;">for</span> i, j <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">zip</span>(ii, jj)])
</pre>
</div>

<p>
The actual photometric standard image we are going to use.  This is from Massimo's ground-based program.  The pixel size is 0.238 arcsec 
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #dfaf8f;">wfi_dir</span> = <span style="color: #eee8aa; font-style: italic;">'/Users/will/Work/OrionTreasury/wfi'</span>
photom, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(os.path.join(wfi_dir, <span style="color: #eee8aa; font-style: italic;">'Orion_H_A_deep.fits'</span>))
<span style="color: #dfaf8f;">wphot</span> = WCS(photom.header)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline8" class="outline-4">
<h4 id="orgheadline8"><a id="ID-1D9200A9-45BA-4128-894B-4D4DF84FC2F2"></a><span class="section-number-4">1.3.5</span> Find the world coordinates of each pixel along the slit</h4>
<div class="outline-text-4" id="text-1-3-5">
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-06 Sun] </span></span> To make this more useful, I will return the entire array of RA and Dec for each pixel along the slit (instead of just RA0, Dec0 for the slit center)
<ul class="org-ul">
<li>This means that the <code>ds</code> and <code>PA</code> parameters will no longer be needed, but I will leave them in anyway.</li>
</ul></li>
<li>Similar to what I did <a href="#orgheadline3">here</a> and <a href="#orgheadline4">here</a>
<ul class="org-ul">
<li>But simpler really</li>
</ul></li>
<li>We need to find the following:
<ul class="org-ul">
<li>(<code>RA0</code>, <code>Dec0</code>) of the slit center
<ul class="org-ul">
<li>This comes from the WCS header of the image+slit, together with the <code>islit</code> and <code>shift</code> values from the <a href="#orgheadline14">table above</a></li>
</ul></li>
<li>Pixel scale along the slit <code>ds</code></li>
<li><code>PA</code> of the slit</li>
</ul></li>
<li>Note that we do the conversion to ICRS frame.  Some of the earlier images are in FK4, which is 1950 epoch!
<ul class="org-ul">
<li>We fix this using <code>astropy.coordinates.SkyCoord</code> with the coordinate frame taken from the <code>radesys</code> WCS parameter.</li>
</ul></li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">find_slit_coords</span>(db, hdr, shdr):
    <span style="color: #eee8aa; font-style: italic;">"""Find the coordinates of all the pixels along a spectrograph slit</span>

<span style="color: #eee8aa; font-style: italic;">    Input arguments are a dict-like 'db' of hand-measured values (must</span>
<span style="color: #eee8aa; font-style: italic;">    contain 'saxis', 'islit' and 'shift') and a FITS headers 'hdr' from</span>
<span style="color: #eee8aa; font-style: italic;">    the image+slit exposure and 'shdr' from a spectrum exposure</span>

<span style="color: #eee8aa; font-style: italic;">    Returns a dict of 'ds' (slit pixel scale), 'PA' (slit position</span>
<span style="color: #eee8aa; font-style: italic;">    angle), 'RA' (array of RA values in degrees along slit), 'Dec'</span>
<span style="color: #eee8aa; font-style: italic;">    (array of Dec values in degrees along slit)</span>

<span style="color: #eee8aa; font-style: italic;">    """</span>
    <span style="color: #dfaf8f;">jstring</span> = <span style="color: #DCDCCC; font-weight: bold;">str</span>(db[<span style="color: #eee8aa; font-style: italic;">'saxis'</span>])  <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">which image axis lies along slit</span>
    <span style="color: #dfaf8f;">dRA_arcsec</span> = hdr[<span style="color: #eee8aa; font-style: italic;">'CD1_'</span>+jstring]*3600*np.cos(np.radians(hdr[<span style="color: #eee8aa; font-style: italic;">'CRVAL2'</span>]))
    <span style="color: #dfaf8f;">dDEC_arcsec</span> = hdr[<span style="color: #eee8aa; font-style: italic;">'CD2_'</span>+jstring]*3600
    <span style="color: #dfaf8f;">ds</span> = np.hypot(dRA_arcsec, dDEC_arcsec)
    <span style="color: #dfaf8f;">PA</span> = np.degrees(np.arctan2(dRA_arcsec, dDEC_arcsec))

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Pixel coords of each slit pixel on image (in 0-based convention)</span>
    <span style="color: #b9d3ee;">if</span> jstring == <span style="color: #eee8aa; font-style: italic;">'1'</span>:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Slit is horizontal in IMAGE coords</span>
        <span style="color: #dfaf8f;">ns</span> = shdr[<span style="color: #eee8aa; font-style: italic;">'NAXIS1'</span>]
        <span style="color: #dfaf8f;">iarr</span> = np.arange(ns) - <span style="color: #DCDCCC; font-weight: bold;">float</span>(db[<span style="color: #eee8aa; font-style: italic;">'shift'</span>])
        <span style="color: #dfaf8f;">jarr</span> = np.ones(ns)*<span style="color: #DCDCCC; font-weight: bold;">float</span>(db[<span style="color: #eee8aa; font-style: italic;">'islit'</span>])
        <span style="color: #b9d3ee;">try</span>:
            <span style="color: #dfaf8f;">image_binning</span> = hdr[<span style="color: #eee8aa; font-style: italic;">'CBIN'</span>]
            <span style="color: #dfaf8f;">spec_binning</span> = shdr[<span style="color: #eee8aa; font-style: italic;">'CBIN'</span>]
        <span style="color: #b9d3ee;">except</span> <span style="color: #ccdddd;">KeyError</span>:
            <span style="color: #dfaf8f;">image_binning</span> = hdr[<span style="color: #eee8aa; font-style: italic;">'CCDXBIN'</span>]
            <span style="color: #dfaf8f;">spec_binning</span> = shdr[<span style="color: #eee8aa; font-style: italic;">'CCDXBIN'</span>]

        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">correct for difference in binning between the image+slit and the spectrum</span>
        <span style="color: #dfaf8f;">iarr</span> *= spec_binning/image_binning
    <span style="color: #b9d3ee;">elif</span> jstring == <span style="color: #eee8aa; font-style: italic;">'2'</span>:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Slit is vertical in IMAGE coords</span>
        <span style="color: #dfaf8f;">ns</span> = shdr[<span style="color: #eee8aa; font-style: italic;">'NAXIS2'</span>]
        <span style="color: #dfaf8f;">iarr</span> = np.ones(ns)*<span style="color: #DCDCCC; font-weight: bold;">float</span>(db[<span style="color: #eee8aa; font-style: italic;">'islit'</span>])
        <span style="color: #dfaf8f;">jarr</span> = np.arange(ns) - <span style="color: #DCDCCC; font-weight: bold;">float</span>(db[<span style="color: #eee8aa; font-style: italic;">'shift'</span>])
        <span style="color: #b9d3ee;">try</span>:
            <span style="color: #dfaf8f;">image_binning</span> = hdr[<span style="color: #eee8aa; font-style: italic;">'RBIN'</span>]
            <span style="color: #dfaf8f;">spec_binning</span> = shdr[<span style="color: #eee8aa; font-style: italic;">'RBIN'</span>]
        <span style="color: #b9d3ee;">except</span> <span style="color: #ccdddd;">KeyError</span>:
            <span style="color: #dfaf8f;">image_binning</span> = hdr[<span style="color: #eee8aa; font-style: italic;">'CCDYBIN'</span>]
            <span style="color: #dfaf8f;">spec_binning</span> = shdr[<span style="color: #eee8aa; font-style: italic;">'CCDYBIN'</span>]

        <span style="color: #dfaf8f;">jarr</span> *= spec_binning/image_binning
    <span style="color: #b9d3ee;">else</span>:
        <span style="color: #b9d3ee;">raise</span> <span style="color: #ccdddd;">ValueError</span>(<span style="color: #eee8aa; font-style: italic;">'Slit axis (saxis) must be 1 or 2'</span>)

    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'iarr ='</span>, iarr[::100], <span style="color: #eee8aa; font-style: italic;">'jarr ='</span>, jarr[::100])
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Also correct the nominal slit plate scale</span>
    <span style="color: #dfaf8f;">ds</span> *= spec_binning/image_binning

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Convert to world coords, using the native frame</span>
    <span style="color: #dfaf8f;">w</span> = WCS(hdr)
    <span style="color: #dfaf8f;">observed_frame</span> = w.wcs.radesys.lower()
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Note it is vital to ensure the pix2world transformation returns</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">values in the order (RA, Dec), even if the image+slit may have</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Dec first</span>
    <span style="color: #dfaf8f;">coords</span> = SkyCoord(*w.all_pix2world(iarr, jarr, 0, ra_dec_order=<span style="color: #cFfBcF;">True</span>),
                      unit=(u.deg, u.deg), frame=observed_frame)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'coords ='</span>, coords[::100])
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Binning along slit: image ='</span>, image_binning, <span style="color: #eee8aa; font-style: italic;">'spectrum ='</span>, spec_binning)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Make sure to return the coords in the ICRS frame</span>
    <span style="color: #b9d3ee;">return</span> {<span style="color: #eee8aa; font-style: italic;">'ds'</span>: ds, <span style="color: #eee8aa; font-style: italic;">'PA'</span>: PA,
            <span style="color: #eee8aa; font-style: italic;">'RA'</span>: coords.icrs.ra.value,
            <span style="color: #eee8aa; font-style: italic;">'Dec'</span>: coords.icrs.dec.value}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20"><span class="section-number-4">1.3.6</span> Package up the slit coordinates for use in a FITS header</h4>
<div class="outline-text-4" id="text-1-3-6">
<p>
We also need to create the WCS keywords so that the slit coordinates can be reconstructed from a FITS header.  The general approach is as follows: 
</p>

<ul class="org-ul">
<li>We use the standard FITS notation for axes: i, j
<ul class="org-ul">
<li>i = 1, 2, &#x2026; are the world coordinate axes</li>
<li>j = 1, 2, &#x2026; are the image (data array) coordinate axes</li>
<li>Python arrays have the order reversed</li>
<li>Reference pixel has <code>CRPIXj</code> and <code>CRVALi</code></li>
<li>Scale is specified with <code>CDELTi</code> and <code>PCi_j</code>
<ul class="org-ul">
<li><code>CDELTi</code> has the pixel scale in arcsec and wavelength</li>
<li><code>PCi_j</code> just has the rotation matrix according to the PA of the slit</li>
</ul></li>
</ul></li>
<li>The calibrated FITS spectra will be regularized so that the image x-axis (j=1 in FITS parlance) is wavelength, and the image y-axis (j=2) is displacement along slit.
<ul class="org-ul">
<li>Any necessary transpose of the data array is done <a href="#orgheadline19">in the main loop</a></li>
<li class="off"><code>[&#xa0;]</code> We could also have a degenerate third image axis that is perpendicular to the slit (dimension of 1 along this axis).  Is this necessary? Is it wise?</li>
</ul></li>
<li>We use 3 world coordinate axes, even though there are only two true image axes, so we can specify the variation of both RA and Dec along the slit
<ul class="org-ul">
<li>The <i>provisional</i> order of the axes is
<dl class="org-dl">
<dt>i = 1</dt><dd>Wavelength</dd>
<dt>i = 2</dt><dd>RA</dd>
<dt>i = 3</dt><dd>Dec</dd>
</dl></li>
<li>This is to have the best mapping between the i and j axis orderings</li>
</ul></li>
<li>We get all the wavelength info directly from the WCS of the original spectrum
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> Later, we will want to put it in velocity units, possibly as an alternate WCS axis</li>
</ul></li>
<li>We get the celestial coordinate info from the list of <code>slit_coords</code>
<ul class="org-ul">
<li>We convert these to <code>astropy.coord.SkyCoord</code> form and use the <code>separation()</code> and <code>position_angle()</code> methods between each pair of adjacent pixels</li>
<li>We then check that each pair has the same separation and PA as for the first pair
<ul class="org-ul">
<li>This works fine for the separations using the <code>np.allclose</code> default relative tolerance of 1e-5, but for the PAs I had to relax it to 1e-4</li>
<li>Then we use the separation to set <code>CDELTi</code> values and the PA to set elements of the <code>PCi_j</code> matrix</li>
</ul></li>
</ul></li>
<li>We set a load of extra WCS keywords
<ul class="org-ul">
<li>The coordinate types and units</li>
<li>The reference frame and date of observations</li>
</ul></li>
<li>At the end, we calculate the coordinates of the slit pixels using this WCS that we have created
<ul class="org-ul">
<li>In theory these should be the same as the <code>slit_coords</code> values that were fed in</li>
<li>I see differences of order 0.01 arcsec by the end of the slit
<ul class="org-ul">
<li>Not sure why, but I'm not too worried</li>
</ul></li>
</ul></li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">make_slit_wcs</span>(db, slit_coords, spechdu):
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Input WCS from original spectrum</span>
    <span style="color: #dfaf8f;">wspec</span> = WCS(spechdu.header)
    wspec.fix()

    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">First find wavelength scale from the spectrum  </span>
    <span style="color: #5F7F5F;">#</span>

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">For original spectrum, the wavelength and slit axes are 0-based,</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">but in FITS axis order instead of python access order, since</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">that is the way that that the WCS object likes to do it</span>
    <span style="color: #dfaf8f;">ospec_wavaxis</span> = 2 - db[<span style="color: #eee8aa; font-style: italic;">'saxis'</span>]
    <span style="color: #dfaf8f;">ospec_slitaxis</span> = db[<span style="color: #eee8aa; font-style: italic;">'saxis'</span>] - 1

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">The rules are that CDi_j is used if it is present, and only if</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">it is absent should CDELTi be used</span>
    <span style="color: #b9d3ee;">if</span> wspec.wcs.has_cd():
        <span style="color: #dfaf8f;">dwav</span> = wspec.wcs.cd[ospec_wavaxis, ospec_wavaxis]
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Check that the off-diagonal terms are zero</span>
        <span style="color: #b9d3ee;">assert</span>(wspec.wcs.cd[0, 1] == wspec.wcs.cd[1, 0] == 0.0)
    <span style="color: #b9d3ee;">else</span>:
        <span style="color: #dfaf8f;">dwav</span> = wspec.wcs.cdelt[ospec_wavaxis]
        <span style="color: #b9d3ee;">if</span> wspec.wcs.has_pc():
            <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">If PCi_j is also present, make sure it is identity matrix</span>
            <span style="color: #b9d3ee;">assert</span>(wspec.wcs.pc == np.eye(2))
    <span style="color: #dfaf8f;">wav0</span> = wspec.wcs.crval[ospec_wavaxis]
    <span style="color: #dfaf8f;">wavpix0</span> = wspec.wcs.crpix[ospec_wavaxis]

    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Second, find the displacement scale and ref point from the slit_coords</span>
    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">The slit_coords should already be in ICRS frame</span>
    <span style="color: #dfaf8f;">c</span> = SkyCoord(slit_coords[<span style="color: #eee8aa; font-style: italic;">'RA'</span>], slit_coords[<span style="color: #eee8aa; font-style: italic;">'Dec'</span>], unit=u.deg)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find vector of separations between adjacent pixels</span>
    <span style="color: #dfaf8f;">seps</span> = c[:-1].separation(c[1:])
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Ditto for the position angles</span>
    <span style="color: #dfaf8f;">PAs</span> = c[:-1].position_angle(c[1:])
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Check that they are all the same as the first one</span>
    <span style="color: #b9d3ee;">assert</span>(np.allclose(seps/seps[0], 1.0))
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">assert(np.allclose(PAs/PAs[0], 1.0, rtol=1.e-4))</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Then use the first one as the slit pixel size and PA</span>
    <span style="color: #dfaf8f;">ds</span>, <span style="color: #dfaf8f;">PA</span>, <span style="color: #dfaf8f;">PA_deg</span> = seps[0].deg, PAs.mean().rad, PAs.mean().deg
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">And for the reference values too</span>
    <span style="color: #dfaf8f;">RA0</span>, <span style="color: #dfaf8f;">Dec0</span> = c[0].ra.deg, c[0].dec.deg

    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Now make a new shiny output WCS, constructed from scratch</span>
    <span style="color: #5F7F5F;">#</span>
    <span style="color: #dfaf8f;">w</span> = WCS(naxis=3)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Make use of all the values that we calculated above</span>
    <span style="color: #dfaf8f;">w.wcs.crpix</span> = [wavpix0, 1, 1]
    <span style="color: #dfaf8f;">w.wcs.cdelt</span> = [dwav, ds, ds]
    <span style="color: #dfaf8f;">w.wcs.crval</span> = [wav0, RA0, Dec0]
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">PC order is i_j = [[1_1, 1_2, 1_3], [2_1, 2_2, 2_3], [3_1, 3_2, 3_3]]</span>
    <span style="color: #dfaf8f;">w.wcs.pc</span> = [[1.0, 0.0, 0.0],
                [0.0, np.sin(PA), -np.cos(PA)],
                [0.0, np.cos(PA), np.sin(PA)]]

    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Finally add in auxillary info</span>
    <span style="color: #5F7F5F;">#</span>
    <span style="color: #dfaf8f;">w.wcs.radesys</span> = <span style="color: #eee8aa; font-style: italic;">'ICRS'</span>
    <span style="color: #dfaf8f;">w.wcs.ctype</span> = [<span style="color: #eee8aa; font-style: italic;">'AWAV'</span>, <span style="color: #eee8aa; font-style: italic;">'RA---TAN'</span>, <span style="color: #eee8aa; font-style: italic;">'DEC--TAN'</span>]
    <span style="color: #dfaf8f;">w.wcs.specsys</span> = <span style="color: #eee8aa; font-style: italic;">'TOPOCENT'</span>
    <span style="color: #dfaf8f;">w.wcs.cunit</span> = [u.Angstrom, u.deg, u.deg]
    <span style="color: #dfaf8f;">w.wcs.name</span> = <span style="color: #eee8aa; font-style: italic;">'TopoWav'</span>
    <span style="color: #dfaf8f;">w.wcs.cname</span> = [<span style="color: #eee8aa; font-style: italic;">'Observed air wavelength'</span>, <span style="color: #eee8aa; font-style: italic;">'Right Ascension'</span>, <span style="color: #eee8aa; font-style: italic;">'Declination'</span>]
    <span style="color: #dfaf8f;">w.wcs.mjdobs</span> = wspec.wcs.mjdobs
    w.wcs.datfix()              <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Sets DATE-OBS from MJD-OBS</span>

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Check the new pixel values</span>
    <span style="color: #dfaf8f;">npix</span> = <span style="color: #DCDCCC; font-weight: bold;">len</span>(slit_coords[<span style="color: #eee8aa; font-style: italic;">'RA'</span>])
    <span style="color: #dfaf8f;">check_coords</span> = pixel_to_skycoord(np.arange(npix), [0]*npix, w, 0)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">These should be the same as the ICRS coords in slit_coords</span>
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'New coords:'</span>, check_coords[::100])
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Displacements in arcsec:'</span>, check_coords.separation(c).arcsec[::100])
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">15 Sep 2015: They seem to be equal to within about 1e-2 arcsec</span>

    <span style="color: #b9d3ee;">return</span> w
</pre>
</div>

<p>
Unfortunately, DS9 does not understand this lovely conformant and informative WCS structure that we have devised, so we need to dumb it down:
</p>
<ul class="org-ul">
<li>Actually I don't use this any more</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">fixup4ds9</span>(w):
    <span style="color: #dfaf8f;">w.wcs.ctype</span>  = [<span style="color: #eee8aa; font-style: italic;">'LINEAR'</span>, <span style="color: #eee8aa; font-style: italic;">'LINEAR'</span>, <span style="color: #eee8aa; font-style: italic;">'LINEAR'</span>]
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">w.wcs.cdelt[1:] *= 3600</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">w.wcs.units[1:] = 'arcsec', 'arcsec'</span>
    w.wcs.crval[1], <span style="color: #dfaf8f;">w.wcs.crval</span>[2] = 0.0, 0.0
    <span style="color: #dfaf8f;">w.wcs.name</span> = <span style="color: #eee8aa; font-style: italic;">'TopoWavDS9'</span>
    <span style="color: #b9d3ee;">return</span> w
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-4">
<h4 id="orgheadline21"><span class="section-number-4">1.3.7</span> Fit Chebyshev polynomials to along-slit variation</h4>
<div class="outline-text-4" id="text-1-3-7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">fit_cheb</span>(x, y, npoly=3, mask=<span style="color: #cFfBcF;">None</span>):
    <span style="color: #eee8aa; font-style: italic;">"""Fits a Chebyshev poly to y(x) and returns fitted y-values"""</span>
    <span style="color: #dfaf8f;">fitter</span> = fitting.LinearLSQFitter()
    <span style="color: #dfaf8f;">p_init</span> = models.Chebyshev1D(npoly, domain=[x.<span style="color: #DCDCCC; font-weight: bold;">min</span>(), x.<span style="color: #DCDCCC; font-weight: bold;">max</span>()])
    <span style="color: #b9d3ee;">if</span> mask <span style="color: #b9d3ee;">is</span> <span style="color: #cFfBcF;">None</span>:
        <span style="color: #dfaf8f;">mask</span> = np.ones_like(x).astype(<span style="color: #DCDCCC; font-weight: bold;">bool</span>)
    <span style="color: #dfaf8f;">p</span> = fitter(p_init, x[mask], y[mask])
    <span style="color: #b9d3ee;">print</span>(p)
    <span style="color: #b9d3ee;">return</span> p(x)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline22" class="outline-4">
<h4 id="orgheadline22"><span class="section-number-4">1.3.8</span> Make some useful and pretty plots</h4>
<div class="outline-text-4" id="text-1-3-8">
<ul class="org-ul">
<li>Three-pane plot that we use for manually adjusting the calibration parameters</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-22 Tue] </span></span> Add the nii/ha ratio to third pane</li>
</ul>
<div class="org-src-container">

<pre class="src src-python">sns.set_palette(<span style="color: #eee8aa; font-style: italic;">'RdPu_d'</span>, 3)
<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">make_three_plots</span>(spec, calib, prefix, niirat=<span style="color: #cFfBcF;">None</span>):
    <span style="color: #b9d3ee;">assert</span> spec.shape == calib.shape
    <span style="color: #dfaf8f;">fig</span>, <span style="color: #dfaf8f;">axes</span> = plt.subplots(3, 1)

    <span style="color: #dfaf8f;">vmin</span>, <span style="color: #dfaf8f;">vmax</span> = 0.0, np.median(calib) + 5*calib.std()

    <span style="color: #dfaf8f;">ypix</span> = np.arange(<span style="color: #DCDCCC; font-weight: bold;">len</span>(calib))
    <span style="color: #dfaf8f;">ratio</span> = spec/calib
    <span style="color: #dfaf8f;">mask</span> = (ypix &gt; 10.0) &amp; (ypix &lt; ypix.<span style="color: #DCDCCC; font-weight: bold;">max</span>() - 10.0) \
           &amp; (ratio &gt; np.median(ratio) - 2*ratio.std()) \
           &amp; (ratio &lt; np.median(ratio) + 2*ratio.std()) 
    <span style="color: #b9d3ee;">try</span>:
        <span style="color: #dfaf8f;">ratio_fit</span> = fit_cheb(ypix, ratio, mask=mask)
    <span style="color: #b9d3ee;">except</span>:
        <span style="color: #dfaf8f;">ratio_fit</span> = np.ones_like(ypix)

    <span style="color: #dfaf8f;">alpha</span> = 0.8

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">First, plot two profiles against each other to check for zero-point offsets</span>
    axes[0].plot(calib, spec/ratio_fit, <span style="color: #eee8aa; font-style: italic;">'.'</span>, alpha=alpha)
    axes[0].plot([vmin, vmax], [vmin, vmax], <span style="color: #eee8aa; font-style: italic;">'-'</span>, alpha=alpha)
    axes[0].set_xlim(vmin, vmax)
    axes[0].set_ylim(vmin, vmax)
    axes[0].set_xlabel(<span style="color: #eee8aa; font-style: italic;">'Calibration Image'</span>)
    axes[0].set_ylabel(<span style="color: #eee8aa; font-style: italic;">'Corrected Integrated Spectrum'</span>)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Second, plot each against slit pixel to check spatial offset</span>
    axes[1].plot(ypix, calib, alpha=alpha, label=<span style="color: #eee8aa; font-style: italic;">'Calibration Image'</span>)
    axes[1].plot(ypix, spec/ratio_fit, alpha=alpha, lw=1.0, label=<span style="color: #eee8aa; font-style: italic;">'Corrected Integrated Spectrum'</span>)
    axes[1].plot(ypix, spec, alpha=alpha, lw=0.5, label=<span style="color: #eee8aa; font-style: italic;">'Uncorrected Integrated Spectrum'</span>)
    axes[1].set_xlim(0.0, ypix.<span style="color: #DCDCCC; font-weight: bold;">max</span>())
    axes[1].set_ylim(vmin, vmax)
    axes[1].legend(fontsize=<span style="color: #eee8aa; font-style: italic;">'xx-small'</span>, loc=<span style="color: #eee8aa; font-style: italic;">'lower right'</span>)
    axes[1].set_xlabel(<span style="color: #eee8aa; font-style: italic;">'Slit pixel'</span>)
    axes[1].set_ylabel(<span style="color: #eee8aa; font-style: italic;">'Profile'</span>)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Third, plot ratio to look for spatial trends</span>
    axes[2].plot(ypix, ratio, alpha=alpha)
    axes[2].plot(ypix, ratio_fit, alpha=alpha)
    <span style="color: #b9d3ee;">if</span> niirat <span style="color: #b9d3ee;">is</span> <span style="color: #b9d3ee;">not</span> <span style="color: #cFfBcF;">None</span>:
        axes[2].plot(ypix, niirat, <span style="color: #eee8aa; font-style: italic;">'b'</span>)
    axes[2].set_xlim(0.0, ypix.<span style="color: #DCDCCC; font-weight: bold;">max</span>())
    axes[2].set_ylim(0.0, 1.5)
    axes[2].set_xlabel(<span style="color: #eee8aa; font-style: italic;">'Slit pixel'</span>)
    axes[2].set_ylabel(<span style="color: #eee8aa; font-style: italic;">'Ratio: Spec / Calib'</span>)


    fig.set_size_inches(5, 8)
    fig.tight_layout()
    fig.savefig(prefix+<span style="color: #eee8aa; font-style: italic;">'.png'</span>, dpi=300)

    <span style="color: #b9d3ee;">return</span> ratio_fit
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-4">
<h4 id="orgheadline23"><span class="section-number-4">1.3.9</span> Use command line argument to restrict which datasets are processed</h4>
<div class="outline-text-4" id="text-1-3-9">
<ul class="org-ul">
<li>Read a single command line argument to choose which datasets to process
<ul class="org-ul">
<li>It can be as specific as a single position:
<ul class="org-ul">
<li>E.g, 2006-02-281</li>
</ul></li>
<li>Or all positions from one set:
<ul class="org-ul">
<li>E.g, 2007-01b</li>
</ul></li>
<li>Or all from one year:
<ul class="org-ul">
<li>E.g, 2013</li>
</ul></li>
<li>Or whatever</li>
</ul></li>
<li>The purpose of this is to speed things up when iterating to find the offsets and norms</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">if</span> <span style="color: #DCDCCC; font-weight: bold;">len</span>(sys.argv) &gt; 1:
    <span style="color: #dfaf8f;">selector_pattern</span> = sys.argv[1]
<span style="color: #b9d3ee;">else</span>:
    <span style="color: #dfaf8f;">selector_pattern</span> = <span style="color: #eee8aa; font-style: italic;">''</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-4">
<h4 id="orgheadline26"><span class="section-number-4">1.3.10</span> <span class="todo TODO">TODO</span> Remove background and sum over wavelength across line</h4>
<div class="outline-text-4" id="text-1-3-10">
<ul class="org-ul">
<li>Although in principal some of the "background" is real continuum, most of it is not</li>
<li>We can get better results by simply removing it, as I did <a href="#orgheadline24">down here</a></li>
<li>But for the time being we will stick to the original simple version</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">extract_profile</span>(data, wcs, wavrest, dw=7.0):
    <span style="color: #dfaf8f;">data</span> = remove_bg_and_regularize(data, wcs, wavrest)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">pixel limits for line extraction</span>
    <span style="color: #dfaf8f;">lineslice</span> = wavs2slice([wavrest-dw/2, wavrest+dw/2], wcs)
    <span style="color: #b9d3ee;">return</span> data[:, lineslice].<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=1)
</pre>
</div>

<p>
New version, adapted from what I did in the ratio section
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">wavs2slice</span>(wavs, wcs):
    <span style="color: #eee8aa; font-style: italic;">"""Convert a wavelength interval `wavs` (length-2 sequence) to a slice of the relevant axis`"""</span>
    <span style="color: #b9d3ee;">assert</span> <span style="color: #DCDCCC; font-weight: bold;">len</span>(wavs) == 2
    <span style="color: #dfaf8f;">isT</span> = row[<span style="color: #eee8aa; font-style: italic;">'saxis'</span>] == 1
    <span style="color: #b9d3ee;">if</span> isT:
        <span style="color: #dfaf8f;">_</span>, <span style="color: #dfaf8f;">xpixels</span> = wcs.all_world2pix([0, 0], wavs, 0)
    <span style="color: #b9d3ee;">else</span>:
        <span style="color: #dfaf8f;">xpixels</span>, <span style="color: #dfaf8f;">_</span> = wcs.all_world2pix(wavs, [0, 0], 0)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Wav:'</span>, wavs, <span style="color: #eee8aa; font-style: italic;">'Pixel:'</span>, xpixels)
    <span style="color: #dfaf8f;">i1</span>, <span style="color: #dfaf8f;">i2</span> = np.maximum(0, (xpixels+0.5).astype(<span style="color: #DCDCCC; font-weight: bold;">int</span>))
    <span style="color: #b9d3ee;">return</span> <span style="color: #DCDCCC; font-weight: bold;">slice</span>(<span style="color: #DCDCCC; font-weight: bold;">min</span>(i1, i2), <span style="color: #DCDCCC; font-weight: bold;">max</span>(i1, i2))

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">remove_bg_and_regularize</span>(data, wcs, wavrest, dwbg_in=7.0, dwbg_out=10.0):
    <span style="color: #eee8aa; font-style: italic;">'''</span>
<span style="color: #eee8aa; font-style: italic;">    Transpose data if necessary, and then subtract off the background (blue and red of line)</span>
<span style="color: #eee8aa; font-style: italic;">    '''</span>
    <span style="color: #dfaf8f;">isT</span> = row[<span style="color: #eee8aa; font-style: italic;">'saxis'</span>] == 1
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Make sure array axis order is (position, wavelength)</span>
    <span style="color: #b9d3ee;">if</span> isT:
        <span style="color: #dfaf8f;">data</span> = data.T
    <span style="color: #b9d3ee;">if</span> row[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>] == <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Don't try this for the newest data, I already removed the BG</span>
        <span style="color: #b9d3ee;">return</span> data
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">pixel limits for blue, red bg extraction</span>
    <span style="color: #dfaf8f;">bslice</span> = wavs2slice([wavrest-dwbg_out/2, wavrest-dwbg_in/2], wcs)
    <span style="color: #dfaf8f;">rslice</span> = wavs2slice([wavrest+dwbg_in/2, wavrest+dwbg_out/2], wcs)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">extract backgrounds on blue and red sides</span>
    <span style="color: #dfaf8f;">bgblu</span> = data[:, bslice].mean(axis=1)
    <span style="color: #dfaf8f;">bgred</span> = data[:, rslice].mean(axis=1)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">take weighted average, accounting for cases where the bg region</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">does not fit in the image</span>
    <span style="color: #dfaf8f;">weight_blu</span> = data[:, bslice].size
    <span style="color: #dfaf8f;">weight_red</span> = data[:, rslice].size
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Background weights:'</span>, weight_blu, weight_red)
    <span style="color: #dfaf8f;">bg</span> = (bgblu*weight_blu + bgred*weight_red)/(weight_blu + weight_red)
    <span style="color: #b9d3ee;">return</span> data - bg[:, <span style="color: #cFfBcF;">None</span>]
</pre>
</div>
</div>


<div id="outline-container-orgheadline25" class="outline-5">
<h5 id="orgheadline25"><span class="section-number-5">1.3.10.1</span> Original version</h5>
<div class="outline-text-5" id="text-1-3-10-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">extract_profile</span>(data):
    <span style="color: #b9d3ee;">return</span> remove_background(data).<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=wavaxis)


<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">remove_background</span>(data):
    <span style="color: #b9d3ee;">return</span> data - row[<span style="color: #eee8aa; font-style: italic;">'zero'</span>]
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline19" class="outline-4">
<h4 id="orgheadline19"><a id="ID-C7D141C2-85FF-427D-AF2D-DCC34B14E1A4"></a><span class="section-number-4">1.3.11</span> Loop over the slit positions and do the stuff</h4>
<div class="outline-text-4" id="text-1-3-11">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">for</span> row <span style="color: #b9d3ee;">in</span> tab:
    <span style="color: #dfaf8f;">full_id</span> = row[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>] + <span style="color: #eee8aa; font-style: italic;">'-'</span> + row[<span style="color: #eee8aa; font-style: italic;">'imid'</span>]
    <span style="color: #b9d3ee;">if</span> <span style="color: #b9d3ee;">not</span> full_id.startswith(selector_pattern):
        <span style="color: #b9d3ee;">continue</span>
    <span style="color: #b9d3ee;">print</span>(row)
    <span style="color: #dfaf8f;">imslitfile</span> = find_fits_filepath(row, <span style="color: #eee8aa; font-style: italic;">'image'</span>)
    <span style="color: #dfaf8f;">specfile</span> = find_fits_filepath(row, <span style="color: #eee8aa; font-style: italic;">'fullspec'</span>)
    <span style="color: #dfaf8f;">hafile</span> = find_fits_filepath(row, <span style="color: #eee8aa; font-style: italic;">'ha'</span>)
    <span style="color: #dfaf8f;">niifile</span> = find_fits_filepath(row, <span style="color: #eee8aa; font-style: italic;">'nii'</span>)
    <span style="color: #dfaf8f;">imhdu</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(imslitfile)[0]
    <span style="color: #dfaf8f;">spechdu</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(specfile)[0]
    <span style="color: #dfaf8f;">hahdu</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(hafile)[0]
    <span style="color: #dfaf8f;">niihdu</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(niifile)[0]

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">World coordinates along slit</span>
    <span style="color: #dfaf8f;">slit_coords</span> = find_slit_coords(row, imhdu.header, hahdu.header)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find synthetic profile from calibration image</span>
    <span style="color: #dfaf8f;">calib_profile</span> = slit_profile(slit_coords[<span style="color: #eee8aa; font-style: italic;">'RA'</span>], slit_coords[<span style="color: #eee8aa; font-style: italic;">'Dec'</span>],
                                 photom.data, wphot)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find actual profile along slit from spectrum</span>
    <span style="color: #dfaf8f;">wavaxis</span> = row[<span style="color: #eee8aa; font-style: italic;">'saxis'</span>] - 1  <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">This always seems to be true</span>
    <span style="color: #dfaf8f;">ha_profile</span> = extract_profile(hahdu.data, WCS(hahdu.header), 6562.79)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Take the nii/ha calibration correction factor  from the table</span>
    <span style="color: #dfaf8f;">nii_profile</span> = row[<span style="color: #eee8aa; font-style: italic;">'r(nii)'</span>]*extract_profile(niihdu.data, WCS(niihdu.header), 6583.45)
    <span style="color: #dfaf8f;">spec_profile</span> = (ha_profile+1.333*nii_profile)/row[<span style="color: #eee8aa; font-style: italic;">'norm'</span>]
    <span style="color: #dfaf8f;">plt_prefix</span> = <span style="color: #eee8aa; font-style: italic;">'plots/{:03d}-{}-calib'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(row.index, full_id)
    <span style="color: #dfaf8f;">ratio</span> = make_three_plots(spec_profile, calib_profile, plt_prefix, niirat=nii_profile/ha_profile)

    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Save calibrated spectra to files</span>
    <span style="color: #5F7F5F;">#</span>

    <span style="color: #b9d3ee;">for</span> hdu, lineid, restwav  <span style="color: #b9d3ee;">in</span> [[hahdu, <span style="color: #eee8aa; font-style: italic;">'ha'</span>, 6562.79],
                                  [niihdu, <span style="color: #eee8aa; font-style: italic;">'nii'</span>, 6583.45]]:
        <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Saving'</span>, lineid, <span style="color: #eee8aa; font-style: italic;">'calibrated spectrum'</span>)
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Apply basic calibration zero-point and scale</span>
        <span style="color: #dfaf8f;">hdu.data</span> = remove_bg_and_regularize(hdu.data, WCS(hdu.header), restwav)/row[<span style="color: #eee8aa; font-style: italic;">'norm'</span>]
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Regularize spectral data so that wavelength is x and pos is y</span>
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">This is now done by the bg subtraction function</span>

        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Apply polynomial correction along slit</span>
        <span style="color: #dfaf8f;">hdu.data</span> /= ratio[:, <span style="color: #cFfBcF;">None</span>]
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Extend in the third dimension (degenerate axis perp to slit)</span>
        <span style="color: #dfaf8f;">hdu.data</span> = hdu.data[<span style="color: #cFfBcF;">None</span>, :, :]

        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Create the WCS object for the calibrated slit spectra</span>
        <span style="color: #dfaf8f;">wslit</span> = make_slit_wcs(row, slit_coords, hdu)
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Set the rest wavelength for this line</span>
        <span style="color: #dfaf8f;">wslit.wcs.restwav</span> = (restwav*u.Angstrom).to(u.m).value
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;"># Remove WCS keywords that might cause problems</span>
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">for i in 1, 2:</span>
        <span style="color: #5F7F5F;">#     </span><span style="color: #8b8b83; font-style: italic;">for j in 1, 2:</span>
        <span style="color: #5F7F5F;">#         </span><span style="color: #8b8b83; font-style: italic;">kwd = 'CD{}_{}'.format(i, j)</span>
        <span style="color: #5F7F5F;">#         </span><span style="color: #8b8b83; font-style: italic;">if kwd in hdu.header:</span>
        <span style="color: #5F7F5F;">#             </span><span style="color: #8b8b83; font-style: italic;">hdu.header.remove(kwd) </span>
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Then update the header with the new WCS structure as the 'A'</span>
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">alternate transform</span>
        hdu.header.update(wslit.to_header(key=<span style="color: #eee8aa; font-style: italic;">'A'</span>))
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Also save the normalization factor as a per-slit weight to use later</span>
        <span style="color: #dfaf8f;">hdu.header</span>[<span style="color: #eee8aa; font-style: italic;">'WEIGHT'</span>] = row[<span style="color: #eee8aa; font-style: italic;">'norm'</span>]

        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">And better not to change the original WCS at all</span>
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Unless we have transposed the array, which we have to compensate for</span>
        <span style="color: #b9d3ee;">if</span> row[<span style="color: #eee8aa; font-style: italic;">'saxis'</span>] == 1:
            <span style="color: #b9d3ee;">for</span> k <span style="color: #b9d3ee;">in</span> [<span style="color: #eee8aa; font-style: italic;">'CRPIX{}'</span>, <span style="color: #eee8aa; font-style: italic;">'CRVAL{}'</span>, <span style="color: #eee8aa; font-style: italic;">'CDELT{}'</span>, <span style="color: #eee8aa; font-style: italic;">'CD{0}_{0}'</span>]:
                hdu.header[k.<span style="color: #DCDCCC; font-weight: bold;">format</span>(<span style="color: #eee8aa; font-style: italic;">'1'</span>)], <span style="color: #dfaf8f;">hdu.header</span>[k.<span style="color: #DCDCCC; font-weight: bold;">format</span>(<span style="color: #eee8aa; font-style: italic;">'2'</span>)] = hdu.header[k.<span style="color: #DCDCCC; font-weight: bold;">format</span>(<span style="color: #eee8aa; font-style: italic;">'2'</span>)], hdu.header[k.<span style="color: #DCDCCC; font-weight: bold;">format</span>(<span style="color: #eee8aa; font-style: italic;">'1'</span>)] 
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;"># And write a bowdlerized version that DS9 can understand as the main WCS</span>
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">hdu.header.update(fixup4ds9(wslit).to_header(key=' '))</span>
        <span style="color: #dfaf8f;">calibfile</span> = <span style="color: #eee8aa; font-style: italic;">'Calibrated/{}-{}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(full_id, lineid)
        hdu.writeto(calibfile, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline27" class="outline-4">
<h4 id="orgheadline27"><span class="section-number-4">1.3.12</span> Test what is going on</h4>
<div class="outline-text-4" id="text-1-3-12">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">print(wphot.wcs)</span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">for row in tab:</span>
<span style="color: #5F7F5F;">#     </span><span style="color: #8b8b83; font-style: italic;">print([row[x] for x in ('Dataset', 'imid', 'specid', 'Notes')])</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline29" class="outline-3">
<h3 id="orgheadline29"><span class="section-number-3">1.4</span> Run slit-calibration.py</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>For debugging we can redirect stdout to stderr with <code>1&gt;&amp;2</code>
<ul class="org-ul">
<li>This means that the normal output (e.g., print statements) will show up in the <code>*Org-Babel Error Output*</code> buffer</li>
</ul></li>
</ul>

<div class="org-src-container">

<pre class="src src-sh">python slit-calibration.py  <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">1&gt;&amp;2</span>
</pre>
</div>

<pre class="example">
&lt;Row 0 of table
 values=('2006-02', '326', '324', 2, 283.5, 74.0, 1000, 1.0, 1.8, 'LL2 first epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp326-ardec.fits
~/Work/SPM2005/pp324.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec324-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec324-nii.fits
iarr = [ 283.5  283.5  283.5  283.5  283.5  283.5] jarr = [ -74.   26.  126.  226.  326.  426.]
coords = &lt;SkyCoord (FK4: equinox=B1950.000, obstime=B1950.000): (ra, dec) in deg
    [(83.05872963, -5.46776112), (83.0584093, -5.45046954),
     (83.05808898, -5.43317795), (83.05776868, -5.41588636),
     (83.0574484, -5.39859478), (83.05712814, -5.38130321)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.67290928  83.67267318  83.67243709  83.67220102  83.67196496
  83.67172891] [-5.43558101 -5.41828808 -5.40099516 -5.38370224 -5.36640932 -5.34911642]
[ 5612.  5615.  5619.  5622.  5626.  5630.] [ 4520.  4781.  5043.  5304.  5566.  5827.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3       
    ------------- --------------- ---------------- ----------------
    1.03654560373 0.0552079560052 -0.0480102937533 -0.0205920904115
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67290928, -5.43558101), (83.67267319, -5.41828809),
     (83.67243713, -5.40099517), (83.67220107, -5.38370226),
     (83.67196503, -5.36640936), (83.671729, -5.34911647)]&gt;
Displacements in arcsec: [  8.58749764e-12   6.20268567e-05   1.26808548e-04   1.96898220e-04
   2.74517678e-04   3.61494280e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67290928, -5.43558101), (83.67267319, -5.41828809),
     (83.67243713, -5.40099517), (83.67220107, -5.38370226),
     (83.67196503, -5.36640936), (83.671729, -5.34911647)]&gt;
Displacements in arcsec: [  8.58749764e-12   6.20268567e-05   1.26808548e-04   1.96898220e-04
   2.74517678e-04   3.61494280e-04]
&lt;Row 1 of table
 values=('2006-02', '318', '319', 2, 280.0, 78.0, 3300, 3.0, 1.8, 'LL2 first epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp318-ardec.fits
~/Work/SPM2005/pp319.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec319-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec319-nii.fits
iarr = [ 280.  280.  280.  280.  280.  280.] jarr = [ -78.   22.  122.  222.  322.  422.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.67221103, -5.4345169), (83.67193445, -5.4172216),
     (83.67165789, -5.3999263), (83.67138134, -5.382631),
     (83.67110482, -5.3653357), (83.6708283, -5.34804041)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.67220496  83.67192838  83.67165182  83.67137528  83.67109875
  83.67082223] [-5.43451169 -5.41721639 -5.39992109 -5.38262578 -5.36533049 -5.3480352 ]
[ 5622.  5627.  5631.  5635.  5639.  5643.] [ 4536.  4797.  5059.  5321.  5582.  5844.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0            c1             c2               c3       
    ------------- ------------- ---------------- ----------------
    1.03501516229 0.10923769379 -0.0233531261762 -0.0359008858877
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67220496, -5.43451169), (83.6719284, -5.41721639),
     (83.67165186, -5.3999211), (83.67137534, -5.38262581),
     (83.67109883, -5.36533053), (83.67082234, -5.34803526)]&gt;
Displacements in arcsec: [  1.43124961e-11   7.29112642e-05   1.50078204e-04   2.35399109e-04
   3.32129432e-04   4.42805597e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67220496, -5.43451169), (83.6719284, -5.41721639),
     (83.67165186, -5.3999211), (83.67137534, -5.38262581),
     (83.67109883, -5.36533053), (83.67082234, -5.34803526)]&gt;
Displacements in arcsec: [  1.43124961e-11   7.29112642e-05   1.50078204e-04   2.35399109e-04
   3.32129432e-04   4.42805597e-04]
&lt;Row 2 of table
 values=('2006-02', '260', '261', 2, 251.4, 55.0, 3600, 1.0, 1.8, 'LL2 first epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp260-ardec.fits
~/Work/SPM2005/pp261.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec261-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec261-nii.fits
iarr = [ 251.4  251.4  251.4  251.4  251.4  251.4] jarr = [ -55.   45.  145.  245.  345.  445.]
coords = &lt;SkyCoord (FK4: equinox=B1950.000, obstime=B1950.000): (ra, dec) in deg
    [(83.05691874, -5.46408808), (83.05663285, -5.44687129),
     (83.05634697, -5.42965451), (83.05606112, -5.41243772),
     (83.05577528, -5.39522094), (83.05548945, -5.37800417)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.67111639  83.67091437  83.67071236  83.67051036  83.67030837
  83.6701064 ] [-5.43189927 -5.41468131 -5.39746336 -5.3802454  -5.36302746 -5.34580952]
[ 5639.  5642.  5645.  5648.  5651.  5654.] [ 4575.  4836.  5096.  5357.  5617.  5877.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0            c1              c2              c3       
    ------------- -------------- --------------- ----------------
    0.97695198007 0.152122951372 0.0216968685733 -0.0165160919713
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67111639, -5.43189927), (83.67091438, -5.41468131),
     (83.67071239, -5.39746336), (83.6705104, -5.38024542),
     (83.67030843, -5.36302748), (83.67010647, -5.34580956)]&gt;
Displacements in arcsec: [  2.28999937e-11   5.27844711e-05   1.07824904e-04   1.67211516e-04
   2.32772508e-04   3.06021538e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67111639, -5.43189927), (83.67091438, -5.41468131),
     (83.67071239, -5.39746336), (83.6705104, -5.38024542),
     (83.67030843, -5.36302748), (83.67010647, -5.34580956)]&gt;
Displacements in arcsec: [  2.28999937e-11   5.27844711e-05   1.07824904e-04   1.67211516e-04
   2.32772508e-04   3.06021538e-04]
&lt;Row 3 of table
 values=('2006-02', '270', '271', 2, 253.5, 60.0, 6500, 4.0, 1.8, 'LL2 first epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp270-ardec.fits
~/Work/SPM2005/pp271.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec271-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec271-nii.fits
iarr = [ 253.5  253.5  253.5  253.5  253.5  253.5] jarr = [ -60.   40.  140.  240.  340.  440.]
coords = &lt;SkyCoord (FK4: equinox=B1950.000, obstime=B1950.000): (ra, dec) in deg
    [(83.05647681, -5.4640169), (83.0561316, -5.44675464),
     (83.0557864, -5.42949239), (83.05544123, -5.41223013),
     (83.05509608, -5.39496789), (83.05475095, -5.37770565)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.67067483  83.67041372  83.67015261  83.66989153  83.66963045
  83.6693694 ] [-5.43182595 -5.41456224 -5.39729853 -5.38003483 -5.36277113 -5.34550743]
[ 5645.  5649.  5653.  5657.  5661.  5665.] [ 4576.  4838.  5099.  5360.  5621.  5882.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2              c3       
    -------------- -------------- --------------- ----------------
    0.994425136971 0.163518687642 0.0342168885265 -0.0152008823235
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67067483, -5.43182595), (83.67041373, -5.41456224),
     (83.67015265, -5.39729854), (83.66989158, -5.38003484),
     (83.66963053, -5.36277115), (83.66936949, -5.34550748)]&gt;
Displacements in arcsec: [  2.57624929e-11   6.82297013e-05   1.38214523e-04   2.11619850e-04
   2.89979386e-04   3.74655076e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67067483, -5.43182595), (83.67041373, -5.41456224),
     (83.67015265, -5.39729854), (83.66989158, -5.38003484),
     (83.66963053, -5.36277115), (83.66936949, -5.34550748)]&gt;
Displacements in arcsec: [  2.57624929e-11   6.82297013e-05   1.38214523e-04   2.11619850e-04
   2.89979386e-04   3.74655076e-04]
&lt;Row 4 of table
 values=('2006-02', '276', '277', 2, 256.0, 60.0, 7000, 6.0, 1.8, 'LL2 first epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp276-ardec.fits
~/Work/SPM2005/pp277.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec277-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec277-nii.fits
iarr = [ 256.  256.  256.  256.  256.  256.] jarr = [ -60.   40.  140.  240.  340.  440.]
coords = &lt;SkyCoord (FK4: equinox=B1950.000, obstime=B1950.000): (ra, dec) in deg
    [(83.05603409, -5.46389959), (83.05568586, -5.44664967),
     (83.05533766, -5.42939975), (83.05498947, -5.41214983),
     (83.05464131, -5.39489992), (83.05429317, -5.37765002)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.67023271  83.66996852  83.66970435  83.66944019  83.66917604
  83.66891191] [-5.43170651 -5.41445512 -5.39720373 -5.37995234 -5.36270096 -5.34544959]
[ 5652.  5656.  5660.  5664.  5668.  5672.] [ 4578.  4839.  5100.  5361.  5622.  5883.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3       
    -------------- -------------- --------------- -----------------
    0.991568343571 0.157710423915 0.0215012499446 -0.00662717002486
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67023271, -5.43170651), (83.66996854, -5.41445512),
     (83.66970439, -5.39720373), (83.66944025, -5.37995236),
     (83.66917612, -5.36270099), (83.66891201, -5.34544963)]&gt;
Displacements in arcsec: [  1.71749953e-11   6.89723111e-05   1.39654810e-04   2.13670512e-04
   2.92519406e-04   3.77538912e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67023271, -5.43170651), (83.66996854, -5.41445512),
     (83.66970439, -5.39720373), (83.66944025, -5.37995236),
     (83.66917612, -5.36270099), (83.66891201, -5.34544963)]&gt;
Displacements in arcsec: [  1.71749953e-11   6.89723111e-05   1.39654810e-04   2.13670512e-04
   2.92519406e-04   3.77538912e-04]
&lt;Row 5 of table
 values=('2006-02', '281', '282', 2, 257.7, 64.0, 3600, 8.0, 1.8, 'LL2 first epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp281-ardec.fits
~/Work/SPM2005/pp282.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec282-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec282-nii.fits
iarr = [ 257.7  257.7  257.7  257.7  257.7  257.7] jarr = [ -64.   36.  136.  236.  336.  436.]
coords = &lt;SkyCoord (FK4: equinox=B1950.000, obstime=B1950.000): (ra, dec) in deg
    [(83.05515786, -5.4639996), (83.05481115, -5.44673089),
     (83.05446446, -5.42946218), (83.05411778, -5.41219347),
     (83.05377113, -5.39492477), (83.0534245, -5.37765608)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.66935606  83.66909347  83.6688309   83.66856834  83.6683058
  83.66804327] [-5.43180229 -5.41453212 -5.39726194 -5.37999177 -5.36272161 -5.34545146]
[ 5665.  5669.  5673.  5677.  5681.  5685.] [ 4577.  4838.  5099.  5360.  5622.  5883.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
         c0            c1              c2               c3       
    ------------ -------------- ---------------- ----------------
    1.2264861603 0.152897453932 0.00458770458405 -0.0277663695623
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66935606, -5.43180229), (83.66909349, -5.41453212),
     (83.66883094, -5.39726195), (83.6685684, -5.37999179),
     (83.66830588, -5.36272164), (83.66804337, -5.3454515)]&gt;
Displacements in arcsec: [  1.14499969e-11   6.86347065e-05   1.39008272e-04   2.12772233e-04
   2.91449020e-04   3.76393745e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66935606, -5.43180229), (83.66909349, -5.41453212),
     (83.66883094, -5.39726195), (83.6685684, -5.37999179),
     (83.66830588, -5.36272164), (83.66804337, -5.3454515)]&gt;
Displacements in arcsec: [  1.14499969e-11   6.86347065e-05   1.39008272e-04   2.12772233e-04
   2.91449020e-04   3.76393745e-04]
&lt;Row 6 of table
 values=('2006-02', '286', '287', 2, 261.0, 64.0, 4000, 8.0, 1.8, 'LL2 first epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp286-ardec.fits
~/Work/SPM2005/pp287.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec287-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec287-nii.fits
iarr = [ 261.  261.  261.  261.  261.  261.] jarr = [ -64.   36.  136.  236.  336.  436.]
coords = &lt;SkyCoord (FK4: equinox=B1950.000, obstime=B1950.000): (ra, dec) in deg
    [(83.0546046, -5.46394719), (83.05424179, -5.44667985),
     (83.05387901, -5.42941252), (83.05351624, -5.41214519),
     (83.0531535, -5.39487786), (83.05279078, -5.37761055)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.66880309  83.6685244   83.66824573  83.66796708  83.66768844
  83.66740982] [-5.43174721 -5.41447833 -5.39720946 -5.37994059 -5.36267172 -5.34540287]
[ 5674.  5678.  5682.  5686.  5690.  5695.] [ 4578.  4839.  5100.  5361.  5622.  5884.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3       
    -------------- -------------- ---------------- ----------------
    0.995189584398 0.128543926324 0.00127316209807 -0.0299083819602
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66880309, -5.43174721), (83.66852442, -5.41447833),
     (83.66824577, -5.39720947), (83.66796714, -5.3799406),
     (83.66768852, -5.36267175), (83.66740992, -5.34540291)]&gt;
Displacements in arcsec: [  8.58749764e-12   7.28056167e-05   1.47240693e-04   2.24857630e-04
   3.07101139e-04   3.95273197e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66880309, -5.43174721), (83.66852442, -5.41447833),
     (83.66824577, -5.39720947), (83.66796714, -5.3799406),
     (83.66768852, -5.36267175), (83.66740992, -5.34540291)]&gt;
Displacements in arcsec: [  8.58749764e-12   7.28056167e-05   1.47240693e-04   2.24857630e-04
   3.07101139e-04   3.95273197e-04]
&lt;Row 7 of table
 values=('2006-02', '291', '292', 2, 262.7, 65.0, 6000, 6.0, 1.8, 'LL2 first epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp291-ardec.fits
~/Work/SPM2005/pp292.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec292-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec292-nii.fits
iarr = [ 262.7  262.7  262.7  262.7  262.7  262.7] jarr = [ -65.   35.  135.  235.  335.  435.]
coords = &lt;SkyCoord (FK4: equinox=B1950.000, obstime=B1950.000): (ra, dec) in deg
    [(83.05416481, -5.46384309), (83.05384842, -5.44665942),
     (83.05353205, -5.42947575), (83.05321571, -5.41229209),
     (83.05289937, -5.39510843), (83.05258306, -5.37792478)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.66836383  83.66813116  83.66789849  83.66766584  83.66743321
  83.66720058] [-5.43164099 -5.414456   -5.39727102 -5.38008604 -5.36290106 -5.3457161 ]
[ 5680.  5684.  5687.  5691.  5694.  5698.] [ 4579.  4839.  5099.  5359.  5619.  5879.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3       
    -------------- -------------- ---------------- ----------------
    0.873285266082 0.123669945253 0.00280405086531 -0.0200415273475
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66836383, -5.43164099), (83.66813117, -5.414456),
     (83.66789853, -5.39727103), (83.66766589, -5.38008605),
     (83.66743327, -5.36290109), (83.66720067, -5.34571614)]&gt;
Displacements in arcsec: [  1.14499969e-11   6.05687755e-05   1.23034034e-04   1.89181649e-04
   2.60628760e-04   3.38777909e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66836383, -5.43164099), (83.66813117, -5.414456),
     (83.66789853, -5.39727103), (83.66766589, -5.38008605),
     (83.66743327, -5.36290109), (83.66720067, -5.34571614)]&gt;
Displacements in arcsec: [  1.14499969e-11   6.05687755e-05   1.23034034e-04   1.89181649e-04
   2.60628760e-04   3.38777909e-04]
&lt;Row 8 of table
 values=('2006-02', '296', '297', 2, 267.0, 66.0, 3000, 8.0, 1.8, 'LL2 first epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp296-ardec.fits
~/Work/SPM2005/pp297.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec297-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec297-nii.fits
iarr = [ 267.  267.  267.  267.  267.  267.] jarr = [ -66.   34.  134.  234.  334.  434.]
coords = &lt;SkyCoord (FK4: equinox=B1950.000, obstime=B1950.000): (ra, dec) in deg
    [(83.05318453, -5.46382238), (83.0528729, -5.44657699),
     (83.0525613, -5.4293316), (83.05224971, -5.41208621),
     (83.05193814, -5.39484083), (83.05162658, -5.37759546)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.66738372  83.6671561   83.6669285   83.66670091  83.66647333
  83.66624577] [-5.43161555 -5.41436887 -5.39712218 -5.3798755  -5.36262883 -5.34538216]
[ 5695.  5698.  5702.  5705.  5709.  5712.] [ 4580.  4840.  5101.  5362.  5623.  5884.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0            c1             c2               c3       
    ------------- ------------- ---------------- ----------------
    1.01313704116 0.12703034738 -0.0014290472296 -0.0291056435684
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66738372, -5.43161555), (83.66715612, -5.41436887),
     (83.66692853, -5.39712219), (83.66670096, -5.37987552),
     (83.6664734, -5.36262885), (83.66624585, -5.3453822)]&gt;
Displacements in arcsec: [  2.86249921e-12   5.94760042e-05   1.20903632e-04   1.86116574e-04
   2.56767114e-04   3.34279964e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66738372, -5.43161555), (83.66715612, -5.41436887),
     (83.66692853, -5.39712219), (83.66670096, -5.37987552),
     (83.6664734, -5.36262885), (83.66624585, -5.3453822)]&gt;
Displacements in arcsec: [  2.86249921e-12   5.94760042e-05   1.20903632e-04   1.86116574e-04
   2.56767114e-04   3.34279964e-04]
&lt;Row 9 of table
 values=('2006-02', '303', '304', 2, 270.5, 70.0, 3300, 8.0, 1.8, 'LL2 first epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp303-ardec.fits
~/Work/SPM2005/pp304.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec304-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec304-nii.fits
iarr = [ 270.5  270.5  270.5  270.5  270.5  270.5] jarr = [ -70.   30.  130.  230.  330.  430.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.6663405, -5.43285584), (83.66612466, -5.41556767),
     (83.66590884, -5.3982795), (83.66569303, -5.38099133),
     (83.66547723, -5.36370317), (83.66526145, -5.34641501)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.66633443  83.6661186   83.66590277  83.66568696  83.66547117
  83.66525538] [-5.43285063 -5.41556246 -5.39827429 -5.38098612 -5.36369795 -5.3464098 ]
[ 5711.  5714.  5717.  5721.  5724.  5727.] [ 4561.  4822.  5084.  5345.  5607.  5868.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3       
    -------------- -------------- ---------------- ----------------
    0.984792900478 0.107249493916 0.00200020164547 -0.0508369711799
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66633443, -5.43285063), (83.66611861, -5.41556246),
     (83.66590281, -5.3982743), (83.66568701, -5.38098614),
     (83.66547123, -5.36369799), (83.66525546, -5.34640986)]&gt;
Displacements in arcsec: [  5.72499843e-12   5.69760944e-05   1.17971418e-04   1.86595529e-04
   2.65761292e-04   3.57641334e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66633443, -5.43285063), (83.66611861, -5.41556246),
     (83.66590281, -5.3982743), (83.66568701, -5.38098614),
     (83.66547123, -5.36369799), (83.66525546, -5.34640986)]&gt;
Displacements in arcsec: [  5.72499843e-12   5.69760944e-05   1.17971418e-04   1.86595529e-04
   2.65761292e-04   3.57641334e-04]
&lt;Row 10 of table
 values=('2006-02', '313', '312', 2, 278.0, 70.0, 2600, 6.0, 1.8, 'Image follows spec!')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/Papers/LL-Objects/feb2006/pp313-ardec.fits
~/Work/SPM2005/pp312.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec312-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec312-nii.fits
iarr = [ 278.  278.  278.  278.  278.  278.] jarr = [ -70.   30.  130.  230.  330.  430.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.6577296, -5.43362307), (83.65745278, -5.41632339),
     (83.65717599, -5.3990237), (83.65689921, -5.38172401),
     (83.65662244, -5.36442432), (83.65634569, -5.34712464)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.65772353  83.65744672  83.65716992  83.65689314  83.65661637
  83.65633962] [-5.43361786 -5.41631817 -5.39901848 -5.38171879 -5.36441911 -5.34711943]
[ 5840.  5845.  5849.  5853.  5857.  5861.] [ 4549.  4811.  5073.  5334.  5596.  5858.]
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
Wav: [6559.29, 6566.29] Pixel: [  29.48427623  189.47647283]
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
Wav: [6579.95, 6586.95] Pixel: [  21.64518546  181.13602566]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0            c1              c2              c3       
    ------------- -------------- --------------- ----------------
    1.06557214851 0.129561432143 0.0215127765245 -0.0682427409982
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ -4.7997659   29.48427623]
Wav: [6566.29, 6567.79] Pixel: [ 189.47647283  223.76051496]
Background weights: 14848 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.65772353, -5.43361786), (83.65744674, -5.41631817),
     (83.65716996, -5.39901849), (83.6568932, -5.38171882),
     (83.65661645, -5.36441915), (83.65633972, -5.3471195)]&gt;
Displacements in arcsec: [  2.28999937e-11   7.30212201e-05   1.50538729e-04   2.36648963e-04
   3.34741668e-04   4.47426861e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [-12.53142316  21.64518546]
Wav: [6586.95, 6588.45] Pixel: [ 181.13602566  215.31263428]
Background weights: 11264 9728
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.65772353, -5.43361786), (83.65744674, -5.41631817),
     (83.65716996, -5.39901849), (83.6568932, -5.38171882),
     (83.65661645, -5.36441915), (83.65633972, -5.3471195)]&gt;
Displacements in arcsec: [  2.28999937e-11   7.30212201e-05   1.50538729e-04   2.36648963e-04
   3.34741668e-04   4.47426861e-04]
&lt;Row 11 of table
 values=('2007-01b', '2061', '2062-c', 2, 256.0, 65.0, 7000, 20.0, 1.8, 'LL2 second epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spm2061-ardec.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2062-c.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2062-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2062-nii.fits
iarr = [ 256.  256.  256.  256.  256.  256.] jarr = [ -65.   35.  135.  235.  335.  435.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.67502547, -5.43793388), (83.67443849, -5.42073519),
     (83.67385154, -5.40353649), (83.67326462, -5.38633779),
     (83.67267774, -5.36913909), (83.67209089, -5.35194041)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.67501941  83.67443242  83.67384547  83.67325856  83.67267168
  83.67208483] [-5.43792867 -5.42072997 -5.40353127 -5.38633257 -5.36913388 -5.35193519]
[ 5580.  5589.  5598.  5607.  5615.  5624.] [ 4484.  4744.  5004.  5265.  5525.  5785.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3       
    -------------- -------------- ---------------- ----------------
    0.953961168808 0.106297575171 -0.0168793452001 -0.0171905281979
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67501941, -5.43792867), (83.67443247, -5.42072997),
     (83.67384556, -5.40353128), (83.67325869, -5.38633259),
     (83.67267185, -5.36913391), (83.67208504, -5.35193524)]&gt;
Displacements in arcsec: [  2.00374945e-11   1.52756199e-04   3.06823168e-04   4.63501380e-04
   6.24055573e-04   7.89698030e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67501941, -5.43792867), (83.67443247, -5.42072997),
     (83.67384556, -5.40353128), (83.67325869, -5.38633259),
     (83.67267185, -5.36913391), (83.67208504, -5.35193524)]&gt;
Displacements in arcsec: [  2.00374945e-11   1.52756199e-04   3.06823168e-04   4.63501380e-04
   6.24055573e-04   7.89698030e-04]
&lt;Row 12 of table
 values=('2007-01b', '2037', '2038-2040', 2, 249.0, 60.0, 7000, 16.0, 1.8, 'LL2 second epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spm2037-ardec.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2038-2040.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2038-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2038-nii.fits
iarr = [ 249.  249.  249.  249.  249.  249.] jarr = [ -60.   40.  140.  240.  340.  440.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.67314611, -5.44332573), (83.67259306, -5.42610746),
     (83.67204003, -5.40888917), (83.67148704, -5.39167089),
     (83.67093408, -5.37445261), (83.67038115, -5.35723434)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.67314005  83.67258699  83.67203397  83.67148097  83.67092801
  83.67037508] [-5.44332052 -5.42610224 -5.40888396 -5.39166568 -5.3744474  -5.35722913]
[ 5608.  5617.  5625.  5633.  5642.  5650.] [ 4403.  4663.  4923.  5184.  5444.  5705.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2              c3       
    -------------- -------------- --------------- ----------------
    0.960532974543 0.103584373895 -0.025029137432 -0.0185422424819
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67314005, -5.44332052), (83.67258703, -5.42610224),
     (83.67203405, -5.40888397), (83.6714811, -5.3916657),
     (83.67092818, -5.37444744), (83.67037529, -5.35722919)]&gt;
Displacements in arcsec: [ 0.          0.00014436  0.00029076  0.00044121  0.00059763  0.00076181]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67314005, -5.44332052), (83.67258703, -5.42610224),
     (83.67203405, -5.40888397), (83.6714811, -5.3916657),
     (83.67092818, -5.37444744), (83.67037529, -5.35722919)]&gt;
Displacements in arcsec: [ 0.          0.00014436  0.00029076  0.00044121  0.00059763  0.00076181]
&lt;Row 13 of table
 values=('2007-01b', '2041', '2042-2044', 2, 250.0, 63.0, 7000, 21.0, 1.8, 'LL2 second epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spm2041-ardec.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2042-2044.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2042-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2042-nii.fits
iarr = [ 250.  250.  250.  250.  250.  250.] jarr = [ -63.   37.  137.  237.  337.  437.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.66822515, -5.44328616), (83.66766792, -5.42606952),
     (83.66711072, -5.40885287), (83.66655355, -5.39163623),
     (83.66599642, -5.37441958), (83.66543931, -5.35720295)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.66821909  83.66766186  83.66710466  83.66654749  83.66599035
  83.66543324] [-5.44328095 -5.4260643  -5.40884766 -5.39163101 -5.37441437 -5.35719773]
[ 5682.  5691.  5699.  5708.  5716.  5724.] [ 4403.  4664.  4924.  5184.  5445.  5705.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3       
    -------------- --------------- ---------------- ----------------
    0.969491163475 0.0889742866858 -0.0506027328398 -0.0166836943988
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66821909, -5.44328095), (83.6676619, -5.4260643),
     (83.66710474, -5.40884767), (83.66654761, -5.39163103),
     (83.66599051, -5.37441441), (83.66543345, -5.3571978)]&gt;
Displacements in arcsec: [  2.86249921e-12   1.45424092e-04   2.92848283e-04   4.44240974e-04
   6.01484265e-04   7.66338898e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66821909, -5.44328095), (83.6676619, -5.4260643),
     (83.66710474, -5.40884767), (83.66654761, -5.39163103),
     (83.66599051, -5.37441441), (83.66543345, -5.3571978)]&gt;
Displacements in arcsec: [  2.86249921e-12   1.45424092e-04   2.92848283e-04   4.44240974e-04
   6.01484265e-04   7.66338898e-04]
&lt;Row 14 of table
 values=('2007-01b', '2045', '2046-2048', 2, 251.5, 64.0, 6500, 25.0, 1.8, 'LL2 second epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spm2045-ardec.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2046-2048.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2046-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2046-nii.fits
iarr = [ 251.5  251.5  251.5  251.5  251.5  251.5] jarr = [ -64.   36.  136.  236.  336.  436.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.66605163, -5.44334042), (83.66553564, -5.42606452),
     (83.66501967, -5.40878861), (83.66450373, -5.3915127),
     (83.66398782, -5.3742368), (83.66347194, -5.3569609)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.66604557  83.66552957  83.6650136   83.66449766  83.66398176
  83.66346588] [-5.44333521 -5.4260593  -5.40878339 -5.39150749 -5.37423158 -5.35695568]
[ 5715.  5723.  5731.  5738.  5746.  5754.] [ 4402.  4664.  4925.  5186.  5448.  5709.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3       
    -------------- --------------- ---------------- ----------------
    0.957395189614 0.0983086061814 -0.0348475187008 0.00399224759929
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66604557, -5.44333521), (83.66552961, -5.4260593),
     (83.66501368, -5.4087834), (83.66449778, -5.39150751),
     (83.66398191, -5.37423162), (83.66346607, -5.35695575)]&gt;
Displacements in arcsec: [  2.86249921e-12   1.35169145e-04   2.72523433e-04   4.14203854e-04
   5.62241875e-04   7.18517410e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66604557, -5.44333521), (83.66552961, -5.4260593),
     (83.66501368, -5.4087834), (83.66449778, -5.39150751),
     (83.66398191, -5.37423162), (83.66346607, -5.35695575)]&gt;
Displacements in arcsec: [  2.86249921e-12   1.35169145e-04   2.72523433e-04   4.14203854e-04
   5.62241875e-04   7.18517410e-04]
&lt;Row 15 of table
 values=('2007-01b', '2049', '2050-2052', 2, 253.0, 65.0, 7000, 25.0, 1.8, 'LL2 second epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spm2049-ardec.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2050-2052.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2050-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2050-nii.fits
iarr = [ 253.  253.  253.  253.  253.  253.] jarr = [ -65.   35.  135.  235.  335.  435.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.66403557, -5.44332049), (83.66356493, -5.42607417),
     (83.66309432, -5.40882783), (83.66262373, -5.3915815),
     (83.66215318, -5.37433518), (83.66168265, -5.35708886)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.6640295   83.66355886  83.66308825  83.66261767  83.66214711
  83.66167658] [-5.44331528 -5.42606895 -5.40882262 -5.39157629 -5.37432996 -5.35708364]
[ 5745.  5753.  5760.  5767.  5774.  5781.] [ 4403.  4663.  4924.  5185.  5446.  5707.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3       
    -------------- --------------- ---------------- ----------------
    0.976845101094 0.0895062173778 -0.0510894326991 0.00828141500794
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.6640295, -5.44331528), (83.6635589, -5.42606895),
     (83.66308832, -5.40882263), (83.66261777, -5.39157631),
     (83.66214725, -5.37433), (83.66167675, -5.35708371)]&gt;
Displacements in arcsec: [  1.43124961e-11   1.23132135e-04   2.48639987e-04   3.78840094e-04
   5.15907775e-04   6.61828535e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.6640295, -5.44331528), (83.6635589, -5.42606895),
     (83.66308832, -5.40882263), (83.66261777, -5.39157631),
     (83.66214725, -5.37433), (83.66167675, -5.35708371)]&gt;
Displacements in arcsec: [  1.43124961e-11   1.23132135e-04   2.48639987e-04   3.78840094e-04
   5.15907775e-04   6.61828535e-04]
&lt;Row 16 of table
 values=('2007-01b', '2053', '2054-2056', 2, 254.5, 68.0, 7000, 25.0, 1.8, 'LL2 second epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spm2053-ardec.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2054-2056.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2054-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2054-nii.fits
iarr = [ 254.5  254.5  254.5  254.5  254.5  254.5] jarr = [ -68.   32.  132.  232.  332.  432.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.66223974, -5.43809419), (83.66169211, -5.42089816),
     (83.66114451, -5.40370213), (83.66059694, -5.3865061),
     (83.66004941, -5.36931008), (83.6595019, -5.35211406)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.66223368  83.66168605  83.66113845  83.66059088  83.66004334
  83.65949583] [-5.43808897 -5.42089295 -5.40369692 -5.38650089 -5.36930487 -5.35210885]
[ 5772.  5781.  5789.  5797.  5806.  5814.] [ 4482.  4742.  5002.  5262.  5522.  5782.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2                c3        
    -------------- --------------- ---------------- ------------------
    0.966654340462 0.0576311710693 -0.0431747629687 -0.000564781345439
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66223368, -5.43808897), (83.66168609, -5.42089295),
     (83.66113853, -5.40369692), (83.660591, -5.38650091),
     (83.6600435, -5.3693049), (83.65949603, -5.3521089)]&gt;
Displacements in arcsec: [  2.28999937e-11   1.42513177e-04   2.86405299e-04   4.33042403e-04
   5.83747687e-04   7.39783015e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.66223368, -5.43808897), (83.66168609, -5.42089295),
     (83.66113853, -5.40369692), (83.660591, -5.38650091),
     (83.6600435, -5.3693049), (83.65949603, -5.3521089)]&gt;
Displacements in arcsec: [  2.28999937e-11   1.42513177e-04   2.86405299e-04   4.33042403e-04
   5.83747687e-04   7.39783015e-04]
&lt;Row 17 of table
 values=('2007-01b', '2057', '2058-2060', 2, 254.5, 66.0, 7000, 25.0, 1.8, 'LL2 second epoch')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spm2057-ardec.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2058-2060.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2058-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2058-nii.fits
iarr = [ 254.5  254.5  254.5  254.5  254.5  254.5] jarr = [ -66.   34.  134.  234.  334.  434.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.65952076, -5.43815979), (83.65901719, -5.42097433),
     (83.65851365, -5.40378887), (83.65801014, -5.38660341),
     (83.65750666, -5.36941796), (83.6570032, -5.35223251)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.6595147   83.65901113  83.65850759  83.65800407  83.65750059
  83.65699713] [-5.43815458 -5.42096912 -5.40378366 -5.3865982  -5.36941274 -5.3522273 ]
[ 5813.  5821.  5829.  5836.  5844.  5852.] [ 4481.  4741.  5001.  5260.  5520.  5780.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3      
    -------------- --------------- ---------------- ---------------
    0.970367144459 0.0932265913695 -0.0356504240689 0.0321892312533
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.6595147, -5.43815458), (83.65901117, -5.42096912),
     (83.65850766, -5.40378367), (83.65800418, -5.38659822),
     (83.65750074, -5.36941278), (83.65699732, -5.35222735)]&gt;
Displacements in arcsec: [  2.28999937e-11   1.30996400e-04   2.63493024e-04   3.98971677e-04
   5.38859965e-04   6.84508252e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.6595147, -5.43815458), (83.65901117, -5.42096912),
     (83.65850766, -5.40378367), (83.65800418, -5.38659822),
     (83.65750074, -5.36941278), (83.65699732, -5.35222735)]&gt;
Displacements in arcsec: [  2.28999937e-11   1.30996400e-04   2.63493024e-04   3.98971677e-04
   5.38859965e-04   6.84508252e-04]
&lt;Row 18 of table
 values=('2007-01', '054', '055', 2, 262.5, 68.0, 5000, 10.0, 1.9, 'LL1 extreme N')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Work/SPM2007/Reduced/spm054-ardec.fits
~/Work/SPM2007/Reduced/spec055-transf.fits
~/Work/SPM2007/Reduced/spec055-ha-fix.fits
~/Work/SPM2007/Reduced/spec055-nii-fix.fits
iarr = [ 262.5  262.5  262.5  262.5  262.5  262.5] jarr = [ -68.   32.  132.  232.  332.  432.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.77285169, -5.48878211), (83.77278744, -5.47148237),
     (83.7727232, -5.45418262), (83.77265896, -5.43688287),
     (83.77259473, -5.41958312), (83.7725305, -5.40228336)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.77284563  83.77278138  83.77271714  83.7726529   83.77258866
  83.77252443] [-5.48877689 -5.47147715 -5.4541774  -5.43687765 -5.41957789 -5.40227814]
[ 4107.  4108.  4109.  4110.  4111.  4112.] [ 3715.  3977.  4238.  4500.  4762.  5023.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298433  44.42959874]
Wav: [6586.95, 6588.45] Pixel: [ 203.92046602  238.09708044]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.42959874  203.92046602]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2               c3      
    -------------- ---------------- ---------------- ---------------
    0.950780557873 -0.0214243017748 -0.0343672699169 0.0168974892052
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.77284563, -5.48877689), (83.77278139, -5.47147716),
     (83.77271715, -5.45417743), (83.77265291, -5.4368777),
     (83.77258868, -5.41957799), (83.77252445, -5.40227829)]&gt;
Displacements in arcsec: [  2.86249921e-12   2.67248915e-05   8.97388558e-05   1.94055598e-04
   3.40045727e-04   5.27768258e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298433  44.42959874]
Wav: [6586.95, 6588.45] Pixel: [ 203.92046602  238.09708044]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.77284563, -5.48877689), (83.77278139, -5.47147716),
     (83.77271715, -5.45417743), (83.77265291, -5.4368777),
     (83.77258868, -5.41957799), (83.77252445, -5.40227829)]&gt;
Displacements in arcsec: [  2.86249921e-12   2.67248915e-05   8.97388558e-05   1.94055598e-04
   3.40045727e-04   5.27768258e-04]
&lt;Row 19 of table
 values=('2007-01', '067', '068', 2, 273.0, 72.0, 5000, 10.0, 1.9, 'LL1 extreme N')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Work/SPM2007/Reduced/spm067-ardec.fits
~/Work/SPM2007/Reduced/spec068-transf.fits
~/Work/SPM2007/Reduced/spec068-ha-fix.fits
~/Work/SPM2007/Reduced/spec068-nii-fix.fits
iarr = [ 273.  273.  273.  273.  273.  273.] jarr = [ -72.   28.  128.  228.  328.  428.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.77130626, -5.48904065), (83.77117784, -5.47173182),
     (83.77104942, -5.45442298), (83.77092101, -5.43711413),
     (83.77079261, -5.41980528), (83.77066422, -5.40249643)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.7713002   83.77117177  83.77104336  83.77091495  83.77078655
  83.77065815] [-5.48903543 -5.4717266  -5.45441776 -5.43710891 -5.41980006 -5.40249121]
[ 4130.  4132.  4134.  4136.  4138.  4140.] [ 3711.  3973.  4235.  4497.  4758.  5020.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298433  44.42959874]
Wav: [6586.95, 6588.45] Pixel: [ 203.92046602  238.09708044]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.42959874  203.92046602]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2               c3      
    -------------- ---------------- ---------------- ---------------
    0.935726292278 -0.0513283678189 -0.0289173295904 0.0316460770054
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.7713002, -5.48903543), (83.77117178, -5.4717266),
     (83.77104338, -5.45441778), (83.77091498, -5.43710896),
     (83.77078659, -5.41980015), (83.7706582, -5.40249136)]&gt;
Displacements in arcsec: [  1.71749953e-11   3.98560611e-05   1.08212941e-04   2.15607029e-04
   3.64449079e-04   5.55346024e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298433  44.42959874]
Wav: [6586.95, 6588.45] Pixel: [ 203.92046602  238.09708044]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.7713002, -5.48903543), (83.77117178, -5.4717266),
     (83.77104338, -5.45441778), (83.77091498, -5.43710896),
     (83.77078659, -5.41980015), (83.7706582, -5.40249136)]&gt;
Displacements in arcsec: [  1.71749953e-11   3.98560611e-05   1.08212941e-04   2.15607029e-04
   3.64449079e-04   5.55346024e-04]
&lt;Row 20 of table
 values=('2007-01', '072', '073', 2, 277.5, 74.0, 5200, 10.0, 1.8, 'LL1 extreme N')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Work/SPM2007/Reduced/spm072-ardec.fits
~/Work/SPM2007/Reduced/spec073-transf.fits
~/Work/SPM2007/Reduced/spec073-ha-fix.fits
~/Work/SPM2007/Reduced/spec073-nii-fix.fits
iarr = [ 277.5  277.5  277.5  277.5  277.5  277.5] jarr = [ -74.   26.  126.  226.  326.  426.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.77054404, -5.48899134), (83.77047005, -5.47172396),
     (83.77039607, -5.45445657), (83.77032209, -5.43718918),
     (83.77024812, -5.41992178), (83.77017415, -5.40265439)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.77053797  83.77046399  83.77039001  83.77031603  83.77024205
  83.77016808] [-5.48898612 -5.47171874 -5.45445135 -5.43718396 -5.41991656 -5.40264917]
[ 4142.  4143.  4144.  4145.  4146.  4147.] [ 3712.  3973.  4234.  4495.  4757.  5018.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298433  44.42959874]
Wav: [6586.95, 6588.45] Pixel: [ 203.92046602  238.09708044]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.42959874  203.92046602]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1             c2              c3      
    -------------- --------------- -------------- ---------------
    0.932298711843 0.0493572124528 -0.04676320083 0.0192191992977
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.77053797, -5.48898612), (83.77046399, -5.47171874),
     (83.77039002, -5.45445137), (83.77031604, -5.43718401),
     (83.77024208, -5.41991665), (83.77016811, -5.40264931)]&gt;
Displacements in arcsec: [  1.14499969e-11   2.76265823e-05   8.78862108e-05   1.86930886e-04
   3.25403307e-04   5.03417020e-04]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298433  44.42959874]
Wav: [6586.95, 6588.45] Pixel: [ 203.92046602  238.09708044]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.77053797, -5.48898612), (83.77046399, -5.47171874),
     (83.77039002, -5.45445137), (83.77031604, -5.43718401),
     (83.77024208, -5.41991665), (83.77016811, -5.40264931)]&gt;
Displacements in arcsec: [  1.14499969e-11   2.76265823e-05   8.78862108e-05   1.86930886e-04
   3.25403307e-04   5.03417020e-04]
&lt;Row 21 of table
 values=('2010-01', '078', '079-080', 2, 248.0, 62.0, 5500, 2.0, 1.8, 'Vertical W of LL2')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm078-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm079-080h.fits
~/Dropbox/SPMJAN10/reducciones/spec079-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec079-nii.fits
iarr = [ 248.  248.  248.  248.  248.  248.] jarr = [ -62.   38.  138.  238.  338.  438.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.63656721, -5.436557), (83.63752307, -5.41930392),
     (83.63847887, -5.40205084), (83.63943461, -5.38479775),
     (83.64039031, -5.36754467), (83.64134595, -5.35029159)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.63656115  83.637517    83.6384728   83.63942855  83.64038424
  83.64133988] [-5.43655178 -5.41929871 -5.40204562 -5.38479254 -5.36753945 -5.35028637]
[ 6159.  6145.  6130.  6116.  6102.  6087.] [ 4505.  4766.  5027.  5288.  5549.  5810.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3       
    -------------- --------------- ---------------- ----------------
    0.962208536256 0.0807176824379 -0.0399917631984 -0.0294928247661
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.63656115, -5.43655178), (83.63751693, -5.41929871),
     (83.63847266, -5.40204563), (83.63942834, -5.38479256),
     (83.64038396, -5.3675395), (83.64133953, -5.35028644)]&gt;
Displacements in arcsec: [  5.72499843e-12   2.49695832e-04   5.01476779e-04   7.57413498e-04
   1.01952032e-03   1.28973083e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.63656115, -5.43655178), (83.63751693, -5.41929871),
     (83.63847266, -5.40204563), (83.63942834, -5.38479256),
     (83.64038396, -5.3675395), (83.64133953, -5.35028644)]&gt;
Displacements in arcsec: [  5.72499843e-12   2.49695832e-04   5.01476779e-04   7.57413498e-04
   1.01952032e-03   1.28973083e-03]
&lt;Row 22 of table
 values=('2010-01', '202', '203-204', 2, 233.6, 52.5, 6500, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm202-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm203-204h.fits
~/Dropbox/SPMJAN10/reducciones/spec203-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec203-nii.fits
iarr = [ 233.6  233.6  233.6  233.6  233.6  233.6] jarr = [ -52.5   47.5  147.5  247.5  347.5  447.5]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.61784607, -5.47002199), (83.61880251, -5.45269796),
     (83.6197589, -5.43537392), (83.62071524, -5.41804987),
     (83.62167152, -5.40072582), (83.62262774, -5.38340178)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.61784001  83.61879645  83.61975284  83.62070917  83.62166545
  83.62262168] [-5.47001678 -5.45269275 -5.4353687  -5.41804466 -5.40072061 -5.38339657]
[ 6441.  6426.  6412.  6398.  6383.  6369.] [ 3999.  4261.  4523.  4785.  5047.  5309.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3      
    -------------- -------------- ---------------- ---------------
    0.941634345096 0.104908918127 -0.0238186239514 0.0126187682739
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61784001, -5.47001678), (83.61879638, -5.45269275),
     (83.6197527, -5.43536871), (83.62070896, -5.41804468),
     (83.62166517, -5.40072066), (83.62262132, -5.38339665)]&gt;
Displacements in arcsec: [  2.28999937e-11   2.52517026e-04   5.07747230e-04   7.68373644e-04
   1.03698609e-03   1.31604282e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61784001, -5.47001678), (83.61879638, -5.45269275),
     (83.6197527, -5.43536871), (83.62070896, -5.41804468),
     (83.62166517, -5.40072066), (83.62262132, -5.38339665)]&gt;
Displacements in arcsec: [  2.28999937e-11   2.52517026e-04   5.07747230e-04   7.68373644e-04
   1.03698609e-03   1.31604282e-03]
&lt;Row 23 of table
 values=('2010-01', '124', '125-127', 2, 235.5, 54.5, 3400, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm124-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm125-127h.fits
~/Dropbox/SPMJAN10/reducciones/spec125-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec125-nii.fits
iarr = [ 235.5  235.5  235.5  235.5  235.5  235.5] jarr = [ -54.5   45.5  145.5  245.5  345.5  445.5]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.61529723, -5.47174328), (83.61632517, -5.45448975),
     (83.61735305, -5.43723621), (83.61838087, -5.41998267),
     (83.61940863, -5.40272913), (83.62043633, -5.38547558)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.61529117  83.61631911  83.61734698  83.6183748   83.61940256
  83.62043026] [-5.47173806 -5.45448454 -5.437231   -5.41997746 -5.40272391 -5.38547037]
[ 6479.  6464.  6448.  6433.  6418.  6402.] [ 3973.  4234.  4494.  4755.  5016.  5277.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2               c3      
    -------------- ---------------- ---------------- ---------------
    0.990808847308 -0.0480488429998 -0.0665176978421 0.0470944793526
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61529117, -5.47173806), (83.61631903, -5.45448454),
     (83.61734683, -5.43723101), (83.61837457, -5.41997749),
     (83.61940226, -5.40272397), (83.62042988, -5.38547047)]&gt;
Displacements in arcsec: [  1.14499969e-11   2.70530661e-04   5.44478294e-04   8.25211694e-04
   1.11596270e-03   1.41977184e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61529117, -5.47173806), (83.61631903, -5.45448454),
     (83.61734683, -5.43723101), (83.61837457, -5.41997749),
     (83.61940226, -5.40272397), (83.62042988, -5.38547047)]&gt;
Displacements in arcsec: [  1.14499969e-11   2.70530661e-04   5.44478294e-04   8.25211694e-04
   1.11596270e-03   1.41977184e-03]
&lt;Row 24 of table
 values=('2010-01', '206', '207-208', 2, 234.6, 54.0, 7700, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm206-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm207-208h.fits
~/Dropbox/SPMJAN10/reducciones/spec207-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec207-nii.fits
iarr = [ 234.6  234.6  234.6  234.6  234.6  234.6] jarr = [ -54.   46.  146.  246.  346.  446.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.61406519, -5.46986179), (83.61506998, -5.45259233),
     (83.61607472, -5.43532287), (83.61707939, -5.41805339),
     (83.61808401, -5.40078392), (83.61908857, -5.38351444)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.61405913  83.61506392  83.61606865  83.61707333  83.61807795
  83.61908251] [-5.46985658 -5.45258712 -5.43531765 -5.41804818 -5.4007787  -5.38350923]
[ 6498.  6483.  6468.  6453.  6437.  6422.] [ 4001.  4262.  4523.  4785.  5046.  5307.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3       
    -------------- -------------- ---------------- ----------------
    0.891506982508 0.105836861703 -0.0296410128879 -0.0395735377681
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61405913, -5.46985658), (83.61506385, -5.45258712),
     (83.61606851, -5.43531766), (83.61707311, -5.41804821),
     (83.61807765, -5.40077876), (83.61908213, -5.38350933)]&gt;
Displacements in arcsec: [  5.72499843e-12   2.64564329e-04   5.32440353e-04   8.06893662e-04
   1.09105800e-03   1.38788356e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61405913, -5.46985658), (83.61506385, -5.45258712),
     (83.61606851, -5.43531766), (83.61707311, -5.41804821),
     (83.61807765, -5.40077876), (83.61908213, -5.38350933)]&gt;
Displacements in arcsec: [  5.72499843e-12   2.64564329e-04   5.32440353e-04   8.06893662e-04
   1.09105800e-03   1.38788356e-03]
&lt;Row 25 of table
 values=('2010-01', '128', '129-130', 2, 237.5, 57.0, 3500, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm128-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm129-130h.fits
~/Dropbox/SPMJAN10/reducciones/spec129-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec129-nii.fits
iarr = [ 237.5  237.5  237.5  237.5  237.5  237.5] jarr = [ -57.   43.  143.  243.  343.  443.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.6127125, -5.47202677), (83.61372484, -5.45474627),
     (83.61473713, -5.43746576), (83.61574935, -5.42018524),
     (83.61676152, -5.40290473), (83.61777363, -5.38562421)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.61270644  83.61371878  83.61473106  83.61574329  83.61675546
  83.61776757] [-5.47202155 -5.45474105 -5.43746054 -5.42018003 -5.40289951 -5.385619  ]
[ 6518.  6503.  6488.  6473.  6457.  6442.] [ 3968.  4230.  4491.  4752.  5014.  5275.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2               c3      
    -------------- ---------------- ---------------- ---------------
    0.877596740281 -0.0268985433478 -0.0845136893671 0.0678641300318
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61270644, -5.47202155), (83.61371871, -5.45474105),
     (83.61473092, -5.43746056), (83.61574306, -5.42018006),
     (83.61675516, -5.40289958), (83.61776719, -5.3856191)]&gt;
Displacements in arcsec: [  2.57624929e-11   2.66873446e-04   5.37325459e-04   8.14879510e-04
   1.10290734e-03   1.40457020e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61270644, -5.47202155), (83.61371871, -5.45474105),
     (83.61473092, -5.43746056), (83.61574306, -5.42018006),
     (83.61675516, -5.40289958), (83.61776719, -5.3856191)]&gt;
Displacements in arcsec: [  2.57624929e-11   2.66873446e-04   5.37325459e-04   8.14879510e-04
   1.10290734e-03   1.40457020e-03]
&lt;Row 26 of table
 values=('2010-01', '133', '134-135', 2, 239.4, 58.0, 5500, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm133-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm134-135h.fits
~/Dropbox/SPMJAN10/reducciones/spec134-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec134-nii.fits
iarr = [ 239.4  239.4  239.4  239.4  239.4  239.4] jarr = [ -58.   42.  142.  242.  342.  442.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.61300795, -5.46641905), (83.61400089, -5.44913861),
     (83.61499378, -5.43185816), (83.61598661, -5.4145777),
     (83.61697938, -5.39729724), (83.61797209, -5.38001678)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.61300189  83.61399483  83.61498771  83.61598054  83.61697331
  83.61796603] [-5.46641384 -5.4491334  -5.43185295 -5.41457249 -5.39729203 -5.38001157]
[ 6514.  6499.  6484.  6469.  6454.  6439.] [ 4053.  4314.  4576.  4837.  5099.  5360.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3       
    -------------- --------------- ---------------- ----------------
    0.950627011665 0.0609712010032 -0.0444860390564 -0.0224491262254
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61300189, -5.46641384), (83.61399476, -5.4491334),
     (83.61498757, -5.43185296), (83.61598032, -5.41457252),
     (83.61697302, -5.39729209), (83.61796565, -5.38001168)]&gt;
Displacements in arcsec: [  1.71749953e-11   2.61545221e-04   5.27037218e-04   8.00353041e-04
   1.08518300e-03   1.38495958e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61300189, -5.46641384), (83.61399476, -5.4491334),
     (83.61498757, -5.43185296), (83.61598032, -5.41457252),
     (83.61697302, -5.39729209), (83.61796565, -5.38001168)]&gt;
Displacements in arcsec: [  1.71749953e-11   2.61545221e-04   5.27037218e-04   8.00353041e-04
   1.08518300e-03   1.38495958e-03]
&lt;Row 27 of table
 values=('2010-01', '210', '211-212', 2, 236.4, 55.0, 7000, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm210-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm211-212h.fits
~/Dropbox/SPMJAN10/reducciones/spec211-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec211-nii.fits
iarr = [ 236.4  236.4  236.4  236.4  236.4  236.4] jarr = [ -55.   45.  145.  245.  345.  445.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.61147366, -5.46987356), (83.61247377, -5.4525994),
     (83.61347382, -5.43532523), (83.61447382, -5.41805105),
     (83.61547375, -5.40077688), (83.61647363, -5.38350271)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.6114676   83.61246771  83.61346776  83.61446775  83.61546769
  83.61646757] [-5.46986834 -5.45259418 -5.43532001 -5.41804584 -5.40077167 -5.38349749]
[ 6537.  6522.  6507.  6492.  6477.  6462.] [ 4001.  4262.  4523.  4785.  5046.  5307.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
         c0            c1              c2               c3      
    ------------ -------------- ---------------- ---------------
    1.0352214659 0.185413814537 0.00750572627067 -0.030354390992
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.6114676, -5.46986834), (83.61246764, -5.45259418),
     (83.61346761, -5.43532002), (83.61446753, -5.41804587),
     (83.61546739, -5.40077172), (83.61646719, -5.38349759)]&gt;
Displacements in arcsec: [  5.72499843e-12   2.63342699e-04   5.29644442e-04   8.01829102e-04
   1.08271456e-03   1.37496918e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.6114676, -5.46986834), (83.61246764, -5.45259418),
     (83.61346761, -5.43532002), (83.61446753, -5.41804587),
     (83.61546739, -5.40077172), (83.61646719, -5.38349759)]&gt;
Displacements in arcsec: [  5.72499843e-12   2.63342699e-04   5.29644442e-04   8.01829102e-04
   1.08271456e-03   1.37496918e-03]
&lt;Row 28 of table
 values=('2010-01', '137', '138-139', 2, 241.3, 60.0, 3600, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm137-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm138-139h.fits
~/Dropbox/SPMJAN10/reducciones/spec138-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec138-nii.fits
iarr = [ 241.3  241.3  241.3  241.3  241.3  241.3] jarr = [ -60.   40.  140.  240.  340.  440.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.61040503, -5.46643003), (83.61140154, -5.44914799),
     (83.612398, -5.43186594), (83.61339439, -5.41458388),
     (83.61439074, -5.39730182), (83.61538702, -5.38001976)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.61039897  83.61139548  83.61239193  83.61338833  83.61438467
  83.61538095] [-5.46642482 -5.44914278 -5.43186073 -5.41457867 -5.39729661 -5.38001455]
[ 6553.  6538.  6523.  6508.  6493.  6478.] [ 4053.  4314.  4576.  4837.  5099.  5360.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3      
    -------------- --------------- ---------------- ---------------
    0.984237921825 0.0612575550185 -0.0328943684461 0.0277863586968
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61039897, -5.46642482), (83.6113954, -5.44914278),
     (83.61239178, -5.43186074), (83.61338811, -5.4145787),
     (83.61438437, -5.39729667), (83.61538058, -5.38001465)]&gt;
Displacements in arcsec: [  2.86249921e-12   2.62502217e-04   5.28894632e-04   8.02998876e-04
   1.08845524e-03   1.38865487e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61039897, -5.46642482), (83.6113954, -5.44914278),
     (83.61239178, -5.43186074), (83.61338811, -5.4145787),
     (83.61438437, -5.39729667), (83.61538058, -5.38001465)]&gt;
Displacements in arcsec: [  2.86249921e-12   2.62502217e-04   5.28894632e-04   8.02998876e-04
   1.08845524e-03   1.38865487e-03]
&lt;Row 29 of table
 values=('2010-01', '214', '215-216', 2, 238.4, 60.0, 7500, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm214-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm215-216h.fits
~/Dropbox/SPMJAN10/reducciones/spec215-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec215-nii.fits
iarr = [ 238.4  238.4  238.4  238.4  238.4  238.4] jarr = [ -60.   40.  140.  240.  340.  440.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.60908238, -5.4706217), (83.61003921, -5.45329387),
     (83.61099598, -5.43596603), (83.61195269, -5.41863819),
     (83.61290935, -5.40131035), (83.61386596, -5.3839825)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.60907632  83.61003315  83.61098992  83.61194663  83.61290329
  83.61385989] [-5.47061649 -5.45328866 -5.43596082 -5.41863298 -5.40130513 -5.38397729]
[ 6573.  6558.  6544.  6530.  6515.  6501.] [ 3989.  4252.  4514.  4776.  5038.  5300.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3       
    -------------- --------------- ---------------- ----------------
    0.945355907357 0.0814244421562 -0.0266554133037 -0.0657238722603
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60907632, -5.47061649), (83.61003308, -5.45328866),
     (83.61098977, -5.43596083), (83.61194642, -5.418633),
     (83.612903, -5.40130519), (83.61385954, -5.38397738)]&gt;
Displacements in arcsec: [  2.57624929e-11   2.52742966e-04   5.08457415e-04   7.70076814e-04
   1.04042315e-03   1.32216271e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60907632, -5.47061649), (83.61003308, -5.45328866),
     (83.61098977, -5.43596083), (83.61194642, -5.418633),
     (83.612903, -5.40130519), (83.61385954, -5.38397738)]&gt;
Displacements in arcsec: [  2.57624929e-11   2.52742966e-04   5.08457415e-04   7.70076814e-04
   1.04042315e-03   1.32216271e-03]
&lt;Row 30 of table
 values=('2010-01', '145', '146-147', 2, 244.3, 65.0, 1000, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm145-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm146-147h.fits
~/Dropbox/SPMJAN10/reducciones/spec146-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec146-nii.fits
iarr = [ 244.3  244.3  244.3  244.3  244.3  244.3] jarr = [ -65.   35.  135.  235.  335.  435.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.60754605, -5.46607162), (83.6085671, -5.44882985),
     (83.6095881, -5.43158808), (83.61060904, -5.4143463),
     (83.61162992, -5.39710452), (83.61265074, -5.37986273)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.60753999  83.60856104  83.60958204  83.61060298  83.61162386
  83.61264468] [-5.46606641 -5.44882464 -5.43158287 -5.41434109 -5.3970993  -5.37985752]
[ 6596.  6581.  6565.  6550.  6535.  6519.] [ 4058.  4319.  4580.  4841.  5102.  5362.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2               c3       
    -------------- ---------------- ---------------- ----------------
    0.950736004549 -0.0535631541194 -0.0244428847836 -0.0188681086146
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60753999, -5.46606641), (83.60856097, -5.44882464),
     (83.60958189, -5.43158288), (83.61060275, -5.41434112),
     (83.61162355, -5.39709938), (83.6126443, -5.37985764)]&gt;
Displacements in arcsec: [  2.86249921e-12   2.68432789e-04   5.41337232e-04   8.23092569e-04
   1.11784621e-03   1.42942879e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60753999, -5.46606641), (83.60856097, -5.44882464),
     (83.60958189, -5.43158288), (83.61060275, -5.41434112),
     (83.61162355, -5.39709938), (83.6126443, -5.37985764)]&gt;
Displacements in arcsec: [  2.86249921e-12   2.68432789e-04   5.41337232e-04   8.23092569e-04
   1.11784621e-03   1.42942879e-03]
&lt;Row 31 of table
 values=('2010-01', '248', '249-250', 2, 254.9, 68.0, 3300, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm248-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm249-250h.fits
~/Dropbox/SPMJAN10/reducciones/spec249-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec249-nii.fits
iarr = [ 254.9  254.9  254.9  254.9  254.9  254.9] jarr = [ -68.   32.  132.  232.  332.  432.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.60679942, -5.47089817), (83.60777996, -5.45361665),
     (83.60876044, -5.43633511), (83.60974087, -5.41905358),
     (83.61072125, -5.40177204), (83.61170156, -5.3844905)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.60679336  83.6077739   83.60875438  83.60973481  83.61071518
  83.6116955 ] [-5.47089296 -5.45361144 -5.4363299  -5.41904836 -5.40176683 -5.38448529]
[ 6607.  6592.  6578.  6563.  6548.  6534.] [ 3985.  4247.  4508.  4770.  5031.  5292.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0               c1               c2               c3       
    -------------- ----------------- ---------------- ----------------
    0.919327217771 -0.00513733541169 -0.0204660921523 -0.0714882165109
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60679336, -5.47089296), (83.60777383, -5.45361144),
     (83.60875424, -5.43632991), (83.60973459, -5.41904839),
     (83.61071489, -5.40176688), (83.61169513, -5.38448538)]&gt;
Displacements in arcsec: [  2.00374945e-11   2.58377250e-04   5.19933314e-04   7.87803298e-04
   1.06499879e-03   1.35435720e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60679336, -5.47089296), (83.60777383, -5.45361144),
     (83.60875424, -5.43632991), (83.60973459, -5.41904839),
     (83.61071489, -5.40176688), (83.61169513, -5.38448538)]&gt;
Displacements in arcsec: [  2.00374945e-11   2.58377250e-04   5.19933314e-04   7.87803298e-04
   1.06499879e-03   1.35435720e-03]
&lt;Row 32 of table
 values=('2010-01', '219', '220-221', 2, 240.0, 57.5, 7700, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm219-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm220-221h.fits
~/Dropbox/SPMJAN10/reducciones/spec220-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec220-nii.fits
iarr = [ 240.  240.  240.  240.  240.  240.] jarr = [ -57.5   42.5  142.5  242.5  342.5  442.5]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.605688, -5.47027797), (83.60670247, -5.45300916),
     (83.60771688, -5.43574033), (83.60873124, -5.41847151),
     (83.60974554, -5.40120268), (83.61075977, -5.38393385)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.60568194  83.60669641  83.60771082  83.60872517  83.60973947
  83.61075371] [-5.47027276 -5.45300394 -5.43573512 -5.41846629 -5.40119747 -5.38392864]
[ 6624.  6609.  6593.  6578.  6563.  6548.] [ 3995.  4256.  4517.  4778.  5040.  5301.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3      
    -------------- -------------- ---------------- ---------------
    0.940350987447 0.113970138081 -0.0709785874232 0.0232200454661
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60568194, -5.47027276), (83.60669633, -5.45300394),
     (83.60771067, -5.43573513), (83.60872495, -5.41846632),
     (83.60973917, -5.40119752), (83.61075333, -5.38392873)]&gt;
Displacements in arcsec: [  2.28999937e-11   2.67033546e-04   5.36815228e-04   8.12064332e-04
   1.09540975e-03   1.38935175e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60568194, -5.47027276), (83.60669633, -5.45300394),
     (83.60771067, -5.43573513), (83.60872495, -5.41846632),
     (83.60973917, -5.40119752), (83.61075333, -5.38392873)]&gt;
Displacements in arcsec: [  2.28999937e-11   2.67033546e-04   5.36815228e-04   8.12064332e-04
   1.09540975e-03   1.38935175e-03]
&lt;Row 33 of table
 values=('2010-01', '157', '158-159', 2, 252.2, 65.0, 1600, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm157-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm158-159h.fits
~/Dropbox/SPMJAN10/reducciones/spec158-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec158-nii.fits
iarr = [ 252.2  252.2  252.2  252.2  252.2  252.2] jarr = [ -65.   35.  135.  235.  335.  435.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.60468528, -5.46689807), (83.60570962, -5.44967572),
     (83.60673389, -5.43245336), (83.60775811, -5.41523099),
     (83.60878228, -5.39800862), (83.60980638, -5.38078625)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.60467922  83.60570355  83.60672783  83.60775205  83.60877621
  83.60980031] [-5.46689286 -5.44967051 -5.43244815 -5.41522578 -5.39800341 -5.38078103]
[ 6639.  6624.  6608.  6593.  6578.  6562.] [ 4046.  4306.  4567.  4827.  5088.  5348.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0               c1               c2               c3      
    -------------- ----------------- ---------------- ---------------
    0.929830008835 0.000583991448376 -0.0364028520259 -0.046332299623
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60467922, -5.46689286), (83.60570348, -5.44967051),
     (83.60672768, -5.43244816), (83.60775182, -5.41522582),
     (83.60877591, -5.39800348), (83.60979993, -5.38078115)]&gt;
Displacements in arcsec: [  2.00374945e-11   2.69057842e-04   5.42712501e-04   8.25462335e-04
   1.12156172e-03   1.43493233e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60467922, -5.46689286), (83.60570348, -5.44967051),
     (83.60672768, -5.43244816), (83.60775182, -5.41522582),
     (83.60877591, -5.39800348), (83.60979993, -5.38078115)]&gt;
Displacements in arcsec: [  2.00374945e-11   2.69057842e-04   5.42712501e-04   8.25462335e-04
   1.12156172e-03   1.43493233e-03]
&lt;Row 34 of table
 values=('2010-01', '236', '237-238', 2, 247.0, 63.0, 7200, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm236-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm237-238h.fits
~/Dropbox/SPMJAN10/reducciones/spec237-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec237-nii.fits
iarr = [ 247.  247.  247.  247.  247.  247.] jarr = [ -63.   37.  137.  237.  337.  437.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.60419996, -5.47048556), (83.60518167, -5.45319777),
     (83.60616333, -5.43590996), (83.60714493, -5.41862216),
     (83.60812647, -5.40133435), (83.60910796, -5.38404654)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.6041939   83.60517561  83.60615726  83.60713886  83.60812041
  83.60910189] [-5.47048035 -5.45319256 -5.43590475 -5.41861695 -5.40132914 -5.38404133]
[ 6646.  6632.  6617.  6602.  6587.  6573.] [ 3992.  4253.  4515.  4776.  5038.  5299.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1             c2               c3      
    -------------- ------------- ---------------- ---------------
    0.957434035099 0.10392363196 -0.0610306523461 0.0252423316486
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.6041939, -5.47048035), (83.60517554, -5.45319256),
     (83.60615712, -5.43590476), (83.60713865, -5.41861697),
     (83.60812011, -5.40132919), (83.60910153, -5.38404142)]&gt;
Displacements in arcsec: [  1.43124961e-11   2.58709704e-04   5.20298772e-04   7.87613165e-04
   1.06339631e-03   1.35024758e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.6041939, -5.47048035), (83.60517554, -5.45319256),
     (83.60615712, -5.43590476), (83.60713865, -5.41861697),
     (83.60812011, -5.40132919), (83.60910153, -5.38404142)]&gt;
Displacements in arcsec: [  1.43124961e-11   2.58709704e-04   5.20298772e-04   7.87613165e-04
   1.06339631e-03   1.35024758e-03]
&lt;Row 35 of table
 values=('2010-01', '240', '241-242', 2, 249.5, 65.0, 5500, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm240-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm241-242h.fits
~/Dropbox/SPMJAN10/reducciones/spec241-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec241-nii.fits
iarr = [ 249.5  249.5  249.5  249.5  249.5  249.5] jarr = [ -65.   35.  135.  235.  335.  435.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.60239606, -5.47068361), (83.60338903, -5.45339048),
     (83.60438195, -5.43609734), (83.60537481, -5.41880419),
     (83.60636761, -5.40151105), (83.60736036, -5.3842179)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.60239     83.60338297  83.60437589  83.60536875  83.60636155
  83.60735429] [-5.4706784  -5.45338526 -5.43609212 -5.41879898 -5.40150583 -5.38421269]
[ 6673.  6659.  6644.  6629.  6614.  6599.] [ 3989.  4250.  4512.  4773.  5035.  5296.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2                c3       
    -------------- --------------- ---------------- -----------------
    0.925101856726 0.0776052558352 -0.0364371466346 -0.00720346675347
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60239, -5.4706784), (83.6033829, -5.45338527),
     (83.60437574, -5.43609213), (83.60536852, -5.41879901),
     (83.60636125, -5.40150589), (83.60735392, -5.38421279)]&gt;
Displacements in arcsec: [  2.86249921e-12   2.61816051e-04   5.26782770e-04   7.98009723e-04
   1.07848587e-03   1.37103122e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60239, -5.4706784), (83.6033829, -5.45338527),
     (83.60437574, -5.43609213), (83.60536852, -5.41879901),
     (83.60636125, -5.40150589), (83.60735392, -5.38421279)]&gt;
Displacements in arcsec: [  2.86249921e-12   2.61816051e-04   5.26782770e-04   7.98009723e-04
   1.07848587e-03   1.37103122e-03]
&lt;Row 36 of table
 values=('2010-01', '244', '245-246', 2, 251.6, 64.0, 4500, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm244-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm245-246h.fits
~/Dropbox/SPMJAN10/reducciones/spec245-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec245-nii.fits
iarr = [ 251.6  251.6  251.6  251.6  251.6  251.6] jarr = [ -64.   36.  136.  236.  336.  436.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.60064615, -5.47055353), (83.60162455, -5.45322291),
     (83.60260289, -5.43589229), (83.60358118, -5.41856166),
     (83.60455941, -5.40123102), (83.60553759, -5.38390039)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.60064008  83.60161848  83.60259683  83.60357512  83.60455335
  83.60553152] [-5.47054832 -5.4532177  -5.43588707 -5.41855644 -5.40122581 -5.38389518]
[ 6700.  6685.  6670.  6656.  6641.  6626.] [ 3990.  4253.  4515.  4777.  5039.  5301.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3       
    -------------- --------------- ---------------- ----------------
    0.929750752195 0.0664161196007 -0.0178580609628 -0.0240467745689
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60064008, -5.47054832), (83.60161841, -5.4532177),
     (83.60259668, -5.43588708), (83.6035749, -5.41855647),
     (83.60455306, -5.40122587), (83.60553116, -5.38389528)]&gt;
Displacements in arcsec: [  1.71749953e-11   2.58526392e-04   5.20265105e-04   7.88384299e-04
   1.06592559e-03   1.35575307e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.60064008, -5.47054832), (83.60161841, -5.4532177),
     (83.60259668, -5.43588708), (83.6035749, -5.41855647),
     (83.60455306, -5.40122587), (83.60553116, -5.38389528)]&gt;
Displacements in arcsec: [  1.71749953e-11   2.58526392e-04   5.20265105e-04   7.88384299e-04
   1.06592559e-03   1.35575307e-03]
&lt;Row 37 of table
 values=('2010-01', '252', '253-254', 2, 258.2, 69.0, 5700, 2.0, 1.8, 'Vertical Far West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMJAN10/reducciones/posiciones/spm252-ardec.fits
~/Dropbox/SPMJAN10/reducciones/spm253-254h.fits
~/Dropbox/SPMJAN10/reducciones/spec253-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec253-nii.fits
iarr = [ 258.2  258.2  258.2  258.2  258.2  258.2] jarr = [ -69.   31.  131.  231.  331.  431.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.5990592, -5.47089219), (83.60007548, -5.45361867),
     (83.6010917, -5.43634514), (83.60210786, -5.41907161),
     (83.60312397, -5.40179808), (83.60414002, -5.38452454)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.59905314  83.60006942  83.60108564  83.6021018   83.6031179
  83.60413395] [-5.47088698 -5.45361346 -5.43633993 -5.4190664  -5.40179286 -5.38451933]
[ 6724.  6708.  6693.  6678.  6663.  6648.] [ 3985.  4247.  4508.  4769.  5030.  5292.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2                c3       
    -------------- --------------- ---------------- -----------------
    0.951963038736 0.0917139419732 -0.0393595342064 -0.00277346507589
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 17408 17920
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.59905314, -5.47088698), (83.60006934, -5.45361346),
     (83.60108549, -5.43633994), (83.60210157, -5.41906643),
     (83.6031176, -5.40179292), (83.60413357, -5.38451943)]&gt;
Displacements in arcsec: [  8.58749764e-12   2.67674314e-04   5.38469088e-04   8.15465296e-04
   1.10162799e-03   1.39975973e-03]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 17408 17408
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.59905314, -5.47088698), (83.60006934, -5.45361346),
     (83.60108549, -5.43633994), (83.60210157, -5.41906643),
     (83.6031176, -5.40179292), (83.60413357, -5.38451943)]&gt;
Displacements in arcsec: [  8.58749764e-12   2.67674314e-04   5.38469088e-04   8.15465296e-04
   1.10162799e-03   1.39975973e-03]
&lt;Row 38 of table
 values=('2013-02', '024', '025', 1, 465.0, -73.0, 1500, 4.5, 1.8, 'Horizontal LL2')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm024_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm025_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec025-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec025-nii.fits
iarr = [  73.  173.  273.  373.  473.  573.  673.] jarr = [ 465.  465.  465.  465.  465.  465.  465.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.61802513, -5.376003), (83.63276384, -5.37615545),
     (83.64750255, -5.37630755), (83.66224127, -5.37645929),
     (83.67698, -5.37661069), (83.69171873, -5.37676173),
     (83.70645746, -5.37691241)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.61801906  83.63275777  83.64749648  83.66223521  83.67697393
  83.69171266  83.70645139] [-5.37599778 -5.37615024 -5.37630233 -5.37645408 -5.37660547 -5.37675651
 -5.37690719]
[ 6438.  6216.  5995.  5773.  5551.  5329.  5107.] [ 5421.  5418.  5416.  5414.  5412.  5409.  5407.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3      
    ------------- --------------- ---------------- ---------------
    0.78559259061 -0.271248768944 -0.0302318531859 0.0352473397411
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61801906, -5.37599778), (83.63275778, -5.37614913),
     (83.6474965, -5.37630013), (83.66223523, -5.37645077),
     (83.67697396, -5.37660106), (83.69171269, -5.376751),
     (83.70645141, -5.37690058)]&gt;
Displacements in arcsec: [  1.14499969e-11   3.96634619e-03   7.93270663e-03   1.18990952e-02
   1.58655260e-02   1.98320128e-02   2.37985698e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.61801906, -5.37599778), (83.63275778, -5.37614913),
     (83.6474965, -5.37630013), (83.66223523, -5.37645077),
     (83.67697396, -5.37660106), (83.69171269, -5.376751),
     (83.70645141, -5.37690058)]&gt;
Displacements in arcsec: [  1.14499969e-11   3.96634619e-03   7.93270663e-03   1.18990952e-02
   1.58655260e-02   1.98320128e-02   2.37985698e-02]
&lt;Row 39 of table
 values=('2013-02', '165', '166-167', 1, 468.5, -67.0, 3500, 5.5, 1.8, 'Horizontal West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm165_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm166-167_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec166-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec166-nii.fits
iarr = [  67.  167.  267.  367.  467.  567.  667.] jarr = [ 468.5  468.5  468.5  468.5  468.5  468.5  468.5]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.57819344, -5.44066911), (83.59290242, -5.44079598),
     (83.60761141, -5.44092248), (83.6223204, -5.44104863),
     (83.6370294, -5.44117442), (83.6517384, -5.44129986),
     (83.66644741, -5.44142494)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.57818738  83.59289636  83.60760535  83.62231434  83.63702334
  83.65173234  83.66644134] [-5.4406639  -5.44079076 -5.44091727 -5.44104342 -5.44116921 -5.44129464
 -5.44141972]
[ 7038.  6817.  6595.  6374.  6152.  5931.  5709.] [ 4442.  4441.  4439.  4437.  4435.  4433.  4431.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3      
    -------------- -------------- ---------------- ---------------
    0.881727531749 0.183323957073 -0.0636534486881 0.0213688494189
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.57818738, -5.4406639), (83.59289637, -5.44078965),
     (83.60760536, -5.44091505), (83.62231435, -5.44104009),
     (83.63702334, -5.44116477), (83.65173233, -5.44128909),
     (83.66644131, -5.44141306)]&gt;
Displacements in arcsec: [  2.00374945e-11   3.99720792e-03   7.99446754e-03   1.19918303e-02
   1.59893477e-02   1.99870712e-02   2.39850522e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.57818738, -5.4406639), (83.59289637, -5.44078965),
     (83.60760536, -5.44091505), (83.62231435, -5.44104009),
     (83.63702334, -5.44116477), (83.65173233, -5.44128909),
     (83.66644131, -5.44141306)]&gt;
Displacements in arcsec: [  2.00374945e-11   3.99720792e-03   7.99446754e-03   1.19918303e-02
   1.59893477e-02   1.99870712e-02   2.39850522e-02]
&lt;Row 40 of table
 values=('2013-02', '169', '170-171', 1, 468.5, -65.0, 3200, 5.5, 1.8, 'Horizontal West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm169_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm170-171_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec170-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec170-nii.fits
iarr = [  65.  165.  265.  365.  465.  565.  665.] jarr = [ 468.5  468.5  468.5  468.5  468.5  468.5  468.5]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.57831686, -5.43805245), (83.59303389, -5.43816741),
     (83.60775092, -5.43828201), (83.62246796, -5.43839626),
     (83.63718501, -5.43851015), (83.65190205, -5.43862368),
     (83.6666191, -5.43873686)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.5783108   83.59302783  83.60774486  83.6224619   83.63717894
  83.65189599  83.66661304] [-5.43804724 -5.4381622  -5.4382768  -5.43839105 -5.43850494 -5.43861847
 -5.43873164]
[ 7036.  6815.  6593.  6371.  6150.  5928.  5707.] [ 4482.  4480.  4479.  4477.  4475.  4474.  4472.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3      
    -------------- -------------- ---------------- ---------------
    0.947535976257 0.200725921895 -0.0668789024946 0.0165058972878
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.5783108, -5.43804724), (83.59302783, -5.43816109),
     (83.60774487, -5.43827458), (83.6224619, -5.43838771),
     (83.63717894, -5.43850049), (83.65189598, -5.43861291),
     (83.66661301, -5.43872498)]&gt;
Displacements in arcsec: [  2.00374945e-11   3.99963621e-03   7.99932274e-03   1.19991097e-02
   1.59990471e-02   1.99991849e-02   2.39995733e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.5783108, -5.43804724), (83.59302783, -5.43816109),
     (83.60774487, -5.43827458), (83.6224619, -5.43838771),
     (83.63717894, -5.43850049), (83.65189598, -5.43861291),
     (83.66661301, -5.43872498)]&gt;
Displacements in arcsec: [  2.00374945e-11   3.99963621e-03   7.99932274e-03   1.19991097e-02
   1.59990471e-02   1.99991849e-02   2.39995733e-02]
&lt;Row 41 of table
 values=('2013-02', '237', '238-239', 1, 467.0, -74.0, 4500, 7.0, 1.8, 'Horizontal West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm237_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm238-239_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec238-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec238-nii.fits
iarr = [  74.  174.  274.  374.  474.  574.  674.] jarr = [ 467.  467.  467.  467.  467.  467.  467.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.5816182, -5.43589465), (83.59633079, -5.43600231),
     (83.61104339, -5.43610961), (83.625756, -5.43621656),
     (83.64046862, -5.43632316), (83.65518123, -5.43642939),
     (83.66989385, -5.43653527)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.58161213  83.59632473  83.61103733  83.62574994  83.64046255
  83.65517517  83.66988778] [-5.43588944 -5.4359971  -5.4361044  -5.43621135 -5.43631794 -5.43642418
 -5.43653006]
[ 6986.  6765.  6543.  6322.  6100.  5879.  5657.] [ 4515.  4513.  4512.  4510.  4508.  4507.  4505.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2               c3      
    -------------- ---------------- ---------------- ---------------
    0.901852834282 -0.0589188029946 -0.0243959362222 0.0240853539235
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.58161213, -5.43588944), (83.59632473, -5.43599599),
     (83.61103734, -5.43610218), (83.62574995, -5.43620802),
     (83.64046255, -5.4363135), (83.65517516, -5.43641863),
     (83.66988775, -5.4365234)]&gt;
Displacements in arcsec: [  1.14499969e-11   3.99563429e-03   7.99131087e-03   1.19870719e-02
   1.59829594e-02   1.99790154e-02   2.39752821e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.58161213, -5.43588944), (83.59632473, -5.43599599),
     (83.61103734, -5.43610218), (83.62574995, -5.43620802),
     (83.64046255, -5.4363135), (83.65517516, -5.43641863),
     (83.66988775, -5.4365234)]&gt;
Displacements in arcsec: [  1.14499969e-11   3.99563429e-03   7.99131087e-03   1.19870719e-02
   1.59829594e-02   1.99790154e-02   2.39752821e-02]
&lt;Row 42 of table
 values=('2013-02', '232', '233-234', 1, 468.5, -78.0, 4800, 9.0, 1.8, 'Horizontal West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm232_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm233-234_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec233-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec233-nii.fits
iarr = [  78.  178.  278.  378.  478.  578.  678.] jarr = [ 468.5  468.5  468.5  468.5  468.5  468.5  468.5]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.58141833, -5.43194365), (83.59611304, -5.43204573),
     (83.61080776, -5.43214746), (83.62550248, -5.43224883),
     (83.64019721, -5.43234984), (83.65489193, -5.4324505),
     (83.66958666, -5.43255081)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.58141226  83.59610698  83.61080169  83.62549642  83.64019114
  83.65488587  83.6695806 ] [-5.43193844 -5.43204052 -5.43214224 -5.43224361 -5.43234463 -5.43244529
 -5.43254559]
[ 6990.  6768.  6547.  6326.  6104.  5883.  5662.] [ 4574.  4573.  4571.  4570.  4568.  4567.  4565.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2              c3      
    -------------- ---------------- ---------------- --------------
    0.847751703253 -0.0570141551873 -0.0287535438957 0.019319241047
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.58141226, -5.43193844), (83.59610698, -5.43203941),
     (83.6108017, -5.43214003), (83.62549642, -5.43224029),
     (83.64019114, -5.4323402), (83.65488586, -5.43243976),
     (83.66958057, -5.43253895)]&gt;
Displacements in arcsec: [  5.72499843e-12   3.98304338e-03   7.96612377e-03   1.19492778e-02
   1.59325423e-02   1.99159538e-02   2.38995492e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.58141226, -5.43193844), (83.59610698, -5.43203941),
     (83.6108017, -5.43214003), (83.62549642, -5.43224029),
     (83.64019114, -5.4323402), (83.65488586, -5.43243976),
     (83.66958057, -5.43253895)]&gt;
Displacements in arcsec: [  5.72499843e-12   3.98304338e-03   7.96612377e-03   1.19492778e-02
   1.59325423e-02   1.99159538e-02   2.38995492e-02]
&lt;Row 43 of table
 values=('2013-02', '226', '227-228', 1, 468.5, -75.0, 4200, 10.0, 1.8, 'Horizontal West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm226_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm227-228_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec227-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec227-nii.fits
iarr = [  75.  175.  275.  375.  475.  575.  675.] jarr = [ 468.5  468.5  468.5  468.5  468.5  468.5  468.5]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.57279399, -5.42923562), (83.58751481, -5.4293542),
     (83.60223565, -5.42947243), (83.61695649, -5.4295903),
     (83.63167733, -5.42970782), (83.64639818, -5.42982498),
     (83.66111903, -5.42994179)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.57278793  83.58750875  83.60222958  83.61695042  83.63167127
  83.64639212  83.66111297] [-5.42923041 -5.42934899 -5.42946722 -5.42958509 -5.42970261 -5.42981977
 -5.42993657]
[ 7119.  6898.  6676.  6454.  6233.  6011.  5789.] [ 4615.  4614.  4612.  4610.  4608.  4607.  4605.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2               c3      
    -------------- ---------------- ---------------- ---------------
    0.955009325655 -0.0548749157634 -0.0731134889632 0.0201443305607
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.57278793, -5.42923041), (83.58750876, -5.42934788),
     (83.60222959, -5.429465), (83.61695042, -5.42958176),
     (83.63167126, -5.42969817), (83.64639209, -5.42981422),
     (83.66111292, -5.42992991)]&gt;
Displacements in arcsec: [  1.71749953e-11   3.99530813e-03   7.99068890e-03   1.19862146e-02
   1.59819576e-02   1.99779901e-02   2.39743844e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.57278793, -5.42923041), (83.58750876, -5.42934788),
     (83.60222959, -5.429465), (83.61695042, -5.42958176),
     (83.63167126, -5.42969817), (83.64639209, -5.42981422),
     (83.66111292, -5.42992991)]&gt;
Displacements in arcsec: [  1.71749953e-11   3.99530813e-03   7.99068890e-03   1.19862146e-02
   1.59819576e-02   1.99779901e-02   2.39743844e-02]
&lt;Row 44 of table
 values=('2013-02', '149', '150-151', 1, 468.0, -70.0, 3600, 3.5, 1.8, 'Horizontal West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm149_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm150-151_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec150-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec150-nii.fits
iarr = [  70.  170.  270.  370.  470.  570.  670.] jarr = [ 468.  468.  468.  468.  468.  468.  468.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.58758896, -5.42364026), (83.60229976, -5.42378354),
     (83.61701057, -5.42392646), (83.63172138, -5.42406902),
     (83.64643221, -5.42421123), (83.66114303, -5.42435309),
     (83.67585386, -5.42449458)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.58758289  83.60229369  83.6170045   83.63171532  83.64642614
  83.66113697  83.6758478 ] [-5.42363505 -5.42377833 -5.42392125 -5.42406381 -5.42420602 -5.42434787
 -5.42448937]
[ 6897.  6675.  6454.  6232.  6011.  5789.  5567.] [ 4700.  4698.  4696.  4694.  4692.  4689.  4687.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2              c3       
    -------------- -------------- --------------- ----------------
    0.946880250401 0.139400224843 -0.106473934026 -0.0377076170597
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.58758289, -5.42363505), (83.6022937, -5.42377722),
     (83.61700452, -5.42391903), (83.63171533, -5.42406049),
     (83.64642615, -5.42420159), (83.66113697, -5.42434234),
     (83.67584778, -5.42448273)]&gt;
Displacements in arcsec: [  1.14499969e-11   3.98589998e-03   7.97184106e-03   1.19578640e-02
   1.59440098e-02   1.99303192e-02   2.39168330e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.58758289, -5.42363505), (83.6022937, -5.42377722),
     (83.61700452, -5.42391903), (83.63171533, -5.42406049),
     (83.64642615, -5.42420159), (83.66113697, -5.42434234),
     (83.67584778, -5.42448273)]&gt;
Displacements in arcsec: [  1.14499969e-11   3.98589998e-03   7.97184106e-03   1.19578640e-02
   1.59440098e-02   1.99303192e-02   2.39168330e-02]
&lt;Row 45 of table
 values=('2013-02', '154', '155-156', 1, 467.2, -67.0, 3600, 4.5, 1.8, 'Horizontal West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm154_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm155-156_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec155-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec155-nii.fits
iarr = [  67.  167.  267.  367.  467.  567.  667.] jarr = [ 467.2  467.2  467.2  467.2  467.2  467.2  467.2]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.58777408, -5.42231276), (83.60248096, -5.42246058),
     (83.61718784, -5.42260804), (83.63189474, -5.42275514),
     (83.64660163, -5.42290189), (83.66130854, -5.42304828),
     (83.67601544, -5.42319432)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.58776802  83.60247489  83.61718178  83.63188867  83.64659557
  83.66130247  83.67600938] [-5.42230755 -5.42245537 -5.42260282 -5.42274993 -5.42289668 -5.42304307
 -5.42318911]
[ 6894.  6672.  6451.  6229.  6008.  5787.  5565.] [ 4720.  4718.  4716.  4714.  4711.  4709.  4707.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2             c3      
    -------------- -------------- --------------- --------------
    0.932827317713 0.155531551385 -0.119098906168 -0.02195825199
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.58776802, -5.42230755), (83.6024749, -5.42245426),
     (83.61718179, -5.42260061), (83.63188869, -5.42274661),
     (83.64659558, -5.42289225), (83.66130248, -5.42303754),
     (83.67600937, -5.42318247)]&gt;
Displacements in arcsec: [  2.86249921e-12   3.98282946e-03   7.96569958e-03   1.19486508e-02
   1.59317234e-02   1.99149579e-02   2.38983945e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.58776802, -5.42230755), (83.6024749, -5.42245426),
     (83.61718179, -5.42260061), (83.63188869, -5.42274661),
     (83.64659558, -5.42289225), (83.66130248, -5.42303754),
     (83.67600937, -5.42318247)]&gt;
Displacements in arcsec: [  2.86249921e-12   3.98282946e-03   7.96569958e-03   1.19486508e-02
   1.59317234e-02   1.99149579e-02   2.38983945e-02]
&lt;Row 46 of table
 values=('2013-02', '159', '160-161', 1, 467.5, -70.0, 3600, 5.0, 1.8, 'Horizontal West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm159_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm160-161_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec160-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec160-nii.fits
iarr = [  70.  170.  270.  370.  470.  570.  670.] jarr = [ 467.5  467.5  467.5  467.5  467.5  467.5  467.5]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.58833119, -5.41984141), (83.60302869, -5.42000758),
     (83.6177262, -5.42017341), (83.63242372, -5.42033888),
     (83.64712125, -5.42050399), (83.66181878, -5.42066875),
     (83.67651632, -5.42083316)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.58832512  83.60302263  83.61772014  83.63241766  83.64711519
  83.66181272  83.67651025] [-5.4198362  -5.42000237 -5.4201682  -5.42033366 -5.42049878 -5.42066354
 -5.42082794]
[ 6885.  6664.  6443.  6221.  6000.  5779.  5558.] [ 4758.  4755.  4753.  4750.  4748.  4745.  4743.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2              c3       
    -------------- -------------- --------------- ----------------
    0.923982812233 0.152624933539 -0.107761788845 -0.0290224579899
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.58832512, -5.4198362), (83.60302264, -5.42000127),
     (83.61772016, -5.42016599), (83.63241768, -5.42033035),
     (83.64711521, -5.42049436), (83.66181273, -5.42065801),
     (83.67651026, -5.42082131)]&gt;
Displacements in arcsec: [  2.86249921e-12   3.97604483e-03   7.95212891e-03   1.19282913e-02
   1.59045708e-02   1.98810067e-02   2.38576377e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.58832512, -5.4198362), (83.60302264, -5.42000127),
     (83.61772016, -5.42016599), (83.63241768, -5.42033035),
     (83.64711521, -5.42049436), (83.66181273, -5.42065801),
     (83.67651026, -5.42082131)]&gt;
Displacements in arcsec: [  2.86249921e-12   3.97604483e-03   7.95212891e-03   1.19282913e-02
   1.59045708e-02   1.98810067e-02   2.38576377e-02]
&lt;Row 47 of table
 values=('2013-02', '033', '034-035', 1, 467.0, -70.0, 3800, 6.0, 1.8, 'Horizontal West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm033_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm034-035_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec034-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec034-nii.fits
iarr = [  70.  170.  270.  370.  470.  570.  670.] jarr = [ 467.  467.  467.  467.  467.  467.  467.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.57573414, -5.41692613), (83.59016511, -5.41683638),
     (83.60459607, -5.41674628), (83.61902703, -5.41665585),
     (83.63345799, -5.41656507), (83.64788894, -5.41647395),
     (83.66231988, -5.41638249)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.57572808  83.59015904  83.60459001  83.61902097  83.63345192
  83.64788287  83.66231382] [-5.41692092 -5.41683117 -5.41674107 -5.41665064 -5.41655986 -5.41646874
 -5.41637728]
[ 7075.  6858.  6641.  6423.  6206.  5989.  5771.] [ 4802.  4803.  4804.  4806.  4807.  4809.  4810.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3      
    -------------- --------------- ---------------- ---------------
    0.835320490759 -0.222274768085 -0.0782006218816 0.0637997946304
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.57572808, -5.41692092), (83.59015903, -5.4168301),
     (83.60458998, -5.41673894), (83.61902092, -5.41664744),
     (83.63345185, -5.4165556), (83.64788277, -5.41646342),
     (83.66231367, -5.41637089)]&gt;
Displacements in arcsec: [  2.57624929e-11   3.83056086e-03   7.66120846e-03   1.14920294e-02
   1.53231103e-02   1.91545376e-02   2.29863981e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.57572808, -5.41692092), (83.59015903, -5.4168301),
     (83.60458998, -5.41673894), (83.61902092, -5.41664744),
     (83.63345185, -5.4165556), (83.64788277, -5.41646342),
     (83.66231367, -5.41637089)]&gt;
Displacements in arcsec: [  2.57624929e-11   3.83056086e-03   7.66120846e-03   1.14920294e-02
   1.53231103e-02   1.91545376e-02   2.29863981e-02]
&lt;Row 48 of table
 values=('2013-02', '029', '030-031', 1, 465.2, -76.0, 3800, 4.5, 1.8, 'Horizontal West')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB13/WesternShocks/spm029_ardec.fits
~/Dropbox/SPMFEB13/WesternShocks/spm030-031_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec030-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec030-nii.fits
iarr = [  76.  176.  276.  376.  476.  576.  676.] jarr = [ 465.2  465.2  465.2  465.2  465.2  465.2  465.2]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.5743561, -5.41573686), (83.58878312, -5.41567021),
     (83.60321014, -5.41560321), (83.61763716, -5.41553588),
     (83.63206418, -5.4154682), (83.64649119, -5.41540018),
     (83.6609182, -5.41533182)]&gt;
Binning along slit: image = 3 spectrum = 3
[ 83.57435003  83.58877705  83.60320407  83.61763109  83.63205811
  83.64648512  83.66091213] [-5.41573165 -5.415665   -5.415598   -5.41553066 -5.41546298 -5.41539496
 -5.4153266 ]
[ 7096.  6879.  6661.  6444.  6227.  6010.  5792.] [ 4820.  4821.  4822.  4823.  4824.  4825.  4826.]
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
Wav: [6559.29, 6566.29] Pixel: [  52.34030432  212.33250092]
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
Wav: [6579.95, 6586.95] Pixel: [  44.4295912   203.92043141]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0             c1              c2               c3      
    -------------- -------------- ---------------- ---------------
    0.833714751434 -0.24324517959 -0.0735090567281 0.0506287438588
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 18.05626219  52.34030432]
Wav: [6566.29, 6567.79] Pixel: [ 212.33250092  246.61654304]
Background weights: 21250 21875
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.57435003, -5.41573165), (83.58877704, -5.41566393),
     (83.60320405, -5.41559587), (83.61763105, -5.41552747),
     (83.63205804, -5.41545873), (83.64648502, -5.41538965),
     (83.66091199, -5.41532022)]&gt;
Displacements in arcsec: [  5.72499843e-12   3.82763944e-03   7.65537073e-03   1.14832856e-02
   1.53114757e-02   1.91400328e-02   2.29690484e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 10.25298258  44.4295912 ]
Wav: [6586.95, 6588.45] Pixel: [ 203.92043141  238.09704002]
Background weights: 21250 21250
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.57435003, -5.41573165), (83.58877704, -5.41566393),
     (83.60320405, -5.41559587), (83.61763105, -5.41552747),
     (83.63205804, -5.41545873), (83.64648502, -5.41538965),
     (83.66091199, -5.41532022)]&gt;
Displacements in arcsec: [  5.72499843e-12   3.82763944e-03   7.65537073e-03   1.14832856e-02
   1.53114757e-02   1.91400328e-02   2.29690484e-02]
&lt;Row 49 of table
 values=('2013-12', '116', '117-118', 1, 395.0, -160.0, 400, 10.5, 1.8, 'Horizontal below LL2')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/papers/LL-Objects/SPMDIC13/spm116-ardec.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spm117-118_bcrx.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec117-118-ha.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec117-118-nii.fits
iarr = [  240.   390.   540.   690.   840.   990.  1140.] jarr = [ 395.  395.  395.  395.  395.  395.  395.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.63782536, -5.39056432), (83.65254471, -5.39115353),
     (83.66726409, -5.39174238), (83.68198349, -5.39233088),
     (83.69670292, -5.39291903), (83.71142238, -5.39350682),
     (83.72614186, -5.39409426)]&gt;
Binning along slit: image = 2 spectrum = 3
[ 83.6378193   83.65253864  83.66725802  83.68197743  83.69669686
  83.71141631  83.72613579] [-5.39055911 -5.39114831 -5.39173716 -5.39232566 -5.39291381 -5.3935016
 -5.39408904]
[ 6140.  5919.  5697.  5475.  5254.  5032.  4810.] [ 5201.  5192.  5183.  5174.  5165.  5156.  5147.]
Wav: [6557.79, 6559.29] Pixel: [ 40.91229027  75.1963324 ]
Wav: [6566.29, 6567.79] Pixel: [ 235.188529    269.47257113]
Background weights: 20910 20910
Wav: [6559.29, 6566.29] Pixel: [  75.1963324  235.188529 ]
Wav: [6578.45, 6579.95] Pixel: [ 33.03739394  67.21400835]
Wav: [6586.95, 6588.45] Pixel: [ 226.70487564  260.88149005]
Background weights: 20910 20910
Wav: [6579.95, 6586.95] Pixel: [  67.21400835  226.70487564]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2              c3      
    -------------- --------------- ----------------- --------------
    0.943515848559 -0.313295195982 -0.00901419410773 0.029813904266
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 40.91229027  75.1963324 ]
Wav: [6566.29, 6567.79] Pixel: [ 235.188529    269.47257113]
Background weights: 20910 20910
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.6378193, -5.39055911), (83.65253869, -5.39114723),
     (83.6672581, -5.391735), (83.68197754, -5.39232241),
     (83.696697, -5.39290947), (83.71141649, -5.39349618),
     (83.72613599, -5.39408253)]&gt;
Displacements in arcsec: [  8.58749764e-12   3.90644584e-03   7.81291882e-03   1.17194459e-02
   1.56260539e-02   1.95327698e-02   2.34396205e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 33.03739394  67.21400835]
Wav: [6586.95, 6588.45] Pixel: [ 226.70487564  260.88149005]
Background weights: 20910 20910
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.6378193, -5.39055911), (83.65253869, -5.39114723),
     (83.6672581, -5.391735), (83.68197754, -5.39232241),
     (83.696697, -5.39290947), (83.71141649, -5.39349618),
     (83.72613599, -5.39408253)]&gt;
Displacements in arcsec: [  8.58749764e-12   3.90644584e-03   7.81291882e-03   1.17194459e-02
   1.56260539e-02   1.95327698e-02   2.34396205e-02]
&lt;Row 50 of table
 values=('2013-12', '086', '088', 1, 404.0, -155.0, 300, 11.0, 1.8, 'W of HH269')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/papers/LL-Objects/SPMDIC13/spm086-ardec.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spm088_bcrx.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec088-ha.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec088-nii.fits
iarr = [  232.5   382.5   532.5   682.5   832.5   982.5  1132.5] jarr = [ 404.  404.  404.  404.  404.  404.  404.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.70503837, -5.38691652), (83.71975962, -5.38746739),
     (83.73448091, -5.3880179), (83.74920222, -5.38856806),
     (83.76392355, -5.38911787), (83.7786449, -5.38966733),
     (83.79336628, -5.39021643)]&gt;
Binning along slit: image = 2 spectrum = 3
[ 83.7050323   83.71975356  83.73447484  83.74919615  83.76391748
  83.77863883  83.79336021] [-5.3869113  -5.38746217 -5.38801268 -5.38856285 -5.38911265 -5.38966211
 -5.39021121]
[ 5128.  4906.  4685.  4463.  4241.  4020.  3798.] [ 5256.  5247.  5239.  5231.  5223.  5214.  5206.]
Wav: [6557.79, 6559.29] Pixel: [ 40.91229027  75.1963324 ]
Wav: [6566.29, 6567.79] Pixel: [ 235.188529    269.47257113]
Background weights: 20910 20910
Wav: [6559.29, 6566.29] Pixel: [  75.1963324  235.188529 ]
Wav: [6578.45, 6579.95] Pixel: [ 33.03739394  67.21400835]
Wav: [6586.95, 6588.45] Pixel: [ 226.70487564  260.88149005]
Background weights: 20910 20910
Wav: [6579.95, 6586.95] Pixel: [  67.21400835  226.70487564]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2                c3       
    -------------- ---------------- ---------------- -----------------
    0.969618125488 0.00367789318551 -0.0276219771832 -0.00793460420947
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 40.91229027  75.1963324 ]
Wav: [6566.29, 6567.79] Pixel: [ 235.188529    269.47257113]
Background weights: 20910 20910
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.7050323, -5.3869113), (83.71975359, -5.38746108),
     (83.73447492, -5.38801052), (83.74919626, -5.38855959),
     (83.76391762, -5.38910832), (83.77863901, -5.38965669),
     (83.79336041, -5.3902047)]&gt;
Displacements in arcsec: [  2.57624929e-11   3.90438996e-03   7.80879325e-03   1.17132231e-02
   1.56176926e-02   1.95222150e-02   2.34268034e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 33.03739394  67.21400835]
Wav: [6586.95, 6588.45] Pixel: [ 226.70487564  260.88149005]
Background weights: 20910 20910
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.7050323, -5.3869113), (83.71975359, -5.38746108),
     (83.73447492, -5.38801052), (83.74919626, -5.38855959),
     (83.76391762, -5.38910832), (83.77863901, -5.38965669),
     (83.79336041, -5.3902047)]&gt;
Displacements in arcsec: [  2.57624929e-11   3.90438996e-03   7.80879325e-03   1.17132231e-02
   1.56176926e-02   1.95222150e-02   2.34268034e-02]
&lt;Row 51 of table
 values=('2013-12', '090', '089', 1, 404.5, -160.0, 400, 10.5, 1.8, 'Image follows spec')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/papers/LL-Objects/SPMDIC13/spm090-ardec.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spm089_bcrx.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec089-ha.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec089-nii.fits
iarr = [  240.   390.   540.   690.   840.   990.  1140.] jarr = [ 404.5  404.5  404.5  404.5  404.5  404.5  404.5]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.70289354, -5.39031548), (83.71761004, -5.39088022),
     (83.73232657, -5.39144462), (83.74704312, -5.39200866),
     (83.7617597, -5.39257235), (83.77647631, -5.39313568),
     (83.79119293, -5.39369866)]&gt;
Binning along slit: image = 2 spectrum = 3
[ 83.70288747  83.71760397  83.7323205   83.74703706  83.76175364
  83.77647024  83.79118686] [-5.39031026 -5.39087501 -5.3914394  -5.39200344 -5.39256713 -5.39313046
 -5.39369344]
[ 5160.  4939.  4717.  4495.  4274.  4052.  3831.] [ 5204.  5196.  5187.  5179.  5170.  5162.  5153.]
Wav: [6557.79, 6559.29] Pixel: [ 40.91229027  75.1963324 ]
Wav: [6566.29, 6567.79] Pixel: [ 235.188529    269.47257113]
Background weights: 20910 20910
Wav: [6559.29, 6566.29] Pixel: [  75.1963324  235.188529 ]
Wav: [6578.45, 6579.95] Pixel: [ 33.03739394  67.21400835]
Wav: [6586.95, 6588.45] Pixel: [ 226.70487564  260.88149005]
Background weights: 20910 20910
Wav: [6579.95, 6586.95] Pixel: [  67.21400835  226.70487564]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2               c3      
    -------------- ---------------- ---------------- ---------------
    0.962474001315 -0.0198239403718 -0.0450027826878 0.0008525427863
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 40.91229027  75.1963324 ]
Wav: [6566.29, 6567.79] Pixel: [ 235.188529    269.47257113]
Background weights: 20910 20910
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.70288747, -5.39031026), (83.71760401, -5.39087392),
     (83.73232058, -5.39143723), (83.74703717, -5.39200019),
     (83.76175378, -5.39256279), (83.77647041, -5.39312504),
     (83.79118706, -5.39368693)]&gt;
Displacements in arcsec: [  1.14499969e-11   3.90446361e-03   7.80894385e-03   1.17134571e-02
   1.56180199e-02   1.95226486e-02   2.34273595e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 33.03739394  67.21400835]
Wav: [6586.95, 6588.45] Pixel: [ 226.70487564  260.88149005]
Background weights: 20910 20910
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.70288747, -5.39031026), (83.71760401, -5.39087392),
     (83.73232058, -5.39143723), (83.74703717, -5.39200019),
     (83.76175378, -5.39256279), (83.77647041, -5.39312504),
     (83.79118706, -5.39368693)]&gt;
Displacements in arcsec: [  1.14499969e-11   3.90446361e-03   7.80894385e-03   1.17134571e-02
   1.56180199e-02   1.95226486e-02   2.34273595e-02]
&lt;Row 52 of table
 values=('2013-12', '102', '103-104', 1, 402.5, -150.0, 350, 10.5, 1.8, 'V faint image')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/papers/LL-Objects/SPMDIC13/spm102-ardec.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spm103-104_bcrx.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec103-104-ha.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec103-104-nii.fits
iarr = [  225.   375.   525.   675.   825.   975.  1125.] jarr = [ 402.5  402.5  402.5  402.5  402.5  402.5  402.5]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.67286954, -5.38733731), (83.68750475, -5.38782312),
     (83.70213998, -5.38830859), (83.71677523, -5.38879371),
     (83.7314105, -5.38927848), (83.74604579, -5.3897629),
     (83.7606811, -5.39024697)]&gt;
Binning along slit: image = 2 spectrum = 3
[ 83.67286348  83.68749868  83.70213391  83.71676916  83.73140443
  83.74603973  83.76067503] [-5.38733209 -5.38781791 -5.38830337 -5.38878849 -5.38927326 -5.38975768
 -5.39024175]
[ 5612.  5392.  5172.  4951.  4731.  4511.  4290.] [ 5249.  5242.  5235.  5227.  5220.  5213.  5205.]
Wav: [6557.79, 6559.29] Pixel: [ 40.91229027  75.1963324 ]
Wav: [6566.29, 6567.79] Pixel: [ 235.188529    269.47257113]
Background weights: 20910 20910
Wav: [6559.29, 6566.29] Pixel: [  75.1963324  235.188529 ]
Wav: [6578.45, 6579.95] Pixel: [ 33.03739394  67.21400835]
Wav: [6586.95, 6588.45] Pixel: [ 226.70487564  260.88149005]
Background weights: 20910 20910
Wav: [6579.95, 6586.95] Pixel: [  67.21400835  226.70487564]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1              c2               c3       
    -------------- --------------- ---------------- ----------------
    0.855785856211 -0.253175860718 -0.0389389250528 0.00368725942487
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 40.91229027  75.1963324 ]
Wav: [6566.29, 6567.79] Pixel: [ 235.188529    269.47257113]
Background weights: 20910 20910
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67286348, -5.38733209), (83.68749871, -5.38781684),
     (83.70213397, -5.38830123), (83.71676925, -5.38878528),
     (83.73140455, -5.38926897), (83.74603986, -5.38975232),
     (83.76067519, -5.39023532)]&gt;
Displacements in arcsec: [  2.28999937e-11   3.85850181e-03   7.71703354e-03   1.15756246e-02
   1.54343048e-02   1.92931035e-02   2.31520505e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 33.03739394  67.21400835]
Wav: [6586.95, 6588.45] Pixel: [ 226.70487564  260.88149005]
Background weights: 20910 20910
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.67286348, -5.38733209), (83.68749871, -5.38781684),
     (83.70213397, -5.38830123), (83.71676925, -5.38878528),
     (83.73140455, -5.38926897), (83.74603986, -5.38975232),
     (83.76067519, -5.39023532)]&gt;
Displacements in arcsec: [  2.28999937e-11   3.85850181e-03   7.71703354e-03   1.15756246e-02
   1.54343048e-02   1.92931035e-02   2.31520505e-02]
&lt;Row 53 of table
 values=('2013-12', '111', '112-113', 1, 400.0, -145.0, 400, 10.5, 1.8, 'W of HH269')
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/papers/LL-Objects/SPMDIC13/spm111-ardec.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spm112-113_bcrx.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec112-113-ha.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec112-113-nii.fits
iarr = [  217.5   367.5   517.5   667.5   817.5   967.5  1117.5] jarr = [ 400.  400.  400.  400.  400.  400.  400.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.71896553, -5.38972956), (83.73360279, -5.39019753),
     (83.74824007, -5.39066516), (83.76287737, -5.39113243),
     (83.77751469, -5.39159935), (83.79215202, -5.39206593),
     (83.80678937, -5.39253215)]&gt;
Binning along slit: image = 2 spectrum = 3
[ 83.71895946  83.73359672  83.748234    83.7628713   83.77750862
  83.79214595  83.8067833 ] [-5.38972434 -5.39019231 -5.39065994 -5.39112721 -5.39159413 -5.39206071
 -5.39252693]
[ 4918.  4698.  4477.  4257.  4037.  3816.  3596.] [ 5213.  5206.  5199.  5192.  5185.  5178.  5171.]
Wav: [6557.79, 6559.29] Pixel: [ 40.91229027  75.1963324 ]
Wav: [6566.29, 6567.79] Pixel: [ 235.188529    269.47257113]
Background weights: 20910 20910
Wav: [6559.29, 6566.29] Pixel: [  75.1963324  235.188529 ]
Wav: [6578.45, 6579.95] Pixel: [ 33.03739394  67.21400835]
Wav: [6586.95, 6588.45] Pixel: [ 226.70487564  260.88149005]
Background weights: 20910 20910
Wav: [6579.95, 6586.95] Pixel: [  67.21400835  226.70487564]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0            c1              c2              c3      
    ------------- -------------- --------------- ---------------
    1.04219041699 -0.14211583759 0.0490816278839 0.0431260651493
Saving ha calibrated spectrum
Wav: [6557.79, 6559.29] Pixel: [ 40.91229027  75.1963324 ]
Wav: [6566.29, 6567.79] Pixel: [ 235.188529    269.47257113]
Background weights: 20910 20910
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.71895946, -5.38972434), (83.73359676, -5.39019124),
     (83.74823407, -5.39065779), (83.7628714, -5.39112399),
     (83.77750875, -5.39158984), (83.79214611, -5.39205535),
     (83.80678348, -5.3925205)]&gt;
Displacements in arcsec: [  1.14499969e-11   3.86109164e-03   7.72218639e-03   1.15832872e-02
   1.54443971e-02   1.93055190e-02   2.31666558e-02]
Saving nii calibrated spectrum
Wav: [6578.45, 6579.95] Pixel: [ 33.03739394  67.21400835]
Wav: [6586.95, 6588.45] Pixel: [ 226.70487564  260.88149005]
Background weights: 20910 20910
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.71895946, -5.38972434), (83.73359676, -5.39019124),
     (83.74823407, -5.39065779), (83.7628714, -5.39112399),
     (83.77750875, -5.39158984), (83.79214611, -5.39205535),
     (83.80678348, -5.3925205)]&gt;
Displacements in arcsec: [  1.14499969e-11   3.86109164e-03   7.72218639e-03   1.15832872e-02
   1.54443971e-02   1.93055190e-02   2.31666558e-02]
&lt;Row 54 of table
 values=(2015-02, 0003, 0004, 1, 463.0, -80.0, 1300, 0.0, 1.8, --)
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB15/archivos/spm0003-ardec.fits
~/Dropbox/SPMFEB15/archivos/spm0004o_bcrx.fits
~/Dropbox/SPMFEB15/archivos/spm0004o_sub-ha.fits
~/Dropbox/SPMFEB15/archivos/spm0004o_sub-nii.fits
iarr = [  80.  180.  280.  380.  480.  580.  680.  780.  880.  980.] jarr = [ 463.  463.  463.  463.  463.  463.  463.  463.  463.  463.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.76300486, -5.38914842), (83.75317756, -5.38920898),
     (83.74335024, -5.38926939), (83.73352293, -5.38932964),
     (83.72369561, -5.38938973), (83.71386829, -5.38944967),
     (83.70404097, -5.38950944), (83.69421365, -5.38956906),
     (83.68438632, -5.38962852), (83.674559, -5.38968782)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.7629988   83.75317149  83.74334418  83.73351686  83.72368954
  83.71386222  83.7040349   83.69420758  83.68438026  83.67455293] [-5.3891432  -5.38920377 -5.38926417 -5.38932442 -5.38938451 -5.38944445
 -5.38950422 -5.38956384 -5.3896233  -5.38968261]
[ 4255.  4403.  4551.  4699.  4847.  4995.  5143.  5291.  5439.  5587.] [ 5222.  5221.  5220.  5219.  5218.  5218.  5217.  5216.  5215.  5214.]
Wav: [6559.29, 6566.29] Pixel: [  12.45186057  134.32298985]
Wav: [6579.95, 6586.95] Pixel: [  10.14579358  132.01692287]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2                c3       
    -------------- ---------------- ---------------- -----------------
    0.968088496551 -0.0353020238319 -0.0368421106332 0.000390521891842
Saving ha calibrated spectrum
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.7629988, -5.3891432), (83.75317148, -5.389203),
     (83.74334417, -5.38926263), (83.73351686, -5.38932211),
     (83.72368954, -5.38938143), (83.71386223, -5.3894406),
     (83.70403492, -5.3894996), (83.6942076, -5.38955845),
     (83.6843803, -5.38961714), (83.67455299, -5.38967568)]&gt;
Displacements in arcsec: [  8.58749764e-12   2.77185864e-03   5.54373697e-03   8.31565447e-03
   1.10876306e-02   1.38596848e-02   1.66318366e-02   1.94041055e-02
   2.21765108e-02   2.49490722e-02]
Saving nii calibrated spectrum
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.7629988, -5.3891432), (83.75317148, -5.389203),
     (83.74334417, -5.38926263), (83.73351686, -5.38932211),
     (83.72368954, -5.38938143), (83.71386223, -5.3894406),
     (83.70403492, -5.3894996), (83.6942076, -5.38955845),
     (83.6843803, -5.38961714), (83.67455299, -5.38967568)]&gt;
Displacements in arcsec: [  8.58749764e-12   2.77185864e-03   5.54373697e-03   8.31565447e-03
   1.10876306e-02   1.38596848e-02   1.66318366e-02   1.94041055e-02
   2.21765108e-02   2.49490722e-02]
&lt;Row 55 of table
 values=(2015-02, 0012, 0013, 1, 464.0, -60.0, 1300, 0.0, 1.8, --)
 dtype=[('Dataset', '&lt;U8'), ('imid', '&lt;U4'), ('specid', '&lt;U9'), ('saxis', '&lt;i8'), ('islit', '&lt;f8'), ('shift', '&lt;f8'), ('norm', '&lt;i8'), ('zero', '&lt;f8'), ('r(nii)', '&lt;f8'), ('Notes', '&lt;U20')]&gt;
~/Dropbox/SPMFEB15/archivos/spm0012-ardec.fits
~/Dropbox/SPMFEB15/archivos/spm0013o_bcrx.fits
~/Dropbox/SPMFEB15/archivos/spm0013o_sub-ha.fits
~/Dropbox/SPMFEB15/archivos/spm0013o_sub-nii.fits
iarr = [  60.  160.  260.  360.  460.  560.  660.  760.  860.  960.] jarr = [ 464.  464.  464.  464.  464.  464.  464.  464.  464.  464.]
coords = &lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    [(83.76323814, -5.3929956), (83.75342282, -5.39306366),
     (83.7436075, -5.39313156), (83.73379217, -5.3931993),
     (83.72397685, -5.39326688), (83.71416152, -5.39333431),
     (83.70434619, -5.39340158), (83.69453086, -5.39346869),
     (83.68471553, -5.39353565), (83.6749002, -5.39360244)]&gt;
Binning along slit: image = 2 spectrum = 2
[ 83.76323207  83.75341675  83.74360143  83.73378611  83.72397078
  83.71415545  83.70434012  83.69452479  83.68470946  83.67489413] [-5.39299038 -5.39305844 -5.39312634 -5.39319408 -5.39326167 -5.39332909
 -5.39339636 -5.39346348 -5.39353043 -5.39359723]
[ 4252.  4399.  4547.  4695.  4843.  4991.  5138.  5286.  5434.  5582.] [ 5164.  5163.  5162.  5161.  5160.  5159.  5158.  5157.  5156.  5155.]
Wav: [6559.29, 6566.29] Pixel: [  13.23643219  135.38568331]
Wav: [6579.95, 6586.95] Pixel: [   3.75122191  125.90047303]
Model: Chebyshev1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Degree: 3
Parameters:
          c0              c1               c2               c3      
    -------------- ---------------- ---------------- ---------------
    0.910890984261 -0.0345993965867 -0.0231613499696 0.0155135592095
Saving ha calibrated spectrum
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.76323207, -5.39299038), (83.75341675, -5.39305767),
     (83.74360142, -5.3931248), (83.7337861, -5.39319178),
     (83.72397078, -5.39325859), (83.71415545, -5.39332525),
     (83.70434013, -5.39339175), (83.69452481, -5.39345809),
     (83.68470949, -5.39352428), (83.67489417, -5.39359031)]&gt;
Displacements in arcsec: [  2.28999937e-11   2.76707470e-03   5.53416590e-03   8.30128974e-03
   1.10684626e-02   1.38357006e-02   1.66030200e-02   1.93704370e-02
   2.21379680e-02   2.49056291e-02]
Saving nii calibrated spectrum
New coords: &lt;SkyCoord (ICRS): (ra, dec) in deg
    [(83.76323207, -5.39299038), (83.75341675, -5.39305767),
     (83.74360142, -5.3931248), (83.7337861, -5.39319178),
     (83.72397078, -5.39325859), (83.71415545, -5.39332525),
     (83.70434013, -5.39339175), (83.69452481, -5.39345809),
     (83.68470949, -5.39352428), (83.67489417, -5.39359031)]&gt;
Displacements in arcsec: [  2.28999937e-11   2.76707470e-03   5.53416590e-03   8.30128974e-03
   1.10684626e-02   1.38357006e-02   1.66030200e-02   1.93704370e-02
   2.21379680e-02   2.49056291e-02]
</pre>
</div>
</div>
</div>



<div id="outline-container-orgheadline52" class="outline-2">
<h2 id="orgheadline52"><span class="section-number-2">2</span> Fix the issue with the [N II]/Ha ratio</h2>
<div class="outline-text-2" id="text-2">
</div>

<div id="outline-container-orgheadline36" class="outline-3">
<h3 id="orgheadline36"><span class="section-number-3">2.1</span> <span class="done DONE">DONE</span> <code>[1/1]</code> Program to check the [N II]/Ha ratios: slit-ratio-check.py</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>We want to check the individual ha and nii images we are using</li>
<li>And also double check against the full spectrum image wherever possible</li>
</ul>
</div>
<div id="outline-container-orgheadline31" class="outline-4">
<h4 id="orgheadline31"><span class="section-number-4">2.1.1</span> Re-use stuff from slit-calibration.py</h4>
<div class="outline-text-4" id="text-2-1-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> os
<span style="color: #b9d3ee;">import</span> sys
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">import</span> astropy
<span style="color: #b9d3ee;">from</span> astropy.table <span style="color: #b9d3ee;">import</span> Table
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS
<span style="color: #b9d3ee;">from</span> astropy.wcs.utils <span style="color: #b9d3ee;">import</span> pixel_to_skycoord
<span style="color: #b9d3ee;">from</span> matplotlib <span style="color: #b9d3ee;">import</span> pyplot <span style="color: #b9d3ee;">as</span> plt
<span style="color: #b9d3ee;">import</span> seaborn <span style="color: #b9d3ee;">as</span> sns
<span style="color: #b9d3ee;">from</span> astropy <span style="color: #b9d3ee;">import</span> units <span style="color: #b9d3ee;">as</span> u
<span style="color: #b9d3ee;">from</span> astropy.coordinates <span style="color: #b9d3ee;">import</span> SkyCoord
<span style="color: #b9d3ee;">from</span> astropy.modeling <span style="color: #b9d3ee;">import</span> models, fitting
<span style="color: #b9d3ee;">from</span> astropy.convolution <span style="color: #b9d3ee;">import</span> convolve_fft, Box1DKernel
<span style="color: #dfaf8f;">converters</span> = {<span style="color: #eee8aa; font-style: italic;">'imid'</span>: [astropy.io.<span style="color: #DCDCCC; font-weight: bold;">ascii</span>.convert_numpy(np.<span style="color: #DCDCCC; font-weight: bold;">str</span>)]}
<span style="color: #dfaf8f;">tab</span> = Table.read(<span style="color: #eee8aa; font-style: italic;">'all-slits-input.tab'</span>,
                 <span style="color: #DCDCCC; font-weight: bold;">format</span>=<span style="color: #eee8aa; font-style: italic;">'ascii.tab'</span>, converters=converters)
<span style="color: #dfaf8f;">file_templates</span> = {
    <span style="color: #eee8aa; font-style: italic;">'fullspec'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2005/pp{}.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spec{}.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spec{}-transf.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/spm{}h.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spm{}_bcr.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spm{}_bcrx.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}o_bcrx.fits'</span>,
    },
    <span style="color: #eee8aa; font-style: italic;">'ha'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/SPMha/spec{}-halpha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spec{}-ha-fix.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}o_sub-ha.fits'</span>,
    },
    <span style="color: #eee8aa; font-style: italic;">'nii'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/SPMnii/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spec{}-nii-fix.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}o_sub-nii.fits'</span>,
    },
    <span style="color: #eee8aa; font-style: italic;">'image'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/Papers/LL-Objects/feb2006/pp{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/posiciones/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spm{}_ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}-ardec.fits'</span>,
    },
}

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">find_fits_filepath</span>(db, filetype):
    <span style="color: #eee8aa; font-style: italic;">"""Return path to the FITS file for an image or spectrum </span>
<span style="color: #eee8aa; font-style: italic;">    """</span>
    <span style="color: #dfaf8f;">id_</span> = db[<span style="color: #eee8aa; font-style: italic;">'imid'</span>] <span style="color: #b9d3ee;">if</span> filetype == <span style="color: #eee8aa; font-style: italic;">'image'</span> <span style="color: #b9d3ee;">else</span> db[<span style="color: #eee8aa; font-style: italic;">'specid'</span>]
    <span style="color: #dfaf8f;">id_</span> = <span style="color: #DCDCCC; font-weight: bold;">str</span>(id_)
    <span style="color: #b9d3ee;">if</span> filetype <span style="color: #b9d3ee;">in</span> (<span style="color: #eee8aa; font-style: italic;">'ha'</span>, <span style="color: #eee8aa; font-style: italic;">'nii'</span>) <span style="color: #b9d3ee;">and</span> db[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>] <span style="color: #b9d3ee;">not</span> <span style="color: #b9d3ee;">in</span> [<span style="color: #eee8aa; font-style: italic;">'2013-12'</span>]:
        <span style="color: #dfaf8f;">id_</span> = id_.split(<span style="color: #eee8aa; font-style: italic;">'-'</span>)[0]
    <span style="color: #dfaf8f;">template</span> = file_templates[filetype][db[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>]]
    <span style="color: #dfaf8f;">path</span> = template.<span style="color: #DCDCCC; font-weight: bold;">format</span>(id_)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'~/'</span>+path)
    <span style="color: #dfaf8f;">homedir</span> = os.path.expanduser(<span style="color: #eee8aa; font-style: italic;">'~'</span>)
    <span style="color: #b9d3ee;">return</span> os.path.join(homedir, path)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline32" class="outline-4">
<h4 id="orgheadline32"><span class="section-number-4">2.1.2</span> Convert wavelength to pixel</h4>
<div class="outline-text-4" id="text-2-1-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">wav2pix</span>(wav, wcs, nwav, isT):
    <span style="color: #b9d3ee;">if</span> isT:
        _, (xpix,) = wcs.all_world2pix([0], [wav], 0)
    <span style="color: #b9d3ee;">else</span>:
        (xpix,), <span style="color: #dfaf8f;">_</span> = wcs.all_world2pix([wav], [0], 0)
<span style="color: #5F7F5F;">#    </span><span style="color: #8b8b83; font-style: italic;">print(wcs.wcs.crpix, wcs.wcs.crval, wcs.wcs.get_cdelt(), wcs.wcs.get_pc())</span>
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Wav:'</span>, wav, <span style="color: #eee8aa; font-style: italic;">'Pixel:'</span>, xpix)
    <span style="color: #b9d3ee;">return</span> <span style="color: #DCDCCC; font-weight: bold;">max</span>(0, <span style="color: #DCDCCC; font-weight: bold;">min</span>(nwav, <span style="color: #DCDCCC; font-weight: bold;">int</span>(xpix+0.5)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline33" class="outline-4">
<h4 id="orgheadline33"><span class="section-number-4">2.1.3</span> Make a sensible WCS (even if wavelength info missing)</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
0.0994382022472
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #dfaf8f;">wcs_extra</span> = {
    <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: (440, 6583.45, 0.1),
    <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: (446, 6583.45, 0.1),
    (<span style="color: #eee8aa; font-style: italic;">'2006-02'</span>, <span style="color: #eee8aa; font-style: italic;">'323'</span>): (442, 6583.45, 0.1),
    (<span style="color: #eee8aa; font-style: italic;">'2006-02'</span>, <span style="color: #eee8aa; font-style: italic;">'318'</span>): (442, 6583.45, 0.1),
    (<span style="color: #eee8aa; font-style: italic;">'2006-02'</span>, <span style="color: #eee8aa; font-style: italic;">'260'</span>): (491, 6583.45, 0.1),
    <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: (440, 6583.45, 0.1),
    <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: (440, 6583.45, 0.1),
    <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: (167, 6583.45, -0.056),
    (<span style="color: #eee8aa; font-style: italic;">'2015-02'</span>, <span style="color: #eee8aa; font-style: italic;">'0003'</span>): (1015, 6583.45, 0.05775),
    (<span style="color: #eee8aa; font-style: italic;">'2015-02'</span>, <span style="color: #eee8aa; font-style: italic;">'0012'</span>): (888, 6583.45, 0.05775),
}
<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">makeWCS</span>(hdr, dset, imid, jwav):
    <span style="color: #dfaf8f;">w</span> = WCS(hdr)
    <span style="color: #dfaf8f;">dwav</span> = w.wcs.get_cdelt()[jwav]*w.wcs.get_pc()[jwav, jwav]
    <span style="color: #b9d3ee;">if</span> dwav == 1.0:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">No WCS info from header, so fix it by hand</span>
        <span style="color: #dfaf8f;">extras</span> =  wcs_extra.get((dset, imid)) <span style="color: #b9d3ee;">or</span> wcs_extra.get(dset)
        <span style="color: #b9d3ee;">if</span> w.wcs.has_cd():
            w.wcs.crpix[jwav], w.wcs.crval[jwav], <span style="color: #dfaf8f;">w.wcs.cd</span>[jwav, jwav] = extras
        <span style="color: #b9d3ee;">else</span>:
            w.wcs.crpix[jwav], w.wcs.crval[jwav], <span style="color: #dfaf8f;">w.wcs.cdelt</span>[jwav] = extras
        <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Fixing WCS to CRPIX = {}, CRVAL = {}, CDELT = {}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(*extras) )
        <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Confirmation CRPIX = {}, CRVAL = {}, CDELT = {}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(w.wcs.crpix[jwav],
                                                                       w.wcs.crval[jwav],
                                                                       w.wcs.get_cdelt()[jwav]) )
    <span style="color: #b9d3ee;">return</span> w
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline24" class="outline-4">
<h4 id="orgheadline24"><a id="ID-74998E9B-988D-4378-9465-DAC5EE6E15A0"></a><span class="section-number-4">2.1.4</span> <span class="done DONE">DONE</span> Extract profile along slit for an isolated line</h4>
<div class="outline-text-4" id="text-2-1-4">
<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock4"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">extract_profile</span>(hdu, wavrest, dset, imid,
                    dw=4.0, dwbg_in=6.0, dwbg_out=8.0,
                    isT=<span style="color: #cFfBcF;">False</span>, smooth=10):
    <span style="color: #dfaf8f;">jwav</span> = 1 <span style="color: #b9d3ee;">if</span> isT <span style="color: #b9d3ee;">else</span> 0
    <span style="color: #dfaf8f;">w</span> = makeWCS(hdu.header, dset, imid, jwav)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Make sure array axis order is (position, wavelength)</span>
    <span style="color: #dfaf8f;">data</span> = hdu.data.T <span style="color: #b9d3ee;">if</span> isT <span style="color: #b9d3ee;">else</span> hdu.data
    <span style="color: #dfaf8f;">nslit</span>, <span style="color: #dfaf8f;">nwav</span> = data.shape
    <span style="color: #dfaf8f;">dwav</span> = w.wcs.get_cdelt()[jwav]*w.wcs.get_pc()[jwav, jwav]
    <span style="color: #dfaf8f;">sgn</span> = np.sign(dwav)         <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Need to take slices backwards if this is negative</span>
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Check: wavrest = {}, dwav = {}, nslit = {}, nwav = {}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(wavrest, dwav, nslit, nwav))
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">pixel limits for line extraction</span>
    <span style="color: #dfaf8f;">i1</span> = wav2pix(wavrest-dw/2, w, nwav, isT)
    <span style="color: #dfaf8f;">i2</span> = wav2pix(wavrest+dw/2, w, nwav, isT)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">pixel limits for blue bg extraction</span>
    <span style="color: #dfaf8f;">iblu1</span> = wav2pix(wavrest-dwbg_out/2, w, nwav, isT)
    <span style="color: #dfaf8f;">iblu2</span> = wav2pix(wavrest-dwbg_in/2, w, nwav, isT)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">pixel limits for red bg extraction</span>
    <span style="color: #dfaf8f;">ired1</span> = wav2pix(wavrest+dwbg_in/2, w, nwav, isT)
    <span style="color: #dfaf8f;">ired2</span> = wav2pix(wavrest+dwbg_out/2, w, nwav, isT)
    <span style="color: #b9d3ee;">print</span>(iblu1, iblu2, i1, i2, ired1, ired2)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">extract backgrounds on blue and red sides</span>
    <span style="color: #dfaf8f;">bgblu</span> = data[:, iblu1:iblu2:sgn].mean(axis=1)
    <span style="color: #dfaf8f;">bgred</span> = data[:, ired1:ired2:sgn].mean(axis=1)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">take weighted average, accounting for cases where the bg region</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">does not fit in the image</span>
    <span style="color: #dfaf8f;">weight_blu</span> = data[:, iblu1:iblu2:sgn].size
    <span style="color: #dfaf8f;">weight_red</span> = data[:, ired1:ired2:sgn].size
    <span style="color: #dfaf8f;">bg</span> = (bgblu*weight_blu + bgred*weight_red)/(weight_blu + weight_red)
    <span style="color: #dfaf8f;">data</span> -= bg[:, <span style="color: #cFfBcF;">None</span>]

    <span style="color: #dfaf8f;">profile</span> = data[:, i1:i2:sgn].<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=1)
    <span style="color: #b9d3ee;">if</span> smooth <span style="color: #b9d3ee;">is</span> <span style="color: #b9d3ee;">not</span> <span style="color: #cFfBcF;">None</span>:
        <span style="color: #dfaf8f;">profile</span> = convolve_fft(profile, Box1DKernel(smooth))
    <span style="color: #b9d3ee;">return</span> profile
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline34" class="outline-4">
<h4 id="orgheadline34"><span class="section-number-4">2.1.5</span> Find the celestial coordinates along the slit by using the WCS of the calibrated spectrum</h4>
<div class="outline-text-4" id="text-2-1-5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">slit_coords_from_wcs</span>(w, isT, nslit):
    <span style="color: #eee8aa; font-style: italic;">"""Input arguments: `w` a WCS object with 3 dimensions and i axis</span>
<span style="color: #eee8aa; font-style: italic;">order (wav, ra, dec) and with j axis order (wav, parallel, perp);</span>
<span style="color: #eee8aa; font-style: italic;">`isT` flag that is True for horizontal slits; `nslit`, is number of</span>
<span style="color: #eee8aa; font-style: italic;">pixels along the slit.  Returns: `coords`, `coord_label` where `coord`</span>
<span style="color: #eee8aa; font-style: italic;">is array of major coordinate for each slit pixel and `coord_label` is</span>
<span style="color: #eee8aa; font-style: italic;">its coordinate name (RA or Dec)</span>

<span style="color: #eee8aa; font-style: italic;">    """</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Note that j axis order is always wavelength, then along slit,</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">then across slit</span>
    <span style="color: #dfaf8f;">wav</span>, <span style="color: #dfaf8f;">ra</span>, <span style="color: #dfaf8f;">dec</span> = w.all_pix2world([0]*nslit, <span style="color: #DCDCCC; font-weight: bold;">range</span>(nslit), [0]*nslit, 0)
    <span style="color: #b9d3ee;">if</span> isT:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Slit axis mainly along RA</span>
        <span style="color: #dfaf8f;">coord_label</span> = w.wcs.cname[1]
        <span style="color: #dfaf8f;">coords</span> = ra
    <span style="color: #b9d3ee;">else</span>:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Slit axis mainly along Dec</span>
        <span style="color: #dfaf8f;">coord_label</span> = w.wcs.cname[2]
        <span style="color: #dfaf8f;">coords</span> = dec
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Major coordinate:'</span>, coord_label)
    <span style="color: #b9d3ee;">print</span>(coords[::100])
    <span style="color: #b9d3ee;">return</span> coords, coord_label
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline35" class="outline-4">
<h4 id="orgheadline35"><span class="section-number-4">2.1.6</span> Loop over all the slits and check the ratios</h4>
<div class="outline-text-4" id="text-2-1-6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #dfaf8f;">datasets</span> = <span style="color: #DCDCCC; font-weight: bold;">set</span>(tab[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>])
<span style="color: #dfaf8f;">MAXLINES</span> = 18
sns.set_palette(<span style="color: #eee8aa; font-style: italic;">"deep"</span>, 6)
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">sns.set_palette(sns.husl_palette(MAXLINES//3, l=0.4))</span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">sns.set_palette(sns.diverging_palette(10, 220, sep=80, n=MAXLINES/2, center='dark'))</span>
<span style="color: #dfaf8f;">ratio_types</span> = <span style="color: #eee8aa; font-style: italic;">'nii-ha'</span>, <span style="color: #eee8aa; font-style: italic;">'nii-ha-full'</span>, <span style="color: #eee8aa; font-style: italic;">'nii-nii-full'</span>
<span style="color: #dfaf8f;">fig_ax_dict</span> = {(ds, rtype): plt.subplots(1, 1)
               <span style="color: #b9d3ee;">for</span> ds <span style="color: #b9d3ee;">in</span> datasets <span style="color: #b9d3ee;">for</span> rtype <span style="color: #b9d3ee;">in</span> ratio_types}
<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">get_plot_dict</span>(iline):
    <span style="color: #eee8aa; font-style: italic;">"""Lines get thicker and fainter as iline increases"""</span>
    <span style="color: #dfaf8f;">x</span> = iline/MAXLINES
    <span style="color: #b9d3ee;">return</span> {<span style="color: #eee8aa; font-style: italic;">"lw"</span>: 0.8 + 1.2*x, <span style="color: #eee8aa; font-style: italic;">"alpha"</span>: 1.0 - 0.6*x}

<span style="color: #b9d3ee;">for</span> row <span style="color: #b9d3ee;">in</span> tab:
    <span style="color: #b9d3ee;">print</span>(row[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>], row[<span style="color: #eee8aa; font-style: italic;">'imid'</span>], row[<span style="color: #eee8aa; font-style: italic;">'specid'</span>])
    <span style="color: #dfaf8f;">full_id</span> = row[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>] + <span style="color: #eee8aa; font-style: italic;">'-'</span> + row[<span style="color: #eee8aa; font-style: italic;">'imid'</span>]
    <span style="color: #dfaf8f;">specfile</span> = find_fits_filepath(row, <span style="color: #eee8aa; font-style: italic;">'fullspec'</span>)
    <span style="color: #dfaf8f;">hafile</span> = find_fits_filepath(row, <span style="color: #eee8aa; font-style: italic;">'ha'</span>)
    <span style="color: #dfaf8f;">niifile</span> = find_fits_filepath(row, <span style="color: #eee8aa; font-style: italic;">'nii'</span>)
    <span style="color: #dfaf8f;">calibfile</span> = <span style="color: #eee8aa; font-style: italic;">'Calibrated/{}-{}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(full_id, <span style="color: #eee8aa; font-style: italic;">'ha'</span>)
    <span style="color: #dfaf8f;">spechdu</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(specfile)[0]
    <span style="color: #dfaf8f;">hahdu</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(hafile)[0]
    <span style="color: #dfaf8f;">niihdu</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(niifile)[0]
    <span style="color: #dfaf8f;">calhdu</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(calibfile)[0]
    <span style="color: #dfaf8f;">calw</span> = WCS(calhdu.header, key=<span style="color: #eee8aa; font-style: italic;">'A'</span>)

    <span style="color: #dfaf8f;">isT</span> = row[<span style="color: #eee8aa; font-style: italic;">'saxis'</span>] == 1
    <span style="color: #dfaf8f;">dset</span> = row[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>]
    <span style="color: #dfaf8f;">imid</span> = row[<span style="color: #eee8aa; font-style: italic;">'imid'</span>]

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">First use the extracted ha and nii spectra, plotted against RA or Dec</span>
    <span style="color: #dfaf8f;">ha</span> = extract_profile(hahdu, 6562.79, dset, imid, isT=isT)
    <span style="color: #dfaf8f;">nii</span> = extract_profile(niihdu, 6583.45, dset, imid, isT=isT)
    <span style="color: #dfaf8f;">fig</span>, <span style="color: #dfaf8f;">ax</span> = fig_ax_dict[(dset, <span style="color: #eee8aa; font-style: italic;">'nii-ha'</span>)]
    <span style="color: #dfaf8f;">coords</span>, <span style="color: #dfaf8f;">coord_label</span> = slit_coords_from_wcs(calw, isT, <span style="color: #DCDCCC; font-weight: bold;">len</span>(ha))
    ax.plot(coords, nii/ha, label=<span style="color: #DCDCCC; font-weight: bold;">str</span>(row[<span style="color: #eee8aa; font-style: italic;">'imid'</span>]), **get_plot_dict(<span style="color: #DCDCCC; font-weight: bold;">len</span>(ax.lines)))
    ax.set_xlabel(coord_label)
    <span style="color: #b9d3ee;">if</span> coord_label == <span style="color: #eee8aa; font-style: italic;">'Declination'</span>:
        ax.set_xlim(-5.51, -5.33)
    <span style="color: #b9d3ee;">else</span>:
        ax.set_xlim(83.85, 83.55)  <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">RA should increase right-to-left</span>

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Then use the full spectrum, just plotted against pixel</span>
    <span style="color: #dfaf8f;">ha</span> = extract_profile(spechdu, 6562.79, dset, imid, isT=isT)
    <span style="color: #dfaf8f;">nii</span> = extract_profile(spechdu, 6583.45, dset, imid, isT=isT)
    <span style="color: #dfaf8f;">niib</span> = extract_profile(spechdu, 6548.05, dset, imid, isT=isT)
    <span style="color: #dfaf8f;">fig</span>, <span style="color: #dfaf8f;">ax</span> = fig_ax_dict[(dset, <span style="color: #eee8aa; font-style: italic;">'nii-ha-full'</span>)]
    ax.plot(nii/ha, label=<span style="color: #DCDCCC; font-weight: bold;">str</span>(row[<span style="color: #eee8aa; font-style: italic;">'imid'</span>]), **get_plot_dict(<span style="color: #DCDCCC; font-weight: bold;">len</span>(ax.lines)))
    <span style="color: #dfaf8f;">fig</span>, <span style="color: #dfaf8f;">ax</span> = fig_ax_dict[(dset, <span style="color: #eee8aa; font-style: italic;">'nii-nii-full'</span>)]
    ax.plot(niib/nii, label=<span style="color: #DCDCCC; font-weight: bold;">str</span>(row[<span style="color: #eee8aa; font-style: italic;">'imid'</span>]), **get_plot_dict(<span style="color: #DCDCCC; font-weight: bold;">len</span>(ax.lines)))


<span style="color: #b9d3ee;">for</span> (ds, rtype), (fig, ax) <span style="color: #b9d3ee;">in</span> fig_ax_dict.items():
    ax.legend()
    ax.set_ylim(0.0, 0.5)
    <span style="color: #b9d3ee;">if</span> <span style="color: #b9d3ee;">not</span> rtype == <span style="color: #eee8aa; font-style: italic;">'nii-ha'</span>:
        ax.set_xlabel(<span style="color: #eee8aa; font-style: italic;">'Pixel'</span>)
    <span style="color: #b9d3ee;">if</span> <span style="color: #eee8aa; font-style: italic;">'ha'</span> <span style="color: #b9d3ee;">in</span> rtype:
        ax.set_ylabel(<span style="color: #eee8aa; font-style: italic;">'6583 / 6563'</span>)
    <span style="color: #b9d3ee;">else</span>:
        ax.set_ylabel(<span style="color: #eee8aa; font-style: italic;">'6548 / 6583'</span>)
    fig.savefig(<span style="color: #eee8aa; font-style: italic;">'plots/{}-check-{}.png'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(rtype, ds), dpi=300)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline46" class="outline-3">
<h3 id="orgheadline46"><span class="section-number-3">2.2</span> Check the pixel bounds for bg and line</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-orgheadline37" class="outline-4">
<h4 id="orgheadline37"><span class="section-number-4">2.2.1</span> Script to check the grating angles and other observational parameters</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock5"><span style="color: #b9d3ee;">import</span> os
<span style="color: #b9d3ee;">import</span> sys
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">import</span> astropy
<span style="color: #b9d3ee;">from</span> astropy.table <span style="color: #b9d3ee;">import</span> Table
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS
<span style="color: #b9d3ee;">from</span> astropy.wcs.utils <span style="color: #b9d3ee;">import</span> pixel_to_skycoord
<span style="color: #b9d3ee;">from</span> matplotlib <span style="color: #b9d3ee;">import</span> pyplot <span style="color: #b9d3ee;">as</span> plt
<span style="color: #b9d3ee;">import</span> seaborn <span style="color: #b9d3ee;">as</span> sns
<span style="color: #b9d3ee;">from</span> astropy <span style="color: #b9d3ee;">import</span> units <span style="color: #b9d3ee;">as</span> u
<span style="color: #b9d3ee;">from</span> astropy.coordinates <span style="color: #b9d3ee;">import</span> SkyCoord
<span style="color: #b9d3ee;">from</span> astropy.modeling <span style="color: #b9d3ee;">import</span> models, fitting
<span style="color: #dfaf8f;">converters</span> = {<span style="color: #eee8aa; font-style: italic;">'imid'</span>: [astropy.io.<span style="color: #DCDCCC; font-weight: bold;">ascii</span>.convert_numpy(np.<span style="color: #DCDCCC; font-weight: bold;">str</span>)]}
<span style="color: #dfaf8f;">tab</span> = Table.read(<span style="color: #eee8aa; font-style: italic;">'all-slits-input.tab'</span>,
                 <span style="color: #DCDCCC; font-weight: bold;">format</span>=<span style="color: #eee8aa; font-style: italic;">'ascii.tab'</span>, converters=converters)
<span style="color: #dfaf8f;">file_templates</span> = {
    <span style="color: #eee8aa; font-style: italic;">'fullspec'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2005/pp{}.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spec{}.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spec{}-transf.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/spm{}h.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spm{}_bcr.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spm{}_bcrx.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}o_bcrx.fits'</span>,
    },
    <span style="color: #eee8aa; font-style: italic;">'ha'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/SPMha/spec{}-halpha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spec{}-ha-fix.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spec{}-ha.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}o_sub-ha.fits'</span>,
    },
    <span style="color: #eee8aa; font-style: italic;">'nii'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/SPMnii/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spec{}-nii-fix.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spec{}-nii.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}o_sub-nii.fits'</span>,
    },
    <span style="color: #eee8aa; font-style: italic;">'image'</span> : {
        <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/Papers/LL-Objects/feb2006/pp{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01b'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/HH505/slits/reducciones/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Work/SPM2007/Reduced/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMJAN10/reducciones/posiciones/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB13/WesternShocks/spm{}_ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/papers/LL-Objects/SPMDIC13/spm{}-ardec.fits'</span>,
        <span style="color: #eee8aa; font-style: italic;">'2015-02'</span>: <span style="color: #eee8aa; font-style: italic;">'Dropbox/SPMFEB15/archivos/spm{}-ardec.fits'</span>,
    },
}

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">find_fits_filepath</span>(db, filetype):
    <span style="color: #eee8aa; font-style: italic;">"""Return path to the FITS file for an image or spectrum </span>
<span style="color: #eee8aa; font-style: italic;">    """</span>
    <span style="color: #dfaf8f;">id_</span> = db[<span style="color: #eee8aa; font-style: italic;">'imid'</span>] <span style="color: #b9d3ee;">if</span> filetype == <span style="color: #eee8aa; font-style: italic;">'image'</span> <span style="color: #b9d3ee;">else</span> db[<span style="color: #eee8aa; font-style: italic;">'specid'</span>]
    <span style="color: #dfaf8f;">id_</span> = <span style="color: #DCDCCC; font-weight: bold;">str</span>(id_)
    <span style="color: #b9d3ee;">if</span> filetype <span style="color: #b9d3ee;">in</span> (<span style="color: #eee8aa; font-style: italic;">'ha'</span>, <span style="color: #eee8aa; font-style: italic;">'nii'</span>) <span style="color: #b9d3ee;">and</span> db[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>] <span style="color: #b9d3ee;">not</span> <span style="color: #b9d3ee;">in</span> [<span style="color: #eee8aa; font-style: italic;">'2013-12'</span>]:
        <span style="color: #dfaf8f;">id_</span> = id_.split(<span style="color: #eee8aa; font-style: italic;">'-'</span>)[0]
    <span style="color: #dfaf8f;">template</span> = file_templates[filetype][db[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>]]
    <span style="color: #dfaf8f;">path</span> = template.<span style="color: #DCDCCC; font-weight: bold;">format</span>(id_)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'~/'</span>+path)
    <span style="color: #dfaf8f;">homedir</span> = os.path.expanduser(<span style="color: #eee8aa; font-style: italic;">'~'</span>)
    <span style="color: #b9d3ee;">return</span> os.path.join(homedir, path)
<span style="color: #dfaf8f;">outtab</span> = [[<span style="color: #eee8aa; font-style: italic;">'ID'</span>, <span style="color: #eee8aa; font-style: italic;">'Spec'</span>, <span style="color: #eee8aa; font-style: italic;">'Date'</span>, <span style="color: #eee8aa; font-style: italic;">'Detector'</span>, <span style="color: #eee8aa; font-style: italic;">'Grating'</span>, <span style="color: #eee8aa; font-style: italic;">'Aperture'</span>, <span style="color: #eee8aa; font-style: italic;">'Gain'</span>], <span style="color: #cFfBcF;">None</span>]
<span style="color: #b9d3ee;">for</span> row <span style="color: #b9d3ee;">in</span> tab:
    <span style="color: #dfaf8f;">full_id</span> = row[<span style="color: #eee8aa; font-style: italic;">'Dataset'</span>] + <span style="color: #eee8aa; font-style: italic;">'-'</span> + row[<span style="color: #eee8aa; font-style: italic;">'imid'</span>]
    <span style="color: #dfaf8f;">specfile</span> = find_fits_filepath(row, <span style="color: #eee8aa; font-style: italic;">'fullspec'</span>)
    <span style="color: #dfaf8f;">hdr</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(specfile)[0].header
    outtab.append([full_id, row[<span style="color: #eee8aa; font-style: italic;">'specid'</span>], hdr.get(<span style="color: #eee8aa; font-style: italic;">'DATE-OBS'</span>),
                   hdr.get(<span style="color: #eee8aa; font-style: italic;">'DETECTOR'</span>) <span style="color: #b9d3ee;">or</span> hdr.get(<span style="color: #eee8aa; font-style: italic;">'CAMERA'</span>),
                   hdr.get(<span style="color: #eee8aa; font-style: italic;">'APERTURE'</span>), hdr.get(<span style="color: #eee8aa; font-style: italic;">'GRATING'</span>), hdr.get(<span style="color: #eee8aa; font-style: italic;">'GAIN'</span>)])
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline38" class="outline-4">
<h4 id="orgheadline38"><span class="section-number-4">2.2.2</span> 2006-02 dataset</h4>
<div class="outline-text-4" id="text-2-2-2">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits ~/Work/SPM2005/pp324.fits
</pre>
</div>

<ul class="org-ul">
<li>Measurements of X at top of image for blue component of 6583</li>
<li>Pixel difference between 6583 and 6548 is 356 =&gt; dwav = 0.1</li>
<li id="A"><ul class="org-ul">
<li>X = 442</li>
<li>Grating = -11</li>
<li>324, 319</li>
</ul></li>
<li id="B"><ul class="org-ul">
<li>X = 491</li>
<li>Grating = -7</li>
<li>261</li>
</ul></li>
<li id="C"><ul class="org-ul">
<li>X = 446</li>
<li>Grating = -4, -8, -7 (!!!), -10
<ul class="org-ul">
<li>287 has grating of -7, which is the same as 261</li>
<li>but the position of the spectrum on the chip is the same as for all the others</li>
<li>So we can't use the Grating value for anything</li>
</ul></li>
<li>271, 277, 282, 287, 292, 297, 304, 312</li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline39" class="outline-4">
<h4 id="orgheadline39"><span class="section-number-4">2.2.3</span> 2007-01b dataset</h4>
<div class="outline-text-4" id="text-2-2-3">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits ~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2058-2060.fits
</pre>
</div>
<ul class="org-ul">
<li>All the same</li>
<li>X = 440</li>
<li>2062, 2038, 2042, 2046, 2050, 2054, 2058</li>
<li>Grating = 0</li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline40" class="outline-4">
<h4 id="orgheadline40"><span class="section-number-4">2.2.4</span> 2007-01 dataset</h4>
<div class="outline-text-4" id="text-2-2-4">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits ~/Work/SPM2007/Reduced/spec055-transf.fits
</pre>
</div>
<ul class="org-ul">
<li>All the same</li>
<li>X = 440</li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline41" class="outline-4">
<h4 id="orgheadline41"><span class="section-number-4">2.2.5</span> 2010-01 dataset</h4>
<div class="outline-text-4" id="text-2-2-5">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits ~/Dropbox/SPMJAN10/reducciones/spm079-080h.fits
</pre>
</div>
<ul class="org-ul">
<li>Only tiny changes in position between X=440 and X=443</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline42" class="outline-4">
<h4 id="orgheadline42"><span class="section-number-4">2.2.6</span> 2013-02</h4>
<div class="outline-text-4" id="text-2-2-6">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits ~/Dropbox/SPMFEB13/WesternShocks/spm025_bcr.fits
</pre>
</div>
<ul class="org-ul">
<li>dwav = -0.056</li>
<li>Y = 167 (6583), Y = 799 (6548)</li>
<li>Changes to Y = 165 in 238, 233</li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline43" class="outline-4">
<h4 id="orgheadline43"><span class="section-number-4">2.2.7</span> 2013-12</h4>
<div class="outline-text-4" id="text-2-2-7">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits ~/Dropbox/papers/LL-Objects/SPMDIC13/spm112-113_bcrx.fits
</pre>
</div>
<ul class="org-ul">
<li>dwav = 0.05664</li>
<li>Y = 843 (6583), Y = 218 (6548)</li>
<li>But this already has a decent WCS</li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline44" class="outline-4">
<h4 id="orgheadline44"><span class="section-number-4">2.2.8</span> 2015-02</h4>
<div class="outline-text-4" id="text-2-2-8">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits ~/Dropbox/SPMFEB15/archivos/spm0013o_bcrx.fits
</pre>
</div>
<dl class="org-dl">
<dt>0004</dt><dd><ul class="org-ul">
<li>Y = 1015 (6583), Y = 402 (6548)</li>
<li>dwav = 0.05775</li>
</ul></dd>
<dt>0013</dt><dd><ul class="org-ul">
<li>Y = 888 (6583), Y = 271 (6548)</li>
</ul></dd>
</dl>
</div>
</div>

<div id="outline-container-orgheadline45" class="outline-4">
<h4 id="orgheadline45"><span class="section-number-4">2.2.9</span> Looking at the calibrated spectra</h4>
<div class="outline-text-4" id="text-2-2-9">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/Calibrated/2006-02-303-ha.fits
</pre>
</div>

<p>
So it seems like all the trouble was due to differences in the zero-level between the nii and the ha spectra! 
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline47" class="outline-3">
<h3 id="orgheadline47"><span class="section-number-3">2.3</span> Run slit-ratio-check.py</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-sh">python slit-ratio-check.py <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">1&gt;&amp;2</span>
</pre>
</div>

<pre class="example">
2006-02 326 324
~/Work/SPM2005/pp324.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec324-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec324-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43558101 -5.41828809 -5.40099517 -5.38370226 -5.36640936 -5.34911647]
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 218.4
Wav: 6564.79 Pixel: 258.4
Wav: 6558.79 Pixel: 198.4
Wav: 6559.79 Pixel: 208.4
Wav: 6565.79 Pixel: 268.4
Wav: 6566.79 Pixel: 278.4
198 208 218 258 268 278
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 425.0
Wav: 6585.45 Pixel: 465.0
Wav: 6579.45 Pixel: 405.0
Wav: 6580.45 Pixel: 415.0
Wav: 6586.45 Pixel: 475.0
Wav: 6587.45 Pixel: 485.0
405 415 425 465 475 485
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 71.0
Wav: 6550.05 Pixel: 111.0
Wav: 6544.05 Pixel: 51.0
Wav: 6545.05 Pixel: 61.0
Wav: 6551.05 Pixel: 121.0
Wav: 6552.05 Pixel: 131.0
51 61 71 111 121 131
2006-02 318 319
~/Work/SPM2005/pp319.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec319-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec319-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43451169 -5.41721639 -5.3999211  -5.38262581 -5.36533053 -5.34803526]
Fixing WCS to CRPIX = 442, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 442.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 214.4
Wav: 6564.79 Pixel: 254.4
Wav: 6558.79 Pixel: 194.4
Wav: 6559.79 Pixel: 204.4
Wav: 6565.79 Pixel: 264.4
Wav: 6566.79 Pixel: 274.4
194 204 214 254 264 274
Fixing WCS to CRPIX = 442, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 442.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 421.0
Wav: 6585.45 Pixel: 461.0
Wav: 6579.45 Pixel: 401.0
Wav: 6580.45 Pixel: 411.0
Wav: 6586.45 Pixel: 471.0
Wav: 6587.45 Pixel: 481.0
401 411 421 461 471 481
Fixing WCS to CRPIX = 442, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 442.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 67.0
Wav: 6550.05 Pixel: 107.0
Wav: 6544.05 Pixel: 47.0
Wav: 6545.05 Pixel: 57.0
Wav: 6551.05 Pixel: 117.0
Wav: 6552.05 Pixel: 127.0
47 57 67 107 117 127
2006-02 260 261
~/Work/SPM2005/pp261.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec261-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec261-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43189927 -5.41468131 -5.39746336 -5.38024542 -5.36302748 -5.34580956]
Fixing WCS to CRPIX = 491, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 491.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 263.4
Wav: 6564.79 Pixel: 303.4
Wav: 6558.79 Pixel: 243.4
Wav: 6559.79 Pixel: 253.4
Wav: 6565.79 Pixel: 313.4
Wav: 6566.79 Pixel: 323.4
243 253 263 303 313 323
Fixing WCS to CRPIX = 491, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 491.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 470.0
Wav: 6585.45 Pixel: 510.0
Wav: 6579.45 Pixel: 450.0
Wav: 6580.45 Pixel: 460.0
Wav: 6586.45 Pixel: 520.0
Wav: 6587.45 Pixel: 530.0
450 460 470 510 512 512
Fixing WCS to CRPIX = 491, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 491.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 116.0
Wav: 6550.05 Pixel: 156.0
Wav: 6544.05 Pixel: 96.0
Wav: 6545.05 Pixel: 106.0
Wav: 6551.05 Pixel: 166.0
Wav: 6552.05 Pixel: 176.0
96 106 116 156 166 176
2006-02 270 271
~/Work/SPM2005/pp271.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec271-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec271-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43182595 -5.41456224 -5.39729854 -5.38003484 -5.36277115 -5.34550748]
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 218.4
Wav: 6564.79 Pixel: 258.4
Wav: 6558.79 Pixel: 198.4
Wav: 6559.79 Pixel: 208.4
Wav: 6565.79 Pixel: 268.4
Wav: 6566.79 Pixel: 278.4
198 208 218 258 268 278
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 425.0
Wav: 6585.45 Pixel: 465.0
Wav: 6579.45 Pixel: 405.0
Wav: 6580.45 Pixel: 415.0
Wav: 6586.45 Pixel: 475.0
Wav: 6587.45 Pixel: 485.0
405 415 425 465 475 485
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 71.0
Wav: 6550.05 Pixel: 111.0
Wav: 6544.05 Pixel: 51.0
Wav: 6545.05 Pixel: 61.0
Wav: 6551.05 Pixel: 121.0
Wav: 6552.05 Pixel: 131.0
51 61 71 111 121 131
2006-02 276 277
~/Work/SPM2005/pp277.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec277-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec277-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43170651 -5.41445512 -5.39720373 -5.37995236 -5.36270099 -5.34544963]
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 218.4
Wav: 6564.79 Pixel: 258.4
Wav: 6558.79 Pixel: 198.4
Wav: 6559.79 Pixel: 208.4
Wav: 6565.79 Pixel: 268.4
Wav: 6566.79 Pixel: 278.4
198 208 218 258 268 278
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 425.0
Wav: 6585.45 Pixel: 465.0
Wav: 6579.45 Pixel: 405.0
Wav: 6580.45 Pixel: 415.0
Wav: 6586.45 Pixel: 475.0
Wav: 6587.45 Pixel: 485.0
405 415 425 465 475 485
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 71.0
Wav: 6550.05 Pixel: 111.0
Wav: 6544.05 Pixel: 51.0
Wav: 6545.05 Pixel: 61.0
Wav: 6551.05 Pixel: 121.0
Wav: 6552.05 Pixel: 131.0
51 61 71 111 121 131
2006-02 281 282
~/Work/SPM2005/pp282.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec282-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec282-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43180229 -5.41453212 -5.39726195 -5.37999179 -5.36272164 -5.3454515 ]
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 218.4
Wav: 6564.79 Pixel: 258.4
Wav: 6558.79 Pixel: 198.4
Wav: 6559.79 Pixel: 208.4
Wav: 6565.79 Pixel: 268.4
Wav: 6566.79 Pixel: 278.4
198 208 218 258 268 278
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 425.0
Wav: 6585.45 Pixel: 465.0
Wav: 6579.45 Pixel: 405.0
Wav: 6580.45 Pixel: 415.0
Wav: 6586.45 Pixel: 475.0
Wav: 6587.45 Pixel: 485.0
405 415 425 465 475 485
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 71.0
Wav: 6550.05 Pixel: 111.0
Wav: 6544.05 Pixel: 51.0
Wav: 6545.05 Pixel: 61.0
Wav: 6551.05 Pixel: 121.0
Wav: 6552.05 Pixel: 131.0
51 61 71 111 121 131
2006-02 286 287
~/Work/SPM2005/pp287.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec287-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec287-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43174721 -5.41447833 -5.39720947 -5.3799406  -5.36267175 -5.34540291]
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 218.4
Wav: 6564.79 Pixel: 258.4
Wav: 6558.79 Pixel: 198.4
Wav: 6559.79 Pixel: 208.4
Wav: 6565.79 Pixel: 268.4
Wav: 6566.79 Pixel: 278.4
198 208 218 258 268 278
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 425.0
Wav: 6585.45 Pixel: 465.0
Wav: 6579.45 Pixel: 405.0
Wav: 6580.45 Pixel: 415.0
Wav: 6586.45 Pixel: 475.0
Wav: 6587.45 Pixel: 485.0
405 415 425 465 475 485
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 71.0
Wav: 6550.05 Pixel: 111.0
Wav: 6544.05 Pixel: 51.0
Wav: 6545.05 Pixel: 61.0
Wav: 6551.05 Pixel: 121.0
Wav: 6552.05 Pixel: 131.0
51 61 71 111 121 131
2006-02 291 292
~/Work/SPM2005/pp292.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec292-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec292-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43164099 -5.414456   -5.39727103 -5.38008605 -5.36290109 -5.34571614]
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 218.4
Wav: 6564.79 Pixel: 258.4
Wav: 6558.79 Pixel: 198.4
Wav: 6559.79 Pixel: 208.4
Wav: 6565.79 Pixel: 268.4
Wav: 6566.79 Pixel: 278.4
198 208 218 258 268 278
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 425.0
Wav: 6585.45 Pixel: 465.0
Wav: 6579.45 Pixel: 405.0
Wav: 6580.45 Pixel: 415.0
Wav: 6586.45 Pixel: 475.0
Wav: 6587.45 Pixel: 485.0
405 415 425 465 475 485
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 71.0
Wav: 6550.05 Pixel: 111.0
Wav: 6544.05 Pixel: 51.0
Wav: 6545.05 Pixel: 61.0
Wav: 6551.05 Pixel: 121.0
Wav: 6552.05 Pixel: 131.0
51 61 71 111 121 131
2006-02 296 297
~/Work/SPM2005/pp297.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec297-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec297-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43161555 -5.41436887 -5.39712219 -5.37987552 -5.36262885 -5.3453822 ]
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 218.4
Wav: 6564.79 Pixel: 258.4
Wav: 6558.79 Pixel: 198.4
Wav: 6559.79 Pixel: 208.4
Wav: 6565.79 Pixel: 268.4
Wav: 6566.79 Pixel: 278.4
198 208 218 258 268 278
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 425.0
Wav: 6585.45 Pixel: 465.0
Wav: 6579.45 Pixel: 405.0
Wav: 6580.45 Pixel: 415.0
Wav: 6586.45 Pixel: 475.0
Wav: 6587.45 Pixel: 485.0
405 415 425 465 475 485
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 71.0
Wav: 6550.05 Pixel: 111.0
Wav: 6544.05 Pixel: 51.0
Wav: 6545.05 Pixel: 61.0
Wav: 6551.05 Pixel: 121.0
Wav: 6552.05 Pixel: 131.0
51 61 71 111 121 131
2006-02 303 304
~/Work/SPM2005/pp304.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec304-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec304-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43285063 -5.41556246 -5.3982743  -5.38098614 -5.36369799 -5.34640986]
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 218.4
Wav: 6564.79 Pixel: 258.4
Wav: 6558.79 Pixel: 198.4
Wav: 6559.79 Pixel: 208.4
Wav: 6565.79 Pixel: 268.4
Wav: 6566.79 Pixel: 278.4
198 208 218 258 268 278
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 425.0
Wav: 6585.45 Pixel: 465.0
Wav: 6579.45 Pixel: 405.0
Wav: 6580.45 Pixel: 415.0
Wav: 6586.45 Pixel: 475.0
Wav: 6587.45 Pixel: 485.0
405 415 425 465 475 485
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 71.0
Wav: 6550.05 Pixel: 111.0
Wav: 6544.05 Pixel: 51.0
Wav: 6545.05 Pixel: 61.0
Wav: 6551.05 Pixel: 121.0
Wav: 6552.05 Pixel: 131.0
51 61 71 111 121 131
2006-02 313 312
~/Work/SPM2005/pp312.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMha/spec312-halpha.fits
~/Work/SPM2007/Reduced/HH505/slits/SPMnii/spec312-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 63.7683183591
Wav: 6564.79 Pixel: 155.192430702
Wav: 6558.79 Pixel: 18.0562621877
Wav: 6559.79 Pixel: 40.9122902734
Wav: 6565.79 Pixel: 178.048458788
Wav: 6566.79 Pixel: 200.904486873
18 41 64 155 178 201
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 200
Wav: 6581.45 Pixel: 55.8217940723
Wav: 6585.45 Pixel: 146.959417047
Wav: 6579.45 Pixel: 10.2529825847
Wav: 6580.45 Pixel: 33.0373883285
Wav: 6586.45 Pixel: 169.743822791
Wav: 6587.45 Pixel: 192.528228535
10 33 56 147 170 193
Major coordinate: Declination
[-5.43361786 -5.41631817 -5.39901849 -5.38171882 -5.36441915 -5.3471195 ]
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 218.4
Wav: 6564.79 Pixel: 258.4
Wav: 6558.79 Pixel: 198.4
Wav: 6559.79 Pixel: 208.4
Wav: 6565.79 Pixel: 268.4
Wav: 6566.79 Pixel: 278.4
198 208 218 258 268 278
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 425.0
Wav: 6585.45 Pixel: 465.0
Wav: 6579.45 Pixel: 405.0
Wav: 6580.45 Pixel: 415.0
Wav: 6586.45 Pixel: 475.0
Wav: 6587.45 Pixel: 485.0
405 415 425 465 475 485
Fixing WCS to CRPIX = 446, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 446.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 71.0
Wav: 6550.05 Pixel: 111.0
Wav: 6544.05 Pixel: 51.0
Wav: 6545.05 Pixel: 61.0
Wav: 6551.05 Pixel: 121.0
Wav: 6552.05 Pixel: 131.0
51 61 71 111 121 131
2007-01b 2061 2062-c
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2062-c.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2062-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2062-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.43792867 -5.42072997 -5.40353128 -5.38633259 -5.36913391 -5.35193524]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2007-01b 2037 2038-2040
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2038-2040.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2038-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2038-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.44332052 -5.42610224 -5.40888397 -5.3916657  -5.37444744 -5.35722919]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2007-01b 2041 2042-2044
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2042-2044.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2042-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2042-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.44328095 -5.4260643  -5.40884767 -5.39163103 -5.37441441 -5.3571978 ]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2007-01b 2045 2046-2048
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2046-2048.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2046-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2046-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.44333521 -5.4260593  -5.4087834  -5.39150751 -5.37423162 -5.35695575]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2007-01b 2049 2050-2052
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2050-2052.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2050-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2050-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.44331528 -5.42606895 -5.40882263 -5.39157631 -5.37433    -5.35708371]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2007-01b 2053 2054-2056
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2054-2056.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2054-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2054-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.43808897 -5.42089295 -5.40369692 -5.38650091 -5.3693049  -5.3521089 ]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2007-01b 2057 2058-2060
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2058-2060.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2058-ha.fits
~/Work/SPM2007/Reduced/HH505/slits/reducciones/spec2058-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.43815458 -5.42096912 -5.40378367 -5.38659822 -5.36941278 -5.35222735]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 0.1
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2007-01 054 055
~/Work/SPM2007/Reduced/spec055-transf.fits
~/Work/SPM2007/Reduced/spec055-ha-fix.fits
~/Work/SPM2007/Reduced/spec055-nii-fix.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896603882313, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6062131601
Wav: 6585.45 Pixel: 169.743851607
Wav: 6579.45 Pixel: 33.0373939368
Wav: 6580.45 Pixel: 55.8218035484
Wav: 6586.45 Pixel: 192.528261218
Wav: 6587.45 Pixel: 215.31267083
33 56 79 170 193 215
Major coordinate: Declination
[-5.48877689 -5.47147716 -5.45417743 -5.4368777  -5.41957799 -5.40227829]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2007-01 067 068
~/Work/SPM2007/Reduced/spec068-transf.fits
~/Work/SPM2007/Reduced/spec068-ha-fix.fits
~/Work/SPM2007/Reduced/spec068-nii-fix.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896603882313, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6062131601
Wav: 6585.45 Pixel: 169.743851607
Wav: 6579.45 Pixel: 33.0373939368
Wav: 6580.45 Pixel: 55.8218035484
Wav: 6586.45 Pixel: 192.528261218
Wav: 6587.45 Pixel: 215.31267083
33 56 79 170 193 215
Major coordinate: Declination
[-5.48903543 -5.4717266  -5.45441778 -5.43710896 -5.41980015 -5.40249136]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2007-01 072 073
~/Work/SPM2007/Reduced/spec073-transf.fits
~/Work/SPM2007/Reduced/spec073-ha-fix.fits
~/Work/SPM2007/Reduced/spec073-nii-fix.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896603882313, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6062131601
Wav: 6585.45 Pixel: 169.743851607
Wav: 6579.45 Pixel: 33.0373939368
Wav: 6580.45 Pixel: 55.8218035484
Wav: 6586.45 Pixel: 192.528261218
Wav: 6587.45 Pixel: 215.31267083
33 56 79 170 193 215
Major coordinate: Declination
[-5.48898612 -5.47171874 -5.45445137 -5.43718401 -5.41991665 -5.40264931]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 078 079-080
~/Dropbox/SPMJAN10/reducciones/spm079-080h.fits
~/Dropbox/SPMJAN10/reducciones/spec079-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec079-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.43655178 -5.41929871 -5.40204563 -5.38479256 -5.3675395  -5.35028644]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 202 203-204
~/Dropbox/SPMJAN10/reducciones/spm203-204h.fits
~/Dropbox/SPMJAN10/reducciones/spec203-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec203-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.47001678 -5.45269275 -5.43536871 -5.41804468 -5.40072066 -5.38339665]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 124 125-127
~/Dropbox/SPMJAN10/reducciones/spm125-127h.fits
~/Dropbox/SPMJAN10/reducciones/spec125-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec125-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.47173806 -5.45448454 -5.43723101 -5.41997749 -5.40272397 -5.38547047]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 206 207-208
~/Dropbox/SPMJAN10/reducciones/spm207-208h.fits
~/Dropbox/SPMJAN10/reducciones/spec207-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec207-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.46985658 -5.45258712 -5.43531766 -5.41804821 -5.40077876 -5.38350933]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 128 129-130
~/Dropbox/SPMJAN10/reducciones/spm129-130h.fits
~/Dropbox/SPMJAN10/reducciones/spec129-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec129-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.47202155 -5.45474105 -5.43746056 -5.42018006 -5.40289958 -5.3856191 ]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 133 134-135
~/Dropbox/SPMJAN10/reducciones/spm134-135h.fits
~/Dropbox/SPMJAN10/reducciones/spec134-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec134-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.46641384 -5.4491334  -5.43185296 -5.41457252 -5.39729209 -5.38001168]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 210 211-212
~/Dropbox/SPMJAN10/reducciones/spm211-212h.fits
~/Dropbox/SPMJAN10/reducciones/spec211-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec211-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.46986834 -5.45259418 -5.43532002 -5.41804587 -5.40077172 -5.38349759]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 137 138-139
~/Dropbox/SPMJAN10/reducciones/spm138-139h.fits
~/Dropbox/SPMJAN10/reducciones/spec138-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec138-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.46642482 -5.44914278 -5.43186074 -5.4145787  -5.39729667 -5.38001465]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 214 215-216
~/Dropbox/SPMJAN10/reducciones/spm215-216h.fits
~/Dropbox/SPMJAN10/reducciones/spec215-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec215-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.47061649 -5.45328866 -5.43596083 -5.418633   -5.40130519 -5.38397738]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 145 146-147
~/Dropbox/SPMJAN10/reducciones/spm146-147h.fits
~/Dropbox/SPMJAN10/reducciones/spec146-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec146-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.46606641 -5.44882464 -5.43158288 -5.41434112 -5.39709938 -5.37985764]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 248 249-250
~/Dropbox/SPMJAN10/reducciones/spm249-250h.fits
~/Dropbox/SPMJAN10/reducciones/spec249-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec249-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.47089296 -5.45361144 -5.43632991 -5.41904839 -5.40176688 -5.38448538]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 219 220-221
~/Dropbox/SPMJAN10/reducciones/spm220-221h.fits
~/Dropbox/SPMJAN10/reducciones/spec220-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec220-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.47027276 -5.45300394 -5.43573513 -5.41846632 -5.40119752 -5.38392873]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 157 158-159
~/Dropbox/SPMJAN10/reducciones/spm158-159h.fits
~/Dropbox/SPMJAN10/reducciones/spec158-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec158-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.46689286 -5.44967051 -5.43244816 -5.41522582 -5.39800348 -5.38078115]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 236 237-238
~/Dropbox/SPMJAN10/reducciones/spm237-238h.fits
~/Dropbox/SPMJAN10/reducciones/spec237-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec237-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.47048035 -5.45319256 -5.43590476 -5.41861697 -5.40132919 -5.38404142]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 240 241-242
~/Dropbox/SPMJAN10/reducciones/spm241-242h.fits
~/Dropbox/SPMJAN10/reducciones/spec241-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec241-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.4706784  -5.45338527 -5.43609213 -5.41879901 -5.40150589 -5.38421279]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 244 245-246
~/Dropbox/SPMJAN10/reducciones/spm245-246h.fits
~/Dropbox/SPMJAN10/reducciones/spec245-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec245-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.47054832 -5.4532177  -5.43588708 -5.41855647 -5.40122587 -5.38389528]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2010-01 252 253-254
~/Dropbox/SPMJAN10/reducciones/spm253-254h.fits
~/Dropbox/SPMJAN10/reducciones/spec253-ha.fits
~/Dropbox/SPMJAN10/reducciones/spec253-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 512, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 512, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Declination
[-5.47088698 -5.45361346 -5.43633994 -5.41906643 -5.40179292 -5.38451943]
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6562.79, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6560.79 Pixel: 212.4
Wav: 6564.79 Pixel: 252.4
Wav: 6558.79 Pixel: 192.4
Wav: 6559.79 Pixel: 202.4
Wav: 6565.79 Pixel: 262.4
Wav: 6566.79 Pixel: 272.4
192 202 212 252 262 272
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6583.45, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6581.45 Pixel: 419.0
Wav: 6585.45 Pixel: 459.0
Wav: 6579.45 Pixel: 399.0
Wav: 6580.45 Pixel: 409.0
Wav: 6586.45 Pixel: 469.0
Wav: 6587.45 Pixel: 479.0
399 409 419 459 469 479
Fixing WCS to CRPIX = 440, CRVAL = 6583.45, CDELT = 0.1
Confirmation CRPIX = 440.0, CRVAL = 6583.45, CDELT = 1.0
Check: wavrest = 6548.05, dwav = 0.1, nslit = 512, nwav = 512
Wav: 6546.05 Pixel: 65.0
Wav: 6550.05 Pixel: 105.0
Wav: 6544.05 Pixel: 45.0
Wav: 6545.05 Pixel: 55.0
Wav: 6551.05 Pixel: 115.0
Wav: 6552.05 Pixel: 125.0
45 55 65 105 115 125
2013-02 024 025
~/Dropbox/SPMFEB13/WesternShocks/spm025_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec025-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec025-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.61801906  83.63275778  83.6474965   83.66223523  83.67697396
  83.69171269  83.70645141]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-02 165 166-167
~/Dropbox/SPMFEB13/WesternShocks/spm166-167_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec166-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec166-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.57818738  83.59289637  83.60760536  83.62231435  83.63702334
  83.65173233  83.66644131]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-02 169 170-171
~/Dropbox/SPMFEB13/WesternShocks/spm170-171_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec170-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec170-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.5783108   83.59302783  83.60774487  83.6224619   83.63717894
  83.65189598  83.66661301]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-02 237 238-239
~/Dropbox/SPMFEB13/WesternShocks/spm238-239_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec238-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec238-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.58161213  83.59632473  83.61103734  83.62574995  83.64046255
  83.65517516  83.66988775]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-02 232 233-234
~/Dropbox/SPMFEB13/WesternShocks/spm233-234_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec233-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec233-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.58141226  83.59610698  83.6108017   83.62549642  83.64019114
  83.65488586  83.66958057]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-02 226 227-228
~/Dropbox/SPMFEB13/WesternShocks/spm227-228_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec227-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec227-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.57278793  83.58750876  83.60222959  83.61695042  83.63167126
  83.64639209  83.66111292]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-02 149 150-151
~/Dropbox/SPMFEB13/WesternShocks/spm150-151_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec150-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec150-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.58758289  83.6022937   83.61700452  83.63171533  83.64642615
  83.66113697  83.67584778]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-02 154 155-156
~/Dropbox/SPMFEB13/WesternShocks/spm155-156_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec155-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec155-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.58776802  83.6024749   83.61718179  83.63188869  83.64659558
  83.66130248  83.67600937]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-02 159 160-161
~/Dropbox/SPMFEB13/WesternShocks/spm160-161_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec160-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec160-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.58832512  83.60302264  83.61772016  83.63241768  83.64711521
  83.66181273  83.67651026]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-02 033 034-035
~/Dropbox/SPMFEB13/WesternShocks/spm034-035_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec034-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec034-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.57572808  83.59015903  83.60458998  83.61902092  83.63345185
  83.64788277  83.66231367]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-02 029 030-031
~/Dropbox/SPMFEB13/WesternShocks/spm030-031_bcr.fits
~/Dropbox/SPMFEB13/WesternShocks/spec030-ha.fits
~/Dropbox/SPMFEB13/WesternShocks/spec030-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 625, nwav = 300
Wav: 6560.79 Pixel: 86.6243464448
Wav: 6564.79 Pixel: 178.048458788
Wav: 6558.79 Pixel: 40.9122902734
Wav: 6559.79 Pixel: 63.7683183591
Wav: 6565.79 Pixel: 200.904486873
Wav: 6566.79 Pixel: 223.760514959
41 64 87 178 201 224
Check: wavrest = 6583.45, dwav = 0.0438896678388119, nslit = 625, nwav = 300
Wav: 6581.45 Pixel: 78.6061998161
Wav: 6585.45 Pixel: 169.743822791
Wav: 6579.45 Pixel: 33.0373883285
Wav: 6580.45 Pixel: 55.8217940723
Wav: 6586.45 Pixel: 192.528228535
Wav: 6587.45 Pixel: 215.312634279
33 56 79 170 193 215
Major coordinate: Right Ascension
[ 83.57435003  83.58877704  83.60320405  83.61763105  83.63205804
  83.64648502  83.66091199]
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6562.79, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6560.79 Pixel: 570.642857143
Wav: 6564.79 Pixel: 499.214285714
Wav: 6558.79 Pixel: 606.357142857
Wav: 6559.79 Pixel: 588.5
Wav: 6565.79 Pixel: 481.357142857
Wav: 6566.79 Pixel: 463.5
606 588 571 499 481 463
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6583.45, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6581.45 Pixel: 201.714285714
Wav: 6585.45 Pixel: 130.285714286
Wav: 6579.45 Pixel: 237.428571429
Wav: 6580.45 Pixel: 219.571428571
Wav: 6586.45 Pixel: 112.428571429
Wav: 6587.45 Pixel: 94.5714285714
237 220 202 130 112 95
Fixing WCS to CRPIX = 167, CRVAL = 6583.45, CDELT = -0.056
Confirmation CRPIX = 167.0, CRVAL = 6583.45, CDELT = -0.056
Check: wavrest = 6548.05, dwav = -0.056, nslit = 625, nwav = 1017
Wav: 6546.05 Pixel: 833.857142857
Wav: 6550.05 Pixel: 762.428571429
Wav: 6544.05 Pixel: 869.571428571
Wav: 6545.05 Pixel: 851.714285714
Wav: 6551.05 Pixel: 744.571428571
Wav: 6552.05 Pixel: 726.714285714
870 852 834 762 745 727
2013-12 116 117-118
~/Dropbox/papers/LL-Objects/SPMDIC13/spm117-118_bcrx.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec117-118-ha.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec117-118-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 615, nwav = 300
Wav: 6560.79 Pixel: 109.480374531
Wav: 6564.79 Pixel: 200.904486873
Wav: 6558.79 Pixel: 63.7683183591
Wav: 6559.79 Pixel: 86.6243464448
Wav: 6565.79 Pixel: 223.760514959
Wav: 6566.79 Pixel: 246.616543045
64 87 109 201 224 247
Check: wavrest = 6583.45, dwav = 0.0438896603882313, nslit = 615, nwav = 300
Wav: 6581.45 Pixel: 101.390622772
Wav: 6585.45 Pixel: 192.528261218
Wav: 6579.45 Pixel: 55.8218035484
Wav: 6580.45 Pixel: 78.6062131601
Wav: 6586.45 Pixel: 215.31267083
Wav: 6587.45 Pixel: 238.097080441
56 79 101 193 215 238
Major coordinate: Right Ascension
[ 83.6378193   83.65253869  83.6672581   83.68197754  83.696697
  83.71141649  83.72613599]
Check: wavrest = 6562.79, dwav = 0.0566950365900993, nslit = 615, nwav = 1024
Wav: 6560.79 Pixel: 437.854549191
Wav: 6564.79 Pixel: 508.407462471
Wav: 6558.79 Pixel: 402.57809255
Wav: 6559.79 Pixel: 420.21632087
Wav: 6565.79 Pixel: 526.045690792
Wav: 6566.79 Pixel: 543.683919112
403 420 438 508 526 544
Check: wavrest = 6583.45, dwav = 0.0566950365900993, nslit = 615, nwav = 1024
Wav: 6581.45 Pixel: 802.260346287
Wav: 6585.45 Pixel: 872.813259567
Wav: 6579.45 Pixel: 766.983889646
Wav: 6580.45 Pixel: 784.622117966
Wav: 6586.45 Pixel: 890.451487888
Wav: 6587.45 Pixel: 908.089716208
767 785 802 873 890 908
Check: wavrest = 6548.05, dwav = 0.0566950365900993, nslit = 615, nwav = 1024
Wav: 6546.05 Pixel: 177.86706375
Wav: 6550.05 Pixel: 248.419977031
Wav: 6544.05 Pixel: 142.59060711
Wav: 6545.05 Pixel: 160.22883543
Wav: 6551.05 Pixel: 266.058205352
Wav: 6552.05 Pixel: 283.696433672
143 160 178 248 266 284
2013-12 086 088
~/Dropbox/papers/LL-Objects/SPMDIC13/spm088_bcrx.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec088-ha.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec088-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 615, nwav = 300
Wav: 6560.79 Pixel: 109.480374531
Wav: 6564.79 Pixel: 200.904486873
Wav: 6558.79 Pixel: 63.7683183591
Wav: 6559.79 Pixel: 86.6243464448
Wav: 6565.79 Pixel: 223.760514959
Wav: 6566.79 Pixel: 246.616543045
64 87 109 201 224 247
Check: wavrest = 6583.45, dwav = 0.0438896603882313, nslit = 615, nwav = 300
Wav: 6581.45 Pixel: 101.390622772
Wav: 6585.45 Pixel: 192.528261218
Wav: 6579.45 Pixel: 55.8218035484
Wav: 6580.45 Pixel: 78.6062131601
Wav: 6586.45 Pixel: 215.31267083
Wav: 6587.45 Pixel: 238.097080441
56 79 101 193 215 238
Major coordinate: Right Ascension
[ 83.7050323   83.71975359  83.73447492  83.74919626  83.76391762
  83.77863901  83.79336041]
Check: wavrest = 6562.79, dwav = 0.0567050613462925, nslit = 615, nwav = 1024
Wav: 6560.79 Pixel: 438.199075688
Wav: 6564.79 Pixel: 508.739516083
Wav: 6558.79 Pixel: 402.92885549
Wav: 6559.79 Pixel: 420.563965589
Wav: 6565.79 Pixel: 526.374626181
Wav: 6566.79 Pixel: 544.00973628
403 421 438 509 526 544
Check: wavrest = 6583.45, dwav = 0.0567050613462925, nslit = 615, nwav = 1024
Wav: 6581.45 Pixel: 802.540450328
Wav: 6585.45 Pixel: 873.080890723
Wav: 6579.45 Pixel: 767.270230131
Wav: 6580.45 Pixel: 784.90534023
Wav: 6586.45 Pixel: 890.716000822
Wav: 6587.45 Pixel: 908.351110921
767 785 803 873 891 908
Check: wavrest = 6548.05, dwav = 0.0567050613462925, nslit = 615, nwav = 1024
Wav: 6546.05 Pixel: 178.257552831
Wav: 6550.05 Pixel: 248.797993227
Wav: 6544.05 Pixel: 142.987332634
Wav: 6545.05 Pixel: 160.622442733
Wav: 6551.05 Pixel: 266.433103325
Wav: 6552.05 Pixel: 284.068213424
143 161 178 249 266 284
2013-12 090 089
~/Dropbox/papers/LL-Objects/SPMDIC13/spm089_bcrx.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec089-ha.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec089-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 615, nwav = 300
Wav: 6560.79 Pixel: 109.480374531
Wav: 6564.79 Pixel: 200.904486873
Wav: 6558.79 Pixel: 63.7683183591
Wav: 6559.79 Pixel: 86.6243464448
Wav: 6565.79 Pixel: 223.760514959
Wav: 6566.79 Pixel: 246.616543045
64 87 109 201 224 247
Check: wavrest = 6583.45, dwav = 0.0438896603882313, nslit = 615, nwav = 300
Wav: 6581.45 Pixel: 101.390622772
Wav: 6585.45 Pixel: 192.528261218
Wav: 6579.45 Pixel: 55.8218035484
Wav: 6580.45 Pixel: 78.6062131601
Wav: 6586.45 Pixel: 215.31267083
Wav: 6587.45 Pixel: 238.097080441
56 79 101 193 215 238
Major coordinate: Right Ascension
[ 83.70288747  83.71760401  83.73232058  83.74703717  83.76175378
  83.77647041  83.79118706]
Check: wavrest = 6562.79, dwav = 0.0567050613462925, nslit = 615, nwav = 1024
Wav: 6560.79 Pixel: 438.199075688
Wav: 6564.79 Pixel: 508.739516083
Wav: 6558.79 Pixel: 402.92885549
Wav: 6559.79 Pixel: 420.563965589
Wav: 6565.79 Pixel: 526.374626181
Wav: 6566.79 Pixel: 544.00973628
403 421 438 509 526 544
Check: wavrest = 6583.45, dwav = 0.0567050613462925, nslit = 615, nwav = 1024
Wav: 6581.45 Pixel: 802.540450328
Wav: 6585.45 Pixel: 873.080890723
Wav: 6579.45 Pixel: 767.270230131
Wav: 6580.45 Pixel: 784.90534023
Wav: 6586.45 Pixel: 890.716000822
Wav: 6587.45 Pixel: 908.351110921
767 785 803 873 891 908
Check: wavrest = 6548.05, dwav = 0.0567050613462925, nslit = 615, nwav = 1024
Wav: 6546.05 Pixel: 178.257552831
Wav: 6550.05 Pixel: 248.797993227
Wav: 6544.05 Pixel: 142.987332634
Wav: 6545.05 Pixel: 160.622442733
Wav: 6551.05 Pixel: 266.433103325
Wav: 6552.05 Pixel: 284.068213424
143 161 178 249 266 284
2013-12 102 103-104
~/Dropbox/papers/LL-Objects/SPMDIC13/spm103-104_bcrx.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec103-104-ha.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec103-104-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 615, nwav = 300
Wav: 6560.79 Pixel: 109.480374531
Wav: 6564.79 Pixel: 200.904486873
Wav: 6558.79 Pixel: 63.7683183591
Wav: 6559.79 Pixel: 86.6243464448
Wav: 6565.79 Pixel: 223.760514959
Wav: 6566.79 Pixel: 246.616543045
64 87 109 201 224 247
Check: wavrest = 6583.45, dwav = 0.0438896603882313, nslit = 615, nwav = 300
Wav: 6581.45 Pixel: 101.390622772
Wav: 6585.45 Pixel: 192.528261218
Wav: 6579.45 Pixel: 55.8218035484
Wav: 6580.45 Pixel: 78.6062131601
Wav: 6586.45 Pixel: 215.31267083
Wav: 6587.45 Pixel: 238.097080441
56 79 101 193 215 238
Major coordinate: Right Ascension
[ 83.67286348  83.68749872  83.70213397  83.71676925  83.73140455
  83.74603986  83.76067519]
Check: wavrest = 6562.79, dwav = 0.0567060150206089, nslit = 615, nwav = 1024
Wav: 6560.79 Pixel: 438.183095364
Wav: 6564.79 Pixel: 508.722349419
Wav: 6558.79 Pixel: 402.913468337
Wav: 6559.79 Pixel: 420.54828185
Wav: 6565.79 Pixel: 526.357162933
Wav: 6566.79 Pixel: 543.991976447
403 421 438 509 526 544
Check: wavrest = 6583.45, dwav = 0.0567060150206089, nslit = 615, nwav = 1024
Wav: 6581.45 Pixel: 802.51834256
Wav: 6585.45 Pixel: 873.057596615
Wav: 6579.45 Pixel: 767.248715532
Wav: 6580.45 Pixel: 784.883529046
Wav: 6586.45 Pixel: 890.692410129
Wav: 6587.45 Pixel: 908.327223643
767 785 803 873 891 908
Check: wavrest = 6548.05, dwav = 0.0567060150206089, nslit = 615, nwav = 1024
Wav: 6546.05 Pixel: 178.245944171
Wav: 6550.05 Pixel: 248.785198226
Wav: 6544.05 Pixel: 142.976317143
Wav: 6545.05 Pixel: 160.611130657
Wav: 6551.05 Pixel: 266.42001174
Wav: 6552.05 Pixel: 284.054825253
143 161 178 249 266 284
2013-12 111 112-113
~/Dropbox/papers/LL-Objects/SPMDIC13/spm112-113_bcrx.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec112-113-ha.fits
~/Dropbox/papers/LL-Objects/SPMDIC13/spec112-113-nii.fits
Check: wavrest = 6562.79, dwav = 0.043752133846283, nslit = 615, nwav = 300
Wav: 6560.79 Pixel: 109.480374531
Wav: 6564.79 Pixel: 200.904486873
Wav: 6558.79 Pixel: 63.7683183591
Wav: 6559.79 Pixel: 86.6243464448
Wav: 6565.79 Pixel: 223.760514959
Wav: 6566.79 Pixel: 246.616543045
64 87 109 201 224 247
Check: wavrest = 6583.45, dwav = 0.0438896603882313, nslit = 615, nwav = 300
Wav: 6581.45 Pixel: 101.390622772
Wav: 6585.45 Pixel: 192.528261218
Wav: 6579.45 Pixel: 55.8218035484
Wav: 6580.45 Pixel: 78.6062131601
Wav: 6586.45 Pixel: 215.31267083
Wav: 6587.45 Pixel: 238.097080441
56 79 101 193 215 238
Major coordinate: Right Ascension
[ 83.71895946  83.73359676  83.74823407  83.7628714   83.77750875
  83.79214611  83.80678348]
Check: wavrest = 6562.79, dwav = 0.0566969476640224, nslit = 615, nwav = 1024
Wav: 6560.79 Pixel: 437.951748142
Wav: 6564.79 Pixel: 508.502283308
Wav: 6558.79 Pixel: 402.676480558
Wav: 6559.79 Pixel: 420.31411435
Wav: 6565.79 Pixel: 526.1399171
Wav: 6566.79 Pixel: 543.777550891
403 420 438 509 526 544
Check: wavrest = 6583.45, dwav = 0.0566969476640224, nslit = 615, nwav = 1024
Wav: 6581.45 Pixel: 802.345262276
Wav: 6585.45 Pixel: 872.895797443
Wav: 6579.45 Pixel: 767.069994693
Wav: 6580.45 Pixel: 784.707628485
Wav: 6586.45 Pixel: 890.533431234
Wav: 6587.45 Pixel: 908.171065026
767 785 802 873 891 908
Check: wavrest = 6548.05, dwav = 0.0566969476640224, nslit = 615, nwav = 1024
Wav: 6546.05 Pixel: 177.973026053
Wav: 6550.05 Pixel: 248.52356122
Wav: 6544.05 Pixel: 142.69775847
Wav: 6545.05 Pixel: 160.335392262
Wav: 6551.05 Pixel: 266.161195011
Wav: 6552.05 Pixel: 283.798828803
143 160 178 249 266 284
2015-02 0003 0004
~/Dropbox/SPMFEB15/archivos/spm0004o_bcrx.fits
~/Dropbox/SPMFEB15/archivos/spm0004o_sub-ha.fits
~/Dropbox/SPMFEB15/archivos/spm0004o_sub-nii.fits
Check: wavrest = 6562.79, dwav = 0.0574377216398716, nslit = 979, nwav = 160
Wav: 6560.79 Pixel: 38.5671025555
Wav: 6564.79 Pixel: 108.207747863
Wav: 6558.79 Pixel: 3.74677990165
Wav: 6559.79 Pixel: 21.1569412286
Wav: 6565.79 Pixel: 125.61790919
Wav: 6566.79 Pixel: 143.028070517
4 21 39 108 126 143
Check: wavrest = 6583.45, dwav = 0.0574377216398716, nslit = 979, nwav = 94
Wav: 6581.45 Pixel: 36.2610355693
Wav: 6585.45 Pixel: 105.901680877
Wav: 6579.45 Pixel: 1.4407129155
Wav: 6580.45 Pixel: 18.8508742424
Wav: 6586.45 Pixel: 123.311842204
Wav: 6587.45 Pixel: 140.722003531
1 19 36 94 94 94
Major coordinate: Right Ascension
[ 83.7629988   83.75317148  83.74334417  83.73351686  83.72368954
  83.71386223  83.70403492  83.6942076   83.6843803   83.67455299]
Check: wavrest = 6562.79, dwav = 0.0574377216398716, nslit = 979, nwav = 1024
Wav: 6560.79 Pixel: 481.567102555
Wav: 6564.79 Pixel: 551.207747863
Wav: 6558.79 Pixel: 446.746779902
Wav: 6559.79 Pixel: 464.156941229
Wav: 6565.79 Pixel: 568.61790919
Wav: 6566.79 Pixel: 586.028070517
447 464 482 551 569 586
Check: wavrest = 6583.45, dwav = 0.0574377216398716, nslit = 979, nwav = 1024
Wav: 6581.45 Pixel: 841.261035569
Wav: 6585.45 Pixel: 910.901680877
Wav: 6579.45 Pixel: 806.440712915
Wav: 6580.45 Pixel: 823.850874242
Wav: 6586.45 Pixel: 928.311842204
Wav: 6587.45 Pixel: 945.722003531
806 824 841 911 928 946
Check: wavrest = 6548.05, dwav = 0.0574377216398716, nslit = 979, nwav = 1024
Wav: 6546.05 Pixel: 224.941324597
Wav: 6550.05 Pixel: 294.581969905
Wav: 6544.05 Pixel: 190.121001943
Wav: 6545.05 Pixel: 207.53116327
Wav: 6551.05 Pixel: 311.992131231
Wav: 6552.05 Pixel: 329.402292558
190 208 225 295 312 329
2015-02 0012 0013
~/Dropbox/SPMFEB15/archivos/spm0013o_bcrx.fits
~/Dropbox/SPMFEB15/archivos/spm0013o_sub-ha.fits
~/Dropbox/SPMFEB15/archivos/spm0013o_sub-nii.fits
Check: wavrest = 6562.79, dwav = 0.0573069415986538, nslit = 979, nwav = 160
Wav: 6560.79 Pixel: 39.4112717166
Wav: 6564.79 Pixel: 109.210843783
Wav: 6558.79 Pixel: 4.51148568358
Wav: 6559.79 Pixel: 21.9613787001
Wav: 6565.79 Pixel: 126.660736799
Wav: 6566.79 Pixel: 144.110629816
5 22 39 109 127 144
Check: wavrest = 6583.45, dwav = 0.0573069415986538, nslit = 979, nwav = 160
Wav: 6581.45 Pixel: 29.9260614377
Wav: 6585.45 Pixel: 99.7256335038
Wav: 6579.45 Pixel: -4.97372459528
Wav: 6580.45 Pixel: 12.4761684212
Wav: 6586.45 Pixel: 117.17552652
Wav: 6587.45 Pixel: 134.625419537
0 12 30 100 117 135
Major coordinate: Right Ascension
[ 83.76323207  83.75341675  83.74360142  83.7337861   83.72397078
  83.71415545  83.70434013  83.69452481  83.68470949  83.67489417]
Check: wavrest = 6562.79, dwav = 0.0573069415986538, nslit = 979, nwav = 1024
Wav: 6560.79 Pixel: 479.411271717
Wav: 6564.79 Pixel: 549.210843783
Wav: 6558.79 Pixel: 444.511485684
Wav: 6559.79 Pixel: 461.9613787
Wav: 6565.79 Pixel: 566.660736799
Wav: 6566.79 Pixel: 584.110629816
445 462 479 549 567 584
Check: wavrest = 6583.45, dwav = 0.0573069415986538, nslit = 979, nwav = 1024
Wav: 6581.45 Pixel: 839.926061438
Wav: 6585.45 Pixel: 909.725633504
Wav: 6579.45 Pixel: 805.026275405
Wav: 6580.45 Pixel: 822.476168421
Wav: 6586.45 Pixel: 927.17552652
Wav: 6587.45 Pixel: 944.625419537
805 822 840 910 927 945
Check: wavrest = 6548.05, dwav = 0.0573069415986538, nslit = 979, nwav = 1024
Wav: 6546.05 Pixel: 222.199848653
Wav: 6550.05 Pixel: 291.999420719
Wav: 6544.05 Pixel: 187.30006262
Wav: 6545.05 Pixel: 204.749955637
Wav: 6551.05 Pixel: 309.449313736
Wav: 6552.05 Pixel: 326.899206752
187 205 222 292 309 327
</pre>
</div>
</div>







<div id="outline-container-orgheadline51" class="outline-3">
<h3 id="orgheadline51"><span class="section-number-3">2.4</span> Looking for more external constraints on the [N II]/Ha ratios</h3>
<div class="outline-text-3" id="text-2-4">
<p>
We have the ODH values, but they are for large areas.  We could do with some actual images of the [N II]/Ha ratio.
</p>
</div>


<div id="outline-container-orgheadline50" class="outline-4">
<h4 id="orgheadline50"><span class="section-number-4">2.4.1</span> WFPC2 mosaic</h4>
<div class="outline-text-4" id="text-2-4-1">
<ul class="org-ul">
<li>We have the f658n and f656n images</li>
<li>We ought to work out the difference in efficiency - use nebulio
<ul class="org-ul">
<li>This would require use of the f547m image too</li>
</ul></li>
</ul>
</div>

<div id="outline-container-orgheadline48" class="outline-5">
<h5 id="orgheadline48"><span class="section-number-5">2.4.1.1</span> Inferences from the mosaic</h5>
<div class="outline-text-5" id="text-2-4-1-1">
<ul class="org-ul">
<li>LL1 region needs correction factor of 1.8</li>
<li>Horizontal E slits also have correction factor of about 1.8, once we fix the zero-point problem
<ul class="org-ul">
<li>Unfortunately, we can't continue to the W end of the slit because the mosaic has fill-in data there</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-5">
<h5 id="orgheadline49"><span class="section-number-5">2.4.1.2</span> Make a ratio map from f658n and f656n</h5>
<div class="outline-text-5" id="text-2-4-1-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #dfaf8f;">template</span> = <span style="color: #eee8aa; font-style: italic;">'/Users/will/Dropbox/JorgeBowshocks/HST/mosaicf{}-fixw-align.fits'</span>

nii, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(template.<span style="color: #DCDCCC; font-weight: bold;">format</span>(658))
ha, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(template.<span style="color: #DCDCCC; font-weight: bold;">format</span>(656))
<span style="color: #dfaf8f;">tnii</span> = nii.header[<span style="color: #eee8aa; font-style: italic;">'EXPTIME'</span>]
<span style="color: #dfaf8f;">tha</span> = ha.header[<span style="color: #eee8aa; font-style: italic;">'EXPTIME'</span>]
<span style="color: #dfaf8f;">nii.data</span> *= tha/(tnii*ha.data)
nii.writeto(<span style="color: #eee8aa; font-style: italic;">'wfpc2-mosaic-f658-over-f656.fits'</span>, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline56" class="outline-2">
<h2 id="orgheadline56"><span class="section-number-2">3</span> <span class="done DONE">DONE</span> <code>[2/2]</code> Final tweaks to the zero level - fit 2D Chebyshev</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>Some spectra still have strangenesses in the background levels, especially the 2013 runs</li>
<li>Plan is to fit a 2D Chebyshev surface to the regions away from the lines</li>
<li class="on"><code>[X]</code> First a pilot program that works on the calibrated spectra
<ul class="org-ul">
<li></li>
</ul></li>
<li class="on"><code>[X]</code> If that works, then incorporate it directly into the calibration process
<ul class="org-ul">
<li>Finally decided not to do this - we keep it as a separate step</li>
<li>Application to all the slits is <a href="#orgheadline53">down here</a></li>
<li>Corrected spectra are saved to <a href="Calibrated/BGsub/">Calibrated/BGsub/</a></li>
</ul></li>
</ul>
</div>


<div id="outline-container-orgheadline54" class="outline-3">
<h3 id="orgheadline54"><span class="section-number-3">3.1</span> Program to fit 2D Chebyshev to so-called continuum: chebfit2d.py</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Zeroth, the imports
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> sys
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy.modeling <span style="color: #b9d3ee;">import</span> models, fitting
</pre>
</div>

<p>
First the function to fit the background to the data 
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">fit_background</span>(data, mask, npx=4, npy=4):
    <span style="color: #eee8aa; font-style: italic;">"""Fit a polynomial surface to all elements of a 2D `data` array where</span>
<span style="color: #eee8aa; font-style: italic;">the corresponding `mask` is True.  Return the fit evaluated at each</span>
<span style="color: #eee8aa; font-style: italic;">point of the original data array.</span>

<span style="color: #eee8aa; font-style: italic;">    """</span>
    <span style="color: #b9d3ee;">assert</span> data.shape == mask.shape
    <span style="color: #dfaf8f;">ny</span>, <span style="color: #dfaf8f;">nx</span> = data.shape
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">y = np.arange(ny).reshape((ny,1))</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">x = np.arange(nx).reshape((1,nx))</span>
    <span style="color: #dfaf8f;">y</span>, <span style="color: #dfaf8f;">x</span> = np.mgrid[:ny, :nx]
    <span style="color: #dfaf8f;">p_init</span> = models.Chebyshev2D(x_degree=npx, y_degree=npy)
    <span style="color: #dfaf8f;">fit_p</span> = fitting.LevMarLSQFitter()
    <span style="color: #dfaf8f;">p</span> = fit_p(p_init, x[mask], y[mask], data[mask])
    <span style="color: #b9d3ee;">return</span> p(x, y)
</pre>
</div>

<p>
Second, how to set the mask for the BG fitting:
</p>
<ul class="org-ul">
<li>Region strategy (harder)
<ol class="org-ol">
<li>We need to be outside a given wavelength range</li>
<li>At this level of precision, heliocentric correction is unnecessary
<ul class="org-ul">
<li>WRONG, we do need helio correction</li>
<li>We also need to avoid stars</li>
</ul></li>
</ol></li>
<li>Threshold strategy (easy)
<ol class="org-ol">
<li>Just set mask true when intensity is below a certain amount</li>
<li>That's it!
<ul class="org-ul">
<li>Threshold intensity of 0.001 looks like it might work</li>
<li>Possible problem is that it might give a downward bias if noise &gt; threshold</li>
<li>Or could give upward bias if signal &lt; threshold</li>
<li>Hopefully they will cancel out</li>
</ul></li>
</ol></li>
<li>Now I have decided we need to use both
<ul class="org-ul">
<li>The threshold strategy to distinguish high velocity knots from the noise</li>
<li>But then also the region strategy to ensure we do not go to close to the line core, even if it is noisy</li>
<li>For this we use an excluded velocity window of -10 to +40 in Vhel</li>
</ul></li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS
<span style="color: #b9d3ee;">from</span> astropy <span style="color: #b9d3ee;">import</span> units <span style="color: #b9d3ee;">as</span> u
<span style="color: #b9d3ee;">from</span> helio_utils <span style="color: #b9d3ee;">import</span> vels2waves

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">find_mask_for_hdu</span>(hdu, threshold=0.001, v1=-100.0, v2=100.0):
    <span style="color: #dfaf8f;">mask</span> = hdu.data &lt; threshold

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Cut out a window around line center</span>
    <span style="color: #dfaf8f;">w</span> = WCS(hdu.header, key=<span style="color: #eee8aa; font-style: italic;">'A'</span>)
    <span style="color: #dfaf8f;">waves</span> = vels2waves([v1, v2], w.wcs.restwav, hdu.header)
    [i1, i2], <span style="color: #dfaf8f;">_</span>, <span style="color: #dfaf8f;">_</span> = w.all_world2pix(waves, [0, 0], [0, 0], 0)
    <span style="color: #dfaf8f;">i1</span>, <span style="color: #dfaf8f;">i2</span> = <span style="color: #DCDCCC; font-weight: bold;">int</span>(i1), <span style="color: #DCDCCC; font-weight: bold;">int</span>(i2) + 1
    <span style="color: #dfaf8f;">mask</span>[:, :, i1:i2] = <span style="color: #cFfBcF;">False</span>

    <span style="color: #b9d3ee;">return</span> mask
</pre>
</div>

<p>
Third, a function to take a FITS file and fit the BG, saving both the BG and the BG-subtracted data
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">estimate_pixel_noise</span>(data, size=50):
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Slices for each corner of the image and one in the middle somewhere</span>
    <span style="color: #dfaf8f;">lo</span>, <span style="color: #dfaf8f;">hi</span>, <span style="color: #dfaf8f;">mid</span> = <span style="color: #DCDCCC; font-weight: bold;">slice</span>(<span style="color: #cFfBcF;">None</span>, 50), <span style="color: #DCDCCC; font-weight: bold;">slice</span>(-50, <span style="color: #cFfBcF;">None</span>), <span style="color: #DCDCCC; font-weight: bold;">slice</span>(300, 350)
    <span style="color: #dfaf8f;">corners</span> = [data[lo, lo], data[lo, hi],
               data[hi, lo], data[hi, hi],
               data[mid, lo], data[mid, hi]]
    <span style="color: #dfaf8f;">sigmas</span> = [np.nanstd(corner) <span style="color: #b9d3ee;">for</span> corner <span style="color: #b9d3ee;">in</span> corners]
    <span style="color: #dfaf8f;">means</span> = [np.nanmean(corner) <span style="color: #b9d3ee;">for</span> corner <span style="color: #b9d3ee;">in</span> corners]
    <span style="color: #dfaf8f;">sigma</span> = np.nanmedian(sigmas)
    <span style="color: #dfaf8f;">mean</span> = np.nanmedian(means)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Corner sigmas:'</span>, sigmas, <span style="color: #eee8aa; font-style: italic;">'Median ='</span>, sigma)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Corner means:'</span>, means, <span style="color: #eee8aa; font-style: italic;">'Median ='</span>, mean)
    <span style="color: #b9d3ee;">return</span> sigma

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">remove_bg</span>(filename, olddir=<span style="color: #eee8aa; font-style: italic;">'Calibrated/'</span>, newdir=<span style="color: #eee8aa; font-style: italic;">'Calibrated/BGsub/'</span>):
    <span style="color: #b9d3ee;">assert</span> olddir <span style="color: #b9d3ee;">in</span> filename
    <span style="color: #dfaf8f;">hdu</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(filename)[0]      <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">always use first HDU in file</span>

    <span style="color: #dfaf8f;">sigma</span> = estimate_pixel_noise(hdu.data[0])
    <span style="color: #dfaf8f;">mask</span> = find_mask_for_hdu(hdu, threshold=2*sigma)

    <span style="color: #b9d3ee;">if</span> <span style="color: #eee8aa; font-style: italic;">'2015-02-0003-nii'</span> <span style="color: #b9d3ee;">in</span> filename:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Low order of x-polynomial for this one</span>
        <span style="color: #dfaf8f;">bg</span> = fit_background(hdu.data[0], mask[0], npx=1, npy=4)
    <span style="color: #b9d3ee;">else</span>:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">FITS data is 3d, so take 2d slice for fitting...</span>
        <span style="color: #dfaf8f;">bg</span> = fit_background(hdu.data[0], mask[0])

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">...and then add back 3rd dimension</span>
    <span style="color: #dfaf8f;">bg</span> = bg[<span style="color: #cFfBcF;">None</span>, :, :]

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Save BG-subtracted data</span>
    <span style="color: #dfaf8f;">hdu.data</span> -= bg
    <span style="color: #dfaf8f;">subfilename</span> = filename.replace(olddir, newdir)
    hdu.writeto(subfilename, clobber=<span style="color: #cFfBcF;">True</span>)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">And save fitted BG itself</span>
    <span style="color: #dfaf8f;">hdu.data</span> = bg
    <span style="color: #dfaf8f;">bgfilename</span> = subfilename.replace(<span style="color: #eee8aa; font-style: italic;">'.fits'</span>, <span style="color: #eee8aa; font-style: italic;">'-bg.fits'</span>)
    hdu.writeto(bgfilename, clobber=<span style="color: #cFfBcF;">True</span>)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">And save the mask</span>
    <span style="color: #dfaf8f;">hdu.data</span> = mask.astype(<span style="color: #DCDCCC; font-weight: bold;">float</span>)
    <span style="color: #dfaf8f;">maskfilename</span> = subfilename.replace(<span style="color: #eee8aa; font-style: italic;">'.fits'</span>, <span style="color: #eee8aa; font-style: italic;">'-mask.fits'</span>)
    hdu.writeto(maskfilename, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>

<p>
Fourth, read a file from the command line if called interactively
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">if</span> <span style="color: #DCDCCC; font-weight: bold;">__name__</span> == <span style="color: #eee8aa; font-style: italic;">'__main__'</span>:
    <span style="color: #b9d3ee;">try</span>:
        <span style="color: #dfaf8f;">fn</span> = sys.argv[1]
    <span style="color: #b9d3ee;">except</span>:
        <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Usage:'</span>, sys.argv[0], <span style="color: #eee8aa; font-style: italic;">'FITSFILE'</span>)
        sys.<span style="color: #cFfBcF;">exit</span>()

    remove_bg(fn)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline55" class="outline-3">
<h3 id="orgheadline55"><span class="section-number-3">3.2</span> Test the chebyshev fitting</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-sh">mkdir -p Calibrated/BGsub
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">python chebfit2d.py Calibrated/2015-02-0003-ha.fits <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">1&gt;&amp;2</span>
</pre>
</div>

<pre class="example">
Corner sigmas: [0.0092039052, 0.009207556, 0.0060184905, 0.0061931033, 0.0081476336, 0.0079773115] Median = 0.00806247
Corner means: [0.00040226532, 0.0058213449, -0.00010916856, 0.0014264929, 0.00077906274, 0.0030811126] Median = 0.00110278
</pre>




<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/Calibrated/BGsub/2010-01-236-nii.fits
xpaset -p ds9 zoom to fit frame
</pre>
</div>

<p>
Note that 2015-02-0003 is a pathological case because we have no BG to right of line, so we can't stop the polynomial from blowing up there.  One solution would be to reflect the line profile. 
</p>
</div>
</div>


<div id="outline-container-orgheadline53" class="outline-3">
<h3 id="orgheadline53"><a id="ID-41519B0D-E285-4BD1-929E-763BE12298F8"></a><span class="section-number-3">3.3</span> Apply to all the slits</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>At the same time, we will change wavelength to Vhel in the FITS headers</li>
<li>And we could try and add pixel coordinates for the output image array too.</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> glob
<span style="color: #b9d3ee;">import</span> chebfit2d

<span style="color: #dfaf8f;">filenames</span> = glob.glob(<span style="color: #eee8aa; font-style: italic;">'Calibrated/*.fits'</span>)

<span style="color: #b9d3ee;">for</span> fn <span style="color: #b9d3ee;">in</span> filenames:
    chebfit2d.remove_bg(fn)
</pre>
</div>

<pre class="example">
Corner sigmas: [0.0014632043, 0.0014105592, 0.0013509666, 0.001325192, 0.0054909131, 0.007089389] Median = 0.00143688
Corner means: [-0.00022139779, -0.00044154807, -0.00031040475, -0.0008519371, -0.0019082779, -0.0030134178] Median = -0.000646743
Corner sigmas: [0.001477215, 0.0010485579, 0.0013697137, 0.0010426297, 0.0014074636, 0.0012496385] Median = 0.00130968
Corner means: [7.5210693e-05, -0.00023023813, -7.1173003e-05, -1.4033735e-05, -5.5818164e-05, 9.2550945e-05] Median = -3.49259e-05
Corner sigmas: [0.00072271761, 0.00078956556, 0.000650478, 0.00075349346, 0.001487357, 0.0016568818] Median = 0.00077153
Corner means: [-0.00023395955, -0.00053457916, -0.00035804117, -0.0010272692, -0.00082681084, -0.0014288132] Median = -0.000680695
Corner sigmas: [0.00083920668, 0.00078511244, 0.00072703441, 0.00065560237, 0.00087804772, 0.0011650173] Median = 0.00081216
Corner means: [-2.76802e-05, -2.8529686e-05, -4.8832208e-06, -1.4298194e-05, -0.00024860929, 0.00020439758] Median = -2.09892e-05
Corner sigmas: [0.0006635703, 0.00075121038, 0.00061689626, 0.00069903373, 0.00058791629, 0.00062494806] Median = 0.000644259
Corner means: [-0.00019852414, -0.00057919609, -0.00034293777, -0.0009423481, -0.00019772716, -0.00076135364] Median = -0.000461067
Corner sigmas: [0.00078200555, 0.00073513377, 0.00067009195, 0.00061699579, 0.00065414998, 0.00062729226] Median = 0.000662121
Corner means: [-2.2748036e-05, -7.6759672e-05, 9.1613201e-06, -1.3556039e-05, -2.7325354e-05, 7.980549e-05] Median = -1.8152e-05
Corner sigmas: [0.0011682139, 0.0012034801, 0.00099312956, 0.0010720264, 0.00093744247, 0.00097204029] Median = 0.00103258
Corner means: [-0.00025582375, -0.00069190777, -0.00036907248, -0.0010608289, -0.00022261136, -0.00083643629] Median = -0.00053049
Corner sigmas: [0.0011638883, 0.0011593443, 0.0010889119, 0.0009894867, 0.00099008996, 0.00093192898] Median = 0.0010395
Corner means: [-9.336507e-06, -0.00013354659, 3.2520453e-05, -6.3618019e-05, -4.277916e-05, 3.0424133e-05] Median = -2.60578e-05
Corner sigmas: [0.0011595117, 0.0012386816, 0.0010741194, 0.0011856057, 0.0010313789, 0.0010744163] Median = 0.00111696
Corner means: [-0.00022985968, -0.0007155051, -0.00032630438, -0.0011197362, -0.00019674523, -0.00091327459] Median = -0.000520905
Corner sigmas: [0.0012797932, 0.001238024, 0.0012510912, 0.0011137044, 0.0011515305, 0.0010474956] Median = 0.00119478
Corner means: [-1.1999592e-05, -0.0001932092, 2.8919837e-06, -3.3244996e-06, 1.090752e-05, 4.9467428e-05] Median = -2.16258e-07
Corner sigmas: [0.00088304386, 0.00097924541, 0.00081425463, 0.00090450334, 0.00072619057, 0.00081700983] Median = 0.000850027
Corner means: [-0.00015872429, -0.00053924479, -0.00030596403, -0.0010041599, -0.00013632135, -0.00075196056] Median = -0.000422604
Corner sigmas: [0.001016896, 0.00092923763, 0.00091537088, 0.00083540403, 0.00085828803, 0.00077318115] Median = 0.000886829
Corner means: [3.7233128e-06, -7.3361778e-05, -9.9717799e-06, -4.0335606e-05, -1.6350534e-05, 1.3966051e-05] Median = -1.31612e-05
Corner sigmas: [0.0015200629, 0.0015965189, 0.0014699502, 0.0015655953, 0.0013151465, 0.0013928429] Median = 0.00149501
Corner means: [-0.00036867292, -0.00081092282, -0.00060055265, -0.0010993329, -0.00043962308, -0.00073171908] Median = -0.000666136
Corner sigmas: [0.0017489973, 0.0015863283, 0.0016368513, 0.0014544198, 0.0015160213, 0.001370392] Median = 0.00155117
Corner means: [2.2922646e-05, 1.7644123e-05, -6.7741662e-06, -1.3886724e-05, -3.8076763e-05, 0.00013304994] Median = 5.43498e-06
Corner sigmas: [0.0013834093, 0.001452985, 0.0013676074, 0.001441716, 0.0012012061, 0.001320699] Median = 0.00137551
Corner means: [-0.00017844823, -0.00072771305, -0.00038970343, -0.00094421423, -0.00021771884, -0.00062920799] Median = -0.000509456
Corner sigmas: [0.00159153, 0.0013980719, 0.001502256, 0.0013701505, 0.0013793012, 0.0012508844] Median = 0.00138869
Corner means: [-6.1142375e-05, -0.00010717578, 6.5474545e-05, -0.00013272645, 3.0503556e-05, 1.7631086e-05] Median = -2.17556e-05
Corner sigmas: [0.0016242558, 0.001737855, 0.0015695565, 0.0016559031, 0.0013968691, 0.0014584544] Median = 0.00159691
Corner means: [-0.00012511411, -0.00065409573, -0.00030645312, -0.0010393198, -0.00012346031, -0.00081927719] Median = -0.000480274
Corner sigmas: [0.0018572584, 0.0016607478, 0.0018039469, 0.0015721746, 0.0016105383, 0.0014679766] Median = 0.00163564
Corner means: [2.2210002e-06, -0.0001239196, -9.5691088e-05, -9.079856e-05, -2.1481206e-05, 9.4267867e-05] Median = -5.61399e-05
Corner sigmas: [0.0013246336, 0.001392733, 0.0012930587, 0.0014074196, 0.0012486369, 0.0012522758] Median = 0.00130885
Corner means: [-0.0002111124, -0.00056961586, -0.0003947365, -0.0010225606, -0.00027800389, -0.00078600313] Median = -0.000482176
Corner sigmas: [0.0014808178, 0.0014185515, 0.0014397042, 0.0012891508, 0.0013087397, 0.0011637113] Median = 0.00136365
Corner means: [4.7245621e-06, 6.3654961e-06, -2.5301797e-05, -5.6661986e-05, 5.6150497e-05, 7.7060315e-05] Median = 5.54503e-06
Corner sigmas: [0.004129454, 0.0043157865, 0.0044114557, 0.0046192664, 0.0037959008, 0.003928713] Median = 0.00422262
Corner means: [-0.00014612763, -0.00065525738, -0.00073436095, -0.0014701067, -0.00016968744, -0.0010622484] Median = -0.000694809
Corner sigmas: [0.0049439352, 0.0042481935, 0.0050284956, 0.0045039188, 0.0041755936, 0.0036310325] Median = 0.00437606
Corner means: [0.00011957669, -7.8610945e-05, -5.5650871e-05, -0.00061950483, 0.00021766048, 3.5578847e-05] Median = -1.0036e-05
Corner sigmas: [0.0010327154, 0.0011671452, 0.001811725, 0.0023419, 0.0013304272, 0.0015990793] Median = 0.00146475
Corner means: [-9.5025287e-05, -0.00047717581, -0.0018048437, -0.0033827224, -0.00079670287, -0.0021091339] Median = -0.00130077
Corner sigmas: [0.0011287276, 0.0012392439, 0.0012817082, 0.0012675013, 0.0011744292, 0.0012163526] Median = 0.0012278
Corner means: [0.00011638243, -0.00038977657, 0.00058033125, -0.0018881225, 0.00046012754, -0.0014388263] Median = -0.000136697
Corner sigmas: [0.0010173647, 0.0011044998, 0.0017385072, 0.0022021479, 0.0013583227, 0.0015458603] Median = 0.00145209
Corner means: [-0.00013277237, -0.00046296162, -0.0015786301, -0.0028251866, -0.00069425022, -0.0020745639] Median = -0.00113644
Corner sigmas: [0.0011396817, 0.0011554033, 0.0012661768, 0.0012739009, 0.0011914551, 0.0011779225] Median = 0.00118469
Corner means: [7.5176809e-05, -0.00014700349, 0.00061758637, -0.0017225933, 0.00044644976, -0.0015451227] Median = -3.59133e-05
Corner sigmas: [0.0010959147, 0.0012205699, 0.0017974571, 0.002280768, 0.0013703355, 0.0016211389] Median = 0.00149574
Corner means: [-0.0001750361, -0.00042779659, -0.0020072162, -0.0029797403, -0.00097526674, -0.0019980147] Median = -0.00148664
Corner sigmas: [0.0011515605, 0.0013166739, 0.0011804608, 0.0011514768, 0.001129727, 0.001069466] Median = 0.00115152
Corner means: [7.3121955e-05, -0.00037098702, 0.00053600274, -0.0016879833, 0.00042407532, -0.0014757987] Median = -0.000148933
Corner sigmas: [0.00066328666, 0.00065836048, 0.011868647, 0.0024225332, 0.00055661675, 0.00058611465] Median = 0.000660824
Corner means: [-0.00014124914, -0.00036231457, -0.00046634287, -0.0002324372, -0.00018464884, -0.00051269395] Median = -0.000297376
Corner sigmas: [0.00066569302, 0.00065347296, 0.00055259879, 0.00052675465, 0.00057547318, 0.00053468649] Median = 0.000564036
Corner means: [6.676538e-05, 2.0214527e-06, 8.1052312e-05, -0.00022498693, 1.6659169e-05, -0.00021987638] Median = 9.34031e-06
Corner sigmas: [0.00066614384, 0.00067159807, 0.0005923445, 0.00065081229, 0.00055623031, 0.00058915874] Median = 0.000621578
Corner means: [-7.7686396e-05, -0.00031713463, -0.00029847599, -0.00066117308, -0.00020778766, -0.00047816924] Median = -0.000307805
Corner sigmas: [0.00064836652, 0.00070810487, 0.00057409937, 0.00055057724, 0.00055406499, 0.00055657054] Median = 0.000565335
Corner means: [1.8816803e-05, 4.4476245e-05, 0.00011022736, -0.00023445778, 7.6075128e-05, -0.00024297624] Median = 3.16465e-05
Corner sigmas: [0.00078389817, 0.00071056263, 0.00066345005, 0.00066934898, 0.00065695337, 0.00067069579] Median = 0.000670022
Corner means: [-0.00015260564, -0.00038408494, -0.00037072515, -0.00061755866, -0.00027250461, -0.00053376216] Median = -0.000377405
Corner sigmas: [0.00069997471, 0.00071769784, 0.00061456702, 0.00059750944, 0.00063714402, 0.00056536007] Median = 0.000625856
Corner means: [2.8867229e-05, 0.00019872005, 9.6854914e-05, -0.00022099767, 1.2417205e-05, -0.0002630052] Median = 2.06422e-05
Corner sigmas: [0.00067101989, 0.00065885036, 0.00057539536, 0.00062469346, 0.00057039253, 0.00058897503] Median = 0.000606834
Corner means: [-0.00010340227, -0.0003120676, -0.00029166994, -0.00060125318, -0.0002156409, -0.00052879209] Median = -0.000301869
Corner sigmas: [0.00066117867, 0.00069785921, 0.00056631101, 0.00053035759, 0.00057033857, 0.00053860975] Median = 0.000568325
Corner means: [-1.1290185e-06, 0.00010500813, 9.0039066e-05, -0.00024126086, 5.919981e-05, -0.0002650042] Median = 2.90354e-05
Corner sigmas: [0.00062760373, 0.00065205345, 0.00060712488, 0.00066129613, 0.00058021728, 0.00058611046] Median = 0.000617364
Corner means: [-9.3577408e-05, -0.00032560309, -0.00029802541, -0.00067015382, -0.00019098283, -0.0004832905] Median = -0.000311814
Corner sigmas: [0.00064203009, 0.00073199003, 0.00055046717, 0.00057592243, 0.00057484972, 0.00053997495] Median = 0.000575386
Corner means: [3.193906e-05, 0.00011596334, 8.639523e-05, -0.00025596033, 2.4088835e-05, -0.00021734639] Median = 2.80139e-05
Corner sigmas: [0.00066422939, 0.00069107168, 0.00057371595, 0.0006155445, 0.00056956819, 0.0006004977] Median = 0.000608021
Corner means: [-7.3566487e-05, -0.00032703247, -0.00029325148, -0.0005803582, -0.00015863606, -0.00041452018] Median = -0.000310142
Corner sigmas: [0.00062992063, 0.00076161936, 0.00056420499, 0.00054483197, 0.00059964141, 0.00054765277] Median = 0.000581923
Corner means: [2.1580492e-05, 4.366439e-05, 0.00010518797, -0.00019669332, 4.0274994e-05, -0.00030888067] Median = 3.09277e-05
Corner sigmas: [0.00075754634, 0.00073964399, 0.00064389087, 0.00068888254, 0.00065647106, 0.00066779641] Median = 0.00067834
Corner means: [-0.00011409037, -0.00036590235, -0.00030422449, -0.00058157166, -0.00019776204, -0.00040570306] Median = -0.000335063
Corner sigmas: [0.00074551551, 0.00079343974, 0.00061451358, 0.00062755792, 0.00065314135, 0.00060712907] Median = 0.00064035
Corner means: [6.277144e-05, 0.00012994627, 0.00012557342, -0.00022822563, 5.3461386e-05, -0.00030958772] Median = 5.81164e-05
Corner sigmas: [0.0010457417, 0.0010061655, 0.00095146924, 0.0009730279, 0.00088660239, 0.00095435156] Median = 0.00096369
Corner means: [-5.7668476e-05, -0.00016784866, -0.00039885449, -0.00092796917, -0.00018158223, -0.00078935095] Median = -0.000290218
Corner sigmas: [0.0010579269, 0.0010432497, 0.00093684276, 0.00089188525, 0.00094233698, 0.00088524533] Median = 0.00093959
Corner means: [6.4463638e-05, -4.8044105e-05, 0.00013267937, -0.00038139409, 0.00020117554, -0.00042691021] Median = 8.20977e-06
Corner sigmas: [0.0013960929, 0.0013638498, 0.0016642972, 0.0017184722, 0.0014991637, 0.0015272525] Median = 0.00151321
Corner means: [-7.2869341e-05, -0.0001254193, -0.00056378992, -0.0010789403, -0.00030189939, -0.00096083363] Median = -0.000432845
Corner sigmas: [0.0014708571, 0.0013820303, 0.0016326439, 0.0015505562, 0.0015219137, 0.0014279246] Median = 0.00149639
Corner means: [3.9169179e-05, 0.00011820068, 0.00014074196, -0.00050397549, 0.00015590337, -0.00039220127] Median = 7.86849e-05
Corner sigmas: [0.0015615419, 0.0015183418, 0.0016783425, 0.0016447714, 0.0015598637, 0.0014468842] Median = 0.0015607
Corner means: [-5.0335264e-05, 1.3481858e-05, -0.00048072671, -0.0010559749, -0.00025614852, -0.0006940015] Median = -0.000368438
Corner sigmas: [0.0016327503, 0.001611946, 0.0016800556, 0.0016243506, 0.0016382851, 0.0014441879] Median = 0.00162855
Corner means: [9.8969933e-05, -0.00014721093, 0.00013154959, -0.00051117805, 0.00013587087, -0.00047916098] Median = -2.41205e-05
Corner sigmas: [0.00094031257, 0.00088066689, 0.00098206953, 0.0010247189, 0.00092857354, 0.00092635484] Median = 0.000934443
Corner means: [-0.00012668328, -0.00021121799, -0.00051460002, -0.0010194668, -0.00026243902, -0.00078381016] Median = -0.00038852
Corner sigmas: [0.0009986501, 0.0009792971, 0.00095310807, 0.00090320973, 0.00093285763, 0.00083050522] Median = 0.000942983
Corner means: [6.5728367e-05, -0.00016465299, 3.5030742e-05, -0.0005378559, 8.8739704e-05, -0.00046915398] Median = -6.48111e-05
Corner sigmas: [0.0014542526, 0.001363298, 0.0012792657, 0.0013388679, 0.0013234779, 0.0013608211] Median = 0.00134984
Corner means: [-0.00013949261, -0.00014828007, -0.00038671866, -0.00089074404, -0.00017082418, -0.0006087693] Median = -0.000278771
Corner sigmas: [0.0014498059, 0.0014721053, 0.0013346514, 0.0012576705, 0.0013656971, 0.0012976395] Median = 0.00135017
Corner means: [-8.328353e-06, -0.00031891803, 7.849597e-05, -0.00049212569, 0.00014653189, -0.00046172351] Median = -0.000163623
Corner sigmas: [0.0045012766, 0.0041926759, 0.0050141918, 0.0049378807, 0.0045350417, 0.0044186744] Median = 0.00451816
Corner means: [0.00011395147, -1.7880006e-05, -0.00060619781, -0.0012419955, -0.00016931375, -0.00088184112] Median = -0.000387756
Corner sigmas: [0.0047562402, 0.0044593099, 0.00530473, 0.0053617619, 0.0049201804, 0.0045728767] Median = 0.00483821
Corner means: [-2.9902101e-06, -0.00054412708, 0.00014499719, -0.0010466006, 0.00026719572, -0.00030514202] Median = -0.000154066
Corner sigmas: [0.0030148197, 0.0030096711, 0.0031862217, 0.0031337563, 0.0028638453, 0.0028372225] Median = 0.00301225
Corner means: [-9.9653073e-05, -0.00038797213, -0.00062641699, -0.00091738137, -0.00028572799, -0.00074279611] Median = -0.000507195
Corner sigmas: [0.0032574327, 0.0030093102, 0.0032697825, 0.0032733453, 0.0029851282, 0.0028022903] Median = 0.00313337
Corner means: [3.1648728e-05, -0.00039374598, -1.3923228e-05, -0.00057757902, 0.00014127622, -0.00038414277] Median = -0.000199033
Corner sigmas: [0.00089243217, 0.00088755781, 0.00083530706, 0.00088114338, 0.00076178805, 0.00083513843] Median = 0.000858225
Corner means: [-7.670965e-05, -7.1730035e-05, -0.00048931473, -0.00082076556, -0.0001777142, -0.00056009745] Median = -0.000333514
Corner sigmas: [0.00094242289, 0.0010703806, 0.00081524858, 0.00076698902, 0.0008165302, 0.00078199734] Median = 0.000815889
Corner means: [2.9082355e-05, -0.00033403229, 4.1332481e-05, -0.0004349183, 4.231319e-05, -0.00038197645] Median = -0.000152475
Corner sigmas: [0.00081437407, 0.00077617384, 0.000782597, 0.00082832103, 0.00072706229, 0.00078981306] Median = 0.000786205
Corner means: [-5.0729901e-05, -8.9232519e-05, -0.00054078776, -0.00093781779, -0.00026920313, -0.00070282898] Median = -0.000404995
Corner sigmas: [0.00084152649, 0.00085601833, 0.00074721681, 0.00068737718, 0.00070684112, 0.00066337193] Median = 0.000727029
Corner means: [5.3956799e-05, -0.00016388868, 1.6556045e-05, -0.00047992705, 6.407265e-05, -0.00040341844] Median = -7.36663e-05
Corner sigmas: [0.0010287594, 0.0009934624, 0.00067037938, 0.000733122, 0.00070183753, 0.00071570685] Median = 0.000724414
Corner means: [-5.5359949e-05, -0.00017056301, -0.00047016336, -0.00078477635, -0.00029489998, -0.00059511454] Median = -0.000382532
Corner sigmas: [0.00087284861, 0.00077065092, 0.00063531904, 0.0006196762, 0.00069609383, 0.0006181713] Median = 0.000665706
Corner means: [4.0301013e-05, -0.00025773293, 4.8651986e-05, -0.00042069206, 7.5064185e-05, -0.00039505991] Median = -0.000108716
Corner sigmas: [0.00075330038, 0.00074352598, 0.00074780267, 0.00079028722, 0.00068217504, 0.00070443866] Median = 0.000745664
Corner means: [-9.3859446e-05, -8.9558678e-05, -0.00044680166, -0.00079312793, -0.00024419272, -0.00058300572] Median = -0.000345497
Corner sigmas: [0.00078053406, 0.00081415876, 0.00071501243, 0.00070233759, 0.00068675127, 0.0006455977] Median = 0.000708675
Corner means: [5.2689189e-05, -0.00019825516, 2.7381593e-05, -0.00049753464, 7.7082339e-05, -0.00037763407] Median = -8.54368e-05
Corner sigmas: [0.00083584304, 0.00082280097, 0.00071524212, 0.00075399695, 0.00067248417, 0.00073438388] Median = 0.00074419
Corner means: [-9.1008391e-05, -0.00027068885, -0.00045534401, -0.00078317145, -0.00023901381, -0.00057320431] Median = -0.000363016
Corner sigmas: [0.00088335603, 0.00081210257, 0.0007004097, 0.00066573429, 0.00069375319, 0.00064953382] Median = 0.000697081
Corner means: [1.8192814e-05, -0.00038113471, 6.7869863e-05, -0.00049095851, 9.0033849e-05, -0.0004537066] Median = -0.000181471
Corner sigmas: [0.00086503616, 0.00082840462, 0.00073538389, 0.00078683277, 0.00071963074, 0.0007289052] Median = 0.000761108
Corner means: [-0.00013692111, -0.00021085277, -0.0004235607, -0.0008249018, -0.00023325527, -0.00059029419] Median = -0.000328408
Corner sigmas: [0.00089284545, 0.00085062115, 0.00072714122, 0.00067769166, 0.00072394358, 0.00068965327] Median = 0.000725542
Corner means: [2.0707819e-05, -0.00037997006, 6.766431e-05, -0.00046326226, 9.0941416e-05, -0.00041102982] Median = -0.000179631
Corner sigmas: [0.0010959129, 0.0010650513, 0.00096137659, 0.001022986, 0.00093360781, 0.00093407999] Median = 0.000992181
Corner means: [-0.00011522261, -0.00021806527, -0.0004322817, -0.00070845394, -0.0002539095, -0.00063227484] Median = -0.000343096
Corner sigmas: [0.0011705005, 0.0010440218, 0.0010344966, 0.00096547935, 0.00097297016, 0.00091149949] Median = 0.00100373
Corner means: [3.5742862e-05, -0.00022112607, 6.5073655e-05, -0.00052863301, 8.37603e-05, -0.00038878547] Median = -9.26916e-05
Corner sigmas: [0.0013383111, 0.0012839476, 0.0011957082, 0.0012189015, 0.0011609, 0.0011577947] Median = 0.0012073
Corner means: [-0.00022056761, -0.00032175204, -0.00051421224, -0.00068594713, -0.00022659457, -0.0006104717] Median = -0.000417982
Corner sigmas: [0.0013324401, 0.0013456919, 0.0011758643, 0.0011335051, 0.0012047305, 0.001117893] Median = 0.0011903
Corner means: [-1.2880589e-05, -0.00019781048, 0.00010543914, -0.00051073811, 7.81665e-05, -0.00049608812] Median = -0.000105346
Corner sigmas: [0.0015453452, 0.0015510061, 0.0017123102, 0.0017713284, 0.0015579951, 0.0015440922] Median = 0.0015545
Corner means: [-0.00011421633, -0.00030598746, -0.0006275723, -0.0010536907, -0.00029693751, -0.00071669975] Median = -0.00046678
Corner sigmas: [0.00164473, 0.0016747798, 0.0017955222, 0.0017526787, 0.0015924186, 0.0014658913] Median = 0.00165975
Corner means: [6.7989233e-05, -0.00040441981, 8.3155719e-05, -0.00059453316, 0.00016079805, -0.0004193265] Median = -0.000168215
Corner sigmas: [0.0010221195, 0.0010112462, 0.00087494048, 0.00091060728, 0.00083403068, 0.0008849969] Median = 0.000897802
Corner means: [-0.00013775616, -0.00029292412, -0.00037572425, -0.000597868, -0.00022195243, -0.0005390321] Median = -0.000334324
Corner sigmas: [0.0010917905, 0.0010064885, 0.00088062114, 0.00084406091, 0.00091190432, 0.00080062391] Median = 0.000896263
Corner means: [-1.1891968e-05, -0.00021250274, 0.00010299115, -0.00039394002, 0.00010791192, -0.00041249351] Median = -0.000112197
Corner sigmas: [0.0011301525, 0.0011368834, 0.0019931684, 0.0021822136, 0.0014244401, 0.0014683274] Median = 0.00144638
Corner means: [-0.00036348088, -0.00026257054, -0.00066400459, 5.6379176e-05, -0.00025404969, -0.00024439269] Median = -0.00025831
Corner sigmas: [0.0011527579, 0.0011227496, 0.0020534133, 0.0020929538, 0.0014186911, 0.0014103464] Median = 0.00141452
Corner means: [-0.00010472547, 7.7249912e-05, -0.00022952275, 0.00056045601, -6.9319824e-05, 9.8486817e-05] Median = 3.96504e-06
Corner sigmas: [0.00029635607, 0.00034921372, 0.0005349883, 0.00057719322, 0.00038297405, 0.00043000016] Median = 0.000406487
Corner means: [-0.00042992059, 0.00028281883, -0.00058044022, 0.00011411362, -0.00049867819, 7.3057832e-05] Median = -0.000178431
Corner sigmas: [0.00030561787, 0.00030757196, 0.00048349818, 0.00050506968, 0.00041540788, 0.00037469179] Median = 0.00039505
Corner means: [-0.00013860222, 3.2298733e-05, -0.00019205126, 1.5504691e-05, 2.0311814e-05, -8.1065758e-05] Median = -3.27805e-05
Corner sigmas: [0.0003512651, 0.00042255619, 0.0005741457, 0.00060422334, 0.00039676661, 0.00045451062] Median = 0.000438533
Corner means: [-0.00047240983, 0.00033506565, -0.0006119358, 0.00013850673, -0.00051029871, 0.00017553853] Median = -0.000166952
Corner sigmas: [0.00034745751, 0.00037090207, 0.00054849347, 0.00056056533, 0.00046634843, 0.00038708778] Median = 0.000426718
Corner means: [-0.00014553362, 4.5057059e-05, -0.00013709647, 3.717974e-05, 1.7810971e-05, -9.1279988e-05] Median = -3.67345e-05
Corner sigmas: [0.00049719121, 0.00059157214, 0.00040885908, 0.00046564493, 0.00037026303, 0.00044207386] Median = 0.000453859
Corner means: [-0.00051167852, 0.00058524398, -0.00046787396, 0.00017470772, -0.00051281758, 0.00034985831] Median = -0.000146583
Corner sigmas: [0.00051205599, 0.00050458475, 0.00038529784, 0.00039130397, 0.00039080204, 0.00036645762] Median = 0.000391053
Corner means: [-6.519493e-05, 0.00023364912, -8.3765495e-05, 0.00010283639, -4.8223537e-05, 0.00010212413] Median = 2.69503e-05
Corner sigmas: [0.00054094318, 0.00063710858, 0.00041806459, 0.00047725378, 0.00037954299, 0.00046092013] Median = 0.000469087
Corner means: [-0.00052718044, 0.00060214155, -0.00049251382, 0.00023339047, -0.00050861202, 0.00039638157] Median = -0.000129562
Corner sigmas: [0.00055641943, 0.00055278814, 0.00039137597, 0.00039210546, 0.00039201175, 0.00036979353] Median = 0.000392059
Corner means: [-6.4393418e-05, 0.00014800101, -8.1628874e-05, 5.6219516e-05, -2.6115989e-05, 3.1193835e-05] Median = 2.53892e-06
Corner sigmas: [0.00053017243, 0.00063370931, 0.00041136268, 0.00048378471, 0.00037478204, 0.00046219534] Median = 0.00047299
Corner means: [-0.00051704369, 0.00057480746, -0.00046451873, 0.00021511641, -0.00051215634, 0.00035127014] Median = -0.000124701
Corner sigmas: [0.0005551934, 0.00055437523, 0.00038987814, 0.00040004952, 0.0004125821, 0.00039215505] Median = 0.000406316
Corner means: [-8.9536552e-05, 0.00011627167, -0.00010336177, 4.7697526e-05, -5.3637265e-05, -5.4445786e-06] Median = -2.95409e-05
Corner sigmas: [0.00058293663, 0.00067342946, 0.00038156085, 0.00045671072, 0.00039886433, 0.0004985382] Median = 0.000477624
Corner means: [-0.00045746498, 0.00053943205, -0.000385858, 0.0002244451, -0.00042006694, 0.00032677097] Median = -8.07064e-05
Corner sigmas: [0.0005864604, 0.00058784895, 0.00038318115, 0.0003874322, 0.00045471056, 0.00043447132] Median = 0.000444591
Corner means: [-0.00017690394, 0.00024281058, -0.00011750382, 6.7654502e-05, -3.1260606e-05, 1.3610565e-05] Median = -8.82502e-06
Corner sigmas: [0.00057294214, 0.00069546909, 0.00040007327, 0.00049290701, 0.00041826465, 0.00051434018] Median = 0.000503624
Corner means: [-0.00039704365, 0.00056648749, -0.0003703355, 0.00026691536, -0.00034729004, 0.00034304996] Median = -4.01873e-05
Corner sigmas: [0.0005886876, 0.00061862252, 0.00039386784, 0.00039862847, 0.00048321305, 0.00042674161] Median = 0.000454977
Corner means: [-0.00021241557, 0.00033818427, -0.00015385916, 0.00012375649, -3.9501687e-05, 0.00011532065] Median = 3.79095e-05
Corner sigmas: [0.00037152256, 0.00043839615, 0.00041329901, 0.00045220653, 0.00035532194, 0.00043683124] Median = 0.000425065
Corner means: [-0.0004726222, 0.00036671862, -0.0003874473, 0.00016958029, -0.00046054693, 0.00021374805] Median = -0.000108934
Corner sigmas: [0.00039037567, 0.0003950267, 0.00039295183, 0.00041187057, 0.00041807181, 0.00035857843] Median = 0.000393989
Corner means: [-0.00013716324, 0.00012600848, -0.00010185715, 7.9259582e-05, -6.3934726e-06, -2.5637597e-05] Median = -1.60155e-05
Corner sigmas: [0.00034853793, 0.00043362027, 0.0004088874, 0.00045917503, 0.00035269166, 0.00041899565] Median = 0.000413942
Corner means: [-0.0005226247, 0.00037820116, -0.00044480653, 0.00016993632, -0.00042987551, 0.00023330495] Median = -0.00012997
Corner sigmas: [0.00035668962, 0.0003883508, 0.0003823631, 0.0003854465, 0.00042838804, 0.00035742682] Median = 0.000383905
Corner means: [-0.00018660021, 0.00012669037, -0.0001256339, 1.0196043e-05, 1.2891374e-05, -1.0116019e-05] Median = 4.00119e-08
Corner sigmas: [0.00035534875, 0.00044419963, 0.00038970431, 0.00044441732, 0.00035962346, 0.00042271335] Median = 0.000406209
Corner means: [-0.00047785859, 0.00038422708, -0.0004137331, 0.00014292153, -0.00037744563, 0.0001877428] Median = -0.000117262
Corner sigmas: [0.00034653378, 0.00037329225, 0.00036761144, 0.00038658624, 0.00045015928, 0.00037068763] Median = 0.00037199
Corner means: [-0.00018849611, 0.00013546291, -0.00012199521, 3.1526219e-05, 4.9444661e-05, -1.1587739e-07] Median = 1.57052e-05
Corner sigmas: [0.0060774712, 0.0060814465, 0.0065606833, 0.0068209195, 0.0060005477, 0.0063301693] Median = 0.00620581
Corner means: [-0.0016869542, 0.00093154213, -0.0046579782, 0.0028471716, -0.0031347657, 0.0017303257] Median = -0.000377706
Corner sigmas: [0.0063291756, 0.0061481842, 0.0065332814, 0.0064649251, 0.0062506315, 0.0062334831] Median = 0.0062899
Corner means: [0.001136796, 0.00018264214, -0.00067309808, 0.0016095387, -0.0003658811, 0.00081607659] Median = 0.000499359
Corner sigmas: [0.0044194269, 0.0045888843, 0.0050076889, 0.0054832073, 0.0045800651, 0.0047404263] Median = 0.00466466
Corner means: [-0.0018818676, 0.0014581964, -0.0054262429, 0.0030349698, -0.0033239578, 0.0021768434] Median = -0.000211836
Corner sigmas: [0.0049757035, 0.0046086712, 0.0048538116, 0.0050597815, 0.0046229567, 0.0046703443] Median = 0.00476208
Corner means: [0.00037112672, 2.4699521e-05, -0.00083896075, 0.0011512307, -0.00035002464, 0.00061351748] Median = 0.000197913
Corner sigmas: [0.0034165112, 0.0034361777, 0.0059658196, 0.0061849747, 0.0043477896, 0.0042072507] Median = 0.00427752
Corner means: [-0.0012610072, 0.0011567065, -0.0032699083, 0.0020381343, -0.0018649403, 0.0012607264] Median = -5.21503e-05
Corner sigmas: [0.0036122731, 0.0035067478, 0.0061228885, 0.0063227047, 0.0042966865, 0.0043844078] Median = 0.00434055
Corner means: [-0.00033124234, 0.00078338949, -0.001383053, 0.0016836716, -0.00050047063, 0.0011191271] Median = 0.000226074
Corner sigmas: [0.0027137785, 0.0028652013, 0.0047198087, 0.0087301228, 0.0034423894, 0.003854333] Median = 0.00364836
Corner means: [-0.0022946266, 0.0016849167, -0.019340402, 0.0080862446, -0.0045582922, 0.0029711174] Median = -0.000304855
Corner sigmas: [0.0035732936, 0.0028051778, 0.0059643509, 0.0041694967, 0.0035951524, 0.003519088] Median = 0.00358422
Corner means: [0.0016664, -0.0017687338, 0.00082664605, -0.00066754967, 4.6705667e-05, -0.00032093801] Median = -0.000137116
Corner sigmas: [0.0026228088, 0.0028023201, 0.0047576353, 0.0047660535, 0.0034305698, 0.0035306215] Median = 0.0034806
Corner means: [-0.0012776591, 0.0009597991, -0.0017905546, 0.0013969712, -0.0010496872, 0.00094267842] Median = -5.35044e-05
Corner sigmas: [0.0027222673, 0.0026854665, 0.0049737627, 0.0050453329, 0.0035741983, 0.0035533039] Median = 0.00356375
Corner means: [-0.00054970273, 0.00088218518, -0.001414789, 0.0017570927, -0.00062442548, 0.0007997182] Median = 0.000125008
Corner sigmas: [0.0092039052, 0.009207556, 0.0060184905, 0.0061931033, 0.0081476336, 0.0079773115] Median = 0.00806247
Corner means: [0.00040226532, 0.0058213449, -0.00010916856, 0.0014264929, 0.00077906274, 0.0030811126] Median = 0.00110278
Corner sigmas: [0.0095919324, 0.065035142, 0.0069335909, 0.0137373, 0.0084114615, 0.046582654] Median = 0.0116646
Corner means: [0.001345986, 0.045171965, 0.0006687186, 0.0071223769, 0.00086974876, 0.029719623] Median = 0.00423418
Corner sigmas: [0.0091026267, 0.0099795656, 0.0063255993, 0.0063358946, 0.007803794, 0.008754787] Median = 0.00827929
Corner means: [0.0030263963, 0.0015026566, -0.00019463028, 0.00036156073, 0.0011780935, 0.00049524114] Median = 0.000836667
Corner sigmas: [0.0097760605, 0.010024212, 0.0064586438, 0.0071481988, 0.008534261, 0.0087968186] Median = 0.00866554
Corner means: [-0.00078236189, -0.0012759629, -0.00054873351, -0.00066943339, -0.00057729223, -0.00089622138] Median = -0.000725898
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline71" class="outline-2">
<h2 id="orgheadline71"><span class="section-number-2">4</span> <span class="done DONE">DONE</span> Back-propagate the heliocentric velocities to the spectra</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>This will allow better cross-referencing between the isovelocity images and the spectra</li>
<li>We will also try and add a better spatial coordinate WCS
<ul class="org-ul">
<li>One possibility would be to use the pixels of the output grid from the spectral maps</li>
</ul></li>
</ul>
</div>

<div id="outline-container-orgheadline58" class="outline-3">
<h3 id="orgheadline58"><span class="section-number-3">4.1</span> Program to add a better wcs to the spectra: spec_augment_wcs.py</h3>
<div class="outline-text-3" id="text-4-1">
<p>
The imports
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> sys
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy <span style="color: #b9d3ee;">import</span> units <span style="color: #b9d3ee;">as</span> u
<span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS
<span style="color: #b9d3ee;">from</span> helio_utils <span style="color: #b9d3ee;">import</span> waves2vels
</pre>
</div>


<p>
This is the WCS for the spectral maps, which is copied from down <a href="#orgheadline57">here</a>. The idea is that we can use this to define the spatial WCS for our slit spectrum that gives the corresponding pixel of the map. 
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">get_specmap_wcs</span>():
    <span style="color: #dfaf8f;">pixel_scale</span> = 0.5               <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">arcsec</span>
    <span style="color: #dfaf8f;">NX</span>, <span style="color: #dfaf8f;">NY</span> = 2048, 2048
    <span style="color: #dfaf8f;">dRA</span>, <span style="color: #dfaf8f;">dDec</span> = -pixel_scale/3600., pixel_scale/3600.
    <span style="color: #dfaf8f;">RA0</span>, <span style="color: #dfaf8f;">Dec0</span> = 83.69, -5.429
    <span style="color: #dfaf8f;">w</span> = WCS(naxis=2)
    <span style="color: #dfaf8f;">w.wcs.crpix</span> = [0.5*(1 + NX), 0.5*(1 + NY)]
    <span style="color: #dfaf8f;">w.wcs.cdelt</span> = [dRA, dDec]
    <span style="color: #dfaf8f;">w.wcs.crval</span> = [RA0, Dec0]
    <span style="color: #dfaf8f;">w.wcs.ctype</span> = [<span style="color: #eee8aa; font-style: italic;">'RA---TAN'</span>, <span style="color: #eee8aa; font-style: italic;">'DEC--TAN'</span>]
    <span style="color: #dfaf8f;">w.wcs.cunit</span> = [<span style="color: #eee8aa; font-style: italic;">'deg'</span>, <span style="color: #eee8aa; font-style: italic;">'deg'</span>]
    <span style="color: #b9d3ee;">return</span> w
</pre>
</div>

<p>
Function to fix up a single fits file
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">fix_up_some_new_wcs</span>(filename, old_new=(<span style="color: #eee8aa; font-style: italic;">'.fits'</span>, <span style="color: #eee8aa; font-style: italic;">'-vhel.fits'</span>)):
    <span style="color: #dfaf8f;">hdu</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(filename)[0]  <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Always use first HDU in file</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Start with the Wav, RA, Dec WCS</span>
    <span style="color: #dfaf8f;">wold</span> = WCS(hdu.header, key=<span style="color: #eee8aa; font-style: italic;">'A'</span>)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">This is where we will put the new stuff</span>
    <span style="color: #dfaf8f;">wnew</span> = wold.deepcopy()

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">First do the velocity part</span>
    <span style="color: #dfaf8f;">wav0</span>, <span style="color: #dfaf8f;">dwav</span> = wold.wcs.crval[0], wold.wcs.cdelt[0]
    <span style="color: #dfaf8f;">vel0</span>, <span style="color: #dfaf8f;">vel1</span> = waves2vels([wav0, wav0 + dwav]*u.m,
                            wold.wcs.restwav*u.m, hdu.header)
    <span style="color: #dfaf8f;">dvel</span> = vel1 - vel0
    <span style="color: #dfaf8f;">wnew.wcs.crval</span>[0] = vel0.to(<span style="color: #eee8aa; font-style: italic;">'km/s'</span>).value
    <span style="color: #dfaf8f;">wnew.wcs.cdelt</span>[0] = dvel.to(<span style="color: #eee8aa; font-style: italic;">'km/s'</span>).value
    <span style="color: #dfaf8f;">wnew.wcs.cunit</span>[0] = u.km/u.s
    <span style="color: #dfaf8f;">wnew.wcs.ctype</span>[0] = <span style="color: #eee8aa; font-style: italic;">'VOPT'</span>
    <span style="color: #dfaf8f;">wnew.wcs.cname</span>[0] = <span style="color: #eee8aa; font-style: italic;">'Heliocentric velocity'</span>
    <span style="color: #dfaf8f;">wnew.wcs.specsys</span> = <span style="color: #eee8aa; font-style: italic;">'HELIOCEN'</span>
    <span style="color: #dfaf8f;">wnew.wcs.name</span> = <span style="color: #eee8aa; font-style: italic;">"VHELIO"</span>

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Now do the spatial part</span>
    <span style="color: #dfaf8f;">wim</span> = get_specmap_wcs()
    <span style="color: #dfaf8f;">RAs</span>, <span style="color: #dfaf8f;">Decs</span> = wold.celestial.all_pix2world([0, 1, 0], [0, 0, 1], 0)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">print('First two pixels RA and Dec:', RAs, Decs)</span>
    [X0, X1, X2], [Y0, Y1, Y2] = wim.all_world2pix(RAs, Decs, 0)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">print('First two pixels X and Y:', [X0, X1, X2], [Y0, Y1, Y2])</span>
    <span style="color: #dfaf8f;">wnew.wcs.crval</span>[1:] = [X0, Y0]
    <span style="color: #dfaf8f;">wnew.wcs.cdelt</span>[1:] = [1., 1.]
    <span style="color: #dfaf8f;">wnew.wcs.pc</span>[1:, 1:] = [[X1 - X0, Y1 - Y0], [X2 - X0, Y2 - Y0]]
    wnew.wcs.ctype[1], <span style="color: #dfaf8f;">wnew.wcs.ctype</span>[2] = [<span style="color: #eee8aa; font-style: italic;">'LINEAR'</span>]*2
    wnew.wcs.cname[1], <span style="color: #dfaf8f;">wnew.wcs.cname</span>[2] = [<span style="color: #eee8aa; font-style: italic;">'X'</span>, <span style="color: #eee8aa; font-style: italic;">'Y'</span>]
    wnew.wcs.cunit[1], <span style="color: #dfaf8f;">wnew.wcs.cunit</span>[2] = [u.dimensionless_unscaled]*2

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Cut off the velocity range in the data array to [-150..200] km/s</span>
    wnew.fix()                  <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Make sure we know it is in SI units</span>
    <span style="color: #dfaf8f;">vwindow</span> = [-150, 200]*u.km/u.s
    [j1, j2], <span style="color: #dfaf8f;">_</span>, <span style="color: #dfaf8f;">_</span> = wnew.all_world2pix(vwindow.to(u.m/u.s).value,
                                        [0, 0], [0, 0], 0)
    <span style="color: #dfaf8f;">view</span> = <span style="color: #DCDCCC; font-weight: bold;">slice</span>(<span style="color: #cFfBcF;">None</span>), <span style="color: #DCDCCC; font-weight: bold;">slice</span>(<span style="color: #cFfBcF;">None</span>), <span style="color: #DCDCCC; font-weight: bold;">slice</span>(<span style="color: #DCDCCC; font-weight: bold;">int</span>(j1), <span style="color: #DCDCCC; font-weight: bold;">int</span>(j2) + 2)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Apply slice to data and to the WCS</span>
    <span style="color: #dfaf8f;">hdu.data</span> = hdu.data[:, :, j1:j2]
    <span style="color: #dfaf8f;">wnew</span> = wnew.<span style="color: #DCDCCC; font-weight: bold;">slice</span>(view)
    <span style="color: #dfaf8f;">wold</span> = wold.<span style="color: #DCDCCC; font-weight: bold;">slice</span>(view)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Update header with a new WCS called V</span>
    hdu.header.update(wnew.to_header(key=<span style="color: #eee8aa; font-style: italic;">'V'</span>))
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">And re-write 'A' too since we have changed it</span>
    hdu.header.update(wold.to_header(key=<span style="color: #eee8aa; font-style: italic;">'A'</span>))

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Now, sort out the default header</span>

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">New blank wcs with only 2 dimensions</span>
    <span style="color: #dfaf8f;">wdef</span> = WCS(naxis=2)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Copy over the velocity part </span>
    <span style="color: #b9d3ee;">for</span> k <span style="color: #b9d3ee;">in</span> <span style="color: #eee8aa; font-style: italic;">'crval'</span>, <span style="color: #eee8aa; font-style: italic;">'crpix'</span>, <span style="color: #eee8aa; font-style: italic;">'cdelt'</span>, <span style="color: #eee8aa; font-style: italic;">'cunit'</span>, <span style="color: #eee8aa; font-style: italic;">'ctype'</span>, <span style="color: #eee8aa; font-style: italic;">'cname'</span>:
        <span style="color: #DCDCCC; font-weight: bold;">getattr</span>(wdef.wcs, k)[0] = <span style="color: #DCDCCC; font-weight: bold;">getattr</span>(wnew.wcs, k)[0]
    <span style="color: #dfaf8f;">wdef.wcs.pc</span>[0, 0] = wnew.wcs.pc[0, 0]

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Check for orientation</span>
    <span style="color: #dfaf8f;">slit_center</span> = hdu.header[<span style="color: #eee8aa; font-style: italic;">'NAXIS2'</span>]/2
    <span style="color: #b9d3ee;">if</span> <span style="color: #DCDCCC; font-weight: bold;">abs</span>(wnew.wcs.pc[1, 1]) &gt; <span style="color: #DCDCCC; font-weight: bold;">abs</span>(wnew.wcs.pc[1, 2]):
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">largely horizontal slit - use X-axis</span>
        <span style="color: #dfaf8f;">jslit</span> = 1
        _, _, [Ycent] = wnew.all_pix2world([0], [slit_center], [0], 0) 
        <span style="color: #dfaf8f;">wdef.wcs.name</span> = <span style="color: #eee8aa; font-style: italic;">'YY{:04d}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(<span style="color: #DCDCCC; font-weight: bold;">int</span>(Ycent))
    <span style="color: #b9d3ee;">else</span>:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">largely vertical slit - use Y-axis</span>
        <span style="color: #dfaf8f;">jslit</span> = 2
        _, [Xcent], <span style="color: #dfaf8f;">_</span> = wnew.all_pix2world([0], [slit_center], [0], 0) 
        <span style="color: #dfaf8f;">wdef.wcs.name</span> = <span style="color: #eee8aa; font-style: italic;">'XX{:04d}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(<span style="color: #DCDCCC; font-weight: bold;">int</span>(Xcent))

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Copy over spatial part (X or Y, depending on orientation)</span>
    <span style="color: #b9d3ee;">for</span> k <span style="color: #b9d3ee;">in</span> <span style="color: #eee8aa; font-style: italic;">'crval'</span>, <span style="color: #eee8aa; font-style: italic;">'crpix'</span>, <span style="color: #eee8aa; font-style: italic;">'cunit'</span>, <span style="color: #eee8aa; font-style: italic;">'ctype'</span>, <span style="color: #eee8aa; font-style: italic;">'cname'</span>:
        <span style="color: #DCDCCC; font-weight: bold;">getattr</span>(wdef.wcs, k)[1] = <span style="color: #DCDCCC; font-weight: bold;">getattr</span>(wnew.wcs, k)[jslit]
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">More intuitive to use CDELT instead of PC</span>
    <span style="color: #dfaf8f;">wdef.wcs.cdelt</span>[1] = wnew.wcs.pc[1, jslit]

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Update header with new default WCS</span>
    hdu.header.update(wdef.to_header(key=<span style="color: #eee8aa; font-style: italic;">' '</span>))
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Convert from m/s to km/s</span>
    <span style="color: #dfaf8f;">hdu.header</span>[<span style="color: #eee8aa; font-style: italic;">'CUNIT1'</span>] = <span style="color: #eee8aa; font-style: italic;">'km/s'</span>
    <span style="color: #dfaf8f;">hdu.header</span>[<span style="color: #eee8aa; font-style: italic;">'CRVAL1'</span>] /= 1000.
    <span style="color: #dfaf8f;">hdu.header</span>[<span style="color: #eee8aa; font-style: italic;">'CDELT1'</span>] /= 1000.
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Remove the pesky CD keywords</span>
    <span style="color: #b9d3ee;">for</span> ij <span style="color: #b9d3ee;">in</span> <span style="color: #eee8aa; font-style: italic;">'1_1'</span>, <span style="color: #eee8aa; font-style: italic;">'1_2'</span>, <span style="color: #eee8aa; font-style: italic;">'2_2'</span>, <span style="color: #eee8aa; font-style: italic;">'1_1'</span>:
        <span style="color: #b9d3ee;">if</span> <span style="color: #eee8aa; font-style: italic;">'CD'</span>+ij <span style="color: #b9d3ee;">in</span> hdu.header:
            hdu.header.remove(<span style="color: #eee8aa; font-style: italic;">'CD'</span>+ij)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">And flatten data array to 2-dimensions</span>
    hdu.data, = hdu.data

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Write a new file </span>
    <span style="color: #dfaf8f;">newfilename</span> = filename.replace(*old_new).replace(<span style="color: #eee8aa; font-style: italic;">'BGsub/'</span>,
                                                     <span style="color: #eee8aa; font-style: italic;">'BGsub/'</span> + wdef.wcs.name + <span style="color: #eee8aa; font-style: italic;">'-'</span>)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Writing'</span>, newfilename)
    hdu.writeto(newfilename, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>


<p>
Read file from command line if called interactively
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">if</span> <span style="color: #DCDCCC; font-weight: bold;">__name__</span> == <span style="color: #eee8aa; font-style: italic;">'__main__'</span>:
    <span style="color: #b9d3ee;">try</span>:
        <span style="color: #dfaf8f;">fn</span> = sys.argv[1]
    <span style="color: #b9d3ee;">except</span>:
        <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Usage:'</span>, sys.argv[0], <span style="color: #eee8aa; font-style: italic;">'FITSFILE'</span>)
        sys.<span style="color: #cFfBcF;">exit</span>()

    fix_up_some_new_wcs(fn)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline59" class="outline-3">
<h3 id="orgheadline59"><span class="section-number-3">4.2</span> Test the addition of the <code>V</code> WCS</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">

<pre class="src src-sh">python spec_augment_wcs.py Calibrated/BGsub/2013-12-111-ha.fits
</pre>
</div>

<pre class="example">
Writing Calibrated/BGsub/YY1295-2013-12-111-ha-vhel.fits
</pre>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p test zoom 4 1
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p test fits $<span style="color: #dfaf8f;">PWD</span>/Calibrated/BGsub/YY1295-2013-12-111-ha-vhel.fits
xpaset -p test zoom to fit
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">open -n -a SAOImage<span style="color: #eee8aa; font-style: italic;">\ </span>DS9 --args -title test
</pre>
</div>
</div>
</div>



<div id="outline-container-orgheadline60" class="outline-3">
<h3 id="orgheadline60"><span class="section-number-3">4.3</span> Add the VHEL and pixel WCS to all the spectra</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #b9d3ee;">for</span> f<span style="color: #b9d3ee;"> in</span> Calibrated/BGsub/*-{ha,nii}.fits; <span style="color: #b9d3ee;">do</span>
    python spec_augment_wcs.py $<span style="color: #dfaf8f;">f</span>
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<pre class="example">
Writing Calibrated/BGsub/XX1162-2006-02-260-ha-vhel.fits
Writing Calibrated/BGsub/XX1166-2006-02-270-ha-vhel.fits
Writing Calibrated/BGsub/XX1170-2006-02-276-ha-vhel.fits
Writing Calibrated/BGsub/XX1176-2006-02-281-ha-vhel.fits
Writing Calibrated/BGsub/XX1180-2006-02-286-ha-vhel.fits
Writing Calibrated/BGsub/XX1182-2006-02-291-ha-vhel.fits
Writing Calibrated/BGsub/XX1189-2006-02-296-ha-vhel.fits
Writing Calibrated/BGsub/XX1197-2006-02-303-ha-vhel.fits
Writing Calibrated/BGsub/XX1259-2006-02-313-ha-vhel.fits
Writing Calibrated/BGsub/XX1156-2006-02-318-ha-vhel.fits
Writing Calibrated/BGsub/XX1150-2006-02-326-ha-vhel.fits
Writing Calibrated/BGsub/XX0430-2007-01-054-ha-vhel.fits
Writing Calibrated/BGsub/XX0443-2007-01-067-ha-vhel.fits
Writing Calibrated/BGsub/XX0447-2007-01-072-ha-vhel.fits
Writing Calibrated/BGsub/XX1154-2007-01b-2037-ha-vhel.fits
Writing Calibrated/BGsub/XX1189-2007-01b-2041-ha-vhel.fits
Writing Calibrated/BGsub/XX1204-2007-01b-2045-ha-vhel.fits
Writing Calibrated/BGsub/XX1218-2007-01b-2049-ha-vhel.fits
Writing Calibrated/BGsub/XX1232-2007-01b-2053-ha-vhel.fits
Writing Calibrated/BGsub/XX1251-2007-01b-2057-ha-vhel.fits
Writing Calibrated/BGsub/XX1141-2007-01b-2061-ha-vhel.fits
Writing Calibrated/BGsub/XX1389-2010-01-078-ha-vhel.fits
Writing Calibrated/BGsub/XX1540-2010-01-124-ha-vhel.fits
Writing Calibrated/BGsub/XX1558-2010-01-128-ha-vhel.fits
Writing Calibrated/BGsub/XX1557-2010-01-133-ha-vhel.fits
Writing Calibrated/BGsub/XX1575-2010-01-137-ha-vhel.fits
Writing Calibrated/BGsub/XX1595-2010-01-145-ha-vhel.fits
Writing Calibrated/BGsub/XX1616-2010-01-157-ha-vhel.fits
Writing Calibrated/BGsub/XX1523-2010-01-202-ha-vhel.fits
Writing Calibrated/BGsub/XX1549-2010-01-206-ha-vhel.fits
Writing Calibrated/BGsub/XX1568-2010-01-210-ha-vhel.fits
Writing Calibrated/BGsub/XX1585-2010-01-214-ha-vhel.fits
Writing Calibrated/BGsub/XX1609-2010-01-219-ha-vhel.fits
Writing Calibrated/BGsub/XX1620-2010-01-236-ha-vhel.fits
Writing Calibrated/BGsub/XX1633-2010-01-240-ha-vhel.fits
Writing Calibrated/BGsub/XX1646-2010-01-244-ha-vhel.fits
Writing Calibrated/BGsub/XX1601-2010-01-248-ha-vhel.fits
Writing Calibrated/BGsub/XX1656-2010-01-252-ha-vhel.fits
Writing Calibrated/BGsub/YY1401-2013-02-024-ha-vhel.fits
Writing Calibrated/BGsub/YY1120-2013-02-029-ha-vhel.fits
Writing Calibrated/BGsub/YY1112-2013-02-033-ha-vhel.fits
Writing Calibrated/BGsub/YY1058-2013-02-149-ha-vhel.fits
Writing Calibrated/BGsub/YY1068-2013-02-154-ha-vhel.fits
Writing Calibrated/BGsub/YY1085-2013-02-159-ha-vhel.fits
Writing Calibrated/BGsub/YY0936-2013-02-165-ha-vhel.fits
Writing Calibrated/BGsub/YY0955-2013-02-169-ha-vhel.fits
Writing Calibrated/BGsub/YY1019-2013-02-226-ha-vhel.fits
Writing Calibrated/BGsub/YY1000-2013-02-232-ha-vhel.fits
Writing Calibrated/BGsub/YY0971-2013-02-237-ha-vhel.fits
Writing Calibrated/BGsub/YY1314-2013-12-086-ha-vhel.fits
Writing Calibrated/BGsub/YY1289-2013-12-090-ha-vhel.fits
Writing Calibrated/BGsub/YY1312-2013-12-102-ha-vhel.fits
Writing Calibrated/BGsub/YY1295-2013-12-111-ha-vhel.fits
Writing Calibrated/BGsub/YY1287-2013-12-116-ha-vhel.fits
Writing Calibrated/BGsub/YY1308-2015-02-0003-ha-vhel.fits
Writing Calibrated/BGsub/YY1280-2015-02-0012-ha-vhel.fits
Writing Calibrated/BGsub/XX1162-2006-02-260-nii-vhel.fits
Writing Calibrated/BGsub/XX1166-2006-02-270-nii-vhel.fits
Writing Calibrated/BGsub/XX1170-2006-02-276-nii-vhel.fits
Writing Calibrated/BGsub/XX1176-2006-02-281-nii-vhel.fits
Writing Calibrated/BGsub/XX1180-2006-02-286-nii-vhel.fits
Writing Calibrated/BGsub/XX1182-2006-02-291-nii-vhel.fits
Writing Calibrated/BGsub/XX1189-2006-02-296-nii-vhel.fits
Writing Calibrated/BGsub/XX1197-2006-02-303-nii-vhel.fits
Writing Calibrated/BGsub/XX1259-2006-02-313-nii-vhel.fits
Writing Calibrated/BGsub/XX1156-2006-02-318-nii-vhel.fits
Writing Calibrated/BGsub/XX1150-2006-02-326-nii-vhel.fits
Writing Calibrated/BGsub/XX0430-2007-01-054-nii-vhel.fits
Writing Calibrated/BGsub/XX0443-2007-01-067-nii-vhel.fits
Writing Calibrated/BGsub/XX0447-2007-01-072-nii-vhel.fits
Writing Calibrated/BGsub/XX1154-2007-01b-2037-nii-vhel.fits
Writing Calibrated/BGsub/XX1189-2007-01b-2041-nii-vhel.fits
Writing Calibrated/BGsub/XX1204-2007-01b-2045-nii-vhel.fits
Writing Calibrated/BGsub/XX1218-2007-01b-2049-nii-vhel.fits
Writing Calibrated/BGsub/XX1232-2007-01b-2053-nii-vhel.fits
Writing Calibrated/BGsub/XX1251-2007-01b-2057-nii-vhel.fits
Writing Calibrated/BGsub/XX1141-2007-01b-2061-nii-vhel.fits
Writing Calibrated/BGsub/XX1389-2010-01-078-nii-vhel.fits
Writing Calibrated/BGsub/XX1540-2010-01-124-nii-vhel.fits
Writing Calibrated/BGsub/XX1558-2010-01-128-nii-vhel.fits
Writing Calibrated/BGsub/XX1557-2010-01-133-nii-vhel.fits
Writing Calibrated/BGsub/XX1575-2010-01-137-nii-vhel.fits
Writing Calibrated/BGsub/XX1595-2010-01-145-nii-vhel.fits
Writing Calibrated/BGsub/XX1616-2010-01-157-nii-vhel.fits
Writing Calibrated/BGsub/XX1523-2010-01-202-nii-vhel.fits
Writing Calibrated/BGsub/XX1549-2010-01-206-nii-vhel.fits
Writing Calibrated/BGsub/XX1568-2010-01-210-nii-vhel.fits
Writing Calibrated/BGsub/XX1585-2010-01-214-nii-vhel.fits
Writing Calibrated/BGsub/XX1609-2010-01-219-nii-vhel.fits
Writing Calibrated/BGsub/XX1620-2010-01-236-nii-vhel.fits
Writing Calibrated/BGsub/XX1633-2010-01-240-nii-vhel.fits
Writing Calibrated/BGsub/XX1646-2010-01-244-nii-vhel.fits
Writing Calibrated/BGsub/XX1601-2010-01-248-nii-vhel.fits
Writing Calibrated/BGsub/XX1656-2010-01-252-nii-vhel.fits
Writing Calibrated/BGsub/YY1401-2013-02-024-nii-vhel.fits
Writing Calibrated/BGsub/YY1120-2013-02-029-nii-vhel.fits
Writing Calibrated/BGsub/YY1112-2013-02-033-nii-vhel.fits
Writing Calibrated/BGsub/YY1058-2013-02-149-nii-vhel.fits
Writing Calibrated/BGsub/YY1068-2013-02-154-nii-vhel.fits
Writing Calibrated/BGsub/YY1085-2013-02-159-nii-vhel.fits
Writing Calibrated/BGsub/YY0936-2013-02-165-nii-vhel.fits
Writing Calibrated/BGsub/YY0955-2013-02-169-nii-vhel.fits
Writing Calibrated/BGsub/YY1019-2013-02-226-nii-vhel.fits
Writing Calibrated/BGsub/YY1000-2013-02-232-nii-vhel.fits
Writing Calibrated/BGsub/YY0971-2013-02-237-nii-vhel.fits
Writing Calibrated/BGsub/YY1314-2013-12-086-nii-vhel.fits
Writing Calibrated/BGsub/YY1289-2013-12-090-nii-vhel.fits
Writing Calibrated/BGsub/YY1312-2013-12-102-nii-vhel.fits
Writing Calibrated/BGsub/YY1295-2013-12-111-nii-vhel.fits
Writing Calibrated/BGsub/YY1287-2013-12-116-nii-vhel.fits
Writing Calibrated/BGsub/YY1308-2015-02-0003-nii-vhel.fits
Writing Calibrated/BGsub/YY1280-2015-02-0012-nii-vhel.fits
</pre>
</div>
</div>

<div id="outline-container-orgheadline70" class="outline-3">
<h3 id="orgheadline70"><span class="section-number-3">4.4</span> Displaying the new calibrated spectra in DS9</h3>
<div class="outline-text-3" id="text-4-4">
</div><div id="outline-container-orgheadline61" class="outline-4">
<h4 id="orgheadline61"><a id="ID-795D79F6-A9F0-4E94-ADBD-18D540713A8C"></a><span class="section-number-4">4.4.1</span> Delete all exisiting frames</h4>
<div class="outline-text-4" id="text-4-4-1">
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 frame delete all
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh" id="orgsrcblock6">open -n -a SAOImage<span style="color: #eee8aa; font-style: italic;">\ </span>DS9 --args -title $<span style="color: #dfaf8f;">DS9</span>
sleep 1
xpaset -p $<span style="color: #dfaf8f;">DS9</span> view buttons no
xpaset -p $<span style="color: #dfaf8f;">DS9</span> frame delete all
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline62" class="outline-4">
<h4 id="orgheadline62"><span class="section-number-4">4.4.2</span> General function for displaying a bunch of spectra</h4>
<div class="outline-text-4" id="text-4-4-2">
<ul class="org-ul">
<li>Passing glob patterns to shell scripts is really fraught.</li>
<li>I am reduced to using <code>find</code> instead</li>
</ul>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">files</span>=$(<span style="color: #CC9393;">find</span> $<span style="color: #dfaf8f;">PWD</span>/Calibrated/BGsub -name <span style="color: #eee8aa; font-style: italic;">"$1-vhel.fits"</span>)
<span style="color: #dfaf8f;">ds9</span>=${<span style="color: #dfaf8f;">2</span>:-ds9}
<span style="color: #b9d3ee;">for</span> path<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">files</span>; <span style="color: #b9d3ee;">do</span>
    <span style="color: #dfaf8f;">f</span>=${<span style="color: #dfaf8f;">path</span>##/*/} <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">just the filename</span>
    <span style="color: #b9d3ee;">if</span> [ ${<span style="color: #dfaf8f;">f</span>:0:1} == <span style="color: #eee8aa; font-style: italic;">"Y"</span> ]; <span style="color: #b9d3ee;">then</span>
        <span style="color: #dfaf8f;">orient</span>=horizontal
    <span style="color: #b9d3ee;">else</span>
        <span style="color: #dfaf8f;">orient</span>=vertical
    <span style="color: #b9d3ee;">fi</span>
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> frame new
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> fits $<span style="color: #dfaf8f;">path</span>
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> zoom to 3 1
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> grid load $<span style="color: #dfaf8f;">PWD</span>/$<span style="color: #dfaf8f;">orient</span>-axes.grd
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> cmap bb
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> scale sqrt
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> scale limits -0.0003 0.05
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour no
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour method smooth
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour smooth 2
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour color blue
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour loadlevels $<span style="color: #dfaf8f;">PWD</span>/ha-contours.lev
    xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour yes
<span style="color: #b9d3ee;">done</span>
xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour close
xpaset -p $<span style="color: #dfaf8f;">ds9</span> frame 1
xpaset -p $<span style="color: #dfaf8f;">ds9</span> match frame wcs
xpaset -p $<span style="color: #dfaf8f;">ds9</span> lock frame wcs
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh" id="orgsrcblock7"><span style="color: #dfaf8f;">files</span>=$(<span style="color: #CC9393;">find</span> $<span style="color: #dfaf8f;">PWD</span>/Calibrated/BGsub -name <span style="color: #eee8aa; font-style: italic;">"$1-vhel.fits"</span>)
<span style="color: #b9d3ee;">for</span> f<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">files</span>; <span style="color: #b9d3ee;">do</span>
    ls -l $<span style="color: #dfaf8f;">f</span>
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<ul class="org-ul">
<li>Testing contour setting</li>
<li>Important thing is to turn it off while fiddling, then turn it back on at the end</li>
</ul>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">ds9</span>=spectra
xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour no
xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour method smooth
xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour smooth 4
xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour color blue
xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour loadlevels $<span style="color: #dfaf8f;">PWD</span>/ha-contours.lev
xpaset -p $<span style="color: #dfaf8f;">ds9</span> contour yes
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline67" class="outline-4">
<h4 id="orgheadline67"><span class="section-number-4">4.4.3</span> Trying out the spectra display</h4>
<div class="outline-text-4" id="text-4-4-3">
</div><div id="outline-container-orgheadline63" class="outline-5">
<h5 id="orgheadline63"><span class="section-number-5">4.4.3.1</span> Horizontal western slits</h5>
<div class="outline-text-5" id="text-4-4-3-1">
<div class="org-src-container">

<pre class="src src-sh">bash display-vel-spectra.sh YY[01][019]*-ha ha-horiz
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">bash display-vel-spectra.sh YY[01][019]*-nii nii-horiz
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline64" class="outline-5">
<h5 id="orgheadline64"><span class="section-number-5">4.4.3.2</span> Vertical western slits</h5>
<div class="outline-text-5" id="text-4-4-3-2">
<div class="org-src-container">

<pre class="src src-sh">bash display-vel-spectra.sh XX1[56]??-2010-01-*-ha ha-vert
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">bash display-vel-spectra.sh XX1[56]??-2010-01-*-nii nii-vert
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline65" class="outline-5">
<h5 id="orgheadline65"><span class="section-number-5">4.4.3.3</span> LL2 vertical slits</h5>
<div class="outline-text-5" id="text-4-4-3-3">
<p>
Ha line
</p>

<div class="org-src-container">

<pre class="src src-sh">bash display-vel-spectra.sh XX1[12]*-ha ha-ll2
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">bash display-vel-spectra.sh XX1[12]*-nii nii-ll2
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline66" class="outline-5">
<h5 id="orgheadline66"><span class="section-number-5">4.4.3.4</span> More eastern horizontal slits</h5>
<div class="outline-text-5" id="text-4-4-3-4">
<div class="org-src-container">

<pre class="src src-sh">bash display-vel-spectra.sh YY1[234]*-ha ha-east
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">bash display-vel-spectra.sh YY1[234]*-nii nii-east
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline68" class="outline-4">
<h4 id="orgheadline68"><span class="section-number-4">4.4.4</span> Testing passing glob patterns to a shell script</h4>
<div class="outline-text-4" id="text-4-4-4">
<p>
For debugging use <code>-x</code> option to bash and redirect stderr to stout
</p>
<div class="org-src-container">

<pre class="src src-sh">bash -x test-sh-args.sh YY[01][019]*-ha 2&gt;&amp;1
</pre>
</div>

<pre class="example">
++ find /Users/will/Dropbox/OrionWest/Calibrated/BGsub -name 'YY[01][019]*-ha-vhel.fits'
+ files='/Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY0936-2013-02-165-ha-vhel.fits
/Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY0955-2013-02-169-ha-vhel.fits
/Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY0971-2013-02-237-ha-vhel.fits
/Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1000-2013-02-232-ha-vhel.fits
/Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1019-2013-02-226-ha-vhel.fits
/Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1058-2013-02-149-ha-vhel.fits
/Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1068-2013-02-154-ha-vhel.fits
/Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1085-2013-02-159-ha-vhel.fits
/Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1112-2013-02-033-ha-vhel.fits
/Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1120-2013-02-029-ha-vhel.fits'
+ for f in '$files'
+ ls -l /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY0936-2013-02-165-ha-vhel.fits
-rw-r--r--@ 1 will  staff  763200 Oct  1 13:27 /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY0936-2013-02-165-ha-vhel.fits
+ for f in '$files'
+ ls -l /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY0955-2013-02-169-ha-vhel.fits
-rw-r--r--@ 1 will  staff  763200 Oct  1 13:27 /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY0955-2013-02-169-ha-vhel.fits
+ for f in '$files'
+ ls -l /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY0971-2013-02-237-ha-vhel.fits
-rw-r--r--@ 1 will  staff  763200 Oct  1 13:27 /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY0971-2013-02-237-ha-vhel.fits
+ for f in '$files'
+ ls -l /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1000-2013-02-232-ha-vhel.fits
-rw-r--r--@ 1 will  staff  763200 Oct  1 13:27 /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1000-2013-02-232-ha-vhel.fits
+ for f in '$files'
+ ls -l /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1019-2013-02-226-ha-vhel.fits
-rw-r--r--@ 1 will  staff  763200 Oct  1 13:27 /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1019-2013-02-226-ha-vhel.fits
+ for f in '$files'
+ ls -l /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1058-2013-02-149-ha-vhel.fits
-rw-r--r--@ 1 will  staff  763200 Oct  1 13:27 /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1058-2013-02-149-ha-vhel.fits
+ for f in '$files'
+ ls -l /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1068-2013-02-154-ha-vhel.fits
-rw-r--r--@ 1 will  staff  763200 Oct  1 13:27 /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1068-2013-02-154-ha-vhel.fits
+ for f in '$files'
+ ls -l /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1085-2013-02-159-ha-vhel.fits
-rw-r--r--@ 1 will  staff  763200 Oct  1 13:27 /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1085-2013-02-159-ha-vhel.fits
+ for f in '$files'
+ ls -l /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1112-2013-02-033-ha-vhel.fits
-rw-r--r--@ 1 will  staff  763200 Oct  1 13:27 /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1112-2013-02-033-ha-vhel.fits
+ for f in '$files'
+ ls -l /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1120-2013-02-029-ha-vhel.fits
-rw-r--r--@ 1 will  staff  763200 Oct  1 13:27 /Users/will/Dropbox/OrionWest/Calibrated/BGsub/YY1120-2013-02-029-ha-vhel.fits
</pre>
</div>
</div>




<div id="outline-container-orgheadline69" class="outline-4">
<h4 id="orgheadline69"><span class="section-number-4">4.4.5</span> Earlier stuff</h4>
<div class="outline-text-4" id="text-4-4-5">
<p>
Western vertical slits
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #b9d3ee;">for</span> f<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">PWD</span>/Calibrated/BGsub/XX1[56]??-2010-01-*-ha-vhel.fits; <span style="color: #b9d3ee;">do</span>
    xpaset -p ds9 frame new
    xpaset -p ds9 fits $<span style="color: #dfaf8f;">f</span>
<span style="color: #b9d3ee;">done</span>
xpaset -p ds9 zoom to fit
xpaset -p ds9 match frame wcs
</pre>
</div>

<p>
Western horizontal slits
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #b9d3ee;">for</span> f<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">PWD</span>/Calibrated/BGsub/YY{09,10,11}*-nii-vhel.fits; <span style="color: #b9d3ee;">do</span>
    xpaset -p ds9 frame new
    xpaset -p ds9 fits $<span style="color: #dfaf8f;">f</span>
    xpaset -p ds9 zoom to 3 1
    xpaset -p ds9 grid load $<span style="color: #dfaf8f;">PWD</span>/horizontal-axes.grd
    xpaset -p ds9 cmap bb
    xpaset -p ds9 scale limits -0.0003 0.05
    xpaset -p ds9 contour loadlevels $<span style="color: #dfaf8f;">PWD</span>/ha-contours.lev
    xpaset -p ds9 contour yes
    xpaset -p ds9 contour color blue
<span style="color: #b9d3ee;">done</span>
xpaset -p ds9 match frame wcs
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaget ds9 cmap
</pre>
</div>

<pre class="example">
bb
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline88" class="outline-2">
<h2 id="orgheadline88"><span class="section-number-2">5</span> <span class="todo TODO">TODO</span> New version of spectral map</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-orgheadline74" class="outline-3">
<h3 id="orgheadline74"><span class="section-number-3">5.1</span> Convert wavelengths to velocities</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>The main difficulty here is calculating the heliocentric correction
<ul class="org-ul">
<li>I had to install pyslalib from github</li>
<li>The observatory ID for the SPM 2m telescope is 'SANPM83'</li>
</ul></li>
</ul>
</div>

<div id="outline-container-orgheadline72" class="outline-4">
<h4 id="orgheadline72"><span class="section-number-4">5.1.1</span> Module to find heliocentric correction: helio_utils.py</h4>
<div class="outline-text-4" id="text-5-1-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy <span style="color: #b9d3ee;">import</span> coordinates <span style="color: #b9d3ee;">as</span> coord
<span style="color: #b9d3ee;">from</span> astropy <span style="color: #b9d3ee;">import</span> units <span style="color: #b9d3ee;">as</span> u
<span style="color: #b9d3ee;">from</span> astropy <span style="color: #b9d3ee;">import</span> constants <span style="color: #b9d3ee;">as</span> const
<span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS
<span style="color: #b9d3ee;">from</span> pyslalib.slalib <span style="color: #b9d3ee;">import</span> sla_dcs2c, sla_evp, sla_rverot, sla_obs

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">ra_dec_from_header</span>(hdr):
    <span style="color: #dfaf8f;">ra</span> = coord.Longitude(hdr[<span style="color: #eee8aa; font-style: italic;">'RA'</span>], u.hour)
    <span style="color: #dfaf8f;">dec</span> = coord.Latitude(hdr[<span style="color: #eee8aa; font-style: italic;">'DEC'</span>], u.deg)
    <span style="color: #b9d3ee;">return</span> ra, dec

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">ra_dec_from_header_wcs</span>(hdr):
    <span style="color: #dfaf8f;">w</span> = WCS(hdr, key=<span style="color: #eee8aa; font-style: italic;">'A'</span>).celestial
    <span style="color: #dfaf8f;">ra</span> = coord.Longitude(w.wcs.crval[0], u.deg)
    <span style="color: #dfaf8f;">dec</span> = coord.Latitude(w.wcs.crval[1], u.deg)
    <span style="color: #b9d3ee;">return</span> ra, dec

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">mjd_from_header</span>(hdr):
    <span style="color: #b9d3ee;">return</span> <span style="color: #DCDCCC; font-weight: bold;">float</span>(hdr.get(<span style="color: #eee8aa; font-style: italic;">'MJD-OBS'</span>))

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">obs_lat_SPM</span>():
    <span style="color: #dfaf8f;">obs_id</span>, <span style="color: #dfaf8f;">obs_name</span>, <span style="color: #dfaf8f;">obs_long</span>, <span style="color: #dfaf8f;">obs_lat</span>, <span style="color: #dfaf8f;">obs_height</span> = sla_obs(0, <span style="color: #eee8aa; font-style: italic;">"SANPM83"</span>)
    <span style="color: #b9d3ee;">return</span> coord.Latitude(obs_lat, u.radian)

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">st_from_header</span>(hdr):
    <span style="color: #b9d3ee;">return</span> coord.Longitude(hdr[<span style="color: #eee8aa; font-style: italic;">'ST'</span>], u.hour)

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">helio_topo_from_header</span>(hdr):
    <span style="color: #dfaf8f;">ra</span>, <span style="color: #dfaf8f;">dec</span> = ra_dec_from_header_wcs(hdr)
    <span style="color: #dfaf8f;">mjd</span> = mjd_from_header(hdr)
    <span style="color: #dfaf8f;">st</span> = st_from_header(hdr)
    <span style="color: #dfaf8f;">obs_lat</span> = obs_lat_SPM()
    <span style="color: #b9d3ee;">return</span> helio_topo_correction(ra, dec, mjd, st, obs_lat)

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">helio_topo_correction</span>(ra, dec, mjd, st, obs_lat):
    <span style="color: #eee8aa; font-style: italic;">"""Find radial velocity correction in km/s due to transformation</span>
<span style="color: #eee8aa; font-style: italic;">    between topocentric and heliocentric frame.  Positive when</span>
<span style="color: #eee8aa; font-style: italic;">    observatory is moving away from source in heliocentric frame.</span>

<span style="color: #eee8aa; font-style: italic;">    Parameters</span>
<span style="color: #eee8aa; font-style: italic;">    ----------</span>
<span style="color: #eee8aa; font-style: italic;">    ra : :class:`~astropy.coordinates.Longitude` </span>
<span style="color: #eee8aa; font-style: italic;">        Right ascension of source</span>
<span style="color: #eee8aa; font-style: italic;">    dec : :class:`~astropy.coordinates.Latitude` </span>
<span style="color: #eee8aa; font-style: italic;">        Declination of source</span>
<span style="color: #eee8aa; font-style: italic;">    mjd : float</span>
<span style="color: #eee8aa; font-style: italic;">        Modified Julian Date of observation</span>
<span style="color: #eee8aa; font-style: italic;">    st : :class:`~astropy.coordinates.Angle`</span>
<span style="color: #eee8aa; font-style: italic;">        Sideral Time of observation</span>
<span style="color: #eee8aa; font-style: italic;">    obs_lat : :class:`~astropy.coordinates.Latitude` </span>
<span style="color: #eee8aa; font-style: italic;">        Latitude of observatory</span>

<span style="color: #eee8aa; font-style: italic;">    """</span>
    <span style="color: #b9d3ee;">return</span> helio_geo_correction(ra, dec, mjd, st) + geo_topo_correction(ra, dec, st, obs_lat)

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">helio_geo_correction</span>(ra, dec, mjd, st):
    <span style="color: #eee8aa; font-style: italic;">"""Motion of earth's center in heliocentric frame"""</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">line-of-sight unit vector to astronomical object</span>
    <span style="color: #dfaf8f;">k_los</span> = sla_dcs2c(ra.radian, dec.radian)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Velocity and position of earth in barycentric and heliocentric frames</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Units are AU and AU/s</span>
    <span style="color: #dfaf8f;">vel_bary</span>, <span style="color: #dfaf8f;">pos_bary</span>, <span style="color: #dfaf8f;">vel_hel</span>, <span style="color: #dfaf8f;">pos_hel</span> = sla_evp(mjd, 2000.0)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Radial velocity correction (km/s) due to helio-geocentric transformation  </span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Positive when earth is moving away from object</span>
    <span style="color: #b9d3ee;">return</span> u.AU.to(u.km, -np.dot(vel_hel, k_los))

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">geo_topo_correction</span>(ra, dec, st, obs_lat):
    <span style="color: #eee8aa; font-style: italic;">"""Motion of telescope in geocentric frame"""</span>
    <span style="color: #b9d3ee;">return</span> sla_rverot(obs_lat.radian, ra.radian, dec.radian, st.radian)


<span style="color: #dfaf8f;">LIGHT_SPEED_KMS</span> = const.c.to(<span style="color: #eee8aa; font-style: italic;">'km/s'</span>).value
<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">vels2waves</span>(vels, restwav, hdr):
    <span style="color: #eee8aa; font-style: italic;">"""Heliocentric radial velocity (in km/s) to observed wavelength (in</span>
<span style="color: #eee8aa; font-style: italic;">    m, or whatever units restwav is in)</span>

<span style="color: #eee8aa; font-style: italic;">    """</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Heliocentric correction</span>
    <span style="color: #dfaf8f;">vels</span> = np.array(vels) + helio_topo_from_header(hdr)
    <span style="color: #dfaf8f;">waves</span> = restwav*(1.0 + vels/LIGHT_SPEED_KMS)
    <span style="color: #b9d3ee;">return</span> waves


<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">waves2vels</span>(waves, restwav, hdr):
    <span style="color: #eee8aa; font-style: italic;">"""Observed wavelength to Heliocentric radial velocity (in m/s) </span>

<span style="color: #eee8aa; font-style: italic;">    """</span>
    <span style="color: #dfaf8f;">vels</span> = const.c*(waves - restwav)/restwav
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Heliocentric correction</span>
    <span style="color: #dfaf8f;">vels</span> -= helio_topo_from_header(hdr)*u.km/u.s

    <span style="color: #b9d3ee;">return</span> vels
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline73" class="outline-4">
<h4 id="orgheadline73"><span class="section-number-4">5.1.2</span> Script to test obtaining heliocentric correction from spectrum headers</h4>
<div class="outline-text-4" id="text-5-1-2">
<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock8"><span style="color: #b9d3ee;">import</span> glob
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> helio_utils <span style="color: #b9d3ee;">import</span> helio_topo_from_header
<span style="color: #dfaf8f;">outtab</span> = [[<span style="color: #eee8aa; font-style: italic;">'File'</span>, <span style="color: #eee8aa; font-style: italic;">'Date'</span>, <span style="color: #eee8aa; font-style: italic;">'JD'</span>, <span style="color: #eee8aa; font-style: italic;">'ST'</span>, <span style="color: #eee8aa; font-style: italic;">'RA'</span>, <span style="color: #eee8aa; font-style: italic;">'Dec'</span>, <span style="color: #eee8aa; font-style: italic;">'Helio'</span>], <span style="color: #cFfBcF;">None</span>]
<span style="color: #dfaf8f;">speclist</span> = glob.glob(<span style="color: #eee8aa; font-style: italic;">'Calibrated/*-ha.fits'</span>)
<span style="color: #b9d3ee;">for</span> fn <span style="color: #b9d3ee;">in</span> speclist:
    <span style="color: #dfaf8f;">hdr</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(fn)[0].header
    <span style="color: #dfaf8f;">id_</span> = fn.split(<span style="color: #eee8aa; font-style: italic;">'/'</span>)[-1].split(<span style="color: #eee8aa; font-style: italic;">'.'</span>)[0]
    outtab.append([id_, hdr.get(<span style="color: #eee8aa; font-style: italic;">'DATE-OBS'</span>),
                   hdr.get(<span style="color: #eee8aa; font-style: italic;">'MJD-OBS'</span>) <span style="color: #b9d3ee;">or</span> hdr.get(<span style="color: #eee8aa; font-style: italic;">'JD'</span>),
                   hdr.get(<span style="color: #eee8aa; font-style: italic;">'ST'</span>), hdr.get(<span style="color: #eee8aa; font-style: italic;">'RA'</span>), hdr.get(<span style="color: #eee8aa; font-style: italic;">'DEC'</span>),
                   <span style="color: #eee8aa; font-style: italic;">'{:.2f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(helio_topo_from_header(hdr))
    ])
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline57" class="outline-3">
<h3 id="orgheadline57"><a id="ID-20ADFA6F-DE49-454E-B433-D684CF3FB826"></a><span class="section-number-3">5.2</span> Program to generate spectral map: spectral-map.py</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li>This based on previous versions for the <a href="#orgheadline5">vertical</a> and <a href="#orgheadline6">horizontal</a> slits</li>
<li>We will start off with bigger pixels and same pixel dims, so bigger area</li>
<li>It is much more general than the earlier versions since the spectra are already flux-calibrated and all the WCS info comes from the spectrum files themselves, instead of from tables</li>
<li>It is also much simpler and more efficient:</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-22 Tue] </span></span> Now extracts a 7 Angstrom window around each line</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-23 Wed] </span></span> Now cuts off vignetted sections at ends of slit</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> glob
<span style="color: #b9d3ee;">import</span> sys
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS
<span style="color: #b9d3ee;">from</span> astropy.wcs.utils <span style="color: #b9d3ee;">import</span> pixel_to_skycoord, skycoord_to_pixel
<span style="color: #b9d3ee;">import</span> astropy.units <span style="color: #b9d3ee;">as</span> u
<span style="color: #b9d3ee;">from</span> helio_utils <span style="color: #b9d3ee;">import</span> helio_topo_from_header, vels2waves

<span style="color: #b9d3ee;">if</span> <span style="color: #DCDCCC; font-weight: bold;">len</span>(sys.argv) == 3:
    <span style="color: #dfaf8f;">line_id</span> = sys.argv[1]
    <span style="color: #dfaf8f;">vrange</span> = sys.argv[2]
<span style="color: #b9d3ee;">elif</span> <span style="color: #DCDCCC; font-weight: bold;">len</span>(sys.argv) == 2:
    <span style="color: #dfaf8f;">line_id</span> = sys.argv[1]
    <span style="color: #dfaf8f;">vrange</span> = <span style="color: #cFfBcF;">None</span>
<span style="color: #b9d3ee;">else</span>:
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Usage: {} LINE_ID [VRANGE]'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(sys.argv[0]))

<span style="color: #b9d3ee;">def</span> <span style="color: #cccccc;">waves2pixels</span>(waves, w):
    <span style="color: #dfaf8f;">n</span> = <span style="color: #DCDCCC; font-weight: bold;">len</span>(waves)
    <span style="color: #dfaf8f;">pixels</span>, <span style="color: #dfaf8f;">_</span>, <span style="color: #dfaf8f;">_</span> = w.all_world2pix(waves, [0]*n, [0]*n, 0)
    <span style="color: #b9d3ee;">return</span> pixels

<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">First set up WCS for the output image</span>
<span style="color: #5F7F5F;">#</span>
<span style="color: #dfaf8f;">pixel_scale</span> = 0.5               <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">arcsec</span>
<span style="color: #dfaf8f;">NX</span>, <span style="color: #dfaf8f;">NY</span> = 2048, 2048
<span style="color: #dfaf8f;">dRA</span>, <span style="color: #dfaf8f;">dDec</span> = -pixel_scale/3600., pixel_scale/3600.
<span style="color: #dfaf8f;">RA0</span>, <span style="color: #dfaf8f;">Dec0</span> = 83.69, -5.429
<span style="color: #dfaf8f;">w</span> = WCS(naxis=2)
<span style="color: #dfaf8f;">w.wcs.crpix</span> = [0.5*(1 + NX), 0.5*(1 + NY)]
<span style="color: #dfaf8f;">w.wcs.cdelt</span> = [dRA, dDec]
<span style="color: #dfaf8f;">w.wcs.crval</span> = [RA0, Dec0]
<span style="color: #dfaf8f;">w.wcs.ctype</span> = [<span style="color: #eee8aa; font-style: italic;">'RA---TAN'</span>, <span style="color: #eee8aa; font-style: italic;">'DEC--TAN'</span>]
<span style="color: #dfaf8f;">w.wcs.cunit</span> = [<span style="color: #eee8aa; font-style: italic;">'deg'</span>, <span style="color: #eee8aa; font-style: italic;">'deg'</span>]

<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Arrays to hold the output image</span>
<span style="color: #dfaf8f;">outimage</span> = np.zeros((NY, NX))
<span style="color: #dfaf8f;">outweights</span> = np.zeros((NY, NX))

<span style="color: #dfaf8f;">slit_width</span> = 2.0                <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">width in arcsec of 150 micron slit</span>
<span style="color: #dfaf8f;">slit_pix_width</span> = slit_width/pixel_scale

<span style="color: #dfaf8f;">speclist</span> = glob.glob(<span style="color: #eee8aa; font-style: italic;">'Calibrated/BGsub/*-{}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(line_id))

<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Window widths for line and BG</span>
<span style="color: #dfaf8f;">dwline</span> = 7.0*u.Angstrom

<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Limits of non-vignetted portion of the slit</span>
<span style="color: #dfaf8f;">good_pixels</span> = {
    <span style="color: #eee8aa; font-style: italic;">'2006-02'</span>: (5, <span style="color: #cFfBcF;">None</span>),
    <span style="color: #eee8aa; font-style: italic;">'2007-01'</span>: (10, <span style="color: #cFfBcF;">None</span>),
    <span style="color: #eee8aa; font-style: italic;">'2010-01'</span>: (10, <span style="color: #cFfBcF;">None</span>),
    <span style="color: #eee8aa; font-style: italic;">'2013-02'</span>: (<span style="color: #cFfBcF;">None</span>, -20),
    <span style="color: #eee8aa; font-style: italic;">'2013-12'</span>: (<span style="color: #cFfBcF;">None</span>, -10),
    <span style="color: #eee8aa; font-style: italic;">'2015-02-0003'</span>: (<span style="color: #cFfBcF;">None</span>, -80),
    <span style="color: #eee8aa; font-style: italic;">'2015-02-0012'</span>: (<span style="color: #cFfBcF;">None</span>, -15),
}

<span style="color: #b9d3ee;">for</span> fn <span style="color: #b9d3ee;">in</span> speclist:
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Processing'</span>, fn)
    spechdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(fn)
    <span style="color: #dfaf8f;">wspec</span> = WCS(spechdu.header, key=<span style="color: #eee8aa; font-style: italic;">'A'</span>)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Trim to good portion of the slit</span>
    <span style="color: #dfaf8f;">goodslice</span> = <span style="color: #DCDCCC; font-weight: bold;">slice</span>(<span style="color: #cFfBcF;">None</span>, <span style="color: #cFfBcF;">None</span>)
    <span style="color: #b9d3ee;">for</span> k, v <span style="color: #b9d3ee;">in</span> good_pixels.items():
        <span style="color: #b9d3ee;">if</span> k <span style="color: #b9d3ee;">in</span> fn:
            <span style="color: #dfaf8f;">goodslice</span> = <span style="color: #DCDCCC; font-weight: bold;">slice</span>(*v)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find per-slit weight</span>
    <span style="color: #dfaf8f;">slit_weight</span> = spechdu.header[<span style="color: #eee8aa; font-style: italic;">'WEIGHT'</span>]

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find sign of delta wavelength</span>
    <span style="color: #dfaf8f;">dwav</span> = wspec.wcs.get_cdelt()[0]*wspec.wcs.get_pc()[0, 0]
    <span style="color: #dfaf8f;">sgn</span> = np.sign(dwav)         <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Need to take slices backwards if this is negative</span>

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Eliminate degenerate 3rd dimension from data array and trim off bad bits</span>
    <span style="color: #dfaf8f;">spec2d</span> = spechdu.data[0]

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Rest wavelength from FITS header is in meters</span>
    <span style="color: #dfaf8f;">wavrest</span> = wspec.wcs.restwav*u.m

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find wavelength limits for line extraction window</span>
    <span style="color: #b9d3ee;">if</span> vrange <span style="color: #b9d3ee;">is</span> <span style="color: #cFfBcF;">None</span>:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Original case: use a window of wavelength full width dwline</span>
        <span style="color: #dfaf8f;">waves</span> =  wavrest + np.array([-0.5, 0.5])*dwline
    <span style="color: #b9d3ee;">else</span>:
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Extract velocity limits from the vrange command line argument</span>
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">vrange should be of a form like '-100+100' or '+020+030'</span>
        <span style="color: #dfaf8f;">v1</span>, <span style="color: #dfaf8f;">v2</span> = <span style="color: #DCDCCC; font-weight: bold;">float</span>(vrange[:4]), <span style="color: #DCDCCC; font-weight: bold;">float</span>(vrange[-4:])
        <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Velocity window:'</span>, v1, <span style="color: #eee8aa; font-style: italic;">'to'</span>, v2)
        <span style="color: #dfaf8f;">waves</span> = vels2waves([v1, v2], wavrest,  spechdu.header)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Wavelength window: {:.2f} to {:.2f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(*waves.to(u.Angstrom)))

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find pixel indices for line extraction window</span>
    <span style="color: #dfaf8f;">i1</span>, <span style="color: #dfaf8f;">i2</span> = waves2pixels(waves, wspec)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Pixel window:'</span>, i1, <span style="color: #eee8aa; font-style: italic;">'to'</span>, i2)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Extract profile for this wavelength or velocity window</span>
    <span style="color: #dfaf8f;">profile</span> = spec2d[:, i1:i2:sgn].<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=-1)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find celestial coordinates for each pixel along the slit</span>
    <span style="color: #dfaf8f;">NS</span> = <span style="color: #DCDCCC; font-weight: bold;">len</span>(profile)
    <span style="color: #dfaf8f;">slit_coords</span> = pixel_to_skycoord(<span style="color: #DCDCCC; font-weight: bold;">range</span>(NS), [0]*NS, wspec, 0)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Trim off bad parts of slit</span>
    <span style="color: #dfaf8f;">profile</span> = profile[goodslice]
    <span style="color: #dfaf8f;">slit_coords</span> = slit_coords[goodslice]

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Convert to pixel coordinates in output image</span>
    <span style="color: #dfaf8f;">xp</span>, <span style="color: #dfaf8f;">yp</span> = skycoord_to_pixel(slit_coords, w, 0)

    <span style="color: #b9d3ee;">for</span> x, y, bright <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">zip</span>(xp, yp, profile):
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find output pixels corresponding to corners of slit pixel</span>
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">(approximate as square)</span>
        <span style="color: #dfaf8f;">i1</span> = <span style="color: #DCDCCC; font-weight: bold;">int</span>(0.5 + x - slit_pix_width/2)
        <span style="color: #dfaf8f;">i2</span> = <span style="color: #DCDCCC; font-weight: bold;">int</span>(0.5 + x + slit_pix_width/2)
        <span style="color: #dfaf8f;">j1</span> = <span style="color: #DCDCCC; font-weight: bold;">int</span>(0.5 + y - slit_pix_width/2)
        <span style="color: #dfaf8f;">j2</span> = <span style="color: #DCDCCC; font-weight: bold;">int</span>(0.5 + y + slit_pix_width/2)
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Make sure we don't go outside the output grid</span>
        <span style="color: #dfaf8f;">i1</span>, <span style="color: #dfaf8f;">i2</span> = <span style="color: #DCDCCC; font-weight: bold;">max</span>(0, i1), <span style="color: #DCDCCC; font-weight: bold;">max</span>(0, i2)
        <span style="color: #dfaf8f;">i1</span>, <span style="color: #dfaf8f;">i2</span> = <span style="color: #DCDCCC; font-weight: bold;">min</span>(NX, i1), <span style="color: #DCDCCC; font-weight: bold;">min</span>(NX, i2)
        <span style="color: #dfaf8f;">j1</span>, <span style="color: #dfaf8f;">j2</span> = <span style="color: #DCDCCC; font-weight: bold;">max</span>(0, j1), <span style="color: #DCDCCC; font-weight: bold;">max</span>(0, j2)
        <span style="color: #dfaf8f;">j1</span>, <span style="color: #dfaf8f;">j2</span> = <span style="color: #DCDCCC; font-weight: bold;">min</span>(NY, j1), <span style="color: #DCDCCC; font-weight: bold;">min</span>(NY, j2)
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Fill in the square</span>
        <span style="color: #dfaf8f;">outimage</span>[j1:j2, i1:i2] += bright*slit_weight
        <span style="color: #dfaf8f;">outweights</span>[j1:j2, i1:i2] += slit_weight

<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Save everything as different images in a single fits file:</span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">1. The sum of the raw slits </span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">2. The weights</span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">3. The slits normalized by the weights</span>
<span style="color: #b9d3ee;">if</span> vrange <span style="color: #b9d3ee;">is</span> <span style="color: #cFfBcF;">None</span>:
    <span style="color: #dfaf8f;">label</span> = line_id + <span style="color: #eee8aa; font-style: italic;">'-allvels'</span>
<span style="color: #b9d3ee;">else</span>:
    <span style="color: #dfaf8f;">label</span> = line_id + vrange

fits.HDUList([
    fits.PrimaryHDU(),
    fits.ImageHDU(header=w.to_header(), data=outimage, name=<span style="color: #eee8aa; font-style: italic;">'slits'</span>),
    fits.ImageHDU(header=w.to_header(), data=outweights, name=<span style="color: #eee8aa; font-style: italic;">'weight'</span>),
    fits.ImageHDU(header=w.to_header(), data=outimage/outweights, name=<span style="color: #eee8aa; font-style: italic;">'scaled'</span>),
    ]).writeto(<span style="color: #eee8aa; font-style: italic;">'new-slits-{}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(label), clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline75" class="outline-3">
<h3 id="orgheadline75"><span class="section-number-3">5.3</span> Run spectral-map.py for the nii or ha spectra</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">

<pre class="src src-sh">python spectral-map.py ha
</pre>
</div>

<pre class="example">
Processing Calibrated/2006-02-260-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2006-02-270-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2006-02-276-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2006-02-281-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2006-02-286-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2006-02-291-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2006-02-296-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2006-02-303-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2006-02-313-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2006-02-318-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2006-02-326-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 29.4842762305 to 189.47647283
Processing Calibrated/2007-01-054-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2007-01-067-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2007-01-072-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2007-01b-2037-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2007-01b-2041-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2007-01b-2045-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2007-01b-2049-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2007-01b-2053-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2007-01b-2057-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2007-01b-2061-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-078-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-124-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-128-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-133-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-137-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-145-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-157-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-202-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-206-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-210-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-214-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-219-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-236-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-240-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-244-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-248-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2010-01-252-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-024-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-029-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-033-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-149-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-154-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-159-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-165-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-169-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-226-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-232-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-02-237-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 52.3403043162 to 212.332500916
Processing Calibrated/2013-12-086-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 75.1963324019 to 235.188529002
Processing Calibrated/2013-12-090-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 75.1963324019 to 235.188529002
Processing Calibrated/2013-12-102-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 75.1963324019 to 235.188529002
Processing Calibrated/2013-12-111-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 75.1963324019 to 235.188529002
Processing Calibrated/2013-12-116-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 75.1963324019 to 235.188529002
Processing Calibrated/2015-02-0003-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 12.4518606084 to 134.322989897
Processing Calibrated/2015-02-0012-ha.fits
Wavelength window: 6559.29 Angstrom to 6566.29 Angstrom
Pixel window: 13.2364321915 to 135.385683307
</pre>

<div class="org-src-container">

<pre class="src src-sh">python spectral-map.py nii
</pre>
</div>

<pre class="example">
Processing Calibrated/2006-02-260-nii.fits
Processing Calibrated/2006-02-270-nii.fits
Processing Calibrated/2006-02-276-nii.fits
Processing Calibrated/2006-02-281-nii.fits
Processing Calibrated/2006-02-286-nii.fits
Processing Calibrated/2006-02-291-nii.fits
Processing Calibrated/2006-02-296-nii.fits
Processing Calibrated/2006-02-303-nii.fits
Processing Calibrated/2006-02-313-nii.fits
Processing Calibrated/2006-02-318-nii.fits
Processing Calibrated/2006-02-326-nii.fits
Processing Calibrated/2007-01-054-nii.fits
Processing Calibrated/2007-01-067-nii.fits
Processing Calibrated/2007-01-072-nii.fits
Processing Calibrated/2007-01b-2037-nii.fits
Processing Calibrated/2007-01b-2041-nii.fits
Processing Calibrated/2007-01b-2045-nii.fits
Processing Calibrated/2007-01b-2049-nii.fits
Processing Calibrated/2007-01b-2053-nii.fits
Processing Calibrated/2007-01b-2057-nii.fits
Processing Calibrated/2007-01b-2061-nii.fits
Processing Calibrated/2010-01-078-nii.fits
Processing Calibrated/2010-01-124-nii.fits
Processing Calibrated/2010-01-128-nii.fits
Processing Calibrated/2010-01-133-nii.fits
Processing Calibrated/2010-01-137-nii.fits
Processing Calibrated/2010-01-145-nii.fits
Processing Calibrated/2010-01-157-nii.fits
Processing Calibrated/2010-01-202-nii.fits
Processing Calibrated/2010-01-206-nii.fits
Processing Calibrated/2010-01-210-nii.fits
Processing Calibrated/2010-01-214-nii.fits
Processing Calibrated/2010-01-219-nii.fits
Processing Calibrated/2010-01-236-nii.fits
Processing Calibrated/2010-01-240-nii.fits
Processing Calibrated/2010-01-244-nii.fits
Processing Calibrated/2010-01-248-nii.fits
Processing Calibrated/2010-01-252-nii.fits
Processing Calibrated/2013-02-024-nii.fits
Processing Calibrated/2013-02-029-nii.fits
Processing Calibrated/2013-02-033-nii.fits
Processing Calibrated/2013-02-149-nii.fits
Processing Calibrated/2013-02-154-nii.fits
Processing Calibrated/2013-02-159-nii.fits
Processing Calibrated/2013-02-165-nii.fits
Processing Calibrated/2013-02-169-nii.fits
Processing Calibrated/2013-02-226-nii.fits
Processing Calibrated/2013-02-232-nii.fits
Processing Calibrated/2013-02-237-nii.fits
Processing Calibrated/2013-12-086-nii.fits
Processing Calibrated/2013-12-090-nii.fits
Processing Calibrated/2013-12-102-nii.fits
Processing Calibrated/2013-12-111-nii.fits
Processing Calibrated/2013-12-116-nii.fits
Processing Calibrated/2015-02-0003-nii.fits
Processing Calibrated/2015-02-0012-nii.fits
</pre>


<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">redranges</span>=<span style="color: #eee8aa; font-style: italic;">'+030+050 +010+030 -010+010'</span>
<span style="color: #dfaf8f;">blueranges</span>=<span style="color: #eee8aa; font-style: italic;">'-030-010 -050-030 -070-050'</span>
<span style="color: #dfaf8f;">farblueranges</span>=<span style="color: #eee8aa; font-style: italic;">'-090-070 -110-090 -130-110'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">redranges</span> $<span style="color: #dfaf8f;">blueranges</span> $<span style="color: #dfaf8f;">farblueranges</span>; <span style="color: #b9d3ee;">do</span>
    python spectral-map.py ha $<span style="color: #dfaf8f;">vrange</span>
    python spectral-map.py nii $<span style="color: #dfaf8f;">vrange</span>
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+030+050.fits[3]
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+010+030.fits[3]
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-010+010.fits[3]
</pre>
</div>

<p>
Try three wide bands that cover the whole line
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">widebands</span>=<span style="color: #eee8aa; font-style: italic;">'+000+060 -060+000 -120-060'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">widebands</span>; <span style="color: #b9d3ee;">do</span>
    python spectral-map.py ha $<span style="color: #dfaf8f;">vrange</span>
    python spectral-map.py nii $<span style="color: #dfaf8f;">vrange</span>
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<p>
Some ranges further to the red
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">nearredranges</span>=<span style="color: #eee8aa; font-style: italic;">'+050+070 +070+090 +090+110'</span>
<span style="color: #dfaf8f;">farredranges</span>=<span style="color: #eee8aa; font-style: italic;">'+110+130 +130+150 +150+170'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">nearredranges</span> $<span style="color: #dfaf8f;">farredranges</span> ; <span style="color: #b9d3ee;">do</span>
    python spectral-map.py ha $<span style="color: #dfaf8f;">vrange</span>
    python spectral-map.py nii $<span style="color: #dfaf8f;">vrange</span>
<span style="color: #b9d3ee;">done</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline76" class="outline-3">
<h3 id="orgheadline76"><span class="section-number-3">5.4</span> Program to do multigridding of new spectral maps: multibin-map.py</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> sys
sys.path.append(<span style="color: #eee8aa; font-style: italic;">'/Users/will/Work/RubinWFC3/Tsquared'</span>)
<span style="color: #b9d3ee;">from</span> rebin_utils <span style="color: #b9d3ee;">import</span> downsample, oversample
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits

<span style="color: #dfaf8f;">nlist</span> = [1, 2, 4, 8, 16, 32, 64]
<span style="color: #dfaf8f;">mingoods</span> = [2, 2, 2, 1, 1, 1, 2]

<span style="color: #b9d3ee;">try</span>: 
    <span style="color: #dfaf8f;">infile</span> = sys.argv[1]
<span style="color: #b9d3ee;">except</span>:
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Usage:'</span>, sys.argv[0], <span style="color: #eee8aa; font-style: italic;">'FITSFILE'</span>)
    sys.<span style="color: #cFfBcF;">exit</span>()

<span style="color: #dfaf8f;">hdulist</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(infile)
<span style="color: #dfaf8f;">hdr</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>].header
<span style="color: #dfaf8f;">im</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>].data
<span style="color: #dfaf8f;">w</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'weight'</span>].data
<span style="color: #dfaf8f;">m</span> = w &gt; 0.0

<span style="color: #b9d3ee;">for</span> n, mingood <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">zip</span>(nlist, mingoods):
    <span style="color: #dfaf8f;">im</span>[~m] = 0.0
    <span style="color: #dfaf8f;">outfile</span> = infile.replace(<span style="color: #eee8aa; font-style: italic;">'.fits'</span>, <span style="color: #eee8aa; font-style: italic;">'-bin{:03d}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(n))
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Saving'</span>, outfile)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Save both the scaled image and the weights, but at the full resolution</span>
    fits.HDUList([
        fits.PrimaryHDU(),
        fits.ImageHDU(data=oversample(im, n), header=hdr, name=<span style="color: #eee8aa; font-style: italic;">'scaled'</span>),
        fits.ImageHDU(data=oversample(w, n), header=hdr, name=<span style="color: #eee8aa; font-style: italic;">'weight'</span>),
    ]).writeto(outfile, clobber=<span style="color: #cFfBcF;">True</span>)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Now do the rebinning by a factor of two</span>
    [im,], <span style="color: #dfaf8f;">m</span>, <span style="color: #dfaf8f;">w</span> = downsample([im,], m, weights=w, mingood=mingood)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline77" class="outline-3">
<h3 id="orgheadline77"><span class="section-number-3">5.5</span> Perform the multigridding</h3>
<div class="outline-text-3" id="text-5-5">
<div class="org-src-container">

<pre class="src src-sh">python multibin-map.py new-slits-ha-allvels.fits
</pre>
</div>

<pre class="example">
Saving new-slits-ha-allvels-bin001.fits
Saving new-slits-ha-allvels-bin002.fits
Saving new-slits-ha-allvels-bin004.fits
Saving new-slits-ha-allvels-bin008.fits
Saving new-slits-ha-allvels-bin016.fits
Saving new-slits-ha-allvels-bin032.fits
Saving new-slits-ha-allvels-bin064.fits
</pre>

<div class="org-src-container">

<pre class="src src-sh">python multibin-map.py new-slits-nii-allvels.fits
</pre>
</div>

<pre class="example">
Saving new-slits-nii-allvels-bin001.fits
Saving new-slits-nii-allvels-bin002.fits
Saving new-slits-nii-allvels-bin004.fits
Saving new-slits-nii-allvels-bin008.fits
Saving new-slits-nii-allvels-bin016.fits
Saving new-slits-nii-allvels-bin032.fits
Saving new-slits-nii-allvels-bin064.fits
</pre>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-allvels-bin064.fits
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">redranges</span>=<span style="color: #eee8aa; font-style: italic;">'+030+050 +010+030 -010+010'</span>
<span style="color: #dfaf8f;">blueranges</span>=<span style="color: #eee8aa; font-style: italic;">'-030-010 -050-030 -070-050'</span>
<span style="color: #dfaf8f;">farblueranges</span>=<span style="color: #eee8aa; font-style: italic;">'-090-070 -110-090 -130-110'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">redranges</span> $<span style="color: #dfaf8f;">blueranges</span> $<span style="color: #dfaf8f;">farblueranges</span>; <span style="color: #b9d3ee;">do</span>
    python multibin-map.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span>.fits
    python multibin-map.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span>.fits
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=bin004
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+030+050-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+010+030-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-010+010-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">widebands</span>=<span style="color: #eee8aa; font-style: italic;">'+000+060 -060+000 -120-060'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">widebands</span>; <span style="color: #b9d3ee;">do</span>
    python multibin-map.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span>.fits
    python multibin-map.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span>.fits
<span style="color: #b9d3ee;">done</span>
</pre>
</div>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">nearredranges</span>=<span style="color: #eee8aa; font-style: italic;">'+050+070 +070+090 +090+110'</span>
<span style="color: #dfaf8f;">farredranges</span>=<span style="color: #eee8aa; font-style: italic;">'+110+130 +130+150 +150+170'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">nearredranges</span> $<span style="color: #dfaf8f;">farredranges</span>; <span style="color: #b9d3ee;">do</span>
    python multibin-map.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span>.fits
    python multibin-map.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span>.fits
<span style="color: #b9d3ee;">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline78" class="outline-3">
<h3 id="orgheadline78"><span class="section-number-3">5.6</span> <span class="done DONE">DONE</span> Program to combine different grids: multibin-combine.py</h3>
<div class="outline-text-3" id="text-5-6">
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-25 Fri] </span></span> We set minweight = 0 for the coarsest grid so that the spatial coverage at that level does not depend on the line intensity, only on the arrangement of slits.  This is necessary so that all RGB channels have the same coverage when we combine them in a color image.</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-30 Wed] </span></span> But this has the disadvantage that the hig velocity channels where the intensity is very low often do not have enough signal, even in the coarsest bins - so we get noisy rubbish there</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">import</span> sys
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np

<span style="color: #b9d3ee;">try</span>: 
    <span style="color: #dfaf8f;">prefix</span>, <span style="color: #dfaf8f;">minw_scale</span> = sys.argv[1], <span style="color: #DCDCCC; font-weight: bold;">float</span>(sys.argv[2])
<span style="color: #b9d3ee;">except</span>:
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Usage:'</span>, sys.argv[0], <span style="color: #eee8aa; font-style: italic;">'FITSFILE_PREFIX MINIMUM_WEIGHT'</span>)
    sys.<span style="color: #cFfBcF;">exit</span>()

<span style="color: #dfaf8f;">nlist</span> = [1, 2, 4, 8, 16, 32]
<span style="color: #dfaf8f;">minweights</span> = [0.5, 1.0, 2.0, 4.0, 8.0, 8.0]
<span style="color: #dfaf8f;">outim</span> = np.zeros((2048, 2048))
<span style="color: #b9d3ee;">for</span> n, minw <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">reversed</span>(<span style="color: #DCDCCC; font-weight: bold;">list</span>(<span style="color: #DCDCCC; font-weight: bold;">zip</span>(nlist, minweights))):
    <span style="color: #dfaf8f;">fn</span> = <span style="color: #eee8aa; font-style: italic;">'{}-bin{:03d}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(prefix, n)
    <span style="color: #dfaf8f;">hdulist</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(fn)
    <span style="color: #dfaf8f;">im</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>].data
    <span style="color: #dfaf8f;">hdr</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>].header
    <span style="color: #dfaf8f;">w</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'weight'</span>].data
    <span style="color: #dfaf8f;">m</span> = w*im &gt;= minw*minw_scale
    <span style="color: #dfaf8f;">outim</span>[m] = im[m]
fits.PrimaryHDU(header=hdr, data=outim).writeto(prefix + <span style="color: #eee8aa; font-style: italic;">'-multibin.fits'</span>, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline85" class="outline-3">
<h3 id="orgheadline85"><span class="section-number-3">5.7</span> <span class="done DONE">DONE</span> Perform the combining</h3>
<div class="outline-text-3" id="text-5-7">
<div class="org-src-container">

<pre class="src src-sh">python multibin-combine.py new-slits-ha-allvels 3e5
python multibin-combine.py new-slits-nii-allvels 2e5
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-allvels-multibin.fits
</pre>
</div>
</div>

<div id="outline-container-orgheadline79" class="outline-4">
<h4 id="orgheadline79"><span class="section-number-4">5.7.1</span> Wide bands</h4>
<div class="outline-text-4" id="text-5-7-1">
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">vrange</span>=+000+060               <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">wide red</span>
python multibin-combine.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span> 3e5
python multibin-combine.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span> 3e4
<span style="color: #dfaf8f;">vrange</span>=-060+000              <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">wide green</span>
python multibin-combine.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span> 3e4
python multibin-combine.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span> 2e4
<span style="color: #dfaf8f;">vrange</span>=-120-060               <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">wide blue</span>
python multibin-combine.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span> 3e3
python multibin-combine.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span> 2e3
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+000+060-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-060+000-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-120-060-$<span style="color: #dfaf8f;">suff</span>.fits
sleep 2
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii+000+060-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-060+000-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-120-060-$<span style="color: #dfaf8f;">suff</span>.fits
sleep 2
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline80" class="outline-4">
<h4 id="orgheadline80"><span class="section-number-4">5.7.2</span> Line core V = -10 to +50 km/s</h4>
<div class="outline-text-4" id="text-5-7-2">
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">redranges</span>=<span style="color: #eee8aa; font-style: italic;">'+030+050 +010+030 -010+010'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">redranges</span>; <span style="color: #b9d3ee;">do</span>
    python multibin-combine.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span> 3e5
    python multibin-combine.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span> 3e4
<span style="color: #b9d3ee;">done</span>
</pre>
</div>


<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+030+050-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+010+030-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-010+010-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii+030+050-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii+010+030-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-010+010-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline81" class="outline-4">
<h4 id="orgheadline81"><span class="section-number-4">5.7.3</span> Blue flank: V = -70 to -10 km/s</h4>
<div class="outline-text-4" id="text-5-7-3">
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">blueranges</span>=<span style="color: #eee8aa; font-style: italic;">'-030-010 -050-030 -070-050'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">blueranges</span>; <span style="color: #b9d3ee;">do</span>
    python multibin-combine.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span> 3e3
    python multibin-combine.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span> 2e3
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-030-010-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-050-030-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-070-050-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-030-010-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-050-030-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-070-050-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline82" class="outline-4">
<h4 id="orgheadline82"><span class="section-number-4">5.7.4</span> Far blue wing: V = -110 to -70 km/s</h4>
<div class="outline-text-4" id="text-5-7-4">
<p>
We actually calculate out to -130, but we don't use it in the image
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">farblueranges</span>=<span style="color: #eee8aa; font-style: italic;">'-090-070 -110-090 -130-110'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">farblueranges</span>; <span style="color: #b9d3ee;">do</span>
    python multibin-combine.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span> 1000
    python multibin-combine.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span> 1000
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<p>
Instead we overlap with the blue flank above.  The red channel here is the blue channel there
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-070-050-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-090-070-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha-110-090-$<span style="color: #dfaf8f;">suff</span>.fits
sleep 2
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-070-050-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-090-070-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-110-090-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>
</div>
</div>



<div id="outline-container-orgheadline83" class="outline-4">
<h4 id="orgheadline83"><span class="section-number-4">5.7.5</span> Near red flank: V = +50 to +110 km/s</h4>
<div class="outline-text-4" id="text-5-7-5">
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">nearredranges</span>=<span style="color: #eee8aa; font-style: italic;">'+050+070 +070+090 +090+110'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">nearredranges</span>; <span style="color: #b9d3ee;">do</span>
    python multibin-combine.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span> 3e3
    python multibin-combine.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span> 1e3
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+090+110-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+070+090-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+050+070-$<span style="color: #dfaf8f;">suff</span>.fits
sleep 2
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii+090+110-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii+070+090-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii+050+070-$<span style="color: #dfaf8f;">suff</span>.fits
sleep 2
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline84" class="outline-4">
<h4 id="orgheadline84"><span class="section-number-4">5.7.6</span> Far red wing: V = +110 to +170 km/s</h4>
<div class="outline-text-4" id="text-5-7-6">
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">farredranges</span>=<span style="color: #eee8aa; font-style: italic;">'+110+130 +130+150 +150+170'</span>
<span style="color: #b9d3ee;">for</span> vrange<span style="color: #b9d3ee;"> in</span> $<span style="color: #dfaf8f;">farredranges</span>; <span style="color: #b9d3ee;">do</span>
    python multibin-combine.py new-slits-ha$<span style="color: #dfaf8f;">vrange</span> 900
    python multibin-combine.py new-slits-nii$<span style="color: #dfaf8f;">vrange</span> 900
<span style="color: #b9d3ee;">done</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+150+170-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+130+150-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-ha+110+130-$<span style="color: #dfaf8f;">suff</span>.fits
sleep 2
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #dfaf8f;">suff</span>=multibin
xpaset -p ds9 rgb red
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii+150+170-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii+130+150-$<span style="color: #dfaf8f;">suff</span>.fits
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii+110+130-$<span style="color: #dfaf8f;">suff</span>.fits
sleep 2
xpaset -p ds9 frame prev
xpaset -p ds9 match frame wcs
xpaset -p ds9 frame next
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline86" class="outline-3">
<h3 id="orgheadline86"><span class="section-number-3">5.8</span> <span class="done DONE">DONE</span> Calculate [N II]/Ha ratio and [N II] + Ha sum</h3>
<div class="outline-text-3" id="text-5-8">
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-09-16 Wed] </span></span> I suspect that much of the remaining issues with the spectra calibration are down to variations in throughput between [N II] and Ha</li>
<li class="on"><code>[X]</code> We can use the O'Dell &amp; Harris spectrophotometry to tie everything down
<ul class="org-ul">
<li>DS9 region file of the slits <a href="file:///Users/will/Work/RubinWFC3/Tsquared/odell-harris-slits.reg">odell-harris-slits.reg</a></li>
<li>Slit D North is the most useful since it is short and overlaps with the vertical 2010 slits
<ul class="org-ul">
<li>It has 6583/6563 = 1.1290/2.8905 = 0.39</li>
<li>Our slits there have a raw ratio of about 0.30
<ul class="org-ul">
<li>Correction factor of 1.3</li>
</ul></li>
<li>But half the slits are obviously lower (what is different about these?)</li>
</ul></li>
<li>Slit D NE overlaps with horizontal 2013-02 slits
<ul class="org-ul">
<li>It has 6583/6563 = 0.9779/2.8139 = 0.347</li>
<li>Our slits show a lot of variation along the length</li>
<li>Ranges from 0.25 to 0.35
<ul class="org-ul">
<li>Average correction factor = 1.16</li>
</ul></li>
</ul></li>
<li>Slit 27 W overlaps with horizontal 2013-02 slit
<ul class="org-ul">
<li>It has 6583/6563 = 1.2522/2.9002 = 0.432</li>
<li>We see some variation along the length
<ul class="org-ul">
<li>0.33 at W end</li>
<li>0.3 in middle</li>
<li>0.2 at E end</li>
</ul></li>
<li>Average correction factor = 1.44</li>
<li>This is hard to reconcile with the D north results</li>
</ul></li>
<li>Slit 27 E
<ul class="org-ul">
<li>1.0010/2.8700 = 0.35</li>
<li>The W end of this section overlaps with the E end of 2013-02 slits
<ul class="org-ul">
<li>where we have ratio = 0.17</li>
<li>Correction factor of 0.35/0.17 = 2.06 !!!</li>
</ul></li>
<li><i>but the OH slit is sampling a region where we have no data</i></li>
</ul></li>
<li>Slit D NW
<ul class="org-ul">
<li>Has its E end overlap with W end of 2013-02 slits</li>
<li>1.3658/2.8894 = 0.473 so this is highest ratio yet</li>
<li>Our slits give 0.37 around there, and increasing westward
<ul class="org-ul">
<li>Correction factor ~= 0.473/0.37 = 1.28</li>
</ul></li>
</ul></li>
<li>Slit 12 W overlaps with our LL1 slits
<ul class="org-ul">
<li>Has ratio 0.2964/2.8906 = 0.10</li>
<li>Our slits have 0.1 there
<ul class="org-ul">
<li>Correction factor of unity?</li>
</ul></li>
<li>But caution needed since brightest part of the 12 W slit is to the E where we have no data</li>
</ul></li>
<li>Slit 9-mid overlaps with E end of our 2013-12 slits
<ul class="org-ul">
<li>It has ratio = 0.4899/2.8907 = 0.17</li>
<li>Our 2013-12 slits have 0.2 there
<ul class="org-ul">
<li>Correction factor = 0.85</li>
</ul></li>
</ul></li>
<li>Slit 9 W overlaps with middle of our 2013-12 slits
<ul class="org-ul">
<li>0.4157/2.8907 = 0.14</li>
<li>Our 2013-12 slits have 0.313 there
<ul class="org-ul">
<li>Correction factor 0.45</li>
<li>This means there is a spurious spatial gradient in [N II]/Ha for the 2013-12 slits</li>
</ul></li>
<li>But the 2015 slits have ratio of 0.12 there
<ul class="org-ul">
<li>Correction factor 1.17</li>
</ul></li>
</ul></li>
<li><b>Conclusions</b>
<ul class="org-ul">
<li></li>
</ul></li>
</ul></li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits

<span style="color: #dfaf8f;">ha</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">'new-slits-ha-allvels.fits'</span>)[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>]
<span style="color: #dfaf8f;">nii</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">'new-slits-nii-allvels.fits'</span>)[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>]

<span style="color: #dfaf8f;">ratio</span> = nii.data/ha.data
<span style="color: #dfaf8f;">sum_</span> = ha.data + 1.333*nii.data
<span style="color: #dfaf8f;">nii.data</span> = ratio
<span style="color: #dfaf8f;">ha.data</span> = sum_
nii.writeto(<span style="color: #eee8aa; font-style: italic;">'new-slits-nii-over-ha-allvels.fits'</span>, clobber=<span style="color: #cFfBcF;">True</span>)
ha.writeto(<span style="color: #eee8aa; font-style: italic;">'new-slits-nii-plus-ha-allvels.fits'</span>, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline87" class="outline-3">
<h3 id="orgheadline87"><span class="section-number-3">5.9</span> Load the spectral map into ds9</h3>
<div class="outline-text-3" id="text-5-9">
<p>
This shows the scaled image in ds9
</p>
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-allvels.fits[3]
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/new-slits-nii-over-ha-allvels.fits
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-orgheadline92" class="outline-2">
<h2 id="orgheadline92"><span class="section-number-2">6</span> Features seen in the isovelocity maps</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-orgheadline89" class="outline-3">
<h3 id="orgheadline89"><span class="section-number-3">6.1</span> Point objects</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li>4410-139
<ul class="org-ul">
<li>Ha only</li>
<li>N of LL2</li>
<li>is it real?</li>
<li>blue shifted only</li>
</ul></li>
<li>IX Ori - LL 2 -</li>
<li>4285-458</li>
<li></li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline91" class="outline-3">
<h3 id="orgheadline91"><span class="section-number-3">6.2</span> The red bows</h3>
<div class="outline-text-3" id="text-6-2">
</div>

<div id="outline-container-orgheadline90" class="outline-4">
<h4 id="orgheadline90"><span class="section-number-4">6.2.1</span> Identification from imaging</h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
I have marked 4 different bows in the region file <a href="red-bow-all.reg">red-bow-all.reg</a>
</p>
<ul class="org-ul">
<li>Red Bow NE
<ul class="org-ul">
<li>This is the one that crosses LL2</li>
</ul></li>
<li>Red Bow SW
<ul class="org-ul">
<li>This is the one that is just to E of the western "wall"</li>
<li>It is not so redshifted as the NE bow</li>
</ul></li>
<li>Red Bow SE
<ul class="org-ul">
<li>This overlaps on the south wing of the SW bow</li>
<li>Best seen on horizontal slits
<ul class="org-ul">
<li>YY1000-2013-02-232 XX &lt; 1250</li>
<li>YY0971-2013-02-237 XX &lt; 1265</li>
<li>YY0955-2013-02-169 XX &lt; 1254 - this is the strongest</li>
<li>YY0936-2013-02-165 XX &lt; 1240 - on the S wing</li>
</ul></li>
<li>Looks like peak is around V = +22 km/s</li>
<li>Also seen on far S end of LL2 vertical slits</li>
</ul></li>

<li>Red Bow NW
<ul class="org-ul">
<li>This is on the W side of the western "wall"</li>
<li>This is identified from the isovel images - doesn't show up well on direct images</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline93" class="outline-2">
<h2 id="orgheadline93"><span class="section-number-2">7</span> T diagnostics from linewidths</h2>
<div class="outline-text-2" id="text-7">
<ul class="org-ul">
<li>We could repeat what we did for the Teresa Atlas Paper, but we only have one slit with [O III] spectrum</li>
<li>For the jet knots, assuming they are kinematically homogeneous, we should be able to measure the T from</li>
<li>Compact knot in slit spec166
<ul class="org-ul">
<li>FWHM in [N II] = 12.76 km/s</li>
<li>FWHM in Ha = 23.77 km/s</li>
<li>=&gt; thermal FWHM = sqrt((23.77**2 - 12.76**2) (14/13)) = 20.8 km/s</li>
<li>So basically 1e4 K, which is not surprising</li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline94" class="outline-2">
<h2 id="orgheadline94"><span class="section-number-2">8</span> The big bowshock</h2>
<div class="outline-text-2" id="text-8">
<ul class="org-ul">
<li>There is a giant, possibly double, possibly triple bow</li>
<li>It's N wing crosses LL2, and is red-shifted
<ul class="org-ul">
<li>And has measured proper motion</li>
</ul></li>
<li>The nose looks red-shifted too</li>
<li>It would be good to get proper motions of the nose</li>
</ul>
</div>
</div>



<div id="outline-container-orgheadline95" class="outline-2">
<h2 id="orgheadline95"><span class="section-number-2">9</span> Proper motions of the Orion West shocks</h2>
<div class="outline-text-2" id="text-9">
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-08-26 Wed] </span></span> Today I discovered that there is a new Massimo Robberto program that has re-observed the whole of Orion with the ACS F775W filter</li>
<li>And also various bits with the F130N and F139M WFC3 IR filters</li>
<li>This will allow us do to proper motion measurements of all the interesting shocks in our field</li>
<li>Relevant images are as follows:
<ul class="org-ul">
<li>JCOL02010 for ACS field W of LL2</li>
<li>JCOL09010 (ORIMOS-16) for ACS field just below that, containing the nose of the giant bowshock</li>
<li>JCOL03010 ACS includes LL2 and region immediately to W</li>
<li>ICOL22030 WFC3 IR image of region W of LL2</li>
<li>JCOL05010 ACS field of the big gap between trapezium and LL2</li>
<li>JCOL11010 ACS way S with filaments along extension of bright bar</li>
</ul></li>
<li>Missing images</li>

<li>Older images that we might use
<ul class="org-ul">
<li>An [S II] WFPC2 image that covers the circular bubble to the S of LL2 plus the upper partial "nose" of the big bowshock: U8OC2604M from Bally's ACS program 9825</li>
<li class="on"><code>[X]</code> We should actually get the entire set of these
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-08-27 Thu] </span></span> Downloaded to <code>/fs/nil/other0/will/orion-bally-wfpc2-2004/</code></li>
</ul></li>
<li>There is a interesting bowshock seen in [S II] to the W of the end of HH269, but not quite as W as the flatter bow that we can see in Ha and NIR
<ul class="org-ul">
<li>RA: 05 34 59.81</li>
<li>Dec: -05 23 39.94</li>
<li>Image: U8OC1804M</li>
</ul></li>
<li>This could be a candidate for the same flow as the big bowshock</li>
<li>We also need to look into possible correspondences with the molecular outflows from Orion S</li>
</ul></li>
</ul>
</div>
</div>



<div id="outline-container-orgheadline124" class="outline-2">
<h2 id="orgheadline124"><span class="section-number-2">10</span> Old stuff on calibration</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-orgheadline98" class="outline-3">
<h3 id="orgheadline98"><span class="section-number-3">10.1</span> Dealing with the offset between image and spectrum</h3>
<div class="outline-text-3" id="text-10-1">
<ul class="org-ul">
<li>It seems that this is not as constant as I had hoped
<ul class="org-ul">
<li>In the <a href="alba-orion-west.html#ID-8685D060-12A9-4E73-B069-11D5315ED8EB">vertical slits</a> it varies from 52 to 60 pixels</li>
<li>And some slits do not have a reference star to use</li>
</ul></li>
<li>One solution will be to compare the brightness profiles of the spectrum with that of the slit image
<ul class="org-ul">
<li>For the spectrum, we can sum in wavelength for the entire ha+nii range</li>
<li>For the image, we would sum a short width across the slit</li>
</ul></li>
<li>Then we could either use the cross-correlation, or simple hunting, to find the best offset</li>
<li>At the same time, this would give the brightness factor between image and spec
<ul class="org-ul">
<li>We could use this to refine the brightness correction factors</li>
</ul></li>
</ul>
</div>


<div id="outline-container-orgheadline1" class="outline-4">
<h4 id="orgheadline1"><a id="ID-0B8D02D8-4C57-48A1-8F17-6AD60BFA1A7B"></a><span class="section-number-4">10.1.1</span> Application to the vertical slits</h4>
<div class="outline-text-4" id="text-10-1-1">
<table id="orgtable1" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">image</th>
<th scope="col" class="org-right">spec</th>
<th scope="col" class="org-right">islit</th>
<th scope="col" class="org-right">jshift</th>
<th scope="col" class="org-right">fac</th>
<th scope="col" class="org-right">bfac</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">202</td>
<td class="org-right">203-204</td>
<td class="org-right">233.6</td>
<td class="org-right">52.5</td>
<td class="org-right">3.9</td>
<td class="org-right">1.143</td>
</tr>

<tr>
<td class="org-right">124</td>
<td class="org-right">125-127</td>
<td class="org-right">235.5</td>
<td class="org-right">54.5</td>
<td class="org-right">2.7</td>
<td class="org-right">1.431</td>
</tr>

<tr>
<td class="org-right">206</td>
<td class="org-right">207-208</td>
<td class="org-right">234.6</td>
<td class="org-right">54</td>
<td class="org-right">4.4</td>
<td class="org-right">1.136</td>
</tr>

<tr>
<td class="org-right">128</td>
<td class="org-right">129-130</td>
<td class="org-right">237.5</td>
<td class="org-right">57</td>
<td class="org-right">4.4</td>
<td class="org-right">2.688</td>
</tr>

<tr>
<td class="org-right">133</td>
<td class="org-right">134-135</td>
<td class="org-right">239.4</td>
<td class="org-right">58</td>
<td class="org-right">5</td>
<td class="org-right">1.608</td>
</tr>

<tr>
<td class="org-right">210</td>
<td class="org-right">211-212</td>
<td class="org-right">236.4</td>
<td class="org-right">55</td>
<td class="org-right">4.4</td>
<td class="org-right">1.021</td>
</tr>

<tr>
<td class="org-right">137</td>
<td class="org-right">138-139</td>
<td class="org-right">241.3</td>
<td class="org-right">60</td>
<td class="org-right">2.8</td>
<td class="org-right">1.550</td>
</tr>

<tr>
<td class="org-right">214</td>
<td class="org-right">215-216</td>
<td class="org-right">238.4</td>
<td class="org-right">55</td>
<td class="org-right">4.1</td>
<td class="org-right">1.067</td>
</tr>

<tr>
<td class="org-right">145</td>
<td class="org-right">146-147</td>
<td class="org-right">244.3</td>
<td class="org-right">58</td>
<td class="org-right">2.0</td>
<td class="org-right">5.181</td>
</tr>

<tr>
<td class="org-right">248</td>
<td class="org-right">249-250</td>
<td class="org-right">254.9</td>
<td class="org-right">68</td>
<td class="org-right">5.4</td>
<td class="org-right">2.400</td>
</tr>

<tr>
<td class="org-right">219</td>
<td class="org-right">220-221</td>
<td class="org-right">240.0</td>
<td class="org-right">57.5</td>
<td class="org-right">4.35</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">157</td>
<td class="org-right">158-159</td>
<td class="org-right">252.2</td>
<td class="org-right">65</td>
<td class="org-right">7.0</td>
<td class="org-right">6.757</td>
</tr>

<tr>
<td class="org-right">236</td>
<td class="org-right">237-238</td>
<td class="org-right">247.0</td>
<td class="org-right">63</td>
<td class="org-right">4.2</td>
<td class="org-right">1.122</td>
</tr>

<tr>
<td class="org-right">240</td>
<td class="org-right">241-242</td>
<td class="org-right">249.5</td>
<td class="org-right">65</td>
<td class="org-right">3.1</td>
<td class="org-right">1.073</td>
</tr>

<tr>
<td class="org-right">244</td>
<td class="org-right">245-246</td>
<td class="org-right">251.6</td>
<td class="org-right">64</td>
<td class="org-right">2.7</td>
<td class="org-right">1.147</td>
</tr>

<tr>
<td class="org-right">252</td>
<td class="org-right">253-254</td>
<td class="org-right">258.2</td>
<td class="org-right">69</td>
<td class="org-right">5.4</td>
<td class="org-right">1.678</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>Pixel positions of slits (islit in table above) also vary between positions, so I have had to measure all of these
<ul class="org-ul">
<li>They are FITS style 1-based indices</li>
<li>The slit width is about 4 pixels</li>
<li>But the slit center does not fall on an integer pixel</li>
<li>To be safe, we take the 5 pixels: [int(islit) - 3 : int(islit) + 3]</li>
</ul></li>
<li>First stab:
<ul class="org-ul">
<li>Read in the images and spectra, and overplot the profiles</li>
<li>There are 16 positions now, so we can use a 4 x 4 grid</li>
<li>The <code>bfac</code> factors are the inter-position image brightness correction factors, calculated <a href="#orgheadline96">below</a> - they multiply all the brightnesses
<ul class="org-ul">
<li>On the graphs, I print out <code>bright = 1/bfac</code></li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-08-25 Tue] </span></span> I am modifying by hand the bfac for 248 from 2.222 to 2.4
<ul class="org-ul">
<li>There is no justification for this, other than that it looks too faint on the maps</li>
</ul></li>
</ul></li>
<li>The <code>fac</code> factors are the image-to-spectrum brightness factors - they multiply the image profile so that it matches the spectrum profile
<ul class="org-ul">
<li>So larger factors mean better spectra (compared to what is expected from the image)</li>
<li>The most common factor <i>should</i> correspond to equal conditions between image and spectrum. But in general <code>fac</code> could be larger or smaller than this.</li>
<li>I am assuing that <code>fac = 4.4</code> is the default value, and dividing all of them by this when I print the info on the plot
<ul class="org-ul">
<li>There are 4 spectra that have the optimum value of <code>bfac</code>:
<ul class="org-ul">
<li>206, 128, 210, 219</li>
</ul></li>
<li>Most of the other values are lower
<ul class="org-ul">
<li>This make sense if conditions were deteriorating during the night</li>
<li>Then each spectrum is worse than its preceding image</li>
</ul></li>
<li>But a few are higher, implying improvements since the image:
<ul class="org-ul">
<li>133, 248, 157, 252</li>
<li>These tend to have high values of bfac</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">import</span> matplotlib.pyplot <span style="color: #b9d3ee;">as</span> plt
<span style="color: #b9d3ee;">import</span> seaborn <span style="color: #b9d3ee;">as</span> sns; sns.<span style="color: #DCDCCC; font-weight: bold;">set</span>()
sns.set_color_codes()

<span style="color: #dfaf8f;">nspec</span> = 12
<span style="color: #dfaf8f;">ny</span> = 512
<span style="color: #dfaf8f;">figfile</span> = <span style="color: #eee8aa; font-style: italic;">'image-spec-offsets.pdf'</span>
<span style="color: #dfaf8f;">yarray</span> = np.arange(ny)
<span style="color: #dfaf8f;">layout</span> = {<span style="color: #eee8aa; font-style: italic;">'left'</span>: 0.05, <span style="color: #eee8aa; font-style: italic;">'bottom'</span>: 0.07, <span style="color: #eee8aa; font-style: italic;">'right'</span>: 0.99, <span style="color: #eee8aa; font-style: italic;">'top'</span>: 0.95,
          <span style="color: #eee8aa; font-style: italic;">'wspace'</span>: 0.02, <span style="color: #eee8aa; font-style: italic;">'hspace'</span>: 0.02}
<span style="color: #dfaf8f;">fig</span>, <span style="color: #dfaf8f;">axgrid</span> = plt.subplots(4, 4, sharex=<span style="color: #cFfBcF;">True</span>, sharey=<span style="color: #cFfBcF;">True</span>, gridspec_kw=layout)
<span style="color: #dfaf8f;">tweak</span> = 1.2
<span style="color: #b9d3ee;">for</span> (imid, specid, islit, jshift, factor, bfac), ax <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">zip</span>(table, axgrid.flat):
    <span style="color: #dfaf8f;">imfile</span> = <span style="color: #eee8aa; font-style: italic;">'posiciones/spm{}-ardec.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(imid)
    <span style="color: #dfaf8f;">specfile</span> = <span style="color: #eee8aa; font-style: italic;">'spm{}h.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid)
    <span style="color: #dfaf8f;">islit</span> = <span style="color: #DCDCCC; font-weight: bold;">int</span>(<span style="color: #DCDCCC; font-weight: bold;">float</span>(islit))
    <span style="color: #dfaf8f;">jshift</span> = <span style="color: #DCDCCC; font-weight: bold;">float</span>(jshift)
    <span style="color: #dfaf8f;">factor</span> = <span style="color: #DCDCCC; font-weight: bold;">float</span>(factor)
    <span style="color: #dfaf8f;">bfac</span> = <span style="color: #DCDCCC; font-weight: bold;">float</span>(bfac)

    imhdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(imfile)
    spechdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(specfile)

    <span style="color: #dfaf8f;">imhdu.data</span> -= 1170.0  <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">remove bias</span>
    <span style="color: #dfaf8f;">improfile</span> = imhdu.data[:, islit-3:islit+3].<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=1)
    <span style="color: #dfaf8f;">specprofile</span> = spechdu.data.<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=1)

    ax.plot(yarray+jshift, bfac*improfile/(1e4*tweak), label=<span style="color: #eee8aa; font-style: italic;">'image'</span>,
            c=<span style="color: #eee8aa; font-style: italic;">'r'</span>, lw=2, alpha=0.3)
    ax.plot(yarray, bfac*specprofile/(1e4*factor), label=<span style="color: #eee8aa; font-style: italic;">'spectrum'</span>,
            c=<span style="color: #eee8aa; font-style: italic;">'k'</span>, lw=0.6)

    <span style="color: #dfaf8f;">text_pattern</span> = <span style="color: #eee8aa; font-style: italic;">'pos #{} shift = {:.1f} factor = {:.2f} bright = {:.2f}'</span>
    <span style="color: #dfaf8f;">text</span> = text_pattern.<span style="color: #DCDCCC; font-weight: bold;">format</span>(imid, jshift, factor/4.4, 1.0/bfac)
    ax.text(300, 0.1, text, ha=<span style="color: #eee8aa; font-style: italic;">'center'</span>, va=<span style="color: #eee8aa; font-style: italic;">'bottom'</span>, fontsize=7)

axgrid[0, 0].legend(fontsize=<span style="color: #eee8aa; font-style: italic;">'xx-small'</span>, loc=<span style="color: #eee8aa; font-style: italic;">'upper left'</span>)
axgrid[0, 0].set_xlim(0.0, 640)
axgrid[0, 0].set_ylim(0.0, 5.5)
axgrid[-1, 2].set_xlabel(<span style="color: #eee8aa; font-style: italic;">'pixel'</span>)
axgrid[1, 0].set_ylabel(<span style="color: #eee8aa; font-style: italic;">'intensity'</span>)
fig.suptitle(<span style="color: #eee8aa; font-style: italic;">'Alignment and flux calibration of vertical slits'</span>)
fig.set_size_inches(11, 8.5)
fig.savefig(figfile)
</pre>
</div>

<p>
<a href="file:///Users/will/Dropbox/SPMJAN10/reducciones/image-spec-offsets.pdf">file:///Users/will/Dropbox/SPMJAN10/reducciones/image-spec-offsets.pdf</a>
</p>
</div>
</div>


<div id="outline-container-orgheadline2" class="outline-4">
<h4 id="orgheadline2"><a id="ID-6CE33437-BC17-49AA-B048-5BACCBB8C99B"></a><span class="section-number-4">10.1.2</span> Repeat for the horizontal slits</h4>
<div class="outline-text-4" id="text-10-1-2">
<table id="orgtable2" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">image</th>
<th scope="col" class="org-right">slit</th>
<th scope="col" class="org-right">night</th>
<th scope="col" class="org-right">jslit</th>
<th scope="col" class="org-right">dj</th>
<th scope="col" class="org-right">ishift</th>
<th scope="col" class="org-right">fac</th>
<th scope="col" class="org-right">bright</th>
<th scope="col" class="org-right">bgrad</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">165</td>
<td class="org-right">166-167</td>
<td class="org-right">160213</td>
<td class="org-right">468.5</td>
<td class="org-right">12</td>
<td class="org-right">67</td>
<td class="org-right">5.5</td>
<td class="org-right">0.777</td>
<td class="org-right">1.4</td>
</tr>

<tr>
<td class="org-right">169</td>
<td class="org-right">170-171</td>
<td class="org-right">160213</td>
<td class="org-right">468.5</td>
<td class="org-right">12</td>
<td class="org-right">65</td>
<td class="org-right">5.3</td>
<td class="org-right">0.744</td>
<td class="org-right">1.4</td>
</tr>

<tr>
<td class="org-right">237</td>
<td class="org-right">238-239</td>
<td class="org-right">160213</td>
<td class="org-right">467.0</td>
<td class="org-right">12</td>
<td class="org-right">74</td>
<td class="org-right">5.5</td>
<td class="org-right">0.969</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-right">232</td>
<td class="org-right">233-234</td>
<td class="org-right">160213</td>
<td class="org-right">468.5</td>
<td class="org-right">12</td>
<td class="org-right">75</td>
<td class="org-right">5.8</td>
<td class="org-right">1.000</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-right">226</td>
<td class="org-right">227-228</td>
<td class="org-right">160213</td>
<td class="org-right">468.5</td>
<td class="org-right">12</td>
<td class="org-right">75</td>
<td class="org-right">6.0</td>
<td class="org-right">0.998</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">149</td>
<td class="org-right">150-151</td>
<td class="org-right">160213</td>
<td class="org-right">468.0</td>
<td class="org-right">12</td>
<td class="org-right">70</td>
<td class="org-right">5.0</td>
<td class="org-right">0.825</td>
<td class="org-right">1.7</td>
</tr>

<tr>
<td class="org-right">154</td>
<td class="org-right">155-156</td>
<td class="org-right">160213</td>
<td class="org-right">467.2</td>
<td class="org-right">12</td>
<td class="org-right">67</td>
<td class="org-right">5.2</td>
<td class="org-right">0.862</td>
<td class="org-right">1.7</td>
</tr>

<tr>
<td class="org-right">159</td>
<td class="org-right">160-161</td>
<td class="org-right">160213</td>
<td class="org-right">467.5</td>
<td class="org-right">12</td>
<td class="org-right">67</td>
<td class="org-right">5.4</td>
<td class="org-right">0.818</td>
<td class="org-right">1.7</td>
</tr>

<tr>
<td class="org-right">033</td>
<td class="org-right">034-035</td>
<td class="org-right">150213</td>
<td class="org-right">467.0</td>
<td class="org-right">12</td>
<td class="org-right">67</td>
<td class="org-right">5.5</td>
<td class="org-right">0.837</td>
<td class="org-right">0.8</td>
</tr>

<tr>
<td class="org-right">029</td>
<td class="org-right">030-031</td>
<td class="org-right">150213</td>
<td class="org-right">465.2</td>
<td class="org-right">6</td>
<td class="org-right">76</td>
<td class="org-right">6.0</td>
<td class="org-right">0.847</td>
<td class="org-right">0.8</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-08-21 Fri] </span></span> I have measured the y-pixel position of the slit (<code>jslit</code>) on the images - it is roughly constant, but not quite
<ul class="org-ul">
<li>We have to be careful to use the "Image" coordinate, not the "Physical" one</li>
</ul></li>
<li>The slit width is 150 micron for all exept <code>029</code> where it is 70 micron
<ul class="org-ul">
<li>This is reflected in the nominal pixel width of the slit, which is given in the <code>dj</code> column</li>
<li>The slit profile is not rectangular - looks more triangular, or perhaps an ellipse</li>
</ul></li>
<li>The bias seems to have been removed, but there is a residual signal in the image+slits of 6 to 12 counts, which varies in J but not in I
<ul class="org-ul">
<li>At the J of the slit it looks to be about 9</li>
</ul></li>
<li>It is hard to tell whether there is anything that should be removed from the spectra
<ul class="org-ul">
<li>But looking at the x-profiles of the line-free parts of the PV image, as compared with the Ha line, I think there is a residual bias of about 3</li>
<li>When multiplied by NY=1017, this gives 3051 as the value that should be subtracted from the y-summed profile</li>
</ul></li>
<li>I have found a better way to extract the slit profile from the image:
<ul class="org-ul">
<li>Sum over a wide window that includes the <i>entire</i> slit profile</li>
<li>But then subtract off the average of the two rows above and below this window, multiplied by the window width</li>
<li>This is equivalent to interpolating the bg underneath the slit profile</li>
<li>It seems to give better results than the previous method</li>
</ul></li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-08-22 Sat] </span></span> The bright and bgrad columns can now be filled in from the calculation <a href="#orgheadline97">down here</a>
<ul class="org-ul">
<li>Note that <b>bright is the reciprocal of bfac</b>, which I used in the table for the vertical slits</li>
<li>The bgrad is for a linear E-W gradient correction to the brightnesses</li>
<li>I rounded it to 1 decimal place, since it is not that well determined</li>
</ul></li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-08-25 Tue] </span></span> I redid the calculation of the <code>bright</code> factors, see <a href="#orgheadline97">down here</a>, so we are now using the <code>corrnorm</code> column of the last table</li>
<li>Also experimented with increasing bgrad from 1.5 to 1.7 for 149, 154, 159</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">import</span> matplotlib.pyplot <span style="color: #b9d3ee;">as</span> plt
<span style="color: #b9d3ee;">import</span> seaborn <span style="color: #b9d3ee;">as</span> sns; sns.<span style="color: #DCDCCC; font-weight: bold;">set</span>()
sns.set_color_codes()

<span style="color: #dfaf8f;">nspec</span> = 10
<span style="color: #dfaf8f;">nx</span> = 625
<span style="color: #dfaf8f;">figfile</span> = <span style="color: #eee8aa; font-style: italic;">'image-spec-offsets.pdf'</span>
<span style="color: #dfaf8f;">xarray</span> = np.arange(nx)
<span style="color: #dfaf8f;">layout</span> = {<span style="color: #eee8aa; font-style: italic;">'left'</span>: 0.05, <span style="color: #eee8aa; font-style: italic;">'bottom'</span>: 0.07, <span style="color: #eee8aa; font-style: italic;">'right'</span>: 0.99, <span style="color: #eee8aa; font-style: italic;">'top'</span>: 0.95,
          <span style="color: #eee8aa; font-style: italic;">'wspace'</span>: 0.02, <span style="color: #eee8aa; font-style: italic;">'hspace'</span>: 0.02}
<span style="color: #dfaf8f;">fig</span>, <span style="color: #dfaf8f;">axgrid</span> = plt.subplots(3, 4, sharex=<span style="color: #cFfBcF;">True</span>, sharey=<span style="color: #cFfBcF;">True</span>, gridspec_kw=layout)
<span style="color: #dfaf8f;">tweak</span> = 1.0
<span style="color: #b9d3ee;">for</span> (imid, specid, night, jslit, dj, ishift,
     factor, bright, bgrad), ax <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">zip</span>(table, axgrid.flat):
    <span style="color: #dfaf8f;">imfile</span> = <span style="color: #eee8aa; font-style: italic;">'spm{:03d}_ardec.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(imid)
    <span style="color: #dfaf8f;">specfile</span> = <span style="color: #eee8aa; font-style: italic;">'../{}/reducciones/spm{}_bcr.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(night, specid)
    <span style="color: #dfaf8f;">jslit</span> = <span style="color: #DCDCCC; font-weight: bold;">int</span>(<span style="color: #DCDCCC; font-weight: bold;">float</span>(jslit))
    <span style="color: #dfaf8f;">dj</span> = <span style="color: #DCDCCC; font-weight: bold;">int</span>(dj)
    <span style="color: #dfaf8f;">ishift</span> = <span style="color: #DCDCCC; font-weight: bold;">float</span>(ishift)
    <span style="color: #dfaf8f;">factor</span> = <span style="color: #DCDCCC; font-weight: bold;">float</span>(factor)
    <span style="color: #dfaf8f;">bfac</span> = 1./<span style="color: #DCDCCC; font-weight: bold;">float</span>(bright)

    imhdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(imfile)
    spechdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(specfile)

    <span style="color: #dfaf8f;">imhdu.data</span> -= 9.0  <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">remove residual bias</span>
    <span style="color: #dfaf8f;">spechdu.data</span> -= 5.5
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">limits of slit (FWZI)</span>
    <span style="color: #dfaf8f;">j1</span>, <span style="color: #dfaf8f;">j2</span> = jslit-dj//2, jslit+dj//2
    <span style="color: #dfaf8f;">improfile</span> = imhdu.data[j1:j2, :].<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=0)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">take average profile either side of the slit</span>
    <span style="color: #dfaf8f;">offprofile</span> = 0.5*(imhdu.data[j1-1, :] + imhdu.data[j2, :])
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">and subtract (multiplied by slit width) to get the pure slit profile</span>
    <span style="color: #dfaf8f;">improfile</span> -= dj*offprofile
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Now find the gradient correction</span>
    <span style="color: #dfaf8f;">NX</span> = <span style="color: #DCDCCC; font-weight: bold;">len</span>(improfile)
    <span style="color: #dfaf8f;">x</span> = np.arange(NX)/NX - 0.5
    <span style="color: #dfaf8f;">grad_corr</span> = 1.0 - 1.24*(bgrad - 1.0)*x

    <span style="color: #dfaf8f;">specprofile</span> = spechdu.data.<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=0)

    ax.plot(xarray-ishift, (12.0/dj)*bfac*grad_corr*improfile/(1e4*tweak),
            label=<span style="color: #eee8aa; font-style: italic;">'image'</span>, c=<span style="color: #eee8aa; font-style: italic;">'r'</span>, lw=2, alpha=0.3)
    ax.plot(xarray, bfac*grad_corr*specprofile/(1e4*factor),
            label=<span style="color: #eee8aa; font-style: italic;">'spectrum'</span>, c=<span style="color: #eee8aa; font-style: italic;">'k'</span>, lw=0.6)

    <span style="color: #dfaf8f;">text_pattern</span> = <span style="color: #eee8aa; font-style: italic;">'pos #{} shift = {:.1f} factor = {:.2f} bright = {:.2f}'</span>
    <span style="color: #dfaf8f;">text</span> = text_pattern.<span style="color: #DCDCCC; font-weight: bold;">format</span>(imid, ishift, factor/5.5, 1.0/bfac)
    ax.text(300, 0.1, text, ha=<span style="color: #eee8aa; font-style: italic;">'center'</span>, va=<span style="color: #eee8aa; font-style: italic;">'bottom'</span>, fontsize=7)

axgrid[0, 0].legend(fontsize=<span style="color: #eee8aa; font-style: italic;">'xx-small'</span>, loc=<span style="color: #eee8aa; font-style: italic;">'upper left'</span>)
axgrid[0, 0].set_xlim(-80, 640)
axgrid[0, 0].set_ylim(0.0, 1.5)
axgrid[-1, 2].set_xlabel(<span style="color: #eee8aa; font-style: italic;">'pixel'</span>)
axgrid[1, 0].set_ylabel(<span style="color: #eee8aa; font-style: italic;">'intensity'</span>)
fig.suptitle(<span style="color: #eee8aa; font-style: italic;">'Alignment and flux calibration of horizontal slits'</span>)
fig.set_size_inches(11, 8.5)
fig.savefig(figfile)
</pre>
</div>

<p>
<a href="file:///Users/will/Dropbox/SPMFEB13/WesternShocks/image-spec-offsets.pdf">file:///Users/will/Dropbox/SPMFEB13/WesternShocks/image-spec-offsets.pdf</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgheadline112" class="outline-3">
<h3 id="orgheadline112"><span class="section-number-3">10.2</span> Datasets that we will use</h3>
<div class="outline-text-3" id="text-10-2">
</div><div id="outline-container-orgheadline99" class="outline-4">
<h4 id="orgheadline99"><span class="section-number-4">10.2.1</span> Odd slits that we don't want to forget</h4>
<div class="outline-text-4" id="text-10-2-1">
<ul class="org-ul">
<li>2007 Jan
<ul class="org-ul">
<li>Some of the LL1 slits show blueshifted emission at their N end
<ul class="org-ul">
<li>spec060-oiii</li>
<li>spec055-ha</li>
<li>spec068-ha</li>
<li>spec073-ha</li>
</ul></li>
<li>Unfortunately, most of the slits were put too far South to see this</li>
<li>The [O III] slits from 2013 Dec Orion S don't quite go far west enough to reach this, and the same is true of the Orion S slits from 2007</li>
</ul></li>
<li>2010 Jan
<ul class="org-ul">
<li>spm078 (Ha, [N II])</li>
<li>spm085 ([S II])</li>
<li>These are vertical slits to the W of LL2 that help fill in that region to the E of the N ends of the other vertical slits</li>
<li>They cross the N wing of the putative big bow
<ul class="org-ul">
<li>Clearly redshifted, helping establish continuity with wing seen in LL2 slits</li>
<li>Also we can measure the electron density</li>
</ul></li>
<li>We also cross a bizarre blue-shited feature to WNW of LL2
<ul class="org-ul">
<li>Looks like a classical triangular bowshock shape in the PV diagram</li>
</ul></li>
</ul></li>
<li>2013 Feb
<ul class="org-ul">
<li>spm024 (Ha, [N II])</li>
<li>This is a horizontal slit across LL2 (just N of star)</li>
<li>It shows that a blue emission layer stops just in front of the LL2 bow</li>
</ul></li>
<li>2013 Dec
<ul class="org-ul">
<li>There is one extra position just below LL2 - spm116
<ul class="org-ul">
<li>Unfortunately, it is low s/n</li>
</ul></li>
</ul></li>
<li>2015 Feb
<ul class="org-ul">
<li>0013 and 0003</li>
<li>More horizontal slits in the middle part</li>
<li>These are similar to the slits from Dec 2013</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline100" class="outline-4">
<h4 id="orgheadline100"><span class="section-number-4">10.2.2</span> Dec 2013</h4>
<div class="outline-text-4" id="text-10-2-2">
<ul class="org-ul">
<li>These are in <a href="file:///Users/will/Dropbox/papers/LL-Objects/SPMDIC13/"><a href="file:///Users/will/Dropbox/papers/LL-Objects/SPMDIC13/">file:///Users/will/Dropbox/papers/LL-Objects/SPMDIC13/</a></a></li>
<li>They are horizontal slits in between LL2 and Orion S</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline101" class="outline-4">
<h4 id="orgheadline101"><span class="section-number-4">10.2.3</span> Feb 2015</h4>
<div class="outline-text-4" id="text-10-2-3">
<ul class="org-ul">
<li>These are in <a href="file:///Users/will/Dropbox/SPMFEB15/"><a href="file:///Users/will/Dropbox/SPMFEB15/">file:///Users/will/Dropbox/SPMFEB15/</a></a></li>
<li>They are horizontal slits in between LL2 and Orion S with a new chip</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline103" class="outline-4">
<h4 id="orgheadline103"><a id="ID-CB720DCF-0A33-4C51-9A0B-932030BC0E45"></a><span class="section-number-4">10.2.4</span> Jan 2007 and Feb 2006</h4>
<div class="outline-text-4" id="text-10-2-4">
<ul class="org-ul">
<li>These are the HH 505 observations in <a href="file:///Users/will/Work/SPM2007/Reduced/HH505/slits/reducciones/"><a href="file:///Users/will/Work/SPM2007/Reduced/HH505/slits/reducciones/">file:///Users/will/Work/SPM2007/Reduced/HH505/slits/reducciones/</a></a></li>
<li>And also in <a href="file:///Users/will/Work/SPM2005/">file:///Users/will/Work/SPM2005/</a> for the older ones
<ul class="org-ul">
<li>Not sure why the folder is called 2005 rather than 2006</li>
<li>With reduced versions of these in <a href="file:///Users/will/Work/SPM2007/Reduced/HH505/slits/SPMha/">file:///Users/will/Work/SPM2007/Reduced/HH505/slits/SPMha/</a></li>
</ul></li>
<li>They are mainly vertical, but there are a few horizontal slits</li>
</ul>
</div>
<div id="outline-container-orgheadline102" class="outline-5">
<h5 id="orgheadline102"><span class="section-number-5">10.2.4.1</span> Original database for vertical slits</h5>
<div class="outline-text-5" id="text-10-2-4-1">
<ul class="org-ul">
<li>Taken from <a href="file:///Users/will/Work/SPM2007/Reduced/HH505/slits/reducciones/jw0.csv">jw0.csv</a></li>
<li>I have removed the following columns from the table because they were constants:
<ul class="org-ul">
<li>lamrest = 6562.82</li>
<li>lamscale = 0.04375213</li>
<li>d vel =  2</li>
<li>NX = 300</li>
<li>NY = 512</li>
<li>ufiddle = 0</li>
<li>fluxfiddle = 1</li>
</ul></li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-right">RA</th>
<th scope="col" class="org-right">Dec</th>
<th scope="col" class="org-right">dataset</th>
<th scope="col" class="org-right">lam0</th>
<th scope="col" class="org-right">helio corr</th>
<th scope="col" class="org-right">ypixscale</th>
<th scope="col" class="org-right">jcenter</th>
<th scope="col" class="org-left">True File</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">jw0e068</td>
<td class="org-right">-0.6828000</td>
<td class="org-right">-15.91200</td>
<td class="org-right">1</td>
<td class="org-right">6557</td>
<td class="org-right">-13.3</td>
<td class="org-right">0.62</td>
<td class="org-right">316</td>
<td class="org-left">spec2062-ha.fits</td>
</tr>

<tr>
<td class="org-left">jw0e043</td>
<td class="org-right">-0.4308000</td>
<td class="org-right">-0.7920000</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-21.53</td>
<td class="org-right">0.623</td>
<td class="org-right">182</td>
<td class="org-left">spec324-halpha.fits</td>
</tr>

<tr>
<td class="org-left">jw0e024</td>
<td class="org-right">-0.2388000</td>
<td class="org-right">5.579999</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-21.5</td>
<td class="org-right">0.623</td>
<td class="org-right">183</td>
<td class="org-left">spec319-halpha.fits</td>
</tr>

<tr>
<td class="org-left">jw0e022</td>
<td class="org-right">-0.2243999</td>
<td class="org-right">-38.23200</td>
<td class="org-right">1</td>
<td class="org-right">6557</td>
<td class="org-right">-12.91</td>
<td class="org-right">0.62</td>
<td class="org-right">317</td>
<td class="org-left">spec2038-ha.fits</td>
</tr>

<tr>
<td class="org-left">jw0e004</td>
<td class="org-right">-0.0419999</td>
<td class="org-right">-0.2160000</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-20.92</td>
<td class="org-right">0.62</td>
<td class="org-right">200</td>
<td class="org-left">spec261-halpha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w012</td>
<td class="org-right">0.116399</td>
<td class="org-right">3.671999</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-21.03</td>
<td class="org-right">0.622</td>
<td class="org-right">196</td>
<td class="org-left">spec271-halpha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w020</td>
<td class="org-right">0.202799</td>
<td class="org-right">3.960000</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-21.09</td>
<td class="org-right">0.621</td>
<td class="org-right">193</td>
<td class="org-left">spec277-halpha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w040</td>
<td class="org-right">0.4019999</td>
<td class="org-right">6.335999</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-21.15</td>
<td class="org-right">0.622</td>
<td class="org-right">192</td>
<td class="org-left">spec282-halpha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w056</td>
<td class="org-right">0.5604000</td>
<td class="org-right">6.515999</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-21.21</td>
<td class="org-right">0.622</td>
<td class="org-right">191</td>
<td class="org-left">spec287-halpha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w062</td>
<td class="org-right">0.6179999</td>
<td class="org-right">6.551999</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-21.27</td>
<td class="org-right">0.619</td>
<td class="org-right">189</td>
<td class="org-left">spec292-halpha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w086</td>
<td class="org-right">0.8628000</td>
<td class="org-right">7.955999</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-21.32</td>
<td class="org-right">0.621</td>
<td class="org-right">189</td>
<td class="org-left">spec297-halpha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w092</td>
<td class="org-right">0.9227999</td>
<td class="org-right">-36.21600</td>
<td class="org-right">1</td>
<td class="org-right">6557</td>
<td class="org-right">-12.97</td>
<td class="org-right">0.62</td>
<td class="org-right">316</td>
<td class="org-left">spec2042-ha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w122</td>
<td class="org-right">1.220399</td>
<td class="org-right">5.543999</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-21.39</td>
<td class="org-right">0.619</td>
<td class="org-right">187</td>
<td class="org-left">spec304-halpha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w143</td>
<td class="org-right">1.433999</td>
<td class="org-right">-35.13600</td>
<td class="org-right">1</td>
<td class="org-right">6557</td>
<td class="org-right">-13.04</td>
<td class="org-right">0.622</td>
<td class="org-right">191</td>
<td class="org-left">spec2046-ha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w186</td>
<td class="org-right">1.863599</td>
<td class="org-right">-34.77600</td>
<td class="org-right">1</td>
<td class="org-right">6557</td>
<td class="org-right">-13.1</td>
<td class="org-right">0.621</td>
<td class="org-right">316</td>
<td class="org-left">spec2050-ha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w238</td>
<td class="org-right">2.379599</td>
<td class="org-right">-14.68800</td>
<td class="org-right">1</td>
<td class="org-right">6557</td>
<td class="org-right">-13.18</td>
<td class="org-right">0.619</td>
<td class="org-right">316</td>
<td class="org-left">spec2054-ha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w300</td>
<td class="org-right">2.996399</td>
<td class="org-right">-16.27200</td>
<td class="org-right">1</td>
<td class="org-right">6557</td>
<td class="org-right">-13.24</td>
<td class="org-right">0.619</td>
<td class="org-right">316</td>
<td class="org-left">spec2058-ha.fits</td>
</tr>

<tr>
<td class="org-left">jw0w323</td>
<td class="org-right">3.231599</td>
<td class="org-right">3.887999</td>
<td class="org-right">2</td>
<td class="org-right">6558</td>
<td class="org-right">-21.47</td>
<td class="org-right">0.623</td>
<td class="org-right">184</td>
<td class="org-left">spec312-halpha.fits</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>They seem to be from two different sets:
<ul class="org-ul">
<li>The 20XX-ha ones from Jan 2007
<ul class="org-ul">
<li>There are also 2022, 2076, 2081 that aren't used here</li>
<li>2022 is a horizontal slit</li>
<li>2076 and 2081 are [O III] Orion S slits (why did we never use these?)</li>
</ul></li>
<li>and the XXX-halpha ones from Feb 2006
<ul class="org-ul">
<li>Unfortunately, I don't have the spmXXX-ardec.fits files for those</li>
<li class="on"><code>[X]</code> Write to Teresa and see if she has them</li>
<li>An example image+slit is pp260.fits</li>
<li>Now she has sent these - they are in <a href="file:///Users/will/Dropbox/papers/LL-Objects/feb2006/"><a href="file:///Users/will/Dropbox/papers/LL-Objects/feb2006/">file:///Users/will/Dropbox/papers/LL-Objects/feb2006/</a></a></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgheadline104" class="outline-4">
<h4 id="orgheadline104"><span class="section-number-4">10.2.5</span> Feb 2013</h4>
<div class="outline-text-4" id="text-10-2-5">
<ul class="org-ul">
<li>These are in <a href="file:///Users/will/Dropbox/SPMFEB13/">file:///Users/will/Dropbox/SPMFEB13/</a>
<ul class="org-ul">
<li>Either in <a href="file:///Users/will/Dropbox/SPMFEB13/WesternShocks/">file:///Users/will/Dropbox/SPMFEB13/WesternShocks/</a></li>
<li>Or in one of the date-named folders</li>
</ul></li>
</ul>
</div>
<div id="outline-container-orgheadline4" class="outline-5">
<h5 id="orgheadline4"><a id="ID-F6ED03C3-EC32-4444-9746-4E3C2A15CD63"></a><span class="section-number-5">10.2.5.1</span> WCS values</h5>
<div class="outline-text-5" id="text-10-2-5-1">
<ul class="org-ul">
<li>These are with a different chip, and with binning of 3x2</li>
<li>Here I calculate a similar table to what I did for the <a href="#orgheadline3">vertical slits</a></li>
<li>This time we have dy = 0.52 arcsec</li>
<li>The PA is within 0.5 deg of 90
<ul class="org-ul">
<li>But it does vary about 1 deg between the two nights</li>
</ul></li>
</ul>
<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock9"><span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS

<span style="color: #dfaf8f;">table</span> = [[<span style="color: #eee8aa; font-style: italic;">'image'</span>, <span style="color: #eee8aa; font-style: italic;">'spectrum'</span>, <span style="color: #eee8aa; font-style: italic;">'grating'</span>,
          <span style="color: #eee8aa; font-style: italic;">'RA0'</span>, <span style="color: #eee8aa; font-style: italic;">'Dec0'</span>, <span style="color: #eee8aa; font-style: italic;">'dy'</span>, <span style="color: #eee8aa; font-style: italic;">'PA'</span>,
          <span style="color: #eee8aa; font-style: italic;">'airmass'</span>, <span style="color: #eee8aa; font-style: italic;">'weight'</span>, <span style="color: #eee8aa; font-style: italic;">'delta'</span>], <span style="color: #cFfBcF;">None</span>]
<span style="color: #b9d3ee;">for</span> imid, specid, night, jslit, dj, ishift, fac, bright, bgrad <span style="color: #b9d3ee;">in</span> intable:
    <span style="color: #dfaf8f;">fn</span> = <span style="color: #eee8aa; font-style: italic;">'spm{:03d}_ardec.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(imid)
    hdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(fn)

    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find pixel scale along slit and position angle of slit</span>
    <span style="color: #5F7F5F;">#</span>
    <span style="color: #dfaf8f;">dRA_arcsec</span> = hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD1_1'</span>]*3600*np.cos(np.radians(hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRVAL2'</span>]))
    <span style="color: #dfaf8f;">dDEC_arcsec</span> = hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD2_1'</span>]*3600
    <span style="color: #dfaf8f;">dy</span> = np.hypot(dRA_arcsec, dDEC_arcsec)
    <span style="color: #dfaf8f;">PA</span> = np.degrees(np.arctan2(dRA_arcsec, dDEC_arcsec))
    <span style="color: #dfaf8f;">grating</span> = hdu.header[<span style="color: #eee8aa; font-style: italic;">'GRATING'</span>]
    <span style="color: #dfaf8f;">airmass</span> = hdu.header[<span style="color: #eee8aa; font-style: italic;">'AIRMASS'</span>]
    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find the RA and Dec of the spectral slit center</span>
    <span style="color: #5F7F5F;">#</span>

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Pixel coords of spectrum slit center on image (in FITS 1-based convention)</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">I *think* the shift along the slit goes the other way here</span>
    <span style="color: #dfaf8f;">i0</span>, <span style="color: #dfaf8f;">j0</span> = 0.5*(1 + hdu.header[<span style="color: #eee8aa; font-style: italic;">'NAXIS1'</span>]) + ishift, jslit

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Convert to world coordinates</span>
    <span style="color: #dfaf8f;">wcs</span> = WCS(hdu.header)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Crazy packing/unpacking required to use single scalar coords</span>
    (RA0, Dec0), = wcs.all_pix2world([[i0, j0]], 1)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Test it by hand using small-patch-of-sky approximation</span>
    <span style="color: #dfaf8f;">c</span> = 1./np.cos(np.radians(-5.42))
    <span style="color: #dfaf8f;">RA1</span> = (hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRVAL1'</span>]
           + c*hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD1_1'</span>]*(i0 - hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRPIX1'</span>])
           + c*hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD1_2'</span>]*(j0 - hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRPIX2'</span>]))
    <span style="color: #dfaf8f;">Dec1</span> = (hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRVAL2'</span>]
            + hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD2_1'</span>]*(i0 - hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRPIX1'</span>])
            + hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD2_2'</span>]*(j0 - hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRPIX2'</span>]))
    <span style="color: #b9d3ee;">assert</span>(<span style="color: #DCDCCC; font-weight: bold;">abs</span>(RA1 - RA0) &lt; 1e-6 )
    <span style="color: #b9d3ee;">assert</span>(<span style="color: #DCDCCC; font-weight: bold;">abs</span>(Dec1 - Dec0) &lt; 1e-6 )

    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find total weight factor, combining inter-image factor with the</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">image-to-spectrum factor</span>
    <span style="color: #5F7F5F;">#</span>
    <span style="color: #dfaf8f;">weight</span> = (fac/5.5)*bright

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find linear E-W gradient to correct</span>
    <span style="color: #dfaf8f;">delta</span> = -1.24*(bgrad - 1.0)

    table.append([imid, <span style="color: #DCDCCC; font-weight: bold;">int</span>(imid)+1, grating, 
                  <span style="color: #eee8aa; font-style: italic;">'{:.5f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(RA0),
                  <span style="color: #eee8aa; font-style: italic;">'{:.5f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(Dec0),
                  <span style="color: #eee8aa; font-style: italic;">'{:.4f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(dy), <span style="color: #eee8aa; font-style: italic;">'{:.3f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(PA),
                  <span style="color: #eee8aa; font-style: italic;">'{:.2f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(airmass),
                  <span style="color: #eee8aa; font-style: italic;">'{:.2f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(weight), <span style="color: #eee8aa; font-style: italic;">'{:.2f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(delta),
    ])
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">image</th>
<th scope="col" class="org-right">spectrum</th>
<th scope="col" class="org-right">grating</th>
<th scope="col" class="org-right">RA0</th>
<th scope="col" class="org-right">Dec0</th>
<th scope="col" class="org-right">dy</th>
<th scope="col" class="org-right">PA</th>
<th scope="col" class="org-right">airmass</th>
<th scope="col" class="org-right">weight</th>
<th scope="col" class="org-right">delta</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">165</td>
<td class="org-right">166</td>
<td class="org-right">12</td>
<td class="org-right">83.62409</td>
<td class="org-right">-5.44097</td>
<td class="org-right">0.5248</td>
<td class="org-right">90.496</td>
<td class="org-right">2.05</td>
<td class="org-right">0.78</td>
<td class="org-right">-0.50</td>
</tr>

<tr>
<td class="org-right">169</td>
<td class="org-right">170</td>
<td class="org-right">13</td>
<td class="org-right">83.62424</td>
<td class="org-right">-5.43831</td>
<td class="org-right">0.5251</td>
<td class="org-right">90.449</td>
<td class="org-right">2.48</td>
<td class="org-right">0.72</td>
<td class="org-right">-0.50</td>
</tr>

<tr>
<td class="org-right">237</td>
<td class="org-right">238</td>
<td class="org-right">11</td>
<td class="org-right">83.62752</td>
<td class="org-right">-5.43613</td>
<td class="org-right">0.5249</td>
<td class="org-right">90.421</td>
<td class="org-right">1.25</td>
<td class="org-right">0.97</td>
<td class="org-right">-0.00</td>
</tr>

<tr>
<td class="org-right">232</td>
<td class="org-right">233</td>
<td class="org-right">9</td>
<td class="org-right">83.62683</td>
<td class="org-right">-5.43216</td>
<td class="org-right">0.5243</td>
<td class="org-right">90.399</td>
<td class="org-right">1.25</td>
<td class="org-right">1.05</td>
<td class="org-right">-0.00</td>
</tr>

<tr>
<td class="org-right">226</td>
<td class="org-right">227</td>
<td class="org-right">10</td>
<td class="org-right">83.61872</td>
<td class="org-right">-5.42951</td>
<td class="org-right">0.5252</td>
<td class="org-right">90.462</td>
<td class="org-right">1.28</td>
<td class="org-right">1.09</td>
<td class="org-right">-0.00</td>
</tr>

<tr>
<td class="org-right">149</td>
<td class="org-right">150</td>
<td class="org-right">4</td>
<td class="org-right">83.63349</td>
<td class="org-right">-5.42399</td>
<td class="org-right">0.5249</td>
<td class="org-right">90.561</td>
<td class="org-right">1.38</td>
<td class="org-right">0.75</td>
<td class="org-right">-0.87</td>
</tr>

<tr>
<td class="org-right">154</td>
<td class="org-right">155</td>
<td class="org-right">5</td>
<td class="org-right">83.63366</td>
<td class="org-right">-5.42268</td>
<td class="org-right">0.5247</td>
<td class="org-right">90.579</td>
<td class="org-right">1.51</td>
<td class="org-right">0.81</td>
<td class="org-right">-0.87</td>
</tr>

<tr>
<td class="org-right">159</td>
<td class="org-right">160</td>
<td class="org-right">9</td>
<td class="org-right">83.63375</td>
<td class="org-right">-5.42026</td>
<td class="org-right">0.5244</td>
<td class="org-right">90.651</td>
<td class="org-right">1.69</td>
<td class="org-right">0.80</td>
<td class="org-right">-0.87</td>
</tr>

<tr>
<td class="org-right">33</td>
<td class="org-right">34</td>
<td class="org-right">-4</td>
<td class="org-right">83.62033</td>
<td class="org-right">-5.41655</td>
<td class="org-right">0.5149</td>
<td class="org-right">89.637</td>
<td class="org-right">1.31</td>
<td class="org-right">0.84</td>
<td class="org-right">0.25</td>
</tr>

<tr>
<td class="org-right">29</td>
<td class="org-right">30</td>
<td class="org-right">-4</td>
<td class="org-right">83.61937</td>
<td class="org-right">-5.41543</td>
<td class="org-right">0.5148</td>
<td class="org-right">89.729</td>
<td class="org-right">1.26</td>
<td class="org-right">0.92</td>
<td class="org-right">0.25</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-orgheadline97" class="outline-5">
<h5 id="orgheadline97"><a id="ID-23506DE2-4D98-40C5-961F-4715BE7A1F55"></a><span class="section-number-5">10.2.5.2</span> Inter-position brightness calibration</h5>
<div class="outline-text-5" id="text-10-2-5-2">
<ul class="org-ul">
<li>I have measured brightness in several parts of the image
<ul class="org-ul">
<li>Shown in table below, where *-ed columns are normalised to <code>226</code> which seems to be the best</li>
</ul></li>
<li>There are problems with large-scale brightness gradients in some exposures
<ul class="org-ul">
<li>Particularly E-W</li>
<li>I have compared with <code>219</code> of the horizontal slits</li>
<li><code>226</code> looks fine, but <code>149</code> has a clear spurious gradient - falling from W to E</li>
<li><code>033</code> and <code>029</code> on the other hand have a gradient the other way</li>
<li>This is shown in the <code>W/E</code> column of the table, which shows the average ratio between the West and East normalizations</li>
<li>So we can divide the images into 3 groups:
<dl class="org-dl">
<dt>Fine</dt><dd>237, 232, 226 (W/E ~= 1)</dd>
<dt>West bias</dt><dd>165, 169, 149, 154, 159 (W/E ~= 1.45)</dd>
<dt>East bias</dt><dd>033, 029 (W/E ~= 0.8)</dd>
</dl></li>
</ul></li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">image</th>
<th scope="col" class="org-right">NE</th>
<th scope="col" class="org-right">NW</th>
<th scope="col" class="org-right">SW</th>
<th scope="col" class="org-right">SE</th>
<th scope="col" class="org-right">*NE</th>
<th scope="col" class="org-right">*NW</th>
<th scope="col" class="org-right">*SW</th>
<th scope="col" class="org-right">*SE</th>
<th scope="col" class="org-left">Mean</th>
<th scope="col" class="org-left">W/E</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">165</td>
<td class="org-right">507</td>
<td class="org-right">435</td>
<td class="org-right">434</td>
<td class="org-right">160</td>
<td class="org-right">0.69</td>
<td class="org-right">0.87</td>
<td class="org-right">0.82</td>
<td class="org-right">0.54</td>
<td class="org-left">0.73 +/- 0.07</td>
<td class="org-left">1.39 +/- 0.13</td>
</tr>

<tr>
<td class="org-right">169</td>
<td class="org-right">470</td>
<td class="org-right">426</td>
<td class="org-right">405</td>
<td class="org-right">149</td>
<td class="org-right">0.64</td>
<td class="org-right">0.85</td>
<td class="org-right">0.76</td>
<td class="org-right">0.50</td>
<td class="org-left">0.69 +/- 0.08</td>
<td class="org-left">1.42 +/- 0.10</td>
</tr>

<tr>
<td class="org-right">237</td>
<td class="org-right">685</td>
<td class="org-right">485</td>
<td class="org-right">491</td>
<td class="org-right">267</td>
<td class="org-right">0.94</td>
<td class="org-right">0.97</td>
<td class="org-right">0.93</td>
<td class="org-right">0.89</td>
<td class="org-left">0.93 +/- 0.02</td>
<td class="org-left">1.04 +/- 6.5e-3</td>
</tr>

<tr>
<td class="org-right">232</td>
<td class="org-right">700</td>
<td class="org-right">473</td>
<td class="org-right">511</td>
<td class="org-right">272</td>
<td class="org-right">0.96</td>
<td class="org-right">0.94</td>
<td class="org-right">0.96</td>
<td class="org-right">0.91</td>
<td class="org-left">0.94 +/- 0.01</td>
<td class="org-left">1.02 +/- 0.04</td>
</tr>

<tr>
<td class="org-right">226</td>
<td class="org-right">730</td>
<td class="org-right">502</td>
<td class="org-right">530</td>
<td class="org-right">299</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">1</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-right">149</td>
<td class="org-right">490</td>
<td class="org-right">470</td>
<td class="org-right">406</td>
<td class="org-right">138</td>
<td class="org-right">0.67</td>
<td class="org-right">0.94</td>
<td class="org-right">0.77</td>
<td class="org-right">0.46</td>
<td class="org-left">0.71 +/- 0.10</td>
<td class="org-left">1.54 +/- 0.14</td>
</tr>

<tr>
<td class="org-right">154</td>
<td class="org-right">508</td>
<td class="org-right">466</td>
<td class="org-right">418</td>
<td class="org-right">138</td>
<td class="org-right">0.70</td>
<td class="org-right">0.93</td>
<td class="org-right">0.79</td>
<td class="org-right">0.46</td>
<td class="org-left">0.72 +/- 0.10</td>
<td class="org-left">1.52 +/- 0.19</td>
</tr>

<tr>
<td class="org-right">159</td>
<td class="org-right">515</td>
<td class="org-right">479</td>
<td class="org-right">436</td>
<td class="org-right">154</td>
<td class="org-right">0.71</td>
<td class="org-right">0.95</td>
<td class="org-right">0.82</td>
<td class="org-right">0.52</td>
<td class="org-left">0.75 +/- 0.09</td>
<td class="org-left">1.46 +/- 0.12</td>
</tr>

<tr>
<td class="org-right">033</td>
<td class="org-right">579</td>
<td class="org-right">294</td>
<td class="org-right">355</td>
<td class="org-right">238</td>
<td class="org-right">0.79</td>
<td class="org-right">0.59</td>
<td class="org-right">0.67</td>
<td class="org-right">0.80</td>
<td class="org-left">0.71 +/- 0.05</td>
<td class="org-left">0.79 +/- 0.05</td>
</tr>

<tr>
<td class="org-right">029</td>
<td class="org-right">581</td>
<td class="org-right">307</td>
<td class="org-right">356</td>
<td class="org-right">224</td>
<td class="org-right">0.80</td>
<td class="org-right">0.61</td>
<td class="org-right">0.67</td>
<td class="org-right">0.75</td>
<td class="org-left">0.71 +/- 0.04</td>
<td class="org-left">0.83 +/- 0.07</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>So to correct the brightness gradients, we use the following:
<ul class="org-ul">
<li>For <code>149</code>, we have brightness the same brightness as 226 in the W side, but 0.5 times the brightness in the E side</li>
<li>So we will try multiplying by a linear function <code>(1 + delta*(i - 0.5*NX)/NX)</code></li>
<li>For this case, we want (1 + 0.5 &delta;)/(1 - 0.5 &delta;) = 0.5 (remember that i increases from W to E)
<ul class="org-ul">
<li>=&gt; 1 + 0.5 &delta; = 0.5 - 0.25 &delta; =&gt; 0.5 = -0.75 &delta; =&gt; &delta; = -2/3</li>
<li>This is for a case W/E = 1.54 and it should scale with (W/E - 1)</li>
<li>So we get &delta; = -1.24 (W/E - 1)</li>
</ul></li>
</ul></li>
<li>The columns "Mean" and "W/E" get copied to columns <code>bfac</code> and <code>bgrad</code> respectively in the <a href="#orgheadline2">table above</a></li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-08-25 Tue] </span></span> I was not satisfied with the brightness normalizations
<ul class="org-ul">
<li>Some slits, notably 149, 154, 159 seem to be too bright in the combined image</li>
<li>So I have remeasured the brightness in a central point (the bright clump just to the W of the nose of the giant bowshock)</li>
<li>This gives slightly higher normalizations for those slits</li>
<li><b>BUT</b> we also need to account for the affect of the &delta; correction on the reference point
<ul class="org-ul">
<li>X0 = NX/2 = 312</li>
<li>From the table, the Xpix values of the reference point can be smaller or larger than that</li>
<li>So there is a further correction factor dcorr = 1 + &delta; (Xpix - X0)/NX, which we have to <i>multiply</i> the brightness norms by</li>
<li>I copied the delta values from the table <a href="#orgheadline4">here</a></li>
</ul></li>
<li>The result is that the corrections are closer to unity for nearly all the slits</li>
</ul></li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">image</th>
<th scope="col" class="org-right">bright</th>
<th scope="col" class="org-right">Xpix</th>
<th scope="col" class="org-right">norm</th>
<th scope="col" class="org-right">delta</th>
<th scope="col" class="org-right">dcorr</th>
<th scope="col" class="org-right">corrnorm</th>
<th scope="col" class="org-right">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">165</td>
<td class="org-right">677</td>
<td class="org-right">344</td>
<td class="org-right">0.798</td>
<td class="org-right">-0.50</td>
<td class="org-right">0.974</td>
<td class="org-right">0.777</td>
<td class="org-right">2719.5</td>
</tr>

<tr>
<td class="org-right">169</td>
<td class="org-right">646</td>
<td class="org-right">341</td>
<td class="org-right">0.762</td>
<td class="org-right">-0.50</td>
<td class="org-right">0.977</td>
<td class="org-right">0.744</td>
<td class="org-right">2604.</td>
</tr>

<tr>
<td class="org-right">237</td>
<td class="org-right">822</td>
<td class="org-right">328</td>
<td class="org-right">0.969</td>
<td class="org-right">-0.00</td>
<td class="org-right">1.000</td>
<td class="org-right">0.969</td>
<td class="org-right">3391.5</td>
</tr>

<tr>
<td class="org-right">232</td>
<td class="org-right">848</td>
<td class="org-right">334</td>
<td class="org-right">1</td>
<td class="org-right">-0.00</td>
<td class="org-right">1.000</td>
<td class="org-right">1.000</td>
<td class="org-right">3500.</td>
</tr>

<tr>
<td class="org-right">226</td>
<td class="org-right">846</td>
<td class="org-right">389</td>
<td class="org-right">0.998</td>
<td class="org-right">-0.00</td>
<td class="org-right">1.000</td>
<td class="org-right">0.998</td>
<td class="org-right">3493.</td>
</tr>

<tr>
<td class="org-right">149</td>
<td class="org-right">673</td>
<td class="org-right">284</td>
<td class="org-right">0.794</td>
<td class="org-right">-0.87</td>
<td class="org-right">1.039</td>
<td class="org-right">0.825</td>
<td class="org-right">2887.5</td>
</tr>

<tr>
<td class="org-right">154</td>
<td class="org-right">700</td>
<td class="org-right">280</td>
<td class="org-right">0.825</td>
<td class="org-right">-0.87</td>
<td class="org-right">1.045</td>
<td class="org-right">0.862</td>
<td class="org-right">3017.</td>
</tr>

<tr>
<td class="org-right">159</td>
<td class="org-right">663</td>
<td class="org-right">279</td>
<td class="org-right">0.782</td>
<td class="org-right">-0.87</td>
<td class="org-right">1.046</td>
<td class="org-right">0.818</td>
<td class="org-right">2863.</td>
</tr>

<tr>
<td class="org-right">033</td>
<td class="org-right">694</td>
<td class="org-right">370</td>
<td class="org-right">0.818</td>
<td class="org-right">0.25</td>
<td class="org-right">1.023</td>
<td class="org-right">0.837</td>
<td class="org-right">2929.5</td>
</tr>

<tr>
<td class="org-right">029</td>
<td class="org-right">697</td>
<td class="org-right">386</td>
<td class="org-right">0.822</td>
<td class="org-right">0.25</td>
<td class="org-right">1.030</td>
<td class="org-right">0.847</td>
<td class="org-right">2964.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-orgheadline111" class="outline-4">
<h4 id="orgheadline111"><span class="section-number-4">10.2.6</span> Jan 2010</h4>
<div class="outline-text-4" id="text-10-2-6">
<ul class="org-ul">
<li>Copied files to <a href="file:///Users/will/Dropbox/SPMJAN10/reducciones/">~/Dropbox/SPMJAN10/reducciones/</a></li>
<li>Looking at which ones to use to see if I agree with Tere</li>
</ul>
</div>
<div id="outline-container-orgheadline3" class="outline-5">
<h5 id="orgheadline3"><a id="ID-6BFD88F6-71FD-48D3-B8E4-5FF55A3B3D9D"></a><span class="section-number-5">10.2.6.1</span> WCS values and per-slit weighting</h5>
<div class="outline-text-5" id="text-10-2-6-1">
<ul class="org-ul">
<li>Alba's coordinates seem to be for the center of the slit in the image+slit</li>
<li>dWav = 0.043752133846283 Ang (2 km/s)</li>
<li>dy = 0.6229 arcsec (see table below)
<ul class="org-ul">
<li>range is 0.6211 to 0.6249</li>
</ul></li>
<li>PA does vary from slit to slit: 3.13 to 3.18</li>
<li>In both cases, over 512 pixels, the variation in PA and dy correspond to only a couple of pixels</li>
<li>Now we gather all the needed information into the following table
<ul class="org-ul">
<li>We calculate the (RA0, Dec0) of the slit center (taking into account the <code>jshift</code> values)</li>
<li>We calculate the pixel scale and PA of the slit</li>
<li>We calculate a total weight by multiplying together the inter-position and the image-to-spectrum values</li>
</ul></li>
</ul>

<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock10"><span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS

<span style="color: #dfaf8f;">table</span> = [[<span style="color: #eee8aa; font-style: italic;">'image'</span>, <span style="color: #eee8aa; font-style: italic;">'spectrum'</span>, <span style="color: #eee8aa; font-style: italic;">'RA0'</span>, <span style="color: #eee8aa; font-style: italic;">'Dec0'</span>, <span style="color: #eee8aa; font-style: italic;">'dy'</span>, <span style="color: #eee8aa; font-style: italic;">'PA'</span>, <span style="color: #eee8aa; font-style: italic;">'weight'</span>], <span style="color: #cFfBcF;">None</span>]
<span style="color: #b9d3ee;">for</span> imid, specid, islit, jshift, fac, bfac <span style="color: #b9d3ee;">in</span> intable:
    <span style="color: #dfaf8f;">fn</span> = <span style="color: #eee8aa; font-style: italic;">'spm{}-ardec.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(imid)
    hdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(fn)

    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find pixel scale along slit and position angle of slit</span>
    <span style="color: #5F7F5F;">#</span>
    <span style="color: #dfaf8f;">dRA_arcsec</span> = hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD1_2'</span>]*3600*np.cos(np.radians(hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRVAL2'</span>]))
    <span style="color: #dfaf8f;">dDEC_arcsec</span> = hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD2_2'</span>]*3600
    <span style="color: #dfaf8f;">dy</span> = np.hypot(dRA_arcsec, dDEC_arcsec)
    <span style="color: #dfaf8f;">PA</span> = np.degrees(np.arctan2(dRA_arcsec, dDEC_arcsec))

    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find the RA and Dec of the spectral slit center</span>
    <span style="color: #5F7F5F;">#</span>

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Pixel coords of spectrum slit center on image (in FITS 1-based convention)</span>
    <span style="color: #dfaf8f;">i0</span>, <span style="color: #dfaf8f;">j0</span> = islit, 0.5*(1 + hdu.header[<span style="color: #eee8aa; font-style: italic;">'NAXIS2'</span>]) - jshift

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Convert to world coordinates</span>
    <span style="color: #dfaf8f;">wcs</span> = WCS(hdu.header)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Crazy packing/unpacking required to use single scalar coords</span>
    (RA0, Dec0), = wcs.all_pix2world([[i0, j0]], 1)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Test it by hand using small-patch-of-sky approximation</span>
    <span style="color: #dfaf8f;">c</span> = 1./np.cos(np.radians(-5.42))
    <span style="color: #dfaf8f;">RA1</span> = (hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRVAL1'</span>]
           + c*hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD1_1'</span>]*(i0 - hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRPIX1'</span>])
           + c*hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD1_2'</span>]*(j0 - hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRPIX2'</span>]))
    <span style="color: #dfaf8f;">Dec1</span> = (hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRVAL2'</span>]
            + hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD2_1'</span>]*(i0 - hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRPIX1'</span>])
            + hdu.header[<span style="color: #eee8aa; font-style: italic;">'CD2_2'</span>]*(j0 - hdu.header[<span style="color: #eee8aa; font-style: italic;">'CRPIX2'</span>]))
    <span style="color: #b9d3ee;">assert</span>(<span style="color: #DCDCCC; font-weight: bold;">abs</span>(RA1 - RA0) &lt; 1e-6 )
    <span style="color: #b9d3ee;">assert</span>(<span style="color: #DCDCCC; font-weight: bold;">abs</span>(Dec1 - Dec0) &lt; 1e-6 )

    <span style="color: #5F7F5F;">#</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find total weight factor, combining inter-image factor with the</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">image-to-spectrum factor</span>
    <span style="color: #5F7F5F;">#</span>
    <span style="color: #dfaf8f;">weight</span> = (fac/4.4)/bfac

    table.append([imid, <span style="color: #DCDCCC; font-weight: bold;">int</span>(imid)+1,
                  <span style="color: #eee8aa; font-style: italic;">'{:.5f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(RA0),
                  <span style="color: #eee8aa; font-style: italic;">'{:.5f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(Dec0),
                  <span style="color: #eee8aa; font-style: italic;">'{:.4f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(dy), <span style="color: #eee8aa; font-style: italic;">'{:.3f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(PA),
                  <span style="color: #eee8aa; font-style: italic;">'{:.4f}'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(weight),
    ])
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">image</th>
<th scope="col" class="org-right">spectrum</th>
<th scope="col" class="org-right">RA0</th>
<th scope="col" class="org-right">Dec0</th>
<th scope="col" class="org-right">dy</th>
<th scope="col" class="org-right">PA</th>
<th scope="col" class="org-right">weight</th>
<th scope="col" class="org-right">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">202</td>
<td class="org-right">203</td>
<td class="org-right">83.62012</td>
<td class="org-right">-5.42575</td>
<td class="org-right">0.6246</td>
<td class="org-right">3.132</td>
<td class="org-right">0.7755</td>
<td class="org-right">3877.5</td>
</tr>

<tr>
<td class="org-right">124</td>
<td class="org-right">125</td>
<td class="org-right">83.61775</td>
<td class="org-right">-5.42765</td>
<td class="org-right">0.6222</td>
<td class="org-right">3.379</td>
<td class="org-right">0.4288</td>
<td class="org-right">2144.</td>
</tr>

<tr>
<td class="org-right">206</td>
<td class="org-right">207</td>
<td class="org-right">83.61646</td>
<td class="org-right">-5.42573</td>
<td class="org-right">0.6227</td>
<td class="org-right">3.300</td>
<td class="org-right">0.8803</td>
<td class="org-right">4401.5</td>
</tr>

<tr>
<td class="org-right">128</td>
<td class="org-right">129</td>
<td class="org-right">83.61513</td>
<td class="org-right">-5.42787</td>
<td class="org-right">0.6231</td>
<td class="org-right">3.322</td>
<td class="org-right">0.3720</td>
<td class="org-right">1860.</td>
</tr>

<tr>
<td class="org-right">133</td>
<td class="org-right">134</td>
<td class="org-right">83.61537</td>
<td class="org-right">-5.42226</td>
<td class="org-right">0.6231</td>
<td class="org-right">3.259</td>
<td class="org-right">0.7067</td>
<td class="org-right">3533.5</td>
</tr>

<tr>
<td class="org-right">210</td>
<td class="org-right">211</td>
<td class="org-right">83.61386</td>
<td class="org-right">-5.42573</td>
<td class="org-right">0.6229</td>
<td class="org-right">3.283</td>
<td class="org-right">0.9794</td>
<td class="org-right">4897.</td>
</tr>

<tr>
<td class="org-right">137</td>
<td class="org-right">138</td>
<td class="org-right">83.61278</td>
<td class="org-right">-5.42226</td>
<td class="org-right">0.6232</td>
<td class="org-right">3.270</td>
<td class="org-right">0.4106</td>
<td class="org-right">2053.</td>
</tr>

<tr>
<td class="org-right">214</td>
<td class="org-right">215</td>
<td class="org-right">83.61140</td>
<td class="org-right">-5.42547</td>
<td class="org-right">0.6247</td>
<td class="org-right">3.132</td>
<td class="org-right">0.8733</td>
<td class="org-right">4366.5</td>
</tr>

<tr>
<td class="org-right">145</td>
<td class="org-right">146</td>
<td class="org-right">83.61005</td>
<td class="org-right">-5.42080</td>
<td class="org-right">0.6218</td>
<td class="org-right">3.358</td>
<td class="org-right">0.0877</td>
<td class="org-right">438.5</td>
</tr>

<tr>
<td class="org-right">248</td>
<td class="org-right">249</td>
<td class="org-right">83.60913</td>
<td class="org-right">-5.42673</td>
<td class="org-right">0.6231</td>
<td class="org-right">3.218</td>
<td class="org-right">0.5523</td>
<td class="org-right">2761.5</td>
</tr>

<tr>
<td class="org-right">219</td>
<td class="org-right">220</td>
<td class="org-right">83.60811</td>
<td class="org-right">-5.42615</td>
<td class="org-right">0.6227</td>
<td class="org-right">3.331</td>
<td class="org-right">0.9886</td>
<td class="org-right">4943.</td>
</tr>

<tr>
<td class="org-right">157</td>
<td class="org-right">158</td>
<td class="org-right">83.60713</td>
<td class="org-right">-5.42289</td>
<td class="org-right">0.6211</td>
<td class="org-right">3.373</td>
<td class="org-right">0.2354</td>
<td class="org-right">1177.</td>
</tr>

<tr>
<td class="org-right">236</td>
<td class="org-right">237</td>
<td class="org-right">83.60653</td>
<td class="org-right">-5.42631</td>
<td class="org-right">0.6233</td>
<td class="org-right">3.220</td>
<td class="org-right">0.8508</td>
<td class="org-right">4254.</td>
</tr>

<tr>
<td class="org-right">240</td>
<td class="org-right">241</td>
<td class="org-right">83.60476</td>
<td class="org-right">-5.42649</td>
<td class="org-right">0.6236</td>
<td class="org-right">3.256</td>
<td class="org-right">0.6566</td>
<td class="org-right">3283.</td>
</tr>

<tr>
<td class="org-right">244</td>
<td class="org-right">245</td>
<td class="org-right">83.60297</td>
<td class="org-right">-5.42626</td>
<td class="org-right">0.6249</td>
<td class="org-right">3.201</td>
<td class="org-right">0.5350</td>
<td class="org-right">2675.</td>
</tr>

<tr>
<td class="org-right">252</td>
<td class="org-right">253</td>
<td class="org-right">83.60148</td>
<td class="org-right">-5.42675</td>
<td class="org-right">0.6229</td>
<td class="org-right">3.335</td>
<td class="org-right">0.7314</td>
<td class="org-right">3657.</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline109" class="outline-5">
<h5 id="orgheadline109"><span class="section-number-5">10.2.6.2</span> Which to use</h5>
<div class="outline-text-5" id="text-10-2-6-2">
</div><ol class="org-ol"><li><a id="orgheadline96"></a><a id="ID-D625BE5F-BE3F-477A-8059-4B0AFEFEED54"></a>Positions in Alba's set that are acceptable<br  /><div class="outline-text-6" id="text-10-2-6-2-1">
<p>
202, 124, 206, 133(+), 210, 137, 214, 248(+), 219, 236, 240, 244, 252
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">ID</th>
<th scope="col" class="org-right">&#xa0;</th>
<th scope="col" class="org-right">Norm</th>
<th scope="col" class="org-right">Inverse</th>
<th scope="col" class="org-right">Bright</th>
<th scope="col" class="org-right">Norm</th>
<th scope="col" class="org-right">Inverse</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">202</td>
<td class="org-right">2083</td>
<td class="org-right">0.875</td>
<td class="org-right">1.143</td>
<td class="org-right">2087</td>
<td class="org-right">0.939</td>
<td class="org-right">1.065</td>
</tr>

<tr>
<td class="org-right">124</td>
<td class="org-right">1900</td>
<td class="org-right">0.699</td>
<td class="org-right">1.431</td>
<td class="org-right">1879</td>
<td class="org-right">0.726</td>
<td class="org-right">1.377</td>
</tr>

<tr>
<td class="org-right">206</td>
<td class="org-right">2089</td>
<td class="org-right">0.880</td>
<td class="org-right">1.136</td>
<td class="org-right">2101</td>
<td class="org-right">0.953</td>
<td class="org-right">1.049</td>
</tr>

<tr>
<td class="org-right">128</td>
<td class="org-right">1558</td>
<td class="org-right">0.372</td>
<td class="org-right">2.688</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>

<tr>
<td class="org-right">133</td>
<td class="org-right">1819</td>
<td class="org-right">0.622</td>
<td class="org-right">1.608</td>
<td class="org-right">1780</td>
<td class="org-right">0.624</td>
<td class="org-right">1.603</td>
</tr>

<tr>
<td class="org-right">210</td>
<td class="org-right">2192</td>
<td class="org-right">0.979</td>
<td class="org-right">1.021</td>
<td class="org-right">2141</td>
<td class="org-right">0.994</td>
<td class="org-right">1.006</td>
</tr>

<tr>
<td class="org-right">137</td>
<td class="org-right">1843</td>
<td class="org-right">0.645</td>
<td class="org-right">1.550</td>
<td class="org-right">1913</td>
<td class="org-right">0.760</td>
<td class="org-right">1.316</td>
</tr>

<tr>
<td class="org-right">214</td>
<td class="org-right">2148</td>
<td class="org-right">0.937</td>
<td class="org-right">1.067</td>
<td class="org-right">2125</td>
<td class="org-right">0.977</td>
<td class="org-right">1.024</td>
</tr>

<tr>
<td class="org-right">145</td>
<td class="org-right">1372</td>
<td class="org-right">0.193</td>
<td class="org-right">5.181</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>

<tr>
<td class="org-right">248</td>
<td class="org-right">1640</td>
<td class="org-right">0.450</td>
<td class="org-right">2.222</td>
<td class="org-right">1615</td>
<td class="org-right">0.455</td>
<td class="org-right">2.198</td>
</tr>

<tr>
<td class="org-right">219</td>
<td class="org-right">2214</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">2124</td>
<td class="org-right">0.976</td>
<td class="org-right">1.025</td>
</tr>

<tr>
<td class="org-right">157</td>
<td class="org-right">1324</td>
<td class="org-right">0.148</td>
<td class="org-right">6.757</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>

<tr>
<td class="org-right">236</td>
<td class="org-right">2100</td>
<td class="org-right">0.891</td>
<td class="org-right">1.122</td>
<td class="org-right">2070</td>
<td class="org-right">0.921</td>
<td class="org-right">1.086</td>
</tr>

<tr>
<td class="org-right">240</td>
<td class="org-right">2143</td>
<td class="org-right">0.932</td>
<td class="org-right">1.073</td>
<td class="org-right">2147</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">244</td>
<td class="org-right">2080</td>
<td class="org-right">0.872</td>
<td class="org-right">1.147</td>
<td class="org-right">2017</td>
<td class="org-right">0.867</td>
<td class="org-right">1.153</td>
</tr>

<tr>
<td class="org-right">252</td>
<td class="org-right">1792</td>
<td class="org-right">0.596</td>
<td class="org-right">1.678</td>
<td class="org-right">1792</td>
<td class="org-right">0.637</td>
<td class="org-right">1.570</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>The Inverse column <i>used</i> to agree closely with Alba's values</li>
<li>But now it does not, because I realised that the radec images have not had the bias subtracted!</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-08-17 Mon] </span></span> Dones it again to include more positions - new version is in columns 2 to 4</li>
<li>Note that values from this table are used <a href="#orgheadline1">above</a> to calculate the slit normalizations</li>
</ul>
</div></li>

<li><a id="orgheadline106"></a>Positions in Alba's set that are bad<br  /><div class="outline-text-6" id="text-10-2-6-2-2">
<p>
128(+), 101, 145, 157, 173
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline105"></a>Rehabilitation of some of these positions<br  /><div class="outline-text-7" id="text-10-2-6-2-2-1">
<ul class="org-ul">
<li>From my experience with the image-spectrum calibration, there is often a big difference between the quality of the image and that of hte spectrum</li>
<li>So we shouldn't rule out a position, just based on a poor image</li>
<li>Worth saving:
<dl class="org-dl">
<dt>128</dt><dd>slots in right next to 133</dd>
<dt>145</dt><dd>goes just before 248</dd>
<dt>157</dt><dd>goes before 236</dd>
</dl></li>
<li>Still terrible: 101 (no spectrum), 173 (just bad)</li>
</ul>
</div></li></ol></li>
<li><a id="orgheadline107"></a>Positions over to the NE<br  /><div class="outline-text-6" id="text-10-2-6-2-3">
<p>
spm078, spm085
</p>
</div></li>
<li><a id="orgheadline108"></a>Other positions omitted ny Alba<br  /><div class="outline-text-6" id="text-10-2-6-2-4">
<ul class="org-ul">
<li>spm142 - no spectrum</li>
<li>spm150 - ha spec exists, but looks weak and Tere says no</li>
<li>spm154 - no spectrum</li>
<li>spm161 - same as 150 but even worse</li>
<li>spm224 - has sii spec but no ha</li>
<li>spm231 - no spectrum</li>
</ul>
</div></li></ol>
</div>
<div id="outline-container-orgheadline110" class="outline-5">
<h5 id="orgheadline110"><span class="section-number-5">10.2.6.3</span> Message from Teresa <span class="timestamp-wrapper"><span class="timestamp">[2010-02-18 Thu]</span></span></h5>
<div class="outline-text-5" id="text-10-2-6-3">
<pre class="example">
Acabo de terminar las reducciones de las observaciones de Enero. Al
final nos quedamos con 16 posiciones, elimin 7 posiciones
porque las observ con muchas nubes por lo que no obtuve buenos
resultados, lo bueno fu que en la siguiente noche pude obtener
estas posiciones o cercanas a ellas. De cualquier manera las reduje
por si decidimos incluirlas.

Las reducciones estan en: /fs/tungol/home0/LEEDS/teresa/SPMENE10/reducciones

incluyo tambin la bitacora en pdf. Las posiciones que no tom en
cuenta para hacer los mapas fueron:

No incluidas        Slit cercana o casi en la misma posicin que la anterior
spm128                   spm133 (se ve mucho mejor que spm128)
spm231                   spm248
spm150                   spm224
spm157                   spm236
spm173                   spm252
spm161
spm129                   spm133

Hice la astrometra, las imagen+slit corregidas estn en el directorio
llamado "posiciones" adentro del direcotorio "reducciones"
Tambin hice dos posiciones al Este de la regin observada. Estn la
oeste de HH 505, las observ en Halpha y [S II]:
spm078 (image+slit), spm085 (image+slit). Podemos obtener la densidad
en estas posiciones.

Para la posicin de spm219 tom los espectros en Ha (spm220,221),
[SII] (spm225,226) y [OIII] (spm228,229)
Los espectros corregidos en longitud de onda los puse en:

/fs/tungol/home0/LEEDS/teresa/SPMENE10/observaciones/SPM{ha,nii,siis,siil,oiii}

Despus de hacer todo el trabajo hice el primer intento de los mapas
de momentos de Halpha y [NII] :D a ver que te parecen,
todos los archivos  estan en
/fs/tungol/home0/LEEDS/teresa/SPMENE10/observaciones:

{ha,nii}_{-100-040,-060+000,+000+060,+060+140,-020+040).wisomom-sum-fake.fits

haciendo un smooth:

{ha,nii}_{-100-040,-060+000,+000+060,+060+140,-020+040).wisomom-sum-smooth2d.fits

Hice tambin en rangos de 20 km/s para poder hacer los mapas a color
(no me quedarn tambin como a ti!)
que son los que anexo a este email.
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline117" class="outline-3">
<h3 id="orgheadline117"><span class="section-number-3">10.3</span> Making spectral maps</h3>
<div class="outline-text-3" id="text-10-3">
<ul class="org-ul">
<li>The plan is to start with a fine orthogonal RA-dec grid
<ul class="org-ul">
<li>Place all the slits onto there by looping over slit pixels and painting all the grid pixels that fall in each</li>
<li>Leave grid pixels transparent where no slit falls</li>
</ul></li>
<li>Then do the multi-resolution thing
<ul class="org-ul">
<li>As in <a href="../../Work/RubinWFC3/Tsquared/orion-t2.html#ID-E1B9B2C8-1CDE-407B-B9FE-4E31144F328C">Rebinning the maps</a> in orion tsquared notes</li>
<li>Which makes use of <a href="file:///Users/will/Work/RubinWFC3/Tsquared/rebin_utils.py"><a href="file:///Users/will/Work/RubinWFC3/Tsquared/rebin_utils.py">file:///Users/will/Work/RubinWFC3/Tsquared/rebin_utils.py</a></a></li>
</ul></li>
<li>This should give a map with all the holes filled in at lower resolution</li>
<li>To start with we will work with the original spectra that I already have
<ul class="org-ul">
<li>Later, we should switch to the bg-subtracted and brightness-corrected ones that Alba has</li>
</ul></li>
</ul>
</div>
<div id="outline-container-orgheadline113" class="outline-4">
<h4 id="orgheadline113"><span class="section-number-4">10.3.1</span> Define the output grid</h4>
<div class="outline-text-4" id="text-10-3-1">
<ul class="org-ul">
<li>1 arcsec is
<ul class="org-ul">
<li>2.778e-4 deg declination</li>
<li>2.765e-4 deg RA</li>
</ul></li>
<li>We will try a grid with 0.5 arcsec pixels that is 1024 x 1024, which should comfortably enclose all of the slits</li>
<li>AR reference of the horizontal slits is 83.6158 +/- 0.0019
<ul class="org-ul">
<li>AR range of vertical slits is 83.6016 to 83.6205: 68 cos(-5.4150) = 67.7 arcsec</li>
</ul></li>
<li>Dec reference of vertical slits is -5.4150 +/- 0.0006
<ul class="org-ul">
<li>Dec range of horizontal slits is -5.4409 to -5.4155 = 91.44 arcsec</li>
<li>Actually Dec value of the vertical slits is a bit lower now that I have taken into account the image-spectrum shift</li>
</ul></li>
<li>So we use
<ul class="org-ul">
<li>CRPIX1 = CRPIX2 = 256.5</li>
<li>CRVAL1 = 83.61, CRVAL2 = -5.423</li>
<li>CDELT1 = -0.5/3600, CDELT2 = 0.5/3600</li>
<li>PC1_1 = 1.0, PC1_2 = 0.0</li>
<li>PC2_1 = 0.0, PC2_2 = 1.0</li>
</ul></li>
<li>Note that the WCS matrix should be given in arcdegrees - the translation to degrees of RA is done automatically (and it doesn't matter much anyway, since we are near the equator)</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-4">
<h4 id="orgheadline5"><a id="ID-23C29E96-4471-454E-A463-D365731119C0"></a><span class="section-number-4">10.3.2</span> Test with the velocity-integrated emission</h4>
<div class="outline-text-4" id="text-10-3-2">
<p>
Some positions are a bit problematic - try missing them out: 
</p>
<ul class="org-ul">
<li>145</li>
</ul>


<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock11"><span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS

<span style="color: #5F7F5F;">#</span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">First set up WCS for the output image</span>
<span style="color: #5F7F5F;">#</span>

<span style="color: #dfaf8f;">NX</span>, <span style="color: #dfaf8f;">NY</span> = 1024, 1024
<span style="color: #dfaf8f;">dRA</span>, <span style="color: #dfaf8f;">dDec</span> = -0.5/3600., 0.5/3600.
<span style="color: #dfaf8f;">RA0</span>, <span style="color: #dfaf8f;">Dec0</span> = 83.61, -5.423
<span style="color: #dfaf8f;">w</span> = WCS(naxis=2)
<span style="color: #dfaf8f;">w.wcs.crpix</span> = [0.5*(1 + NX), 0.5*(1 + NY)]
<span style="color: #dfaf8f;">w.wcs.cdelt</span> = [dRA, dDec]
<span style="color: #dfaf8f;">w.wcs.crval</span> = [RA0, Dec0]
<span style="color: #dfaf8f;">w.wcs.ctype</span> = [<span style="color: #eee8aa; font-style: italic;">'RA---TAN'</span>, <span style="color: #eee8aa; font-style: italic;">'DEC--TAN'</span>]

<span style="color: #dfaf8f;">outimage</span> = np.zeros((NY, NX))
<span style="color: #dfaf8f;">outweights</span> = np.zeros((NY, NX))

<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Create world coord arrays for output image</span>
<span style="color: #dfaf8f;">II</span>, <span style="color: #dfaf8f;">JJ</span> = np.meshgrid(np.arange(NX), np.arange(NY))
<span style="color: #dfaf8f;">RA</span>, <span style="color: #dfaf8f;">Dec</span> = w.all_pix2world(II, JJ, 0)

<span style="color: #dfaf8f;">slit_width</span> = 2.0                <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">width in arcsec of 150 micron slit</span>

<span style="color: #dfaf8f;">light_speed</span> = 2.99792458e5
<span style="color: #dfaf8f;">wavrest</span> = 6562.7910
<span style="color: #dfaf8f;">heliocentric_correction</span> = 0.0   <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">I need to find this</span>
<span style="color: #dfaf8f;">vmin</span>, <span style="color: #dfaf8f;">vmax</span> = <span style="color: #DCDCCC; font-weight: bold;">float</span>(vmin), <span style="color: #DCDCCC; font-weight: bold;">float</span>(vmax)
<span style="color: #b9d3ee;">for</span> imid, specid, ra0, dec0, dy, PA, weight <span style="color: #b9d3ee;">in</span> vtab:
    <span style="color: #b9d3ee;">if</span> <span style="color: #DCDCCC; font-weight: bold;">int</span>(imid) <span style="color: #b9d3ee;">in</span> ignore:
        <span style="color: #b9d3ee;">continue</span>  <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">drop some positions</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Unpack floats from strings in table row</span>
    <span style="color: #dfaf8f;">ra0</span>, <span style="color: #dfaf8f;">dec0</span>, <span style="color: #dfaf8f;">dy</span>, <span style="color: #dfaf8f;">PA</span>, <span style="color: #dfaf8f;">weight</span> = [<span style="color: #DCDCCC; font-weight: bold;">float</span>(_) <span style="color: #b9d3ee;">for</span> _ <span style="color: #b9d3ee;">in</span> (ra0, dec0, dy, PA, weight)]
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Open H alpha slit spectrum</span>
    spechdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">'spec{}-ha.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid))

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Create velocity array from header</span>
    <span style="color: #dfaf8f;">nwav</span>, <span style="color: #dfaf8f;">k0</span>, <span style="color: #dfaf8f;">wav0</span>, <span style="color: #dfaf8f;">dwav</span> = [spechdu.header[kwd+<span style="color: #eee8aa; font-style: italic;">'1'</span>]
                            <span style="color: #b9d3ee;">for</span> kwd <span style="color: #b9d3ee;">in</span> (<span style="color: #eee8aa; font-style: italic;">'NAXIS'</span>, <span style="color: #eee8aa; font-style: italic;">'CRPIX'</span>, <span style="color: #eee8aa; font-style: italic;">'CRVAL'</span>, <span style="color: #eee8aa; font-style: italic;">'CDELT'</span>)]
    <span style="color: #dfaf8f;">wavs</span> = wav0 + (np.arange(nwav) - k0 + 1)*dwav
    <span style="color: #dfaf8f;">vels</span> = heliocentric_correction + light_speed*(wavs - wavrest)/wavrest
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find indices corresponding to velocity limits</span>
    <span style="color: #dfaf8f;">k1</span> = (vels &lt; vmin).<span style="color: #DCDCCC; font-weight: bold;">sum</span>()
    <span style="color: #dfaf8f;">k2</span> = (vels &lt;= vmax).<span style="color: #DCDCCC; font-weight: bold;">sum</span>()
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Velocities used'</span>, vels[k1:k2])

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Sum spectrum over all wavelengths</span>
    <span style="color: #dfaf8f;">profile</span> = spechdu.data[:, k1:k2].<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=1)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Transform output grid coords into slit frame offsets in arcsec</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">XX, YY are intermediate offset coordinates along RA, Dec axes</span>
    <span style="color: #dfaf8f;">XX</span> = 3600*(RA - ra0)*np.cos(np.radians(Dec))
    <span style="color: #dfaf8f;">YY</span> = 3600*(Dec - dec0)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Precalculate geometric factors for rotation to slit frame</span>
    <span style="color: #dfaf8f;">c</span>, <span style="color: #dfaf8f;">s</span> = np.cos(np.radians(PA)), np.sin(np.radians(PA))
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">X is ordinate perpendicular to slit</span>
    <span style="color: #dfaf8f;">X</span> = XX*c - YY*s
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Y is ordinate along slit</span>
    <span style="color: #dfaf8f;">Y</span> = YY*c - XX*s

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Mask for all output pixels that fall in the slit</span>
    <span style="color: #dfaf8f;">slitmask</span> = <span style="color: #DCDCCC; font-weight: bold;">abs</span>(X) &lt;= 0.5*slit_width
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">cycle over all slit y pixels</span>
    <span style="color: #b9d3ee;">for</span> j, intensity <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">enumerate</span>(profile):
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Offset from slit center</span>
        <span style="color: #dfaf8f;">y</span> = (j - 255.5)*dy
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Mask for output pixels that fall in this slit pixel</span>
        <span style="color: #dfaf8f;">pixmask</span> = slitmask &amp; (<span style="color: #DCDCCC; font-weight: bold;">abs</span>(Y - y) &lt;= 0.5*dy)
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Fill in the output intensity and weight arrays</span>
        <span style="color: #dfaf8f;">outimage</span>[pixmask] += intensity
        <span style="color: #dfaf8f;">outweights</span>[pixmask] += weight

<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Save everything as different images in a single fits file:</span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">1. The sum of the raw slits </span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">2. The weights</span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">3. The slits normalized by the weights</span>
fits.HDUList([
    fits.PrimaryHDU(),
    fits.ImageHDU(header=w.to_header(), data=outimage, name=<span style="color: #eee8aa; font-style: italic;">'slits'</span>),
    fits.ImageHDU(header=w.to_header(), data=outweights, name=<span style="color: #eee8aa; font-style: italic;">'weight'</span>),
    fits.ImageHDU(header=w.to_header(), data=outimage/outweights, name=<span style="color: #eee8aa; font-style: italic;">'scaled'</span>),
    ]).writeto(<span style="color: #eee8aa; font-style: italic;">'all-vert-{}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(label), clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>

<pre class="example">
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
Velocities used [-264.5365553  -262.53793006 -260.53930481 -258.54067957 -256.54205433
 -254.54342909 -252.54480385 -250.54617861 -248.54755336 -246.54892812
 -244.55030288 -242.55167764 -240.5530524  -238.55442716 -236.55580191
 -234.55717667 -232.55855143 -230.55992619 -228.56130095 -226.56267571
 -224.56405046 -222.56542522 -220.56679998 -218.56817474 -216.5695495
 -214.57092426 -212.57229901 -210.57367377 -208.57504853 -206.57642329
 -204.57779805 -202.57917281 -200.58054756 -198.58192232 -196.58329708
 -194.58467184 -192.5860466  -190.58742136 -188.58879611 -186.59017087
 -184.59154563 -182.59292039 -180.59429515 -178.59566991 -176.59704466
 -174.59841942 -172.59979418 -170.60116894 -168.6025437  -166.60391845
 -164.60529321 -162.60666797 -160.60804273 -158.60941749 -156.61079225
 -154.612167   -152.61354176 -150.61491652 -148.61629128 -146.61766604
 -144.6190408  -142.62041555 -140.62179031 -138.62316507 -136.62453983
 -134.62591459 -132.62728935 -130.6286641  -128.63003886 -126.63141362
 -124.63278838 -122.63416314 -120.6355379  -118.63691265 -116.63828741
 -114.63966217 -112.64103693 -110.64241169 -108.64378645 -106.6451612
 -104.64653596 -102.64791072 -100.64928548  -98.65066024  -96.652035
  -94.65340975  -92.65478451  -90.65615927  -88.65753403  -86.65890879
  -84.66028355  -82.6616583   -80.66303306  -78.66440782  -76.66578258
  -74.66715734  -72.6685321   -70.66990685  -68.67128161  -66.67265637
  -64.67403113  -62.67540589  -60.67678065  -58.6781554   -56.67953016
  -54.68090492  -52.68227968  -50.68365444  -48.6850292   -46.68640395
  -44.68777871  -42.68915347  -40.69052823  -38.69190299  -36.69327775
  -34.6946525   -32.69602726  -30.69740202  -28.69877678  -26.70015154
  -24.7015263   -22.70290105  -20.70427581  -18.70565057  -16.70702533
  -14.70840009  -12.70977484  -10.7111496    -8.71252436   -6.71389912
   -4.71527388   -2.71664864   -0.71802339    1.28060185    3.27922709
    5.27785233    7.27647757    9.27510281   11.27372806   13.2723533
   15.27097854   17.26960378   19.26822902   21.26685426   23.26547951
   25.26410475   27.26272999   29.26135523   31.25998047   33.25860571
   35.25723096   37.2558562    39.25448144   41.25310668   43.25173192
   45.25035716   47.24898241   49.24760765   51.24623289   53.24485813
   55.24348337   57.24210861   59.24073386   61.2393591    63.23798434
   65.23660958   67.23523482   69.23386006   71.23248531   73.23111055
   75.22973579   77.22836103   79.22698627   81.22561151   83.22423676
   85.222862     87.22148724   89.22011248   91.21873772   93.21736296
   95.21598821   97.21461345   99.21323869  101.21186393  103.21048917
  105.20911441  107.20773966  109.2063649   111.20499014  113.20361538
  115.20224062  117.20086586  119.19949111  121.19811635  123.19674159
  125.19536683  127.19399207  129.19261731  131.19124256  133.1898678
  135.18849304  137.18711828  139.18574352  141.18436877  143.18299401
  145.18161925  147.18024449  149.17886973  151.17749497  153.17612022
  155.17474546  157.1733707   159.17199594  161.17062118  163.16924642
  165.16787167  167.16649691  169.16512215  171.16374739  173.16237263
  175.16099787  177.15962312  179.15824836  181.1568736   183.15549884
  185.15412408  187.15274932  189.15137457  191.14999981  193.14862505
  195.14725029  197.14587553  199.14450077  201.14312602  203.14175126
  205.1403765   207.13900174  209.13762698  211.13625222  213.13487747
  215.13350271  217.13212795  219.13075319  221.12937843  223.12800367
  225.12662892  227.12525416  229.1238794   231.12250464  233.12112988
  235.11975512  237.11838037  239.11700561  241.11563085  243.11425609
  245.11288133  247.11150657  249.11013182  251.10875706  253.1073823
  255.10600754  257.10463278  259.10325802  261.10188327  263.10050851
  265.09913375  267.09775899  269.09638423  271.09500947  273.09363472
  275.09225996  277.0908852   279.08951044  281.08813568  283.08676092
  285.08538617  287.08401141  289.08263665  291.08126189  293.07988713
  295.07851238  297.07713762  299.07576286  301.0743881   303.07301334
  305.07163858  307.07026383  309.06888907  311.06751431  313.06613955
  315.06476479  317.06339003  319.06201528  321.06064052  323.05926576
  325.057891    327.05651624  329.05514148  331.05376673  333.05239197]
</pre>

<ul class="org-ul">
<li>The first image in the file is what can be used to combine with more data, for instance the horizontal slits</li>
<li>The third image is what should be used in the rebinning process (together with the second image, the weights)</li>
</ul>

<p>
This shows the scaled image in ds9
</p>
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-sum.fits[3]
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline6" class="outline-4">
<h4 id="orgheadline6"><a id="ID-60833550-A462-4F18-86DE-895625FF3E7A"></a><span class="section-number-4">10.3.3</span> Repeat the spectral map for the horizontal slits</h4>
<div class="outline-text-4" id="text-10-3-3">
<ul class="org-ul">
<li>We can't use the same program as for the vertical slits because the table has extra columns
<ul class="org-ul">
<li>In particular, it has the &delta; parameter to account for the linear brightness correction along the slit</li>
</ul></li>
<li>Also, the spectra are organised differently (wavelength along y-axis)</li>
<li>So we need to copy and modify the program</li>
<li><code>[3/3]</code> Other changes to the program:
<ul class="org-ul">
<li class="on"><code>[X]</code> Remove hardcoding of slit length in pixels (now NY)</li>
<li class="on"><code>[X]</code> Correct for &delta; factor
<ul class="org-ul">
<li>We should actually apply this to the weights, which would no longer be constant for the entire slit</li>
<li>Except, that I don't understand the reason for the gradient correction</li>
<li>But I have done it like that anyhow</li>
</ul></li>
<li class="on"><code>[X]</code> change sign of offset along slit</li>
</ul></li>
</ul>

<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock12"><span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">from</span> astropy.wcs <span style="color: #b9d3ee;">import</span> WCS

<span style="color: #5F7F5F;">#</span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">First set up WCS for the output image</span>
<span style="color: #5F7F5F;">#</span>

<span style="color: #dfaf8f;">NX</span>, <span style="color: #dfaf8f;">NY</span> = 1024, 1024
<span style="color: #dfaf8f;">dRA</span>, <span style="color: #dfaf8f;">dDec</span> = -0.5/3600., 0.5/3600.
<span style="color: #dfaf8f;">RA0</span>, <span style="color: #dfaf8f;">Dec0</span> = 83.61, -5.423
<span style="color: #dfaf8f;">w</span> = WCS(naxis=2)
<span style="color: #dfaf8f;">w.wcs.crpix</span> = [0.5*(1 + NX), 0.5*(1 + NY)]
<span style="color: #dfaf8f;">w.wcs.cdelt</span> = [dRA, dDec]
<span style="color: #dfaf8f;">w.wcs.crval</span> = [RA0, Dec0]
<span style="color: #dfaf8f;">w.wcs.ctype</span> = [<span style="color: #eee8aa; font-style: italic;">'RA---TAN'</span>, <span style="color: #eee8aa; font-style: italic;">'DEC--TAN'</span>]

<span style="color: #dfaf8f;">outimage</span> = np.zeros((NY, NX))
<span style="color: #dfaf8f;">outweights</span> = np.zeros((NY, NX))

<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Create world coord arrays for output image</span>
<span style="color: #dfaf8f;">II</span>, <span style="color: #dfaf8f;">JJ</span> = np.meshgrid(np.arange(NX), np.arange(NY))
<span style="color: #dfaf8f;">RA</span>, <span style="color: #dfaf8f;">Dec</span> = w.all_pix2world(II, JJ, 0)

<span style="color: #dfaf8f;">slit_width</span> = 2.0                <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">width in arcsec of 150 micron slit</span>

<span style="color: #dfaf8f;">light_speed</span> = 2.99792458e5
<span style="color: #dfaf8f;">wavrest</span> = 6562.7910
<span style="color: #dfaf8f;">heliocentric_correction</span> = 0.0   <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">I need to find this</span>
<span style="color: #dfaf8f;">vmin</span>, <span style="color: #dfaf8f;">vmax</span> = <span style="color: #DCDCCC; font-weight: bold;">float</span>(vmin), <span style="color: #DCDCCC; font-weight: bold;">float</span>(vmax)
<span style="color: #b9d3ee;">for</span> imid, specid, _, ra0, dec0, dy, PA, _, weight, delta <span style="color: #b9d3ee;">in</span> htab:
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Unpack floats from strings in table row</span>
    <span style="color: #dfaf8f;">ra0</span>, <span style="color: #dfaf8f;">dec0</span>, <span style="color: #dfaf8f;">dy</span>, <span style="color: #dfaf8f;">PA</span>, <span style="color: #dfaf8f;">weight</span>, <span style="color: #dfaf8f;">delta</span> = [<span style="color: #DCDCCC; font-weight: bold;">float</span>(_) <span style="color: #b9d3ee;">for</span> _ <span style="color: #b9d3ee;">in</span> (ra0, dec0, dy, PA, weight, delta)]
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Open H alpha slit spectrum</span>
    spechdu, = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">'spec{:03d}-ha.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(specid))

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Create velocity array from header</span>
    <span style="color: #dfaf8f;">nwav</span>, <span style="color: #dfaf8f;">k0</span>, <span style="color: #dfaf8f;">wav0</span>, <span style="color: #dfaf8f;">dwav</span> = [spechdu.header[kwd+<span style="color: #eee8aa; font-style: italic;">'2'</span>]
                            <span style="color: #b9d3ee;">for</span> kwd <span style="color: #b9d3ee;">in</span> (<span style="color: #eee8aa; font-style: italic;">'NAXIS'</span>, <span style="color: #eee8aa; font-style: italic;">'CRPIX'</span>, <span style="color: #eee8aa; font-style: italic;">'CRVAL'</span>, <span style="color: #eee8aa; font-style: italic;">'CDELT'</span>)]
    <span style="color: #dfaf8f;">wavs</span> = wav0 + (np.arange(nwav) - k0 + 1)*dwav
    <span style="color: #dfaf8f;">vels</span> = heliocentric_correction + light_speed*(wavs - wavrest)/wavrest
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Find indices corresponding to velocity limits</span>
    <span style="color: #dfaf8f;">k1</span> = (vels &lt; vmin).<span style="color: #DCDCCC; font-weight: bold;">sum</span>()
    <span style="color: #dfaf8f;">k2</span> = (vels &lt;= vmax).<span style="color: #DCDCCC; font-weight: bold;">sum</span>()
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">print('Velocities used', vels[k1:k2])</span>

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Sum spectrum over all wavelengths</span>
    <span style="color: #dfaf8f;">profile</span> = spechdu.data[k1:k2, :].<span style="color: #DCDCCC; font-weight: bold;">sum</span>(axis=0)

    <span style="color: #dfaf8f;">NY</span> = spechdu.header[<span style="color: #eee8aa; font-style: italic;">'NAXIS1'</span>]
    <span style="color: #dfaf8f;">yy</span> = np.arange(NY)/NY - 0.5
    <span style="color: #dfaf8f;">grad_corr</span> = 1.0 + delta*yy


    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Transform output grid coords into slit frame offsets in arcsec</span>
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">XX, YY are intermediate offset coordinates along RA, Dec axes</span>
    <span style="color: #dfaf8f;">XX</span> = 3600*(RA - ra0)*np.cos(np.radians(Dec))
    <span style="color: #dfaf8f;">YY</span> = 3600*(Dec - dec0)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Precalculate geometric factors for rotation to slit frame</span>
    <span style="color: #dfaf8f;">c</span>, <span style="color: #dfaf8f;">s</span> = np.cos(np.radians(PA)), np.sin(np.radians(PA))
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">X is ordinate perpendicular to slit</span>
    <span style="color: #dfaf8f;">X</span> = XX*c - YY*s
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Y is ordinate along slit</span>
    <span style="color: #dfaf8f;">Y</span> = -(YY*c - XX*s)

    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Mask for all output pixels that fall in the slit</span>
    <span style="color: #dfaf8f;">slitmask</span> = <span style="color: #DCDCCC; font-weight: bold;">abs</span>(X) &lt;= 0.5*slit_width
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">cycle over all slit y pixels</span>
    <span style="color: #b9d3ee;">for</span> j, (intensity, gcorr) <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">enumerate</span>(<span style="color: #DCDCCC; font-weight: bold;">zip</span>(profile, grad_corr)):
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Offset from slit center</span>
        <span style="color: #dfaf8f;">y</span> = (j - 0.5*(NY-1))*dy
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Mask for output pixels that fall in this slit pixel</span>
        <span style="color: #dfaf8f;">pixmask</span> = slitmask &amp; (<span style="color: #DCDCCC; font-weight: bold;">abs</span>(Y - y) &lt;= 0.5*dy)
        <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Fill in the output intensity and weight arrays</span>
        <span style="color: #dfaf8f;">outimage</span>[pixmask] += intensity
        <span style="color: #dfaf8f;">outweights</span>[pixmask] += weight/gcorr

<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Save everything as different images in a single fits file:</span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">1. The sum of the raw slits </span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">2. The weights</span>
<span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">3. The slits normalized by the weights</span>
fits.HDUList([
    fits.PrimaryHDU(),
    fits.ImageHDU(header=w.to_header(), data=outimage, name=<span style="color: #eee8aa; font-style: italic;">'slits'</span>),
    fits.ImageHDU(header=w.to_header(), data=outweights, name=<span style="color: #eee8aa; font-style: italic;">'weight'</span>),
    fits.ImageHDU(header=w.to_header(), data=outimage/outweights, name=<span style="color: #eee8aa; font-style: italic;">'scaled'</span>),
    ]).writeto(<span style="color: #eee8aa; font-style: italic;">'all-horiz-{}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(label), clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>

<p>
This shows the scaled image in ds9
</p>
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-horiz-sum.fits[3]
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline114" class="outline-4">
<h4 id="orgheadline114"><span class="section-number-4">10.3.4</span> <span class="todo TODO">TODO</span> Correction for heliocentric velocity</h4>
<div class="outline-text-4" id="text-10-3-4">
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2015-08-23 Sun] </span></span> I haven't done this yet</li>
<li>I have it in a table for the 2013 observations, but need to calculate it for the others</li>
<li>Plan is to base on what I did before:
<ul class="org-ul">
<li>For Keck spectra <a href="../KeckProplyd/keck-revisited.html#ID-1772B088-D07A-4228-95D4-14F9C3529EC1">here</a></li>
<li>And for HST <a href="../../Work/RubinWFC3/Tsquared/orion-t2.html#ID-5D00EFD4-5F66-4075-B89D-1AFCF3A73B70">here</a></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline115" class="outline-4">
<h4 id="orgheadline115"><span class="section-number-4">10.3.5</span> Try to use different velocity ranges</h4>
<div class="outline-text-4" id="text-10-3-5">
<ul class="org-ul">
<li>It would be more efficient to do these all at the sane time, but for the time being I will do them separately</li>
<li>Although the noisiest slit looked fine on the integrated maps, it makes a mess of the velocity channels where the emission is faint</li>
</ul>

<ul class="org-ul">
<li>145</li>
</ul>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-blue.fits[3]
</pre>
</div>

<ul class="org-ul">
<li>Try some blue wing 20 km/s channels</li>

<li>And some line core channels</li>
</ul>
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 rgb new
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b30.fits[3]
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b50.fits[3]
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b70.fits[3]
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 rgb new
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-r30.fits[3]
xpaset -p ds9 scale linear
xpaset -p ds9 scale limits 0 50000
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-r10.fits[3]
xpaset -p ds9 scale linear
xpaset -p ds9 scale limits 0 15000
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b10.fits[3]
xpaset -p ds9 scale linear
xpaset -p ds9 scale limits 0 6000
</pre>
</div>


<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 rgb new
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b30-bin016.fits[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>]
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b50-bin016.fits[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>]
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b70-bin016.fits[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>]
</pre>
</div>


<ul class="org-ul">
<li>Display the multigrid smoothed channel maps</li>
</ul>
<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 rgb new
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b30-multibin.fits
xpaset -p ds9 scale linear
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b50-multibin.fits
xpaset -p ds9 scale linear
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b70-multibin.fits
xpaset -p ds9 scale linear
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 rgb new
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-r30-multibin.fits
xpaset -p ds9 scale linear
xpaset -p ds9 scale limits 0 50000
xpaset -p ds9 rgb green
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-r10-multibin.fits
xpaset -p ds9 scale linear
xpaset -p ds9 scale limits 0 15000
xpaset -p ds9 rgb blue
xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-b10-multibin.fits
xpaset -p ds9 scale linear
xpaset -p ds9 scale limits 0 6000
</pre>
</div>
</div>
</div>




<div id="outline-container-orgheadline116" class="outline-4">
<h4 id="orgheadline116"><span class="section-number-4">10.3.6</span> Combine both the horizontal and vertical slits</h4>
<div class="outline-text-4" id="text-10-3-6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #dfaf8f;">scale</span> = 1.8
<span style="color: #dfaf8f;">horiz</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">'../SPMFEB13/WesternShocks/all-horiz-sum.fits'</span>)
<span style="color: #dfaf8f;">vert</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(<span style="color: #eee8aa; font-style: italic;">'../SPMJAN10/reducciones/all-vert-sum.fits'</span>)
horiz[<span style="color: #eee8aa; font-style: italic;">'slits'</span>]<span style="color: #dfaf8f;">.data</span> += vert[<span style="color: #eee8aa; font-style: italic;">'slits'</span>].data/scale
horiz[<span style="color: #eee8aa; font-style: italic;">'weight'</span>]<span style="color: #dfaf8f;">.data</span> += vert[<span style="color: #eee8aa; font-style: italic;">'weight'</span>].data
horiz[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>]<span style="color: #dfaf8f;">.data</span> = horiz[<span style="color: #eee8aa; font-style: italic;">'slits'</span>].data/horiz[<span style="color: #eee8aa; font-style: italic;">'weight'</span>].data
horiz.writeto(<span style="color: #eee8aa; font-style: italic;">'all-slits-sum.fits'</span>, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>

<pre class="example">
None
</pre>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-slits-sum.fits[3]
</pre>
</div>


<ul class="org-ul">
<li>Note that we have to explicitly set the working directory for this to work
<ul class="org-ul">
<li>It is not enough that <code>dir</code> is set for this subtree</li>
</ul></li>
</ul>
<pre class="example">
Saving all-slits-sum-bin001.fits
Saving all-slits-sum-bin002.fits
Saving all-slits-sum-bin004.fits
Saving all-slits-sum-bin008.fits
Saving all-slits-sum-bin016.fits
Saving all-slits-sum-bin032.fits
</pre>


<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-slits-sum-bin032.fits[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>]
</pre>
</div>


<p>
Now we do the multiresolution maps for the combined data.  For the moment, just the spectrally integrated emission
</p>

<ul class="org-ul">
<li>sum</li>
</ul>

<p>
We need to extend the largest pixels used up to 32x32 in order to fill in all the big gaps between the horizontal slits 
</p>
<table id="orgtable3" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">8</td>
<td class="org-right">16</td>
<td class="org-right">32</td>
</tr>

<tr>
<td class="org-right">2.0</td>
<td class="org-right">2.0</td>
<td class="org-right">2.0</td>
<td class="org-right">2.0</td>
<td class="org-right">2.0</td>
<td class="org-right">4.0</td>
</tr>
</tbody>
</table>

<p>
We can use the <code>imscale</code> parameter to adjust the resolution of the map.  If <code>imscale</code> is larger then we need a higher total flux for a pixel to be accepted, so we will end up with larger pixels 
</p>

<pre class="example">
.+..+..+..+..+..+..+..+..+..+..+..+.
Channel sum
Binning 32 - pixels used 217088
Binning 16 - pixels used 183296
Binning 8 - pixels used 76224
Binning 4 - pixels used 6448
Binning 2 - pixels used 16
Binning 1 - pixels used 0
</pre>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-slits-sum-multibin.fits
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline118" class="outline-3">
<h3 id="orgheadline118"><span class="section-number-3">10.4</span> The multigrid smoothing method</h3>
<div class="outline-text-3" id="text-10-4">
<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock13"><span style="color: #b9d3ee;">import</span> sys
sys.path.append(<span style="color: #eee8aa; font-style: italic;">'/Users/will/Work/RubinWFC3/Tsquared'</span>)
<span style="color: #b9d3ee;">from</span> rebin_utils <span style="color: #b9d3ee;">import</span> downsample, oversample
<span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits

<span style="color: #dfaf8f;">nlist</span> = [1, 2, 4, 8, 16, 32]

<span style="color: #dfaf8f;">infile</span> = <span style="color: #eee8aa; font-style: italic;">'all-{}-{}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(slits, label)

<span style="color: #dfaf8f;">hdulist</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(infile)
<span style="color: #dfaf8f;">hdr</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>].header
<span style="color: #dfaf8f;">im</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>].data
<span style="color: #dfaf8f;">w</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'weight'</span>].data
<span style="color: #dfaf8f;">m</span> = w &gt; 0.0

<span style="color: #b9d3ee;">for</span> n <span style="color: #b9d3ee;">in</span> nlist:
    <span style="color: #dfaf8f;">im</span>[~m] = 0.0
    <span style="color: #dfaf8f;">outfile</span> = infile.replace(<span style="color: #eee8aa; font-style: italic;">'.fits'</span>, <span style="color: #eee8aa; font-style: italic;">'-bin{:03d}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(n))
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Saving'</span>, outfile)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Save both the scaled image and the weights, but at the full resolution</span>
    fits.HDUList([
        fits.PrimaryHDU(),
        fits.ImageHDU(data=oversample(im, n), header=hdr, name=<span style="color: #eee8aa; font-style: italic;">'scaled'</span>),
        fits.ImageHDU(data=oversample(w, n), header=hdr, name=<span style="color: #eee8aa; font-style: italic;">'weight'</span>),
    ]).writeto(outfile, clobber=<span style="color: #cFfBcF;">True</span>)
    <span style="color: #5F7F5F;"># </span><span style="color: #8b8b83; font-style: italic;">Now do the rebinning by a factor of two</span>
    [im,], <span style="color: #dfaf8f;">m</span>, <span style="color: #dfaf8f;">w</span> = downsample([im,], m, weights=w)
</pre>
</div>

<pre class="example">
Saving all-vert-sum-bin001.fits
Saving all-vert-sum-bin002.fits
Saving all-vert-sum-bin004.fits
Saving all-vert-sum-bin008.fits
Saving all-vert-sum-bin016.fits
Saving all-vert-sum-bin032.fits
</pre>

<div class="org-src-container">

<pre class="src src-sh">xpaset -p ds9 fits $<span style="color: #dfaf8f;">PWD</span>/all-vert-sum-bin016.fits[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>]
</pre>
</div>

<ul class="org-ul">
<li>Unfortunately, the weights increase a lot with the binning - more than they ought to.</li>
<li>The problem is that the pixels at the finest grid levels are not independent, since many of them come from the same pixel of the slit spectrum</li>
<li>However, the algorithm does not know this and so adds them up when it rebins to the next coarser grid</li>
<li>This will be a problem if we want to combine the different levels and impose a minimum weight
<ul class="org-ul">
<li>An easy solution would be to have the minimum weight vary per level</li>
</ul></li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #dfaf8f;">nlist</span> = [1, 2, 4, 8, 16]
<span style="color: #dfaf8f;">minweights</span> = [0.5, 1.0, 2.0, 2.0, 2.0, 2.0]
<span style="color: #dfaf8f;">outim</span> = np.zeros((1024, 1024))
<span style="color: #b9d3ee;">for</span> n, minw <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">reversed</span>(<span style="color: #DCDCCC; font-weight: bold;">list</span>(<span style="color: #DCDCCC; font-weight: bold;">zip</span>(nlist, minweights))):
    <span style="color: #dfaf8f;">fn</span> = <span style="color: #eee8aa; font-style: italic;">'all-vert-sum-bin{:03d}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(n)
    <span style="color: #dfaf8f;">hdulist</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(fn)
    <span style="color: #dfaf8f;">im</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>].data
    <span style="color: #dfaf8f;">hdr</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>].header
    <span style="color: #dfaf8f;">w</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'weight'</span>].data
    <span style="color: #dfaf8f;">m</span> = w*im &gt;= minw*1e5
    <span style="color: #dfaf8f;">outim</span>[m] = im[m]
fits.PrimaryHDU(header=hdr, data=outim).writeto(<span style="color: #eee8aa; font-style: italic;">'all-vert-sum-multibin.fits'</span>, clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>


<p>
And here is a version for the velocity channels
</p>

<ul class="org-ul">
<li>r30</li>
<li>r10</li>
<li>b10</li>
<li>b30</li>
<li>b50</li>
<li>b70</li>
</ul>


<table id="orgtable4" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">8</td>
<td class="org-right">16</td>
</tr>

<tr>
<td class="org-right">0.5</td>
<td class="org-right">1.0</td>
<td class="org-right">2.0</td>
<td class="org-right">2.0</td>
<td class="org-right">2.0</td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-python" id="orgsrcblock14"><span style="color: #b9d3ee;">from</span> astropy.io <span style="color: #b9d3ee;">import</span> fits
<span style="color: #b9d3ee;">import</span> numpy <span style="color: #b9d3ee;">as</span> np
<span style="color: #dfaf8f;">nlist</span>, <span style="color: #dfaf8f;">minweights</span> = wtab
<span style="color: #dfaf8f;">outim</span> = np.zeros((1024, 1024))
<span style="color: #b9d3ee;">for</span> label <span style="color: #b9d3ee;">in</span> labels:
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'.+.'</span>*12)
    <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Channel'</span>, label)
    <span style="color: #b9d3ee;">for</span> n, minw <span style="color: #b9d3ee;">in</span> <span style="color: #DCDCCC; font-weight: bold;">reversed</span>(<span style="color: #DCDCCC; font-weight: bold;">list</span>(<span style="color: #DCDCCC; font-weight: bold;">zip</span>(nlist, minweights))):
        <span style="color: #dfaf8f;">fn</span> = <span style="color: #eee8aa; font-style: italic;">'all-{}-{}-bin{:03d}.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(slits, label, n)
        <span style="color: #dfaf8f;">hdulist</span> = fits.<span style="color: #DCDCCC; font-weight: bold;">open</span>(fn)
        <span style="color: #dfaf8f;">im</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>].data
        <span style="color: #dfaf8f;">hdr</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'scaled'</span>].header
        <span style="color: #dfaf8f;">w</span> = hdulist[<span style="color: #eee8aa; font-style: italic;">'weight'</span>].data
        <span style="color: #dfaf8f;">m</span> = w*im &gt;= minw*imscale
        <span style="color: #b9d3ee;">print</span>(<span style="color: #eee8aa; font-style: italic;">'Binning'</span>, n, <span style="color: #eee8aa; font-style: italic;">'- pixels used'</span>, m.<span style="color: #DCDCCC; font-weight: bold;">sum</span>())
        <span style="color: #dfaf8f;">outim</span>[m] = im[m]
    fits.PrimaryHDU(header=hdr, data=outim).writeto(
        <span style="color: #eee8aa; font-style: italic;">'all-{}-{}-multibin.fits'</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(slits, label), clobber=<span style="color: #cFfBcF;">True</span>)
</pre>
</div>

<pre class="example">
.+..+..+..+..+..+..+..+..+..+..+..+.
Channel r30
Binning 16 - pixels used 101120
Binning 8 - pixels used 86400
Binning 4 - pixels used 62144
Binning 2 - pixels used 44500
Binning 1 - pixels used 35532
.+..+..+..+..+..+..+..+..+..+..+..+.
Channel r10
Binning 16 - pixels used 100608
Binning 8 - pixels used 86144
Binning 4 - pixels used 61968
Binning 2 - pixels used 44408
Binning 1 - pixels used 35471
.+..+..+..+..+..+..+..+..+..+..+..+.
Channel b10
Binning 16 - pixels used 99840
Binning 8 - pixels used 82112
Binning 4 - pixels used 39872
Binning 2 - pixels used 21452
Binning 1 - pixels used 6119
.+..+..+..+..+..+..+..+..+..+..+..+.
Channel b30
Binning 16 - pixels used 98560
Binning 8 - pixels used 72832
Binning 4 - pixels used 22928
Binning 2 - pixels used 8888
Binning 1 - pixels used 2342
.+..+..+..+..+..+..+..+..+..+..+..+.
Channel b50
Binning 16 - pixels used 98048
Binning 8 - pixels used 69888
Binning 4 - pixels used 20272
Binning 2 - pixels used 7752
Binning 1 - pixels used 3025
.+..+..+..+..+..+..+..+..+..+..+..+.
Channel b70
Binning 16 - pixels used 95744
Binning 8 - pixels used 61568
Binning 4 - pixels used 12800
Binning 2 - pixels used 3424
Binning 1 - pixels used 1135
</pre>
</div>
</div>


<div id="outline-container-orgheadline123" class="outline-3">
<h3 id="orgheadline123"><span class="section-number-3">10.5</span> Coordinates of the slits</h3>
<div class="outline-text-3" id="text-10-5">
<ul class="org-ul">
<li>Data received from Alba <span class="timestamp-wrapper"><span class="timestamp">[2015-08-11 Tue]</span></span></li>
</ul>
</div>

<div id="outline-container-orgheadline119" class="outline-4">
<h4 id="orgheadline119"><span class="section-number-4">10.5.1</span> Description from Alba</h4>
<div class="outline-text-4" id="text-10-5-1">
<pre class="example">
Todos los datos estn en:
/fs/posgrado01/other0/albafm/WesternShocks/3.CuboWS/0.Datos
Diferencio entre especros e imagenes y luego entre los del 2010 (verticales) y
2013 (horizontales)
Todos los espectros tienen la sustraccion del continuo (*nc*) y los del 2010
adems tiene el factor de calidad (aplicado entre ellos y a todos los de esa
campaa de observacion, son *cc*fits)

Por ultimo te adjunto tabla las coordenadas de cada posicion de las rendijas.
</pre>
</div>
</div>



<div id="outline-container-orgheadline120" class="outline-4">
<h4 id="orgheadline120"><span class="section-number-4">10.5.2</span> Brightness correction factors</h4>
<div class="outline-text-4" id="text-10-5-2">
<ul class="org-ul">
<li>The 2010 data in <code>3.CuboWS/0.Datos</code> are <code>.nc.cc.</code> have already had this applied</li>
<li>The prior stage (just <code>.nc.</code>) is in <code>2.Datos2010/1.PreparandoDatos/1.SustraccionContinuo</code></li>
<li>The factors are in <a href="file://ssh:nil:/fs/posgrado01/other0/albafm/WesternShocks/2.Datos2010/1.PreparandoDatos/2.IgualandoCalidad/intensidades.dat">intensidades.dat</a>
<ul class="org-ul">
<li>Transposed version of this table below</li>
<li>The factors multiply the observed intensities</li>
</ul></li>
<li>The 2013 data don't seem to have any brightness correction</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Imagen</th>
<th scope="col" class="org-right">I. original</th>
<th scope="col" class="org-right">I. corregida</th>
<th scope="col" class="org-right">Factor</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">101</td>
<td class="org-right">2149.52</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.01435</td>
</tr>

<tr>
<td class="org-right">124</td>
<td class="org-right">1936.37</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.12601</td>
</tr>

<tr>
<td class="org-right">128</td>
<td class="org-right">1567.50</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.39099</td>
</tr>

<tr>
<td class="org-right">133</td>
<td class="org-right">1814.61</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.20156</td>
</tr>

<tr>
<td class="org-right">137</td>
<td class="org-right">1939.18</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.12438</td>
</tr>

<tr>
<td class="org-right">145</td>
<td class="org-right">1361.85</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.60103</td>
</tr>

<tr>
<td class="org-right">157</td>
<td class="org-right">1323.03</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.64801</td>
</tr>

<tr>
<td class="org-right">173</td>
<td class="org-right">1249.18</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.74544</td>
</tr>

<tr>
<td class="org-right">202</td>
<td class="org-right">2170.67</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.00447</td>
</tr>

<tr>
<td class="org-right">206</td>
<td class="org-right">2169.70</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.00492</td>
</tr>

<tr>
<td class="org-right">210</td>
<td class="org-right">2211.48</td>
<td class="org-right">2180.37</td>
<td class="org-right">0.98594</td>
</tr>

<tr>
<td class="org-right">214</td>
<td class="org-right">2231.37</td>
<td class="org-right">2180.37</td>
<td class="org-right">0.97715</td>
</tr>

<tr>
<td class="org-right">219</td>
<td class="org-right">2226.34</td>
<td class="org-right">2180.37</td>
<td class="org-right">0.97935</td>
</tr>

<tr>
<td class="org-right">236</td>
<td class="org-right">2184.94</td>
<td class="org-right">2180.37</td>
<td class="org-right">0.99791</td>
</tr>

<tr>
<td class="org-right">240</td>
<td class="org-right">2186.48</td>
<td class="org-right">2180.37</td>
<td class="org-right">0.99720</td>
</tr>

<tr>
<td class="org-right">244</td>
<td class="org-right">2150.31</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.01398</td>
</tr>

<tr>
<td class="org-right">248</td>
<td class="org-right">1632.71</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.33543</td>
</tr>

<tr>
<td class="org-right">252</td>
<td class="org-right">1816.34</td>
<td class="org-right">2180.37</td>
<td class="org-right">1.20042</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline121" class="outline-4">
<h4 id="orgheadline121"><span class="section-number-4">10.5.3</span> HORIZONTALES 2013</h4>
<div class="outline-text-4" id="text-10-5-3">
<table id="orgtable5" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">imagen</th>
<th scope="col" class="org-left">Espectro</th>
<th scope="col" class="org-right">AR</th>
<th scope="col" class="org-right">DEC</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">spm165</td>
<td class="org-left">spec166</td>
<td class="org-right">83.6141</td>
<td class="org-right">-5.4409</td>
</tr>

<tr>
<td class="org-left">spm169</td>
<td class="org-left">spec170</td>
<td class="org-right">83.6146</td>
<td class="org-right">-5.4382</td>
</tr>

<tr>
<td class="org-left">spm237</td>
<td class="org-left">spec238</td>
<td class="org-right">83.6166</td>
<td class="org-right">-5.4361</td>
</tr>

<tr>
<td class="org-left">spm232</td>
<td class="org-left">spec233</td>
<td class="org-right">83.6157</td>
<td class="org-right">-5.4321</td>
</tr>

<tr>
<td class="org-left">spm226</td>
<td class="org-left">spec227</td>
<td class="org-right">83.6076</td>
<td class="org-right">-5.4294</td>
</tr>

<tr>
<td class="org-left">spm149</td>
<td class="org-left">spec150</td>
<td class="org-right">83.6231</td>
<td class="org-right">-5.4239</td>
</tr>

<tr>
<td class="org-left">spm154</td>
<td class="org-left">spec155</td>
<td class="org-right">83.6237</td>
<td class="org-right">-5.4226</td>
</tr>

<tr>
<td class="org-left">spm159</td>
<td class="org-left">spec160</td>
<td class="org-right">83.6238</td>
<td class="org-right">-5.4201</td>
</tr>

<tr>
<td class="org-left">spm033</td>
<td class="org-left">spec034</td>
<td class="org-right">83.6107</td>
<td class="org-right">-5.4165</td>
</tr>

<tr>
<td class="org-left">spm029</td>
<td class="org-left">spec030</td>
<td class="org-right">83.6084</td>
<td class="org-right">-5.4155</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">83.6158 +/- 0.0019</td>
<td class="org-right">-5.4275 +/- 0.0029</td>
</tr>
</tbody>
</table>
</div>
</div>



<div id="outline-container-orgheadline122" class="outline-4">
<h4 id="orgheadline122"><span class="section-number-4">10.5.4</span> VERTICALES 2010</h4>
<div class="outline-text-4" id="text-10-5-4">
<ul class="org-ul">
<li>From the region file <a href="file://ssh:nil:/fs/posgrado01/other0/albafm/WesternShocks/3.CuboWS/1.Posiciones/pos_todas.reg">pos_todas.reg</a> it looks like the PA = 3.03 deg</li>
</ul>

<table id="orgtable6" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">imagen</th>
<th scope="col" class="org-left">Espectro</th>
<th scope="col" class="org-right">AR</th>
<th scope="col" class="org-right">DEC</th>
<th scope="col" class="org-right">Factor</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">spm252</td>
<td class="org-left">spec253</td>
<td class="org-right">83.6016</td>
<td class="org-right">-5.4149</td>
<td class="org-right">1.20042</td>
</tr>

<tr>
<td class="org-left">spm173</td>
<td class="org-left">spec174</td>
<td class="org-right">83.6020</td>
<td class="org-right">-5.4108</td>
<td class="org-right">1.74544</td>
</tr>

<tr>
<td class="org-left">spm244</td>
<td class="org-left">spec245</td>
<td class="org-right">83.6031</td>
<td class="org-right">-5.4152</td>
<td class="org-right">1.01398</td>
</tr>

<tr>
<td class="org-left">spm240</td>
<td class="org-left">spec241</td>
<td class="org-right">83.6053</td>
<td class="org-right">-5.4153</td>
<td class="org-right">0.99720</td>
</tr>

<tr>
<td class="org-left">spm236</td>
<td class="org-left">spec237</td>
<td class="org-right">83.6071</td>
<td class="org-right">-5.4155</td>
<td class="org-right">0.99791</td>
</tr>

<tr>
<td class="org-left">spm157</td>
<td class="org-left">spec158</td>
<td class="org-right">83.6078</td>
<td class="org-right">-5.4118</td>
<td class="org-right">1.64801</td>
</tr>

<tr>
<td class="org-left">spm219</td>
<td class="org-left">spec220</td>
<td class="org-right">83.6087</td>
<td class="org-right">-5.4163</td>
<td class="org-right">0.97935</td>
</tr>

<tr>
<td class="org-left">spm248</td>
<td class="org-left">spec249</td>
<td class="org-right">83.6091</td>
<td class="org-right">-5.4150</td>
<td class="org-right">1.33543</td>
</tr>

<tr>
<td class="org-left">spm145</td>
<td class="org-left">spec146</td>
<td class="org-right">83.6106</td>
<td class="org-right">-5.4109</td>
<td class="org-right">1.60103</td>
</tr>

<tr>
<td class="org-left">spm214</td>
<td class="org-left">spec215</td>
<td class="org-right">83.6119</td>
<td class="org-right">-5.4160</td>
<td class="org-right">0.97715</td>
</tr>

<tr>
<td class="org-left">spm137</td>
<td class="org-left">spec138</td>
<td class="org-right">83.6133</td>
<td class="org-right">-5.4120</td>
<td class="org-right">1.12438</td>
</tr>

<tr>
<td class="org-left">spm210</td>
<td class="org-left">spec211</td>
<td class="org-right">83.6143</td>
<td class="org-right">-5.4163</td>
<td class="org-right">0.98594</td>
</tr>

<tr>
<td class="org-left">spm101</td>
<td class="org-left">spec102</td>
<td class="org-right">83.6149</td>
<td class="org-right">-5.4177</td>
<td class="org-right">1.01435</td>
</tr>

<tr>
<td class="org-left">spm128</td>
<td class="org-left">spec129</td>
<td class="org-right">83.6156</td>
<td class="org-right">-5.4181</td>
<td class="org-right">1.39099</td>
</tr>

<tr>
<td class="org-left">spm133</td>
<td class="org-left">spec134</td>
<td class="org-right">83.6159</td>
<td class="org-right">-5.4123</td>
<td class="org-right">1.20156</td>
</tr>

<tr>
<td class="org-left">spm206</td>
<td class="org-left">spec207</td>
<td class="org-right">83.6171</td>
<td class="org-right">-5.4165</td>
<td class="org-right">1.00492</td>
</tr>

<tr>
<td class="org-left">spm124</td>
<td class="org-left">spec125</td>
<td class="org-right">83.6184</td>
<td class="org-right">-5.4183</td>
<td class="org-right">1.12601</td>
</tr>

<tr>
<td class="org-left">spm202</td>
<td class="org-left">spec203</td>
<td class="org-right">83.6205</td>
<td class="org-right">-5.4167</td>
<td class="org-right">1.00447</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">83.6110 +/- 0.0014</td>
<td class="org-right">-5.4150 +/- 0.0006</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: William Henney</p>
<p class="date">Created: 2015-10-06 Tue 11:51</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
